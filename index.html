<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Python Destiled</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div id="sbo-rt-content">

      <section epub:type="chapter">
        <h2 class="h2" id="ch01">
          <span epub:type="pagebreak" id="page_1"></span
          ><span class="ash">1.</span> Python Basics
        </h2>
        <p class="noindent">
          This chapter gives an overview of the core of the Python language. It
          covers variables, data types, expressions, control flow, functions,
          classes, and input/output. The chapter concludes with a discussion of
          modules, script writing, packages, and a few tips on organizing larger
          programs. This chapter is not trying to provide comprehensive coverage
          of every feature, nor does it concern itself with all of the tooling
          that might surround a larger Python project. However, experienced
          programmers should be able to extrapolate from the material here to
          write more advanced programs. Newcomers are encouraged to try the
          examples in a simple environment, such as a terminal window and a
          basic text editor.
        </p>
        <section>
          <h3 class="h3" id="ch01lev1sec1">1.1 Running Python</h3>
          <p class="noindent">
            Python programs are executed by an interpreter. There are many
            different environments in which the Python interpreter might run—an
            IDE, a browser, or a terminal window. However, underneath all that,
            the core of the interpreter is a text-based application that can be
            started by typing <code>python</code> in a command shell such as
            <code>bash</code>. Since Python 2 and Python 3 might both be
            installed on the same machine, you might need to type
            <code>python2</code> or <code>python3</code> to pick a version. This
            book assumes Python 3.8 or newer.
          </p>
          <p class="indent">
            When the interpreter starts, a prompt appears where you can type
            programs into a so-called “read-evaluation-print loop” (or REPL).
            For example, in the following output, the interpreter displays its
            copyright message and presents the user with the
            <code>&gt;&gt;&gt;</code> prompt, at which the user types a familiar
            “Hello World” program:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0001-01" id="f0001-01"
              >Click here to view code image</a
            >
          </p>
          <pre>
Python 3.8.0 (default, Feb 3 2019, 05:53:21)
        [GCC 4.2.1 Compatible Apple LLVM 8.0.0 (clang-800.0.38)] on darwin
        Type "help", "copyright", "credits" or "license" for more information.
        &gt;&gt;&gt; print('Hello World')
        Hello World
        &gt;&gt;&gt;</pre
          >
          <p class="indent">
            <span epub:type="pagebreak" id="page_2"></span>Certain environments
            may display a different prompt. The following output is from
            <code>ipython</code> (an alternate shell for Python):
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0002-01" id="f0002-01"
              >Click here to view code image</a
            >
          </p>
          <pre>
Python 3.8.0 (default, Feb 4, 2019, 07:39:16)
        Type 'copyright', 'credits' or 'license' for more information
        IPython 6.5.0 -- An enhanced Interactive Python. Type '?' for help.
        
        In [1]: print('Hello World')
        Hello World
        
        In [2]:</pre
          >
          <p class="indent">
            Regardless of the exact form of output you see, the underlying
            principle is the same. You type a command, it runs, and you
            immediately see the output.
          </p>
          <p class="indent">
            Python’s interactive mode is one of its most useful features because
            you can type any valid statement and immediately see the result.
            This is useful for debugging and experimentation. Many people,
            including the author, use interactive Python as their desktop
            calculator. For example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0002-02" id="f0002-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; 6000 + 4523.50 + 134.25
        10657.75
        &gt;&gt;&gt; _ + 8192.75
        18850.5
        &gt;&gt;&gt;</pre
          >
          <p class="indent">
            When you use Python interactively, the variable <code>_</code> holds
            the result of the last operation. This is useful if you want to use
            that result in subsequent statements. This variable only gets
            defined when working interactively, so don’t use it in saved
            programs.
          </p>
          <p class="indent">
            You can exit the interactive interpreter by typing
            <code>quit()</code> or the EOF (end of file) character. On UNIX, EOF
            is Ctrl+D; on Windows, it’s Ctrl+Z.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch01lev1sec2">1.2 Python Programs</h3>
          <p class="noindent">
            If you want to create a program that you can run repeatedly, put
            statements in a text file. For example:
          </p>
          <pre><span class="hblue"># hello.py</span>
        print(<span class="mblue">'Hello World'</span>)</pre>
          <p class="indent">
            Python source files are UTF-8-encoded text files that normally have
            a <code>.py</code> suffix. The <code>#</code> character denotes a
            comment that extends to the end of the line. International (Unicode)
            characters can be freely used in the source code as long as you use
            the UTF-8 encoding (this is the default in most editors, but it
            never hurts to check your editor settings if you’re unsure).
          </p>
          <p class="indent">
            <span epub:type="pagebreak" id="page_3"></span>To execute the
            <code>hello.py</code> file, provide the filename to the interpreter
            as follows:
          </p>
          <pre>
shell % python3 hello.py
        Hello World
        shell %</pre
          >
          <p class="indent">
            It is common to use <code>#!</code> to specify the interpreter on
            the first line of a program, like this:
          </p>
          <pre><span class="hblue">#!/usr/bin/env python3</span>
        print(<span class="mblue">'Hello World'</span>)</pre>
          <p class="indent">
            On UNIX, if you give this file execute permissions (for example, by
            <code>chmod +x hello.py</code>), you can run the program by typing
            <code>hello.py</code> into your shell.
          </p>
          <p class="indent">
            On Windows, you can double-click on a <code>.py</code> file or type
            the name of the program into the Run command on the Windows Start
            menu to launch it. The <code>#!</code> line, if given, is used to
            pick the interpreter version (Python 2 versus 3). Execution of a
            program might take place in a console window that disappears
            immediately after the program completes— often before you can read
            its output. For debugging, it’s better to run the program within a
            Python development environment.
          </p>
          <p class="indent">
            The interpreter runs statements in order until it reaches the end of
            the input file. At that point, the program terminates and Python
            exits.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch01lev1sec3">
            1.3 Primitives, Variables, and Expressions
          </h3>
          <p class="noindent">
            Python provides a collection of primitive types such as integers,
            floats, and strings:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0003-03" id="f0003-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="sgreen">42</span>               <span class="hblue"># int</span>
        <span class="sgreen">4.2</span>              <span class="hblue"># float</span>
        <span class="hblue">'forty-two'      # str</span>
        <span class="dblue">True</span>             <span class="hblue"># bool</span></pre>
          <p class="indent">
            A variable is a name that refers to a value. A value represents an
            object of some type:
          </p>
          <pre>x <span class="igrey">=</span> <span class="sgreen">42</span></pre>
          <p class="indent">
            Sometimes you might see a type explicitly attached to a name. For
            example:
          </p>
          <pre>x: int <span class="igrey">=</span> <span class="sgreen">42</span></pre>
          <p class="indent">
            The type is merely a hint to improve code readability. It can be
            used by third-party code-checking tools. Otherwise, it is completely
            ignored. It does not prevent you from assigning a different kind of
            value later.
          </p>
          <p class="indent">
            An expression is a combination of primitives, names, and operators
            that produces a value:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0003-06" id="f0003-06"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="sgreen">2</span> <span class="igrey">+</span> <span class="sgreen">3</span> <span class="igrey">*</span> <span class="sgreen">4</span>            <span class="hblue"># -&gt; 14</span></pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_4"></span>The following program
            uses variables and expressions to perform a compound-interest
            calculation:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0004-01" id="f0004-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># interest.py</span>
        
        principal <span class="igrey">=</span> <span class="sgreen">1000</span>        <span class="hblue"># Initial amount</span>
        rate <span class="igrey">=</span> <span class="sgreen">0.05</span>             <span class="hblue"># Interest rate</span>
        numyears <span class="igrey">=</span> <span class="sgreen">5</span>            <span class="hblue"># Number of years</span>
        year <span class="igrey">=</span> <span class="sgreen">1</span>
        <span class="lgreen"><strong>while</strong></span> year <span class="igrey">&lt;=</span> numyears:
            principal <span class="igrey">=</span> principal <span class="igrey">*</span> (<span class="sgreen">1</span> <span class="igrey">+</span> rate)
            print(year, principal)
            year <span class="igrey">+=</span> <span class="sgreen">1</span></pre>
          <p class="indent">When executed, it produces the following output:</p>
          <pre><span class="sgreen">1 1050.0
        2 1102.5
        3 1157.625
        4 1215.5062500000001
        5 1276.2815625000003</span></pre>
          <p class="indent">
            The <code>while</code> statement tests the conditional expression
            that immediately follows. If the tested condition is true, the body
            of the <code>while</code> statement executes. The condition is then
            retested and the body executed again until the condition becomes
            false. The body of the loop is denoted by indentation. Thus, the
            three statements following <code>while</code> in
            <code>interest.py</code> execute on each iteration. Python doesn’t
            specify the amount of required indentation, as long as it’s
            consistent within a block. It is most common to use four spaces per
            indentation level.
          </p>
          <p class="indent">
            One problem with the <code>interest.py</code> program is that the
            output isn’t very pretty. To make it better, you could right-align
            the columns and limit the precision of principal to two digits.
            Change the <code>print()</code> function to use a so-called
            <em>f-string</em> like this:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0004-03" id="f0004-03"
              >Click here to view code image</a
            >
          </p>
          <pre>print(<span class="trose">f'</span><span class="mblue">{</span>year<span class="mblue">:&gt;3d} {</span>principal<span class="mblue">:0.2f}</span><span class="trose">'</span>)</pre>
          <p class="indent">
            In the f-string, variable names and expressions can be evaluated by
            enclosing them in curly braces. Optionally, each substitution can
            have a formatting specifier attached to it.
            <code>'&gt;3d'</code> means a three-digit decimal number, right
            aligned. <code>'0.2f'</code> means a floating-point number with two
            decimal places of accuracy. More information about these formatting
            codes can be found in <a href="ch09.xhtml#ch09">Chapter 9</a>.
          </p>
          <p class="indent">Now the output of the program looks like this:</p>
          <pre><span class="sgreen">1 1050.00
        2 1102.50
        3 1157.62
        4 1215.51
        5 1276.28</span></pre>
        </section>
        <section>
          <h3 class="h3" id="ch01lev1sec4">
            <span epub:type="pagebreak" id="page_5"></span>1.4 Arithmetic
            Operators
          </h3>
          <p class="noindent">
            Python has a standard set of mathematical operators, shown in
            <a href="ch01.xhtml#ch01tab01">Table 1.1</a>. These operators have
            the same meaning they do in most other programming languages.
          </p>
          <figure class="table" id="ch01tab01">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 1.1</span> Arithmetic Operators
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Operation</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext"><code>x + y</code></p>
                  </td>
                  <td><p class="tabtext">Addition</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x - y</code></p>
                  </td>
                  <td><p class="tabtext">Subtraction</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x * y</code></p>
                  </td>
                  <td><p class="tabtext">Multiplication</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x / y</code></p>
                  </td>
                  <td><p class="tabtext">Division</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x // y</code></p>
                  </td>
                  <td><p class="tabtext">Truncating division</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x ** y</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Power (<code>x</code> to the <code>y</code> power)
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x % y</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Modulo (<code>x</code> mod <code>y</code>). Remainder.
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>–x</code></p>
                  </td>
                  <td><p class="tabtext">Unary minus</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>+x</code></p>
                  </td>
                  <td><p class="tabtext">Unary plus</p></td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            The division operator (<code>/</code>) produces a floating-point
            number when applied to integers. Therefore, <code>7/4</code> is
            <code>1.75</code>. The truncating division operator <code>//</code>,
            also known as floor division, truncates the result to an integer and
            works with both integers and floating-point numbers. The modulo
            operator returns the remainder of the division <code>x // y</code>.
            For example, <code>7 % 4</code> is <code>3</code>. For
            floating-point numbers, the modulo operator returns the
            floating-point remainder of <code>x // y</code>, which is
            <code>x – (x // y) * y</code>.
          </p>
          <p class="indent">
            In addition, the built-in functions in
            <a href="ch01.xhtml#ch01tab02">Table 1.2</a> provide a few more
            commonly used numerical operations.
          </p>
          <figure class="table" id="ch01tab02">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 1.2</span> Common Mathematic Functions
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Function</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext"><code>abs(x)</code></p>
                  </td>
                  <td><p class="tabtext">Absolute value</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>divmod(x,y)</code></p>
                  </td>
                  <td>
                    <p class="tabtext">Returns <code>(x // y, x % y)</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>pow(x,y [,modulo])</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Returns <code>(x ** y) % modulo</code>
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>round(x,[n])</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Rounds to the nearest multiple of 10 to the
                      <code>n</code>th power.
                    </p>
                  </td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            The <code>round()</code> function implements “banker’s rounding.” If
            the value being rounded is equally close to two multiples, it is
            rounded to the nearest even multiple (for example, 0.5 is rounded to
            0.0, and 1.5 is rounded to 2.0).
          </p>
          <p class="indent">
            Integers provide a few additional operators to support bit
            manipulation, shown in
            <a href="ch01.xhtml#ch01tab03">Table 1.3</a>.<span
              epub:type="pagebreak"
              id="page_6"
            ></span>
          </p>
          <figure class="table" id="ch01tab03">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 1.3</span> Bit Manipulation Operators
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Operation</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext"><code>x &lt;&lt; y</code></p>
                  </td>
                  <td><p class="tabtext">Left shift</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x &gt;&gt; y</code></p>
                  </td>
                  <td><p class="tabtext">Right shift</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x &amp; y</code></p>
                  </td>
                  <td><p class="tabtext">Bitwise and</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x | y</code></p>
                  </td>
                  <td><p class="tabtext">Bitwise or</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x ^ y</code></p>
                  </td>
                  <td><p class="tabtext">Bitwise xor (exclusive or)</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>~x</code></p>
                  </td>
                  <td><p class="tabtext">Bitwise negation</p></td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            One would commonly use these with binary integers. For example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0006-01" id="f0006-01"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> <span class="sgreen">0b11001001</span>
        mask <span class="igrey">=</span> <span class="sgreen">0b11110000</span>
        x <span class="igrey">=</span> (a <span class="igrey">&amp;</span> mask) <span class="igrey">&gt;&gt;</span> <span class="sgreen">4</span>    <span class="hblue"># x = 0b1100 (12)</span></pre>
          <p class="indent">
            In this example, <code>0b11001001</code> is how you write an integer
            value in binary. You could have written it as decimal
            <code>201</code> or hexadecimal <code>0xc9</code>, but if you’re
            fiddling with bits, binary makes it easier to visualize what you’re
            doing.
          </p>
          <p class="indent">
            The semantics of the bitwise operators assumes that the integers use
            a two’s complement binary representation and that the sign bit is
            infinitely extended to the left. Some care is required if you are
            working with raw bit patterns that are intended to map to native
            integers on the hardware. This is because Python does not truncate
            the bits or allow values to overflow—instead, the result will grow
            arbitrarily large in magnitude. It’s up to you to make sure the
            result is properly sized or truncated if needed.
          </p>
          <p class="indent">
            To compare numbers, use the comparison operators in
            <a href="ch01.xhtml#ch01tab04">Table 1.4</a>.
          </p>
          <figure class="table" id="ch01tab04">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 1.4</span> Comparison Operators
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Operation</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext"><code>x == y</code></p>
                  </td>
                  <td><p class="tabtext">Equal to</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x != y</code></p>
                  </td>
                  <td><p class="tabtext">Not equal to</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x &lt; y</code></p>
                  </td>
                  <td><p class="tabtext">Less than</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x &gt; y</code></p>
                  </td>
                  <td><p class="tabtext">Greater than</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x &gt;= y</code></p>
                  </td>
                  <td><p class="tabtext">Greater than or equal to</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x &lt;= y</code></p>
                  </td>
                  <td><p class="tabtext">Less than or equal to</p></td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            The result of a comparison is a Boolean value <code>True</code> or
            <code>False</code>.
          </p>
          <p class="indent">
            The <code>and</code>, <code>or</code>, and
            <code>not</code> operators (not to be confused with the
            bit-manipulation operators above) can form more complex Boolean
            expressions. The behavior of these operators is as shown in
            <a href="ch01.xhtml#ch01tab05">Table 1.5</a>.<span
              epub:type="pagebreak"
              id="page_7"
            ></span>
          </p>
          <figure class="table" id="ch01tab05">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 1.5</span> Logical Operators
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Operator</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext"><code>x or y</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      If <code>x</code> is false, return <code>y</code>;
                      otherwise, return <code>x</code>.
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x and y</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      If <code>x</code> is false, return <code>x</code>;
                      otherwise, return <code>y</code>.
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>not x</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      If <code>x</code> is false, return <code>True</code>;
                      otherwise, return <code>False</code>.
                    </p>
                  </td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            A value is considered false if it is literally <code>False</code>,
            <code>None</code>, numerically zero, or empty. Otherwise, it’s
            considered true.
          </p>
          <p class="indent">
            It is common to write an expression that updates a value. For
            example:
          </p>
          <pre>x <span class="igrey">=</span> x <span class="igrey">+</span> <span class="sgreen">1</span>
        y <span class="igrey">=</span> y <span class="igrey">*</span> n</pre>
          <p class="indent">
            For these, you can write the following shortened operation instead:
          </p>
          <pre>x <span class="igrey">+=</span> <span class="sgreen">1</span>
        y <span class="igrey">*=</span> n</pre>
          <p class="indent">
            This shortened form of update can be used with any of the
            <code>+</code>, <code>-</code>, <code>*</code>, <code>**</code>,
            <code>/</code>, <code>//</code>, <code>%</code>, <code>&amp;</code>,
            <code>|</code>, <code>^</code>, <code>&lt;&lt;</code>,
            <code>&gt;&gt;</code> operators. Python does not have increment
            (<code>++</code>) or decrement (<code>--</code>) operators found in
            some other languages.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch01lev1sec5">
            1.5 Conditionals and Control Flow
          </h3>
          <p class="noindent">
            The <code>while</code>, <code>if</code> and
            <code>else</code> statements are used for looping and conditional
            code execution. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0007-03" id="f0007-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>if</strong></span> a <span class="igrey">&lt;</span> b:
            print(<span class="mblue">'Computer says Yes'</span>)
        <span class="lgreen"><strong>else</strong></span>:
            print(<span class="mblue">'Computer says No'</span>)</pre>
          <p class="indent">
            The bodies of the <code>if</code> and <code>else</code> clauses are
            denoted by indentation. The <code>else</code> clause is optional. To
            create an empty clause, use the <code>pass</code> statement, as
            follows:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0007-04" id="f0007-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>if</strong></span> a <span class="igrey">&lt;</span> b:
            <span class="lgreen"><strong>pass</strong></span>      <span class="hblue"># Do nothing</span>
        <span class="lgreen"><strong>else</strong></span>:
            print(<span class="mblue">'Computer says No'</span>)</pre>
          <p class="indent">
            To handle multiple-test cases, use the <code>elif</code> statement:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0007-05" id="f0007-05"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>if</strong></span> suffix <span class="igrey">==</span> <span class="mblue">'.htm'</span>:
            content <span class="igrey">=</span> <span class="mblue">'text/html'</span>
        <span class="lgreen"><strong>elif</strong></span> suffix <span class="igrey">==</span> <span class="mblue">'.jpg'</span>:
            content <span class="igrey">=</span> <span class="mblue">'image/jpeg'</span>
        <span epub:type="pagebreak" id="page_8"></span><span class="lgreen"><strong>elif</strong></span> suffix <span class="igrey">==</span> <span class="mblue">'.png'</span>:
            content <span class="igrey">=</span> <span class="mblue">'image/png'</span>
        <span class="lgreen"><strong>else</strong></span>:
            <span class="lgreen"><strong>raise</strong></span> <span class="pgold">RuntimeError</span>(<span class="trose">f'Unknown content type</span> <span class="mblue">{</span>suffix<span class="mblue">!r}</span><span class="trose">'</span>)</pre>
          <p class="indent">
            If you are assigning a value in combination with a test, use a
            conditional expression:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0008-02" id="f0008-02"
              >Click here to view code image</a
            >
          </p>
          <pre>maxval <span class="igrey">=</span> a <span class="lgreen"><strong>if</strong></span> a <span class="igrey">&gt;</span> b <span class="lgreen"><strong>else</strong></span> b</pre>
          <p class="indent">This is the same as the longer:</p>
          <pre><span class="lgreen"><strong>if</strong></span> a <span class="igrey">&gt;</span> b:
            maxval <span class="igrey">=</span> a
        <span class="lgreen"><strong>else</strong></span>:
            maxval <span class="igrey">=</span> b</pre>
          <p class="indent">
            Sometimes, you may see the assignment of a variable and a
            conditional combined together using the <code>:=</code> operator.
            This is known as an assignment expression (or more colloquially as
            the "walrus operator" because <code>:=</code> looks like a walrus
            tipped over on its side—presumably playing dead). For example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0008-04" id="f0008-04"
              >Click here to view code image</a
            >
          </p>
          <pre>x <span class="igrey">=</span> <span class="sgreen">0</span>
        <span class="lgreen"><strong>while</strong></span> (x :<span class="igrey">=</span> x <span class="igrey">+</span> <span class="sgreen">1</span>) <span class="igrey">&lt;</span> <span class="sgreen">10</span>:    <span class="hblue"># Prints 1, 2, 3, ..., 9</span>
            print(x)</pre>
          <p class="indent">
            The parentheses used to surround an assignment expression are always
            required.
          </p>
          <p class="indent">
            The <code>break</code> statement can be used to abort a loop early.
            It only applies to the innermost loop. For example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0008-05" id="f0008-05"
              >Click here to view code image</a
            >
          </p>
          <pre>x <span class="igrey">=</span> <span class="sgreen">0</span>
        <span class="lgreen"><strong>while</strong></span> x <span class="igrey">&lt;</span> <span class="sgreen">10</span>:
            <span class="lgreen"><strong>if</strong></span> x <span class="igrey">==</span> <span class="sgreen">5</span>:
                <span class="lgreen"><strong>break</strong></span> <span class="hblue"># Stops the loop. Moves to Done below</span>
            print(x)
            x <span class="igrey">+=</span> <span class="sgreen">1</span>
        
        print(<span class="mblue">'Done'</span>)</pre>
          <p class="indent">
            The <code>continue</code> statement skips the rest of the loop body
            and goes back to the top of the loop. For example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0008-06" id="f0008-06"
              >Click here to view code image</a
            >
          </p>
          <pre>x <span class="igrey">=</span> <span class="sgreen">0</span>
        <span class="lgreen"><strong>while</strong></span> x <span class="igrey">&lt;</span> <span class="sgreen">10</span>:
            x <span class="igrey">+=</span> <span class="sgreen">1</span>
            <span class="lgreen"><strong>if</strong></span> x <span class="igrey">==</span> <span class="sgreen">5</span>:
               <span class="lgreen"><strong>continue</strong></span>   <span class="hblue"># Skips the print(x). Goes back to loop start.</span>
            print(x)
        
        print(<span class="mblue">'Done'</span>)</pre>
        </section>
        <section>
          <h3 class="h3" id="ch01lev1sec6">
            <span epub:type="pagebreak" id="page_9"></span>1.6 Text Strings
          </h3>
          <p class="noindent">
            To define a string literal, enclose it in single, double, or triple
            quotes as follows:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0009-01" id="f0009-01"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> <span class="mblue">'Hello World'</span>
        b <span class="igrey">=</span> <span class="mblue">"Python is groovy"</span>
        c <span class="igrey">=</span> <span class="mblue">'''Computer says no.'''</span>
        d <span class="igrey">=</span> <span class="mblue">"""Computer still says no."""</span></pre>
          <p class="indent">
            The same type of quote used to start a string must be used to
            terminate it. Triple-quoted strings capture all the text until the
            terminating triple quote—as opposed to single-and double-quoted
            strings which must be specified on one logical line. Triple-quoted
            strings are useful when the contents of a string literal span
            multiple lines of text:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0009-02" id="f0009-02"
              >Click here to view code image</a
            >
          </p>
          <pre>print(<span class="mblue">'''Content-type: text/html</span>
        
        <span class="mblue">&lt;h1&gt; Hello World &lt;/h1&gt;</span>
        <span class="mblue">Click &lt;a href="http://www.python.org"&gt;here&lt;/a&gt;.</span>
        <span class="mblue">'''</span>)</pre>
          <p class="indent">
            Immediately adjacent string literals are concatenated into a single
            string. Thus, the above example could also be written as:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0009-03" id="f0009-03"
              >Click here to view code image</a
            >
          </p>
          <pre>print(
        <span class="mblue">'Content-type: text/html\n'</span>
        <span class="mblue">'\n'</span>
        <span class="mblue">'&lt;h1&gt; Hello World &lt;/h1&gt;\n'</span>
        <span class="mblue">'Clock &lt;a href="http://www.python.org"&gt;here&lt;/a&gt;\n'</span>
        )</pre>
          <p class="indent">
            If the opening quotation mark of a string is prefaced by an
            <code>f</code>, escaped expressions within a string are evaluated.
            For example, in earlier examples, the following statement was used
            to output values of a calculation:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0009-04" id="f0009-04"
              >Click here to view code image</a
            >
          </p>
          <pre><code>print(<span class="trose">f'</span><span class="mblue">{</span>year<span class="mblue">:&gt;3d} {</span>principal<span class="mblue">:0.2f}</span><span class="trose">'</span>)</code></pre>
          <p class="indent">
            Although this is only using simple variable names, any valid
            expression can appear. For example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0009-05" id="f0009-05"
              >Click here to view code image</a
            >
          </p>
          <pre>base_year <span class="igrey">=</span> <span class="sgreen">2020</span>
        ...
        print(<span class="trose">f'</span><span class="mblue">{</span>base_year <span class="igrey">+</span> year<span class="mblue">:&gt;4d} {</span>principal<span class="mblue">:0.2f}</span><span class="trose">'</span>)</pre>
          <p class="indent">
            As an alternative to f-strings, the <code>format()</code> method and
            <code>%</code> operator are also sometimes used to format strings.
            For example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0009-06" id="f0009-06"
              >Click here to view code image</a
            >
          </p>
          <pre>print(<span class="mblue">'{0:&gt;3d} {1:0.2f}'</span>.format(year, principal))
        print(<span class="mblue">'%3d %0.2f'</span> <span class="igrey">%</span> (year, principal))</pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_10"></span>More information
            about string formatting is found in
            <a href="ch09.xhtml#ch09">Chapter 9</a>.
          </p>
          <p class="indent">
            Strings are stored as sequences of Unicode characters indexed by
            integers, starting at zero. Negative indices index from the end of
            the string. The length of a string <code>s</code> is computed using
            <code>len(s)</code>. To extract a single character, use the indexing
            operator <code>s[i]</code> where <code>i</code> is the index.
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0010-01" id="f0010-01"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> <span class="mblue">'Hello World'</span>
        print(len(a))                <span class="hblue"># 11</span>
        b <span class="igrey">=</span> a[<span class="sgreen">4</span>]                     <span class="hblue"># b = 'o'</span>
        c <span class="igrey">=</span> a[<span class="igrey">-</span><span class="sgreen">1</span>]                    <span class="hblue"># c = 'd'</span></pre>
          <p class="indent">
            To extract a substring, use the slicing operator
            <code>s[i:j]</code>. It extracts all characters from
            <code>s</code> whose index <code>k</code> is in the range
            <code>i &lt;= k &lt; j</code>. If either index is omitted, the
            beginning or end of the string is assumed, respectively:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0010-02" id="f0010-02"
              >Click here to view code image</a
            >
          </p>
          <pre>c <span class="igrey">=</span> a[:<span class="sgreen">5</span>]               <span class="hblue"># c = 'Hello'</span>
        d <span class="igrey">=</span> a[<span class="sgreen">6</span>:]               <span class="hblue"># d = 'World'</span>
        e <span class="igrey">=</span> a[<span class="sgreen">3</span>:<span class="sgreen">8</span>]              <span class="hblue"># e = 'lo Wo'</span>
        f <span class="igrey">=</span> a[<span class="igrey">-</span><span class="sgreen">5</span>:]              <span class="hblue"># f = 'World'</span></pre>
          <p class="indent">
            Strings have a variety of methods for manipulating their contents.
            For example, the <code>replace()</code> method performs a simple
            text replacement:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0010-03" id="f0010-03"
              >Click here to view code image</a
            >
          </p>
          <pre>g <span class="igrey">=</span> a.replace(<span class="mblue">'Hello'</span>, <span class="mblue">'Hello Cruel'</span>)  <span class="hblue"># f = 'Hello Cruel World'</span></pre>
          <p class="indent">
            <a href="ch01.xhtml#ch01tab06">Table 1.6</a> shows a few common
            string methods. Here and elsewhere, arguments enclosed in square
            brackets are optional.
          </p>
          <figure class="table" id="ch01tab06">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 1.6</span> Common String Methods
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Method</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>s.endswith(prefix [,start [,end]])</code>
                    </p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Checks whether a string ends with <code>prefix</code>.
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>s.find(sub [, start [,end]])</code>
                    </p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Finds the first occurrence of the specified substring
                      <code>sub</code> or -1 if not found.
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>s.lower()</code></p>
                  </td>
                  <td><p class="tabtext">Converts to lowercase.</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>s.replace(old, new [,maxreplace])</code>
                    </p>
                  </td>
                  <td><p class="tabtext">Replaces a substring.</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>s.split([sep [,maxsplit]])</code>
                    </p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Splits a string using <code>sep</code> as a delimiter.
                      <code>maxsplit</code> is the maximum number of splits to
                      perform.
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>s.startswith(prefix [,start [,end]])</code>
                    </p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Checks whether a string starts with <code>prefix</code>.
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>s.strip([chrs])</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Removes leading and trailing whitespace or characters
                      supplied in <code>chrs</code>.
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>s.upper()</code></p>
                  </td>
                  <td>
                    <p class="tabtext">Converts a string to uppercase.</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            Strings are concatenated with the plus (<code>+</code>) operator:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0010-08" id="f0010-08"
              >Click here to view code image</a
            >
          </p>
          <pre>g <span class="igrey">=</span> a <span class="igrey">+</span> <span class="mblue">'ly'</span>     <span class="hblue"># g = 'Hello Worldly'</span></pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_11"></span>Python never
            implicitly interprets the contents of a string as numerical data.
            Thus, <code>+</code> always concatenates strings:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0011-01" id="f0011-01"
              >Click here to view code image</a
            >
          </p>
          <pre>x <span class="igrey">=</span> <span class="mblue">'37'</span>
        y <span class="igrey">=</span> <span class="mblue">'42'</span>
        z <span class="igrey">=</span> x <span class="igrey">+</span> y     <span class="hblue"># z = '3742' (String Concatenation)</span></pre>
          <p class="indent">
            To perform mathematical calculations, a string first has to be
            converted into a numeric value using a function such as
            <code>int()</code> or <code>float()</code>. For example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0011-02" id="f0011-02"
              >Click here to view code image</a
            >
          </p>
          <pre>z <span class="igrey">=</span> int(x) <span class="igrey">+</span> int(y)   <span class="hblue"># z = 79 (Integer Addition)</span></pre>
          <p class="indent">
            Non-string values can be converted into a string representation by
            using the <code>str()</code>, <code>repr()</code>, or
            <code>format()</code> functions. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0011-03" id="f0011-03"
              >Click here to view code image</a
            >
          </p>
          <pre>s <span class="igrey">=</span> <span class="mblue">'The value of x is '</span> <span class="igrey">+</span> str(x)
        s <span class="igrey">=</span> <span class="mblue">'The value of x is '</span> <span class="igrey">+</span> repr(x)
        s <span class="igrey">=</span> <span class="mblue">'The value of x is '</span> <span class="igrey">+</span> format(x, <span class="mblue">'4d'</span>)</pre>
          <p class="indent">
            Although <code>str()</code> and <code>repr()</code> both create
            strings, their output is often different.
            <code>str()</code> produces the output that you get when you use the
            <code>print()</code> function, whereas <code>repr()</code> creates a
            string that you type into a program to exactly represent the value
            of an object. For example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0011-04" id="f0011-04"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; s = 'hello\nworld'
        &gt;&gt;&gt; print(str(s))
        hello
        world
        &gt;&gt;&gt; print(repr(s))
        'hello\nworld'
        &gt;&gt;&gt;</pre
          >
          <p class="indent">
            When debugging, use <code>repr(s)</code> to produce output because
            it shows you more information about a value and its type.
          </p>
          <p class="indent">
            The <code>format()</code> function is used to convert a single value
            to a string with a specific formatting applied. For example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0011-05" id="f0011-05"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; x = 12.34567
        &gt;&gt;&gt; format(x, '0.2f')
        '12.35'
        &gt;&gt;&gt;</pre
          >
          <p class="indent">
            The format code given to <code>format()</code> is the same code you
            would use with f-strings when producing formatted output. For
            example, the above code could be replaced by the following:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0011-06" id="f0011-06"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; f'{x:0.2f}'
        '12.35'
        &gt;&gt;&gt;</pre
          >
        </section>
        <section>
          <h3 class="h3" id="ch01lev1sec7">
            <span epub:type="pagebreak" id="page_12"></span>1.7 File Input and
            Output
          </h3>
          <p class="noindent">
            The following program opens a file and reads its contents line by
            line as text strings:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0012-01" id="f0012-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>with</strong></span> open(<span class="mblue">'data.txt'</span>) as file:
            <span class="lgreen"><strong>for</strong></span> line <span class="lgreen"><strong>in</strong></span> file:
                print(line, end<span class="igrey">=</span><span class="mblue">''</span>) <span class="hblue"># end='' omits the extra newline</span></pre>
          <p class="indent">
            The <code>open()</code> function returns a new file object. The
            <code>with</code> statement that precedes it declares a block of
            statements (or context) where the file (<code>file</code>) is going
            to be used. Once control leaves this block, the file is
            automatically closed. If you don’t use the
            <code>with</code> statement, the code would need to look like this:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0012-02" id="f0012-02"
              >Click here to view code image</a
            >
          </p>
          <pre>file <span class="igrey">=</span> open(<span class="mblue">'data.txt'</span>)
        <span class="lgreen"><strong>for</strong></span> line <span class="lgreen"><strong>in</strong></span> file:
            print(line, end<span class="igrey">=</span><span class="mblue">''</span>) <span class="hblue"># end='' omits the extra newline</span>
        file.close()</pre>
          <p class="indent">
            It’s easy to forget the extra step of calling
            <code>close()</code> so it’s better to use the
            <code>with</code> statement and have the file closed for you.
          </p>
          <p class="indent">
            The <code>for</code> loop iterates line-by-line over the file until
            no more data is available.
          </p>
          <p class="indent">
            If you want to read the file in its entirety as a string, use the
            <code>read()</code> method like this:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0012-03" id="f0012-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>with</strong></span> open(<span class="mblue">'data.txt'</span>) as file:
            data <span class="igrey">=</span> file.read()</pre>
          <p class="indent">
            If you want to read a large file in chunks, give a size hint to the
            <code>read()</code> method as follows:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0012-04" id="f0012-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>with</strong></span> open(<span class="mblue">'data.txt'</span>) as file:
            <span class="lgreen"><strong>while</strong></span> (chunk :<span class="igrey">=</span> file.read(<span class="sgreen">10000</span>)):
                print(chunk, end<span class="igrey">=</span><span class="mblue">''</span>)</pre>
          <p class="indent">
            The <code>:=</code> operator used in this example assigns to a
            variable and returns its value so that it can be tested by the
            <code>while</code> loop to break out. When the end of a file is
            reached, <code>read()</code> returns an empty string. An alternate
            way to write the above function is using <code>break</code>:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0012-05" id="f0012-05"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>with</strong></span> open(<span class="mblue">'data.txt'</span>) as file:
            <span class="lgreen"><strong>while</strong></span> <span class="dblue">True</span>:
                chunk <span class="igrey">=</span> file.read(<span class="sgreen">10000</span>)
                <span class="lgreen"><strong>if not</strong></span> chunk:
                    <span class="lgreen"><strong>break</strong></span>
                print(chunk, end<span class="igrey">=</span><span class="mblue">''</span>)</pre>
          <p class="indent">
            To make the output of a program go to a file, supply a file argument
            to the <code>print()</code> function:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0012-06" id="f0012-06"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>with</strong></span> open(<span class="mblue">'out.txt'</span>, <span class="mblue">'wt'</span>) as out:
            <span class="lgreen"><strong>while</strong></span> year <span class="igrey">&lt;=</span> numyears:
        <span epub:type="pagebreak" id="page_13"></span>        principal <span class="igrey">=</span> principal <span class="igrey">*</span> (<span class="sgreen">1</span> <span class="igrey">+</span> rate)
                print(<span class="trose">f'</span><span class="mblue">{</span>year<span class="mblue">:&gt;3d} {</span>principal<span class="mblue">:0.2f}</span><span class="trose">'</span>, file<span class="igrey">=</span>out)
                year <span class="igrey">+=</span> <span class="sgreen">1</span></pre>
          <p class="indent">
            In addition, file objects support a <code>write()</code> method that
            can be used to write string data. For example, the
            <code>print()</code> function in the previous example could have
            been written this way:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0013-02" id="f0013-02"
              >Click here to view code image</a
            >
          </p>
          <pre>out.write(<span class="trose">f'</span><span class="mblue">{</span>year<span class="mblue">:3d} {</span>principal<span class="mblue">:0.2f}\n</span><span class="trose">'</span>)</pre>
          <p class="indent">
            By default, files contain text encoded as UTF-8. If you’re working
            with a different text encoding, use the extra
            <code>encoding</code> argument when opening the file. For example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0013-03" id="f0013-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>with</strong></span> open(<span class="mblue">'data.txt'</span>, encoding<span class="igrey">=</span><span class="mblue">'latin-1'</span>) as file:
            data <span class="igrey">=</span> file.read()</pre>
          <p class="indent">
            Sometimes you might want to read data typed interactively in the
            console. To do that, use the <code>input()</code> function. For
            example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0013-04" id="f0013-04"
              >Click here to view code image</a
            >
          </p>
          <pre>name <span class="igrey">=</span> input(<span class="mblue">'Enter your name : '</span>)
        print(<span class="mblue">'Hello'</span>, name)</pre>
          <p class="indent">
            The <code>input()</code> function returns all of the typed text up
            to the terminating newline, which is not included.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch01lev1sec8">1.8 Lists</h3>
          <p class="noindent">
            Lists are an ordered collection of arbitrary objects. Create a list
            by enclosing values in square brackets:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0013-05" id="f0013-05"
              >Click here to view code image</a
            >
          </p>
          <pre>names <span class="igrey">=</span> [ <span class="mblue">'Dave'</span>, <span class="mblue">'Paula'</span>, <span class="mblue">'Thomas'</span>, <span class="mblue">'Lewis'</span> ]</pre>
          <p class="indent">
            Lists are indexed by integers, starting with zero. Use the indexing
            operator to access and modify individual items of the list:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0013-06" id="f0013-06"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> names[<span class="sgreen">2</span>]         <span class="hblue"># Returns the third item of the list,  'Thomas'</span>
        names[<span class="sgreen">2</span>] <span class="igrey">=</span> <span class="mblue">'Tom'</span>     <span class="hblue"># Changes the third item to 'Tom'</span>
        print(names[<span class="igrey">-</span><span class="sgreen">1</span>])     <span class="hblue"># Print the last item ('Lewis')</span></pre>
          <p class="indent">
            To append new items to the end of a list, use the
            <code>append()</code> method:
          </p>
          <pre>names.append(<span class="mblue">'Alex'</span>)</pre>
          <p class="indent">
            To insert an item in the list at a specific position, use the
            <code>insert()</code> method:
          </p>
          <pre>names.insert(<span class="sgreen">2</span>, <span class="mblue">'Aya'</span>)</pre>
          <p class="indent">
            To iterate over the items in a list, use a
            <code>for</code> loop:<span
              epub:type="pagebreak"
              id="page_14"
            ></span>
          </p>
          <pre><span class="lgreen"><strong>for</strong></span> name <span class="lgreen"><strong>in</strong></span> names:
            print(name)</pre>
          <p class="indent">
            You can extract or reassign a portion of a list by using the slicing
            operator:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0014-02" id="f0014-02"
              >Click here to view code image</a
            >
          </p>
          <pre>b <span class="igrey">=</span> names[<span class="sgreen">0</span>:<span class="sgreen">2</span>]      <span class="hblue"># b -&gt; ['Dave', 'Paula']</span>
        c <span class="igrey">=</span> names[<span class="sgreen">2</span>:]       <span class="hblue"># c -&gt; ['Aya', 'Tom', 'Lewis', 'Alex']</span>
        names[<span class="sgreen">1</span>] <span class="igrey">=</span> <span class="mblue">'Becky'</span>  <span class="hblue"># Replaces 'Paula' with 'Becky'</span>
        names[<span class="sgreen">0</span>:<span class="sgreen">2</span>] <span class="igrey">=</span> [<span class="mblue">'Dave'</span>, <span class="mblue">'Mark'</span>, <span class="mblue">'Jeff'</span>] <span class="hblue"># Replace the first two items</span>
                                              <span class="hblue"># with ['Dave','Mark','Jeff']</span></pre>
          <p class="indent">
            Use the plus (<code>+</code>) operator to concatenate lists:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0014-03" id="f0014-03"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> [<span class="mblue">'x'</span>,<span class="mblue">'y'</span>] <span class="igrey">+</span> [<span class="mblue">'z'</span>,<span class="mblue">'z'</span>,<span class="mblue">'y'</span>]  <span class="hblue"># Result is ['x','y','z','z','y']</span></pre>
          <p class="indent">An empty list is created in one of two ways:</p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0014-04" id="f0014-04"
              >Click here to view code image</a
            >
          </p>
          <pre>names <span class="igrey">=</span> []        <span class="hblue"># An empty list</span>
        names <span class="igrey">=</span> list()    <span class="hblue"># An empty list</span></pre>
          <p class="indent">
            Specifying <code>[]</code> for an empty list is more idiomatic.
            <code>list</code> is the name of the class associated with the list
            type. It’s more common to see it used when performing conversions of
            data to a list. For example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0014-05" id="f0014-05"
              >Click here to view code image</a
            >
          </p>
          <pre>letters <span class="igrey">=</span> list(<span class="mblue">'Dave'</span>)    <span class="hblue"># letters = ['D', 'a', 'v', 'e']</span></pre>
          <p class="indent">
            Most of the time, all of the items in a list are of the same type
            (for example, a list of numbers or a list of strings). However,
            lists can contain any mix of Python objects, including other lists,
            as in the following example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0014-06" id="f0014-06"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> [<span class="sgreen">1</span>, <span class="mblue">'Dave'</span>, <span class="sgreen">3.14</span>, [<span class="mblue">'Mark'</span>, <span class="sgreen">7</span>, <span class="sgreen">9</span>, [<span class="sgreen">100</span>, <span class="sgreen">101</span>]], <span class="sgreen">10</span>]</pre>
          <p class="indent">
            Items contained in nested lists are accessed by applying more than
            one indexing operation:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0014-07" id="f0014-07"
              >Click here to view code image</a
            >
          </p>
          <pre>a[<span class="sgreen">1</span>]             <span class="hblue"># Returns 'Dave'</span>
        a[<span class="sgreen">3</span>][<span class="sgreen">2</span>]          <span class="hblue"># Returns 9</span>
        a[<span class="sgreen">3</span>][<span class="sgreen">3</span>][<span class="sgreen">1</span>]       <span class="hblue"># Returns 101</span></pre>
          <p class="indent">
            The following program <code>pcost.py</code> illustrates how to read
            data into a list and perform a simple calculation. In this example,
            lines are assumed to contain comma-separated values. The program
            computes the sum of the product of two columns.
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0014-08" id="f0014-08"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># pcost.py</span>
        <span class="hblue">#</span>
        <span class="hblue"># Reads input lines of the form 'NAME,SHARES,PRICE'.</span>
        <span class="hblue"># For example:</span>
        <span class="hblue">#</span>
        <span class="hblue">#    SYM,123,456.78</span>
        <span epub:type="pagebreak" id="page_15"></span>
        import sys
        <span class="lgreen"><strong>if</strong></span> len(sys.argv) <span class="igrey">!=</span> <span class="sgreen">2</span>:
            <span class="lgreen"><strong>raise</strong></span> <span class="pgold">SystemExit</span>(<span class="trose">f'Usage:</span> <span class="mblue">{</span>sys<span class="mblue">.</span>argv[<span class="sgreen">0</span>]<span class="mblue">}</span> <span class="trose">filename'</span>)
        
        rows <span class="igrey">=</span> []
        <span class="lgreen"><strong>with</strong></span> open(sys.argv[<span class="sgreen">1</span>], <span class="mblue">'rt'</span>) as file:
            <span class="lgreen"><strong>for</strong></span> line <span class="lgreen"><strong>in</strong></span> file:
                rows.append(line.split(<span class="mblue">','</span>))
        
        <span class="hblue"># rows is a list of this form</span>
        <span class="hblue"># [</span>
        <span class="hblue">#   ['SYM', '123', '456.78']</span>
        <span class="hblue">#   ...</span>
        <span class="hblue"># ]</span>
        
        total <span class="igrey">=</span> sum([int(row[<span class="sgreen">1</span>]) <span class="igrey">*</span> float(row[<span class="sgreen">2</span>]) <span class="lgreen"><strong>for</strong></span> row <span class="lgreen"><strong>in</strong></span> rows ])
        print(<span class="trose">f'Total cost:</span> <span class="mblue">{</span>total<span class="mblue">:0.2f}</span><span class="trose">'</span>)</pre>
          <p class="indent">
            The first line of this program uses the
            <code>import</code> statement to load the <code>sys</code> module
            from the Python library. This module is used to obtain command-line
            arguments which are found in the list <code>sys.argv</code>. The
            initial check makes sure that a filename has been provided. If not,
            a <code>SystemExit</code> exception is raised with a helpful error
            message. In this message, <code>sys.argv[0]</code> inserts the name
            of the program that’s running.
          </p>
          <p class="indent">
            The <code>open()</code> function uses the filename that was
            specified on the command line. The
            <code>for line in file</code> loop is reading the file line by line.
            Each line is split into a small list using the comma character as a
            delimiter. This list is appended to <code>rows</code>. The final
            result, <code>rows</code>, is a list of lists—remember that a list
            can contain anything including other lists.
          </p>
          <p class="indent">
            The expression
            <code>[ int(row[1]) * float(row[2]) for row in rows ]</code>
            constructs a new list by looping over all of the lists in
            <code>rows</code> and computing the product of the second and third
            items. This useful technique for constructing a list is known as a
            list comprehension. The same computation could have been expressed
            more verbosely as follows:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0015-03" id="f0015-03"
              >Click here to view code image</a
            >
          </p>
          <pre>values <span class="igrey">=</span> []
        <span class="lgreen"><strong>for</strong></span> row <span class="lgreen"><strong>in</strong></span> rows:
            values.append(int(row[<span class="sgreen">1</span>]) <span class="igrey">*</span> float(row[<span class="sgreen">2</span>]))
        total <span class="igrey">=</span> sum(values)</pre>
          <p class="indent">
            As a general rule, list comprehensions are a preferred technique for
            performing simple calculations. The built-in
            <code>sum()</code> function computes the sum for all items in a
            sequence.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch01lev1sec9">1.9 Tuples</h3>
          <p class="noindent">
            To create simple data structures, you can pack a collection of
            values into an immutable object known as a tuple. You create a tuple
            by enclosing a group of values in parentheses:<span
              epub:type="pagebreak"
              id="page_16"
            ></span>
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0016-01" id="f0016-01"
              >Click here to view code image</a
            >
          </p>
          <pre>holding <span class="igrey">=</span> (<span class="mblue">'GOOG'</span>, <span class="sgreen">100</span>, <span class="sgreen">490.10</span>)
        address <span class="igrey">=</span> (<span class="mblue">'www.python.org'</span>, <span class="sgreen">80</span>)</pre>
          <p class="indent">
            For completeness, 0- and 1-element tuples can be defined, but have
            special syntax:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0016-02" id="f0016-02"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> ()         <span class="hblue"># 0-tuple (empty tuple)</span>
        b <span class="igrey">=</span> (item,)    <span class="hblue"># 1-tuple (note the trailing comma)</span></pre>
          <p class="indent">
            The values in a tuple can be extracted by numerical index just like
            a list. However, it is more common to unpack tuples into a set of
            variables, like this:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0016-03" id="f0016-03"
              >Click here to view code image</a
            >
          </p>
          <pre>name, shares, price <span class="igrey">=</span> holding
        host, port <span class="igrey">=</span> address</pre>
          <p class="indent">
            Although tuples support most of the same operations as lists (such
            as indexing, slicing, and concatenation), the elements of a tuple
            cannot be changed after creation—that is, you cannot replace,
            delete, or append new elements to an existing tuple. A tuple is best
            viewed as a single immutable object that consists of several parts,
            not as a collection of distinct objects like a list.
          </p>
          <p class="indent">
            Tuples and lists are often used together to represent data. For
            example, this program shows how you might read a file containing
            columns of data separated by commas:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0016-04" id="f0016-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># File containing lines of the form "name,shares,price"</span>
        filename <span class="igrey">=</span> <span class="mblue">'portfolio.csv'</span>
        
        portfolio <span class="igrey">=</span> []
        <span class="lgreen"><strong>with</strong></span> open(filename) as file:
            <span class="lgreen"><strong>for</strong></span> line <span class="lgreen"><strong>in</strong></span> file:
                row <span class="igrey">=</span> line.split(<span class="mblue">','</span>)
                name <span class="igrey">=</span> row[<span class="sgreen">0</span>]
                shares <span class="igrey">=</span> int(row[<span class="sgreen">1</span>])
                price <span class="igrey">=</span> float(row[<span class="sgreen">2</span>])
                holding <span class="igrey">=</span> (name, shares, price)
                portfolio.append(holding)</pre>
          <p class="indent">
            The resulting <code>portfolio</code> list created by this program
            looks like a two-dimensional array of rows and columns. Each row is
            represented by a tuple and can be accessed as follows:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0016-05" id="f0016-05"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; portfolio[0]
        ('AA', 100, 32.2)
        &gt;&gt;&gt; portfolio[1]
        ('IBM', 50, 91.1)
        &gt;&gt;&gt;</pre
          >
          <p class="indent">
            Individual items of data can be accessed like this:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0016-06" id="f0016-06"
              >Click here to view code image</a
            >
          </p>
          <pre>&gt;&gt;&gt; portfolio[1][1]
        50
        <span epub:type="pagebreak" id="page_17"></span>&gt;&gt;&gt; portfolio[1][2]
        91.1
        &gt;&gt;&gt;</pre>
          <p class="indent">
            Here’s how to loop over all of the records and unpack fields into a
            set of variables:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0017-02" id="f0017-02"
              >Click here to view code image</a
            >
          </p>
          <pre>total <span class="igrey">=</span> <span class="sgreen">0.0</span>
        <span class="lgreen"><strong>for</strong></span> name, shares, price <span class="lgreen"><strong>in</strong></span> portfolio:
            total <span class="igrey">+=</span> shares <span class="igrey">*</span> price</pre>
          <p class="indent">
            Alternatively, you could use a list comprehension:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0017-03" id="f0017-03"
              >Click here to view code image</a
            >
          </p>
          <pre>total <span class="igrey">=</span> sum([shares <span class="igrey">*</span> price <span class="lgreen"><strong>for</strong></span> _, shares, price <span class="lgreen"><strong>in</strong></span> portfolio])</pre>
          <p class="indent">
            When iterating over tuples, the variable <code>_</code> can be used
            to indicate a discarded value. In the above calculation, it means
            we’re ignoring the first item (the name).
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch01lev1sec10">1.10 Sets</h3>
          <p class="noindent">
            A set is an unordered collection of unique objects. Sets are used to
            find distinct values or to manage problems related to membership. To
            create a set, enclose a collection of values in curly braces or give
            an existing collection of items to <code>set()</code>. For example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0017-04" id="f0017-04"
              >Click here to view code image</a
            >
          </p>
          <pre>names1 <span class="igrey">=</span> { <span class="mblue">'IBM'</span>, <span class="mblue">'MSFT'</span>, <span class="mblue">'AA'</span> }
        names2 <span class="igrey">=</span> set([<span class="mblue">'IBM'</span>, <span class="mblue">'MSFT'</span>, <span class="mblue">'HPE'</span>, <span class="mblue">'IBM'</span>, <span class="mblue">'CAT'</span>])</pre>
          <p class="indent">
            The elements of a set are typically restricted to immutable objects.
            For example, you can make a set of numbers, strings, or tuples.
            However, you can’t make a set containing lists. Most common objects
            will probably work with a set, however—when in doubt, try it.
          </p>
          <p class="indent">
            Unlike lists and tuples, sets are unordered and cannot be indexed by
            numbers. Moreover, the elements of a set are never duplicated. For
            example, if you inspect the value of <code>names2</code> from the
            preceding code, you get the following:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0017-05" id="f0017-05"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; names2
        {'CAT', 'IBM', 'MSFT', 'HPE'}
        &gt;&gt;&gt;</pre
          >
          <p class="indent">
            Notice that <code>'IBM'</code> only appears once. Also, the order of
            items can’t be predicted; the output may vary from what’s shown. The
            order might even change between interpreter runs on the same
            computer.
          </p>
          <p class="indent">
            If working with existing data, you can also create a set using a set
            comprehension. For example, this statement turns all of the stock
            names from the data in the previous section into a set:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0017-06" id="f0017-06"
              >Click here to view code image</a
            >
          </p>
          <pre>names <span class="igrey">=</span> { s[<span class="sgreen">0</span>] <span class="lgreen"><strong>for</strong></span> s <span class="lgreen"><strong>in</strong></span> portfolio }</pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_18"></span>To create an empty
            set, use <code>set()</code> with no arguments:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0018-01" id="f0018-01"
              >Click here to view code image</a
            >
          </p>
          <pre>r <span class="igrey">=</span> set()    <span class="hblue"># Initially empty set</span></pre>
          <p class="indent">
            Sets support a standard collection of operations including union,
            intersection, difference, and symmetric difference. Here’s an
            example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0018-02" id="f0018-02"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> t <span class="igrey">|</span> s      <span class="hblue"># Union {'MSFT', 'CAT', 'HPE', 'AA', 'IBM'}</span>
        b <span class="igrey">=</span> t <span class="igrey">&amp;</span> s      <span class="hblue"># Intersection {'IBM', 'MSFT'}</span>
        c <span class="igrey">=</span> t <span class="igrey">-</span> s      <span class="hblue"># Difference { 'CAT', 'HPE' }</span>
        d <span class="igrey">=</span> s <span class="igrey">-</span> t      <span class="hblue"># Difference { 'AA' }</span>
        e <span class="igrey">=</span> t <span class="igrey">^</span> s      <span class="hblue"># Symmetric difference { 'CAT', 'HPE', 'AA' }</span></pre>
          <p class="indent">
            The difference operation <code>s - t</code> gives items in
            <code>s</code> that aren’t in <code>t</code>. The symmetric
            difference <code>s ^ t</code> gives items that are in either
            <code>s</code> or <code>t</code> but not in both.
          </p>
          <p class="indent">
            New items can be added to a set using <code>add()</code> or
            <code>update()</code>:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0018-03" id="f0018-03"
              >Click here to view code image</a
            >
          </p>
          <pre>t.add(<span class="mblue">'DIS'</span>)                   <span class="hblue"># Add a single item</span>
        s.update({<span class="mblue">'JJ'</span>, <span class="mblue">'GE'</span>, <span class="mblue">'ACME'</span>}) <span class="hblue"># Adds multiple items to s</span></pre>
          <p class="indent">
            An item can be removed using <code>remove()</code> or
            <code>discard()</code>:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0018-04" id="f0018-04"
              >Click here to view code image</a
            >
          </p>
          <pre>t.remove(<span class="mblue">'IBM'</span>)    <span class="hblue"># Remove 'IBM' or raise KeyError if absent.</span>
        s.discard(<span class="mblue">'SCOX'</span>)  <span class="hblue"># Remove 'SCOX' if it exists.</span></pre>
          <p class="indent">
            The difference between <code>remove()</code> and
            <code>discard()</code> is that <code>discard()</code> doesn’t raise
            an exception if the item isn’t present.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch01lev1sec11">1.11 Dictionaries</h3>
          <p class="noindent">
            A dictionary is a mapping between keys and values. You create a
            dictionary by enclosing the key-value pairs, each separated by a
            colon, in curly braces (<code>{ }</code>), like this:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0018-05" id="f0018-05"
              >Click here to view code image</a
            >
          </p>
          <pre>s <span class="igrey">=</span> {
             <span class="mblue">'name'</span> : <span class="mblue">'GOOG'</span>,
             <span class="mblue">'shares'</span> : <span class="sgreen">100</span>,
             <span class="mblue">'price'</span> : <span class="sgreen">490.10</span>
            }</pre>
          <p class="indent">
            To access members of a dictionary, use the indexing operator as
            follows:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0018-06" id="f0018-06"
              >Click here to view code image</a
            >
          </p>
          <pre>name <span class="igrey">=</span> s[<span class="mblue">'name'</span>]
        cost <span class="igrey">=</span> s[<span class="mblue">'shares'</span>] <span class="igrey">*</span> s[<span class="mblue">'price'</span>]</pre>
          <p class="indent">Inserting or modifying objects works like this:</p>
          <pre>s[<span class="mblue">'shares'</span>] <span class="igrey">=</span> <span class="sgreen">75</span>
        s[<span class="mblue">'date'</span>] <span class="igrey">=</span> <span class="mblue">'2007-06-07'</span></pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_19"></span>A dictionary is a
            useful way to define an object that consists of named fields.
            However, dictionaries are also commonly used as a mapping for
            performing fast lookups on unordered data. For example, here’s a
            dictionary of stock prices:
          </p>
          <pre>prices <span class="igrey">=</span> {
            <span class="mblue">'GOOG'</span> : <span class="sgreen">490.1</span>,
            <span class="mblue">'AAPL'</span> : <span class="sgreen">123.5</span>,
            <span class="mblue">'IBM'</span> : <span class="sgreen">91.5</span>,
            <span class="mblue">'MSFT'</span> : <span class="sgreen">52.13</span>
        }</pre>
          <p class="indent">
            Given such a dictionary, you can look up a price:
          </p>
          <pre>p <span class="igrey">=</span> prices[<span class="mblue">'IBM'</span>]</pre>
          <p class="indent">
            Dictionary membership is tested with the <code>in</code> operator:
          </p>
          <pre><span class="lgreen"><strong>if</strong></span> <span class="mblue">'IBM'</span> <span class="lgreen"><strong>in</strong></span> prices:
            p <span class="igrey">=</span> prices[<span class="mblue">'IBM'</span>]
        <span class="lgreen"><strong>else</strong></span>:
            p <span class="igrey">=</span> <span class="sgreen">0.0</span></pre>
          <p class="indent">
            This particular sequence of steps can also be performed more
            compactly using the <code>get()</code> method:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0019-04" id="f0019-04"
              >Click here to view code image</a
            >
          </p>
          <pre>p <span class="igrey">=</span> prices.get(<span class="mblue">'IBM'</span>, <span class="sgreen">0.0</span>)    <span class="hblue"># prices['IBM'] if it exists, else 0.0</span></pre>
          <p class="indent">
            Use the <code>del</code> statement to remove an element of a
            dictionary:
          </p>
          <pre><span class="lgreen"><strong>del</strong></span> prices[<span class="mblue">'GOOG'</span>]</pre>
          <p class="indent">
            Although strings are the most common type of key, you can use many
            other Python objects, including numbers and tuples. For example,
            tuples are often used to construct composite or multipart keys:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0019-06" id="f0019-06"
              >Click here to view code image</a
            >
          </p>
          <pre>prices <span class="igrey">=</span> { }
        prices[(<span class="mblue">'IBM'</span>, <span class="mblue">'2015-02-03'</span>)] <span class="igrey">=</span> <span class="sgreen">91.23</span>
        prices[<span class="mblue">'IBM'</span>, <span class="mblue">'2015-02-04'</span>] <span class="igrey">=</span> <span class="sgreen">91.42</span>     <span class="hblue"># Parens omitted</span></pre>
          <p class="indent">
            Any kind of object can be placed into a dictionary, including other
            dictionaries. However, mutable data structures such as lists, sets,
            and dictionaries cannot be used as keys.
          </p>
          <p class="indent">
            Dictionaries are often used as building blocks for various
            algorithms and data-handling problems. One such problem is
            tabulation. For example, here’s how you could count the total number
            of shares for each stock name in earlier data:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0019-07" id="f0019-07"
              >Click here to view code image</a
            >
          </p>
          <pre>portfolio <span class="igrey">=</span> [
           (<span class="mblue">'ACME'</span>, <span class="sgreen">50</span>, <span class="sgreen">92.34</span>),
           (<span class="mblue">'IBM'</span>, <span class="sgreen">75</span>, <span class="sgreen">102.25</span>),
           (<span class="mblue">'PHP'</span>, <span class="sgreen">40</span>, <span class="sgreen">74.50</span>),
        <span epub:type="pagebreak" id="page_20"></span>   (<span class="mblue">'IBM'</span>, <span class="sgreen">50</span>, <span class="sgreen">124.75</span>)
        ]
        
        total_shares <span class="igrey">=</span> { s[<span class="sgreen">0</span>]: <span class="sgreen">0</span> <span class="lgreen"><strong>for</strong></span> s <span class="lgreen"><strong>in</strong></span> portfolio }
        <span class="lgreen"><strong>for</strong></span> name, shares, _ <span class="lgreen"><strong>in</strong></span> portfolio:
            total_shares[name] <span class="igrey">+=</span> shares
        
        <span class="hblue"># total_shares = {'IBM': 125, 'ACME': 50, 'PHP': 40}</span></pre>
          <p class="indent">
            In this example, <code>{ s[0]: 0 for s in portfolio }</code> is an
            example of a dictionary comprehension. It creates a dictionary of
            key-value pairs from another collection of data. In this case, it’s
            making an initial dictionary mapping stock names to <code>0</code>.
            The <code>for</code> loop that follows iterates over the dictionary
            and adds up all of the held shares for each stock symbol.
          </p>
          <p class="indent">
            Many common data processing tasks such as this one have already been
            implemented by library modules. For example, the
            <code>collections</code> module has a <code>Counter</code> object
            that can be used for this task:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0020-02" id="f0020-02"
              >Click here to view code image</a
            >
          </p>
          <pre>from collections import Counter
        
        total_shares <span class="igrey">=</span> Counter()
        <span class="lgreen"><strong>for</strong></span> name, shares, _ <span class="lgreen"><strong>in</strong></span> portfolio:
            total_shares[name] <span class="igrey">+=</span> shares
        
        <span class="hblue"># total_shares = Counter({'IBM': 125, 'ACME': 50, 'PHP': 40})</span></pre>
          <p class="indent">
            An empty dictionary is created in one of two ways:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0020-03" id="f0020-03"
              >Click here to view code image</a
            >
          </p>
          <pre>prices <span class="igrey">=</span> {}        <span class="hblue"># An empty dict</span>
        prices <span class="igrey">=</span> dict()    <span class="hblue"># An empty dict</span></pre>
          <p class="indent">
            It is more idiomatic to use <code>{}</code> for an empty
            dictionary—although caution is required since it might look like you
            are trying to create an empty set (use <code>set()</code> instead).
            <code>dict()</code> is commonly used to create dictionaries from
            key-value values. For example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0020-04" id="f0020-04"
              >Click here to view code image</a
            >
          </p>
          <pre>pairs <span class="igrey">=</span> [(<span class="mblue">'IBM'</span>, <span class="sgreen">125</span>), (<span class="mblue">'ACME'</span>, <span class="sgreen">50</span>), (<span class="mblue">'PHP'</span>, <span class="sgreen">40</span>)]
        d <span class="igrey">=</span> dict(pairs)</pre>
          <p class="indent">
            To obtain a list of dictionary keys, convert a dictionary to a list:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0020-05" id="f0020-05"
              >Click here to view code image</a
            >
          </p>
          <pre>syms <span class="igrey">=</span> list(prices)     <span class="hblue"># syms = ['AAPL', 'MSFT', 'IBM', 'GOOG']</span></pre>
          <p class="indent">
            Alternatively, you can obtain the keys using
            <code>dict.keys()</code>:
          </p>
          <pre>syms <span class="igrey">=</span> prices.keys()</pre>
          <p class="indent">
            The difference between these two methods is that
            <code>keys()</code> returns a special “keys view” that is attached
            to the dictionary and actively reflects changes made to the
            dictionary. For example:<span
              epub:type="pagebreak"
              id="page_21"
            ></span>
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0021-01" id="f0021-01"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; d = { 'x': 2, 'y':3 }
        &gt;&gt;&gt; k = d.keys()
        &gt;&gt;&gt; k
        dict_keys(['x', 'y'])
        &gt;&gt;&gt; d['z'] = 4
        &gt;&gt;&gt; k
        dict_keys(['x', 'y', 'z'])
        &gt;&gt;&gt;</pre
          >
          <p class="indent">
            The keys always appear in the same order as the items were initially
            inserted into the dictionary. The list conversion above will
            preserve this order. This can be useful when dicts are used to
            represent key-value data read from files and other data sources. The
            dictionary will preserve the input order. This might help
            readability and debugging. It’s also nice if you want to write the
            data back to a file. Prior to Python 3.6, however, this ordering was
            not guaranteed, so you cannot rely upon it if compatibility with
            older versions of Python is required. Order is also not guaranteed
            if multiple deletions and insertions have taken place.
          </p>
          <p class="indent">
            To obtain the values stored in a dictionary, use the
            <code>dict.values()</code> method. To obtain key-value pairs, use
            <code>dict.items()</code>. For example, here’s how to iterate over
            the entire contents of a dictionary as key-value pairs:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0021-02" id="f0021-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>for</strong></span> sym, price <span class="lgreen"><strong>in</strong></span> prices.items():
            print(<span class="trose">f'</span><span class="mblue">{</span>sym<span class="mblue">}</span> <span class="trose">=</span> <span class="mblue">{</span>price<span class="mblue">}</span><span class="trose">'</span>)</pre>
        </section>
        <section>
          <h3 class="h3" id="ch01lev1sec12">1.12 Iteration and Looping</h3>
          <p class="noindent">
            The most widely used looping construct is the
            <code>for</code> statement that iterates over a collection of items.
            One common form of iteration is to loop over all the members of a
            sequence—such as a string, list, or tuple. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0021-03" id="f0021-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>for</strong></span> n <span class="lgreen"><strong>in</strong></span> [<span class="sgreen">1</span>, <span class="sgreen">2</span>, <span class="sgreen">3</span>, <span class="sgreen">4</span>, <span class="sgreen">5</span>, <span class="sgreen">6</span>, <span class="sgreen">7</span>, <span class="sgreen">8</span>, <span class="sgreen">9</span>]:
            print(<span class="trose">f'2 to the</span> <span class="mblue">{n}</span> <span class="trose">power is</span> <span class="mblue">{</span><span class="sgreen">2</span><span class="igrey">**</span><span class="mblue">n}</span><span class="trose">'</span>)</pre>
          <p class="indent">
            In this example, the variable <code>n</code> will be assigned
            successive items from the list <code>[1, 2, 3, 4, ..., 9]</code> on
            each iteration. Since looping over ranges of integers is quite
            common, there is a shortcut:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0021-04" id="f0021-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>for</strong></span> n <span class="lgreen"><strong>in</strong></span> range(<span class="sgreen">1</span>, <span class="sgreen">10</span>):
            print(<span class="trose">f'2 to the</span> <span class="mblue">{n}</span> <span class="trose">power is</span> <span class="mblue">{</span><span class="sgreen">2</span><span class="igrey">**</span><span class="mblue">n}</span><span class="trose">'</span>)</pre>
          <p class="indent">
            The <code>range(i, j [,step])</code> function creates an object that
            represents a range of integers with values from <code>i</code> up
            to, but not including, <code>j</code>. If the starting value is
            omitted, it’s taken to be zero. An optional stride can also be given
            as a third argument. Here are some examples:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0021-05" id="f0021-05"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> range(<span class="sgreen">5</span>)         <span class="hblue"># a = 0, 1, 2, 3, 4</span>
        b <span class="igrey">=</span> range(<span class="sgreen">1</span>, <span class="sgreen">8</span>)      <span class="hblue"># b = 1, 2, 3, 4, 5, 6, 7</span>
        c <span class="igrey">=</span> range(<span class="sgreen">0</span>, <span class="sgreen">14</span>, <span class="sgreen">3</span>)  <span class="hblue"># c = 0, 3, 6, 9, 12</span>
        d <span class="igrey">=</span> range(<span class="sgreen">8</span>, <span class="sgreen">1</span>, <span class="igrey">-</span><span class="sgreen">1</span>)  <span class="hblue"># d = 8, 7, 6, 5, 4, 3, 2</span></pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_22"></span>The object created
            by <code>range()</code> computes the values it represents on demand
            when lookups are requested. Thus, it’s efficient to use even with a
            large range of numbers.
          </p>
          <p class="indent">
            The <code>for</code> statement is not limited to sequences of
            integers. It can be used to iterate over many kinds of objects
            including strings, lists, dictionaries, and files. Here’s an
            example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0022-01" id="f0022-01"
              >Click here to view code image</a
            >
          </p>
          <pre>message <span class="igrey">=</span> <span class="mblue">'Hello World'</span>
        <span class="hblue"># Print out the individual characters in message</span>
        <span class="lgreen"><strong>for</strong></span> c <span class="lgreen"><strong>in</strong></span> message:
            print(c)
        
        names <span class="igrey">=</span> [<span class="mblue">'Dave'</span>, <span class="mblue">'Mark'</span>, <span class="mblue">'Ann'</span>, <span class="mblue">'Phil'</span>]
        <span class="hblue"># Print out the members of a list</span>
        <span class="lgreen"><strong>for</strong></span> name <span class="lgreen"><strong>in</strong></span> names:
            print(name)
        
        prices <span class="igrey">=</span> { <span class="mblue">'GOOG'</span> : <span class="sgreen">490.10</span>, <span class="mblue">'IBM'</span> : <span class="sgreen">91.50</span>, <span class="mblue">'AAPL'</span> : <span class="sgreen">123.15</span> }
        <span class="hblue"># Print out all of the members of a dictionary</span>
        
        <span class="lgreen"><strong>for</strong></span> key <span class="lgreen"><strong>in</strong></span> prices:
            print(key, <span class="mblue">'='</span>, prices[key])
        
        <span class="hblue"># Print all of the lines in a file</span>
        <span class="lgreen"><strong>with</strong></span> open(<span class="mblue">'foo.txt'</span>) as file:
            <span class="lgreen"><strong>for</strong></span> line <span class="lgreen"><strong>in</strong></span> file:
                print(line, end<span class="igrey">=</span><span class="mblue">''</span>)</pre>
          <p class="indent">
            The <code>for</code> loop is one of Python’s most powerful language
            features because you can create custom iterator objects and
            generator functions that supply it with sequences of values. More
            details about iterators and generators can be found later in
            <a href="ch06.xhtml#ch06">Chapter 6</a>.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch01lev1sec13">1.13 Functions</h3>
          <p class="noindent">
            Use the <code>def</code> statement to define a function:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0022-02" id="f0022-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> remainder(a, b):
            q <span class="igrey">=</span> a <span class="igrey">//</span> b       <span class="hblue"># // is truncating division.</span>
            r <span class="igrey">=</span> a <span class="igrey">-</span> q <span class="igrey">*</span> b
            <span class="lgreen"><strong>return</strong></span> r</pre>
          <p class="indent">
            To invoke a function, use its name followed by its arguments in
            parentheses, for example <code>result = remainder(37, 15)</code>.
          </p>
          <p class="indent">
            It is common practice for a function to include a documentation
            string as the first statement. This string feeds the
            <code>help()</code> command and may be used by IDEs and other
            development tools to assist the programmer. For example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0022-03" id="f0022-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> remainder(a, b):
            <span class="hblue">'''</span>
        <span epub:type="pagebreak" id="page_23"></span>    <span class="hblue">Computes the remainder of dividing a by b</span>
            <span class="hblue">'''</span>
            q <span class="igrey">=</span> a <span class="igrey">//</span> b
            r <span class="igrey">=</span> a <span class="igrey">-</span> q <span class="igrey">*</span> b
            <span class="lgreen"><strong>return</strong></span> r</pre>
          <p class="indent">
            If the inputs and outputs of a function aren’t clear from their
            names, they might be annotated with types:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0023-01" id="f0023-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> remainder(a: int, b: int) <span class="igrey">-&gt;</span> int:
            <span class="hblue">'''</span>
            <span class="hblue">Computes the remainder of dividing a by b</span>
            <span class="hblue">'''</span>
            q <span class="igrey">=</span> a <span class="igrey">//</span> b
            r <span class="igrey">=</span> a <span class="igrey">-</span> q <span class="igrey">*</span> b
            <span class="lgreen"><strong>return</strong></span> r</pre>
          <p class="indent">
            Such annotations are merely informational and are not actually
            enforced at runtime. Someone could still call the above function
            with non-integer values, such as
            <code>result = remainder(37.5, 3.2)</code>.
          </p>
          <p class="indent">
            Use a tuple to return multiple values from a function:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0023-03" id="f0023-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> divide(a, b):
            q <span class="igrey">=</span> a <span class="igrey">//</span> b         <span class="hblue"># If a and b are integers, q is integer</span>
            r <span class="igrey">=</span> a <span class="igrey">-</span> q <span class="igrey">*</span> b
            <span class="lgreen"><strong>return</strong></span> (q, r)</pre>
          <p class="indent">
            When multiple values are returned in a tuple, they can be unpacked
            into separate variables like this:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0023-04" id="f0023-04"
              >Click here to view code image</a
            >
          </p>
          <pre>quotient, remainder <span class="igrey">=</span> divide(<span class="sgreen">1456</span>, <span class="sgreen">33</span>)</pre>
          <p class="indent">
            To assign a default value to a function parameter, use assignment:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0023-05" id="f0023-05"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> connect(hostname, port, timeout<span class="igrey">=</span><span class="sgreen">300</span>):
            <span class="hblue"># Function body</span>
            ...</pre>
          <p class="indent">
            When default values are given in a function definition, they can be
            omitted from subsequent function calls. An omitted argument will
            take on the supplied default value. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0023-06" id="f0023-06"
              >Click here to view code image</a
            >
          </p>
          <pre>connect(<span class="mblue">'www.python.org'</span>, <span class="sgreen">80</span>)
        connect(<span class="mblue">'www.python.org'</span>, <span class="sgreen">80</span>, <span class="sgreen">500</span>)</pre>
          <p class="indent">
            Default arguments are often used for optional features. If there are
            many such arguments, readability can suffer. It’s therefore
            recommended to specify such arguments using keyword arguments. For
            example:<span epub:type="pagebreak" id="page_24"></span>
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0024-01" id="f0024-01"
              >Click here to view code image</a
            >
          </p>
          <pre>connect(<span class="mblue">'www.python.org'</span>, <span class="sgreen">80</span>, timeout<span class="igrey">=</span><span class="sgreen">500</span>)</pre>
          <p class="indent">
            If you know the names of the arguments, all of them can be named
            when calling a function. When named, the order in which they are
            listed doesn’t matter. For example, this is fine:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0024-02" id="f0024-02"
              >Click here to view code image</a
            >
          </p>
          <pre>connect(port<span class="igrey">=</span><span class="sgreen">80</span>, hostname<span class="igrey">=</span><span class="mblue">'www.python.org'</span>)</pre>
          <p class="indent">
            When variables are created or assigned inside a function, their
            scope is local. That is, the variable is only defined inside the
            body of the function and is destroyed when the function returns.
            Functions can also access variables defined outside of a function as
            long as they are defined in the same file. For example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0024-03" id="f0024-03"
              >Click here to view code image</a
            >
          </p>
          <pre>debug <span class="igrey">=</span> <span class="dblue">True</span>      <span class="hblue"># Global variable</span>
        
        <span class="lgreen"><strong>def</strong></span> read_data(filename):
            <span class="lgreen"><strong>if</strong></span> debug:
                print(<span class="mblue">'Reading'</span>, filename)
            ...</pre>
          <p class="indent">
            Scoping rules are described in more detail in
            <a href="ch05.xhtml#ch05">Chapter 5</a>.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch01lev1sec14">1.14 Exceptions</h3>
          <p class="noindent">
            If an error occurs in your program, an exception is raised and a
            traceback message appears:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0024-04" id="f0024-04"
              >Click here to view code image</a
            >
          </p>
          <pre>Traceback (most recent call last):
          File <span class="mblue">"readport.py"</span>, line <span class="sgreen">9</span>, <span class="lgreen"><strong>in</strong></span> <span class="igrey">&lt;</span>module<span class="igrey">&gt;</span>
            shares <span class="igrey">=</span> int(row[<span class="sgreen">1</span>])
        <span class="pgold">ValueError</span>: invalid literal <span class="lgreen"><strong>for</strong></span> int() <span class="lgreen"><strong>with</strong></span> base <span class="sgreen">10</span>: <span class="mblue">'N/A'</span></pre>
          <p class="indent">
            The traceback message indicates the type of error that occurred,
            along with its location. Normally, errors cause a program to
            terminate. However, you can catch and handle exceptions using
            <code>try</code> and <code>except</code> statements, like this:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0024-05" id="f0024-05"
              >Click here to view code image</a
            >
          </p>
          <pre>portfolio <span class="igrey">=</span> []
        <span class="lgreen"><strong>with</strong></span> open(<span class="mblue">'portfolio.csv'</span>) as file:
            <span class="lgreen"><strong>for</strong></span> line <span class="lgreen"><strong>in</strong></span> file:
                row <span class="igrey">=</span> line.split(<span class="mblue">','</span>)
                <span class="lgreen"><strong>try</strong></span>:
                    name <span class="igrey">=</span> row[<span class="sgreen">0</span>]
                    shares <span class="igrey">=</span> int(row[<span class="sgreen">1</span>])
                    price <span class="igrey">=</span> float(row[<span class="sgreen">2</span>])
                    holding <span class="igrey">=</span> (name, shares, price)
                    portfolio.append(holding)
                <span class="lgreen"><strong>except</strong></span> <span class="pgold">ValueError</span> as err:
        <span epub:type="pagebreak" id="page_25"></span>            print(<span class="mblue">'Bad row:'</span>, row)
                    print(<span class="mblue">'Reason:'</span>, err)</pre>
          <p class="indent">
            In this code, if a <code>ValueError</code> occurs, details
            concerning the cause of the error are placed in <code>err</code> and
            control passes to the code in the <code>except</code> block. If some
            other kind of exception is raised, the program crashes as usual. If
            no errors occur, the code in the <code>except</code> block is
            ignored. When an exception is handled, program execution resumes
            with the statement that immediately follows the last
            <code>except</code> block. The program does not return to the
            location where the exception occurred.
          </p>
          <p class="indent">
            The <code>raise</code> statement is used to signal an exception. You
            need to give the name of an exception. For instance, here’s how to
            raise <code>RuntimeError</code>, a built-in exception:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0025-02" id="f0025-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>raise</strong></span> <span class="pgold">RuntimeError</span>(<span class="mblue">'Computer says no'</span>)</pre>
          <p class="indent">
            Proper management of system resources such as locks, files, and
            network connections is often tricky when combined with exception
            handling. Sometimes there are actions that must be performed no
            matter what happens. For this, use
            <code>try</code>-<code>finally</code>. Here is an example involving
            a lock that must be released to avoid deadlock:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0025-03" id="f0025-03"
              >Click here to view code image</a
            >
          </p>
          <pre>import threading
        lock <span class="igrey">=</span> threading.Lock()
        ...
        lock.acquire()
        <span class="hblue"># If a lock has been acquired, it MUST be released</span>
        <span class="lgreen"><strong>try</strong></span>:
            ...
            statements
            ...
        <span class="lgreen"><strong>finally</strong></span>:
            lock.release()       <span class="hblue"># Always runs</span></pre>
          <p class="indent">
            To simplify such programming, most objects that involve resource
            management also support the <code>with</code> statement. Here is a
            modified version of the above code:
          </p>
          <pre><span class="lgreen"><strong>with</strong></span> lock:
            ...
            statements
            ...</pre>
          <p class="indent">
            In this example, the <code>lock</code> object is automatically
            acquired when the <code>with</code> statement executes. When
            execution leaves the context of the with block, the lock is
            automatically released. This is done regardless of what happens
            inside the <code>with</code> block. For example, if an exception
            occurs, the lock is released when control leaves the context of the
            block.
          </p>
          <p class="indent">
            The <code>with</code> statement is normally only compatible with
            objects related to system resources or the execution
            environment—such as files, connections, and locks. However,
            user-defined objects can have their own custom processing, as
            described further in <a href="ch03.xhtml#ch03">Chapter 3</a>.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch01lev1sec15">
            <span epub:type="pagebreak" id="page_26"></span>1.15 Program
            Termination
          </h3>
          <p class="noindent">
            A program terminates when no more statements exist to execute in the
            input program or when an uncaught <code>SystemExit</code> exception
            is raised. If you want to force a program to quit, here’s how to do
            it:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0026-01" id="f0026-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>raise</strong></span> <span class="pgold">SystemExit</span>()                      <span class="hblue"># Exit with no error message</span>
        <span class="lgreen"><strong>raise</strong></span> <span class="pgold">SystemExit</span>(<span class="mblue">"Something is wrong"</span>)  <span class="hblue"># Exit with error</span></pre>
          <p class="indent">
            On exit, the interpreter makes a best effort to garbage-collect all
            active objects. However, if you need to perform a specific cleanup
            action (remove files, close a connection), you can register it with
            the <code>atexit</code> module as follows:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0026-02" id="f0026-02"
              >Click here to view code image</a
            >
          </p>
          <pre>import atexit
        
        <span class="hblue"># Example</span>
        connection <span class="igrey">=</span> open_connection(<span class="mblue">"deaddot.com"</span>)
        
        <span class="lgreen"><strong>def</strong></span> cleanup():
            print <span class="mblue">"Going away..."</span>
            close_connection(connection)
        
        atexit.register(cleanup)</pre>
        </section>
        <section>
          <h3 class="h3" id="ch01lev1sec16">1.16 Objects and Classes</h3>
          <p class="noindent">
            All values used in a program are objects. An object consists of
            internal data and methods that perform various kinds of operations
            involving that data. You have already used objects and methods when
            working with the built-in types such as strings and lists. For
            example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0026-03" id="f0026-03"
              >Click here to view code image</a
            >
          </p>
          <pre>items <span class="igrey">=</span> [<span class="sgreen">37</span>, <span class="sgreen">42</span>]      <span class="hblue"># Create a list object</span>
        items.append(<span class="sgreen">73</span>)      <span class="hblue"># Call the append() method</span></pre>
          <p class="indent">
            The <code>dir()</code> function lists the methods available on an
            object. It is a useful tool for interactive experimentation when no
            fancy IDE is available. For example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0026-04" id="f0026-04"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; items = [37, 42]
        &gt;&gt;&gt; dir(items)
        ['__add__', '__class__', '__contains__', '__delattr__', '__delitem__',
        ...
         'append', 'count', 'extend', 'index', 'insert', 'pop',
         'remove', 'reverse', 'sort']
        &gt;&gt;&gt;</pre
          >
          <p class="indent">
            When inspecting objects, you will see familiar methods such as
            <code>append()</code> and <code>insert()</code> listed. However, you
            will also see special methods whose names begin and end with a
            <span epub:type="pagebreak" id="page_27"></span>double underscore.
            These methods implement various operators. For example, the
            <code>__add__()</code> method is used to implement the
            <code>+</code> operator. These methods are explained in more detail
            in later chapters.
          </p>
          <pre>
&gt;&gt;&gt; items.__add__([73, 101])
        [37, 42, 73, 101]
        &gt;&gt;&gt;</pre
          >
          <p class="indent">
            The <code>class</code> statement is used to define new types of
            objects and for object-oriented programming. For example, the
            following class defines a stack with <code>push()</code> and
            <code>pop()</code> operations:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0027-02" id="f0027-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Stack:
            <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>):          <span class="hblue"># Initialize the stack</span>
                <span class="dblue">self</span>._items <span class="igrey">=</span> [ ]
        
            <span class="lgreen"><strong>def</strong></span> push(<span class="dblue">self</span>, item):
                <span class="dblue">self</span>._items.append(item)
        
            <span class="lgreen"><strong>def</strong></span> pop(<span class="dblue">self</span>):
                <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>._items.pop()
        
            <span class="lgreen"><strong>def</strong></span> <span class="cblue">__repr__</span>(<span class="dblue">self</span>):
                <span class="lgreen"><strong>return</strong></span> <span class="trose">f'&lt;</span><span class="mblue">{</span>type(<span class="dblue">self</span>)<span class="mblue">.</span><span class="dblue">__name__</span><span class="mblue">}</span> <span class="trose">at 0x</span><span class="mblue">{</span>id(<span class="dblue">self</span>)<span class="mblue">:x}</span><span class="trose">, size=</span><span class="mblue">{</span>len(<span class="dblue">self</span>)<span class="mblue">}</span><span class="trose">&gt;'</span>
        
            <span class="lgreen"><strong>def</strong></span> <span class="cblue">__len__</span>(<span class="dblue">self</span>):
                <span class="lgreen"><strong>return</strong></span> len(<span class="dblue">self</span>._items)</pre>
          <p class="indent">
            Inside the class definition, methods are defined using the
            <code>def</code> statement. The first argument in each method always
            refers to the object itself. By convention, <code>self</code> is the
            name used for this argument. All operations involving the attributes
            of an object must explicitly refer to the
            <code>self</code> variable. Methods with leading and trailing double
            underscores are special methods. For example,
            <code>__init__</code> is used to initialize an object. In this case,
            <code>__init__</code> creates an internal list for storing the stack
            data.
          </p>
          <p class="indent">To use a class, write code such as this:</p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0027-03" id="f0027-03"
              >Click here to view code image</a
            >
          </p>
          <pre>s <span class="igrey">=</span> Stack()              <span class="hblue"># Create a stack</span>
        s.push(<span class="mblue">'Dave'</span>)           <span class="hblue"># Push some things onto it</span>
        s.push(<span class="sgreen">42</span>)
        s.push([<span class="sgreen">3</span>, <span class="sgreen">4</span>, <span class="sgreen">5</span>])
        x <span class="igrey">=</span> s.pop()              <span class="hblue"># x gets [3,4,5]</span>
        y <span class="igrey">=</span> s.pop()              <span class="hblue"># y gets 42</span></pre>
          <p class="indent">
            Within the class, you will notice that the methods use an internal
            <code>_items</code> variable. Python does not have any mechanism for
            hiding or protecting data. However, there is a programming
            convention wherein names preceded by a single underscore are taken
            to be <span epub:type="pagebreak" id="page_28"></span>“private.” In
            this example, <code>_items</code> should be treated (by you) as
            internal implementation and not used outside the
            <code>Stack</code> class itself. Be aware that there is no actual
            enforcement of this convention—if you want to access
            <code>_items</code>, you can do so at any time. You’ll just have to
            answer to your coworkers when they review your code.
          </p>
          <p class="indent">
            The <code>__repr__()</code> and <code>__len__()</code> methods are
            there to make the object play nicely with the rest of the
            environment. Here, <code>__len__()</code> makes a
            <code>Stack</code> work with the built-in
            <code>len()</code> function and <code>__repr__()</code> changes the
            way that a <code>Stack</code> is displayed and printed. It’s a good
            idea to always define <code>__repr__()</code> as it can simplify
            debugging.
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0028-01" id="f0028-01"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; s = Stack()
        &gt;&gt;&gt; s.push('Dave')
        &gt;&gt;&gt; s.push(42)
        &gt;&gt;&gt; len(s)
        2
        &gt;&gt;&gt; s
        &lt;Stack at 0x10108c1d0, size=2&gt;
        &gt;&gt;&gt;</pre
          >
          <p class="indent">
            A major feature of objects is that you can add to or redefine the
            capabilities of existing classes via inheritance.
          </p>
          <p class="indent">
            Suppose you wanted to add a method to swap the top two items on the
            stack. You might write a class like this:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0028-02" id="f0028-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
class MyStack(Stack):
            def swap(self):
                a = self.pop()
                b = self.pop()
                self.push(a)
                self.push(b)</pre
          >
          <p class="indent">
            <code>MyStack</code> is identical to <code>Stack</code> except that
            it has a new method, <code>swap()</code>.
          </p>
          <pre>
&gt;&gt;&gt; s = MyStack()
        &gt;&gt;&gt; s.push('Dave')
        &gt;&gt;&gt; s.push(42)
        &gt;&gt;&gt; s.swap()
        &gt;&gt;&gt; s.pop()
        'Dave'
        &gt;&gt;&gt; s.pop()
        42
        &gt;&gt;&gt;</pre
          >
          <p class="indent">
            Inheritance can also be used to change the behavior of an existing
            method. Suppose you want to restrict the stack to only hold numeric
            data. Write a class like this:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0028-04" id="f0028-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> NumericStack(Stack):
            <span class="lgreen"><strong>def</strong></span> push(<span class="dblue">self</span>, item):
        <span epub:type="pagebreak" id="page_29"></span>        <span class="lgreen"><strong>if not</strong></span> isinstance(item, (int, float)):
                    <span class="lgreen"><strong>raise</strong></span> <span class="pgold">TypeError</span>(<span class="mblue">'Expected an int or float'</span>)
                super().push(item)</pre>
          <p class="indent">
            In this example, the <code>push()</code> method has been redefined
            to add extra checking. The <code>super()</code> operation is a way
            to invoke the prior definition of <code>push()</code>. Here’s how
            this class would work:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0029-02" id="f0029-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; s = NumericStack()
        &gt;&gt;&gt; s.push(42)
        &gt;&gt;&gt; s.push('Dave')
        Traceback (most recent call last):
           ...
        TypeError: Expected an int or float
        &gt;&gt;&gt;</pre
          >
          <p class="indent">
            Often, inheritance is not the best solution. Suppose you wanted to
            define a simple stack-based 4-function calculator that worked like
            this:
          </p>
          <pre>
&gt;&gt;&gt; # Calculate 2 + 3 * 4
        &gt;&gt;&gt; calc = Calculator()
        &gt;&gt;&gt; calc.push(2)
        &gt;&gt;&gt; calc.push(3)
        &gt;&gt;&gt; calc.push(4)
        &gt;&gt;&gt; calc.mul()
        &gt;&gt;&gt; calc.add()
        &gt;&gt;&gt; calc.pop()
        14
        &gt;&gt;&gt;</pre
          >
          <p class="indent">
            You might look at this code, see the use of <code>push()</code> and
            <code>pop()</code>, and think that <code>Calculator</code> could be
            defined by inheriting from <code>Stack</code>. Although that would
            work, it is probably better to define <code>Calculator</code> as a
            completely separate class:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0029-04" id="f0029-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Calculator:
            <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>):
                <span class="dblue">self</span>._stack <span class="igrey">=</span> Stack()
        
            <span class="lgreen"><strong>def</strong></span> push(<span class="dblue">self</span>, item):
                <span class="dblue">self</span>._stack.push(item)
        
            <span class="lgreen"><strong>def</strong></span> pop(<span class="dblue">self</span>):
                <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>._stack.pop()
        
            <span class="lgreen"><strong>def</strong></span> add(<span class="dblue">self</span>):
                <span class="dblue">self</span>.push(<span class="dblue">self</span>.pop() <span class="igrey">+</span> <span class="dblue">self</span>.pop())
        
        <span epub:type="pagebreak" id="page_30"></span>    <span class="lgreen"><strong>def</strong></span> mul(<span class="dblue">self</span>):
                <span class="dblue">self</span>.push(<span class="dblue">self</span>.pop() <span class="igrey">*</span> <span class="dblue">self</span>.pop())
        
            <span class="lgreen"><strong>def</strong></span> sub(<span class="dblue">self</span>):
                right <span class="igrey">=</span> <span class="dblue">self</span>.pop()
                <span class="dblue">self</span>.push(<span class="dblue">self</span>.pop() <span class="igrey">-</span> right)
        
            <span class="lgreen"><strong>def</strong></span> div(<span class="dblue">self</span>):
                right <span class="igrey">=</span> <span class="dblue">self</span>.pop()
                <span class="dblue">self</span>.push(<span class="dblue">self</span>.pop() <span class="igrey">/</span> right)</pre>
          <p class="indent">
            In this implementation, a <code>Calculator</code> contains a
            <code>Stack</code> as an internal implementation detail. This is an
            example of <em>composition.</em> The <code>push()</code> and
            <code>pop()</code> methods delegate to the internal
            <code>Stack</code>. The main reason for taking this approach is that
            you don’t really think of the <code>Calculator</code> as a
            <code>Stack</code>. It’s a separate concept—a different kind of
            object. By analogy, your phone contains a central processing unit
            (CPU) but you don’t usually think of your phone as a type of CPU.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch01lev1sec17">1.17 Modules</h3>
          <p class="noindent">
            As your programs grow in size, you will want to break them into
            multiple files for easier maintenance. To do this, use the
            <code>import</code> statement. To create a module, put the relevant
            statements and definitions into a file with a
            <code>.py</code> suffix and the same name as the module. Here’s an
            example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0030-02" id="f0030-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># readport.py</span>
        <span class="hblue">#</span>
        <span class="hblue"># Reads a file of 'NAME,SHARES,PRICE' data</span>
        
        <span class="lgreen"><strong>def</strong></span> read_portfolio(filename):
            portfolio <span class="igrey">=</span> []
            <span class="lgreen"><strong>with</strong></span> open(filename) as file:
                <span class="lgreen"><strong>for</strong></span> line <span class="lgreen"><strong>in</strong></span> file:
                    row <span class="igrey">=</span> line.split(<span class="mblue">','</span>)
                    <span class="lgreen"><strong>try</strong></span>:
                        name <span class="igrey">=</span> row[<span class="sgreen">0</span>]
                        shares <span class="igrey">=</span> int(row[<span class="sgreen">1</span>])
                        price <span class="igrey">=</span> float(row[<span class="sgreen">2</span>])
                        holding <span class="igrey">=</span> (name, shares, price)
                        portfolio.append(holding)
                    <span class="lgreen"><strong>except</strong></span> <span class="pgold">ValueError</span> as err:
                        print(<span class="mblue">'Bad row:'</span>, row)
                        print(<span class="mblue">'Reason:'</span>, err)
            <span class="lgreen"><strong>return</strong></span> portfolio</pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_31"></span>To use your module
            in other files, use the <code>import</code> statement. For example,
            here is a module <code>pcost.py</code> that uses the above
            <code>read_portfolio()</code> function:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0031-01" id="f0031-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># pcost.py</span>
        
        import readport
        
        <span class="lgreen"><strong>def</strong></span> portfolio_cost(filename):
            <span class="hblue">'''</span>
            <span class="hblue">Compute the total shares*price of a portfolio</span>
            <span class="hblue">'''</span>
            port <span class="igrey">=</span> readport.read_portfolio(filename)
            <span class="lgreen"><strong>return</strong></span> sum(shares <span class="igrey">*</span> price <span class="lgreen"><strong>for</strong></span> _, shares, price <span class="lgreen"><strong>in</strong></span> port)</pre>
          <p class="indent">
            The <code>import</code> statement creates a new namespace (or
            environment) and executes all the statements in the associated
            <code>.py</code> file within that namespace. To access the contents
            of the namespace after import, use the name of the module as a
            prefix, as in <code>readport.read_portfolio()</code> in the
            preceding example.
          </p>
          <p class="indent">
            If the <code>import</code> statement fails with an
            <code>ImportError</code> exception, you need to check a few things
            in your environment. First, make sure you created a file called
            <code>readport.py</code>. Next, check the directories listed on
            <code>sys.path</code>. If your file isn’t saved in one of those
            directories, Python won’t be able to find it.
          </p>
          <p class="indent">
            If you want to import a module under a different name, supply the
            <code>import</code> statement with an optional
            <code>as</code> qualifier:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0031-02" id="f0031-02"
              >Click here to view code image</a
            >
          </p>
          <pre>import readport as rp
        port <span class="igrey">=</span> rp.read_portfolio(<span class="mblue">'portfolio.dat'</span>)</pre>
          <p class="indent">
            To import specific definitions into the current namespace, use the
            <code>from</code> statement:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0031-03" id="f0031-03"
              >Click here to view code image</a
            >
          </p>
          <pre>from readport import read_portfolio
        port <span class="igrey">=</span> read_portfolio(<span class="mblue">'portfolio.dat'</span>)</pre>
          <p class="indent">
            As with objects, the <code>dir()</code> function lists the contents
            of a module. It is a useful tool for interactive experimentation.
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0031-04" id="f0031-04"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; import readport
        &gt;&gt;&gt; dir(readport)
        ['__builtins__', '__cached__', '__doc__', '__file__', '__loader__',
          '__name__', '__package__', '__spec__', 'read_portfolio']
        ...
        &gt;&gt;&gt;</pre
          >
          <p class="indent">
            Python provides a large standard library of modules that simplify
            certain programming tasks. For example, the <code>csv</code> module
            is a standard library for dealing with files of comma-separated
            values. You could use it in your program as follows:<span
              epub:type="pagebreak"
              id="page_32"
            ></span>
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0032-01" id="f0032-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># readport.py</span>
        <span class="hblue">#</span>
        <span class="hblue"># Reads a file of 'NAME,SHARES,PRICE' data</span>
        
        import csv
        
        <span class="lgreen"><strong>def</strong></span> read_portfolio(filename):
            portfolio <span class="igrey">=</span> []
            <span class="lgreen"><strong>with</strong></span> open(filename) as file:
                rows <span class="igrey">=</span> csv.reader(file)
                <span class="lgreen"><strong>for</strong></span> row <span class="lgreen"><strong>in</strong></span> rows:
                    <span class="lgreen"><strong>try</strong></span>:
                        name <span class="igrey">=</span> row[<span class="sgreen">0</span>]
                        shares <span class="igrey">=</span> int(row[<span class="sgreen">1</span>])
                        price <span class="igrey">=</span> float(row[<span class="sgreen">2</span>])
                        holding <span class="igrey">=</span> (name, shares, price)
                        portfolio.append(holding)
                    <span class="lgreen"><strong>except</strong></span> <span class="pgold">ValueError</span> as err:
                        print(<span class="mblue">'Bad row:'</span>, row)
                        print(<span class="mblue">'Reason:'</span>, err)
            <span class="lgreen"><strong>return</strong></span> portfolio</pre>
          <p class="indent">
            Python also has a vast number of third-party modules that can be
            installed to solve almost any imaginable task (including the reading
            of CSV files). See
            <code><a href="https://pypi.org">https://pypi.org</a></code
            >.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch01lev1sec18">1.18 Script Writing</h3>
          <p class="noindent">
            Any file can execute either as a script or as a library imported
            with <code>import</code>. To better support imports, script code is
            often enclosed with a conditional check against the module name:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0032-02" id="f0032-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># readport.py</span>
        <span class="hblue">#</span>
        <span class="hblue"># Reads a file of 'NAME,SHARES,PRICE' data</span>
        
        import csv
        
        <span class="lgreen"><strong>def</strong></span> read_portfolio(filename):
            ...
        
        <span class="lgreen"><strong>def</strong></span> main():
            portfolio <span class="igrey">=</span> read_portfolio(<span class="mblue">'portfolio.csv'</span>)
            <span class="lgreen"><strong>for</strong></span> name, shares, price <span class="lgreen"><strong>in</strong></span> portfolio:
                print(<span class="trose">f'</span><span class="mblue">{</span>name<span class="mblue">:&gt;10s} {</span>shares<span class="mblue">:10d} {</span>price<span class="mblue">:10.2f}</span><span class="trose">'</span>)
        
        <span epub:type="pagebreak" id="page_33"></span><span class="lgreen"><strong>if</strong></span> <span class="dblue">__name__</span> <span class="igrey">==</span> <span class="mblue">'__main__'</span>:
            main()</pre>
          <p class="indent">
            <code>__name__</code> is a built-in variable that always contains
            the name of the enclosing module. If a program is run as the main
            script with a command such as <code>python readport.py</code>, the
            <code>__name__</code> variable is set to <code>'__main__'</code>.
            Otherwise, if the code is imported using a statement such as
            <code>import readport</code>, the <code>__name__</code> variable is
            set to <code>'readport'</code>.
          </p>
          <p class="indent">
            As shown, the program is hardcoded to use a filename
            <code>'portfolio.csv'</code>. Instead, you may want to prompt the
            user for a filename or accept the filename as a command-line
            argument. To do this, use the built-in <code>input()</code> function
            or the <code>sys.argv</code> list. For example, here is a modified
            version of the <code>main()</code> function:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0033-02" id="f0033-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> main(argv):
            <span class="lgreen"><strong>if</strong></span> len(argv) <span class="igrey">==</span> <span class="sgreen">1</span>:
                filename <span class="igrey">=</span> input(<span class="mblue">'Enter filename: '</span>)
            <span class="lgreen"><strong>elif</strong></span> len(argv) <span class="igrey">==</span> <span class="sgreen">2</span>:
                filename <span class="igrey">=</span> argv[<span class="sgreen">1</span>]
            <span class="lgreen"><strong>else</strong></span>:
                <span class="lgreen"><strong>raise</strong></span> <span class="pgold">SystemExit</span>(<span class="trose">f'Usage:</span> <span class="mblue">{</span>argv[<span class="sgreen">0</span>]<span class="mblue">}</span> <span class="trose">[ filename ]'</span>)
            portfolio <span class="igrey">=</span> read_portfolio(filename)
            <span class="lgreen"><strong>for</strong></span> name, shares, price <span class="lgreen"><strong>in</strong></span> portfolio:
                print(<span class="trose">f'</span><span class="mblue">{</span>name<span class="mblue">:&gt;10s} {</span>shares<span class="mblue">:10d} {</span>price<span class="mblue">:10.2f}</span><span class="trose">'</span>)
        
        <span class="lgreen"><strong>if</strong></span> <span class="dblue">__name__</span> <span class="igrey">==</span> <span class="mblue">'__main__'</span>:
            import sys
            main(sys.argv)</pre>
          <p class="indent">
            This program can be run in two different ways from the command line:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0033-03" id="f0033-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="cblue">bash</span> % python readport.py
        Enter filename: portfolio.csv
        ...
        <span class="cblue">bash</span> % python readport.py portfolio.csv
        ...
        <span class="cblue">bash</span> % python readport.py a b c
        Usage: readport.py [ filename ]
        <span class="cblue">bash</span> %</pre>
          <p class="indent">
            For very simple programs, it is often enough to process arguments in
            <code>sys.argv</code> as shown. For more advanced usage, the
            <code>argparse</code> standard library module can be used.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch01lev1sec19">1.19 Packages</h3>
          <p class="noindent">
            In large programs, it’s common to organize code into packages. A
            package is a hierarchical collection of modules. On the filesystem,
            put your code as a collection of files in a directory like
            this:<span epub:type="pagebreak" id="page_34"></span>
          </p>
          <pre>
tutorial/
            __init__.py
            readport.py
            pcost.py
            stack.py
            ...</pre
          >
          <p class="indent">
            The directory should have an <code>__init__.py</code> file, which
            may be empty. Once you’ve done this, you should be able to make
            nested import statements. For example:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0034-02" id="f0034-02"
              >Click here to view code image</a
            >
          </p>
          <pre>import tutorial.readport
        
        port <span class="igrey">=</span> tutorial.readport.read_portfolio(<span class="mblue">'portfolio.dat'</span>)</pre>
          <p class="indent">
            If you don’t like the long names, you can shorten things using an
            import like this:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0034-03" id="f0034-03"
              >Click here to view code image</a
            >
          </p>
          <pre>from tutorial.readport import read_portfolio
        
        port <span class="igrey">=</span> read_portfolio(<span class="mblue">'portfolio.dat'</span>)</pre>
          <p class="indent">
            One tricky issue with packages is imports between files within the
            same package. In an earlier example, a <code>pcost.py</code> module
            was shown that started with an import like this:
          </p>
          <pre><span class="hblue"># pcost.py</span>
        import readport
        ...</pre>
          <p class="indent">
            If the <code>pcost.py</code> and <code>readport.py</code> files are
            moved into a package, this <code>import</code> statement breaks. To
            fix it, you must use a fully qualified module import:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0034-05" id="f0034-05"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># pcost.py</span>
        from tutorial import readport
        ...</pre>
          <p class="indent">
            Alternatively, you can use a package-relative import like this:
          </p>
          <pre><span class="hblue"># pcost.py</span>
        from . import readport
        ...</pre>
          <p class="indent">
            The latter form has the benefit of not hardcoding the package name.
            This makes it easier to later rename a package or move it around
            within your project.
          </p>
          <p class="indent">
            Other subtle details concerning packages are covered later (see
            <a href="ch08.xhtml#ch08">Chapter 8</a>).
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch01lev1sec20">1.20 Structuring an Application</h3>
          <p class="noindent">
            As you start to write more Python code, you may find yourself
            working on larger applications that include a mix of your own code
            as well as third-party dependencies.
            <span epub:type="pagebreak" id="page_35"></span>Managing all of this
            is a complex topic that continues to evolve. There are also many
            conflicting opinions about what constitutes “best practice.”
            However, there are a few essential facets to it that you should
            know.
          </p>
          <p class="indent">
            First, it is standard practice to organize large code bases into
            packages (that is, directories of <code>.py</code> files that
            include the special <code>__init__.py</code> file). When doing this,
            pick a unique package name for the top-level directory name. The
            primary purpose of the package directory is to manage
            <code>import</code> statements and the namespaces of modules used
            while programming. You want your code isolated from everyone else’s
            code.
          </p>
          <p class="indent">
            In addition to your main project source code, you might additionally
            have tests, examples, scripts, and documentation. This additional
            material usually lives in a separate set of directories than the
            package containing your source code. Thus, it is common to create an
            enclosing top-level directory for your project and to put all of
            your work under that. For example, a fairly typical project
            organization might look like this:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0035-01" id="f0035-01"
              >Click here to view code image</a
            >
          </p>
          <pre>
tutorial-project/
            tutorial/
                __init__.py
                readport.py
                pcost.py
                stack.py
                ...
            tests/
                test_stack.py
                test_pcost.py
                ...
            examples/
                sample.py
                ...
            doc/
                tutorial.txt
                ...</pre
          >
          <p class="indent">
            Keep in mind that there is more than one way to do it. The nature of
            the problem you’re solving might dictate a different structure.
            Nevertheless, as long as your main set of source code files lives in
            a proper package (again, the directory with the
            <code>__init__.py</code> file), you should be fine.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch01lev1sec21">
            1.21 Managing Third-Party Packages
          </h3>
          <p class="noindent">
            Python has a large library of contributed packages that can be found
            at the Python Package Index (<code
              ><a href="https://pypi.org">https://pypi.org</a></code
            >). You may need to depend on some of these packages in your own
            code. To install a third-party package, use a command such as
            <code>pip</code>:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0035-02" id="f0035-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="cblue">bash</span> % python3 <span class="wasabi">-m</span> pip install somepackage</pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_36"></span>Installed packages
            are placed into a special <code>site-packages</code> directory that
            you can find if you inspect the value of <code>sys.path</code>. For
            example, on a UNIX machine, packages might be placed in
            <code>/usr/local/lib/python3.8/site-packages</code>. If you are ever
            left wondering where a package is coming from, inspect the
            <code>__file__</code> attribute of a package after importing it in
            the interpreter:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0036-01" id="f0036-01"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; import pandas
        &gt;&gt;&gt; pandas.__file__
        '/usr/local/lib/python3.8/site-packages/pandas/__init__.py'
        &gt;&gt;&gt;</pre
          >
          <p class="indent">
            One potential problem with installing a package is that you might
            not have permission to change the locally installed version of
            Python. Even if you had permission, it still might not be a good
            idea. For example, many systems already have Python installed for
            use by various system utilities. Altering the installation of that
            version of Python is often a bad idea.
          </p>
          <p class="indent">
            To make a sandbox where you can install packages and work without
            worrying about breaking anything, create a
            <em>virtual environment</em> by a command like this:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0036-02" id="f0036-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="cblue">bash</span> % python3 <span class="wasabi">-m</span> venv myproject</pre>
          <p class="indent">
            This will set up a dedicated Python installation for you in a
            directory called <code>myproject/</code>. Within that directory,
            you’ll find an interpreter executable and library where you can
            safely install packages. For example, if you run
            <code>myproject/bin/python3</code>, you’ll get an interpreter
            configured for your personal use. You can install packages into this
            interpreter without worrying about breaking any part of the default
            Python installation. To install a package, use <code>pip</code> as
            before but make sure to specify the correct interpreter:
          </p>
          <p class="codelink">
            <a href="ch01_images.xhtml#rf0036-03" id="f0036-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="cblue">bash</span> % ./myproject/bin/python3 <span class="wasabi">-m</span> pip install somepackage</pre>
          <p class="indent">
            There are various tools that aim to simplify the use of
            <code>pip</code> and <code>venv</code>. Such matters might also be
            handled automagically by your IDE. As this is a fluid and
            ever-evolving part of Python, no further advice is given here.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch01lev1sec22">1.22 Python: It Fits Your Brain</h3>
          <p class="noindent">
            In the early days of Python, “it fits your brain” was a common
            motto. Even today, the core of Python is a small programming
            language along with a useful collection of built-in objects—lists,
            sets, and dictionaries. A vast array of practical problems can be
            solved using nothing more than the basic features presented in this
            chapter. This is a good thing to keep in mind as you begin your
            Python adventure—although there are always more complicated ways to
            solve a problem, there might also be a simple way to do it with the
            basic features Python already provides. When in doubt, you’ll
            probably thank your past self for doing just that.
          </p>
        </section>
      </section>
    </div>
    <div id="sbo-rt-content">
      <section epub:type="chapter">
        <h2 class="h2" id="ch02">
          <span epub:type="pagebreak" id="page_37"></span
          ><span class="ash">2.</span> Operators, Expressions, and Data
          Manipulation
        </h2>
        <p class="noindent">
          This chapter describes Python’s expressions, operators, and evaluation
          rules related to data manipulation. Expressions are at the heart of
          performing useful computations. Moreover, third-party libraries can
          customize Python’s behavior to provide a better user experience. This
          chapter describes expressions at a high level.
          <a href="ch03.xhtml#ch03">Chapter 3</a> describes the underlying
          protocols that can be used to customize the behavior of the
          interpreter.
        </p>
        <section>
          <h3 class="h3" id="ch02lev1sec1">2.1 Literals</h3>
          <p class="noindent">
            A literal is a value typed directly into a program such as
            <code>42</code>, <code>4.2</code>, or <code>'forty-two'</code>.
          </p>
          <p class="indent">
            Integer literals represent a signed integer value of arbitrary size.
            It’s possible to specify integers in binary, octal, or hexadecimal:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0037-01" id="f0037-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="sgreen">42</span>
            <span class="sgreen">0b101010</span>         <span class="hblue"># Binary integer</span>
            <span class="sgreen">0o52</span>             <span class="hblue"># Octal integer</span>
            <span class="sgreen">0x2a</span>             <span class="hblue"># Hexadecimal integer</span></pre>
          <p class="indent">
            The base is not stored as part of the integer value. All of the
            above literals will display as <code><sup>42</sup></code> if
            printed. You can use the built-in functions <code>bin(x)</code>,
            <code>oct(x)</code>, or <code>hex(x)</code> to convert an integer to
            a string representing its value in different bases.
          </p>
          <p class="indent">
            Floating-point numbers can be written by adding a decimal point or
            by using scientific notation where an <code>e</code> or
            <code>E</code> specifies an exponent. All of the following are
            floating-point numbers:
          </p>
          <pre><span class="sgreen">4.2</span>
            <span class="sgreen">42.</span>
            <span class="sgreen">.42</span>
            <span class="sgreen">4.2e+2</span>
            <span class="sgreen">4.2E2</span>
            <span class="igrey">-</span><span class="sgreen">4.2e-2</span></pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_38"></span>Internally,
            floating-point numbers are stored as IEEE 754 double-precision
            (64-bit) values.
          </p>
          <p class="indent">
            In numeric literals, a single underscore ( <code>_</code> ) can be
            used as a visual separator between digits. For example:
          </p>
          <pre><span class="sgreen">123_456_789</span>
            <span class="sgreen">0x1234_5678</span>
            <span class="sgreen">0b111_00_101</span>
            <span class="sgreen">123.789_012</span></pre>
          <p class="indent">
            The digit separator is not stored as part of the number—it’s only
            used to make large numeric literals easier to read in source code.
          </p>
          <p class="indent">
            Boolean literals are written as <code>True</code> and
            <code>False</code>.
          </p>
          <p class="indent">
            String literals are written by enclosing characters with single,
            double, or triple quotes. Single- and double-quoted strings must
            appear on the same line. Triple-quoted strings can span multiple
            lines. For example:
          </p>
          <pre><span class="hblue">'hello world'</span>
            <span class="hblue">"hello world"</span>
            <span class="hblue">'''hello world'''</span>
            <span class="hblue">"""hello world"""</span></pre>
          <p class="indent">
            Tuple, liss, set, and dictionary literals are written as follows:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0038-03" id="f0038-03"
              >Click here to view code image</a
            >
          </p>
          <pre>(<span class="sgreen">1</span>, <span class="sgreen">2</span>, <span class="sgreen">3</span>)               <span class="hblue"># tuple</span>
            [<span class="sgreen">1</span>, <span class="sgreen">2</span>, <span class="sgreen">3</span>]               <span class="hblue"># list</span>
            {<span class="sgreen">1</span>, <span class="sgreen">2</span>, <span class="sgreen">3</span>}               <span class="hblue"># set</span>
            {<span class="mblue">'x'</span>:<span class="sgreen">1</span>, <span class="mblue">'y'</span>:<span class="sgreen">2</span>, <span class="mblue">'z'</span>: <span class="sgreen">3</span>}  <span class="hblue"># dict</span></pre>
        </section>
        <section>
          <h3 class="h3" id="ch02lev1sec2">2.2 Expressions and Locations</h3>
          <p class="noindent">
            An expression represents a computation that evaluates to a concrete
            value. It consists of a combination of literals, names, operators,
            and function or method calls. An expression can always appear on the
            right-hand side of an assignment statement, be used as an operand in
            operations in other expressions, or be passed as a function
            argument. For example:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0038-04" id="f0038-04"
              >Click here to view code image</a
            >
          </p>
          <pre>value <span class="igrey">=</span> <span class="sgreen">2</span> <span class="igrey">+</span> <span class="sgreen">3</span> <span class="igrey">*</span> <span class="sgreen">5</span> <span class="igrey">+</span> sqrt(<span class="sgreen">6</span><span class="igrey">+</span><span class="sgreen">7</span>)</pre>
          <p class="indent">
            Operators, such as <code>+</code> (addition) or
            <code>*</code> (multiplication), represent an operation performed on
            objects provided as operands. <code>sqrt()</code> is a function that
            is applied to input arguments.
          </p>
          <p class="indent">
            The left hand side of an assignment represents a location where a
            reference to an object is stored. That location, as shown in the
            previous example, might be a simple identifier such as
            <code>value</code>. It could also be an attribute of an object or an
            index within a container. For example:<span
              epub:type="pagebreak"
              id="page_39"
            ></span>
          </p>
          <pre>a <span class="igrey">=</span> <span class="sgreen">4</span> <span class="igrey">+</span> <span class="sgreen">2</span>
            b[<span class="sgreen">1</span>] <span class="igrey">=</span> <span class="sgreen">4</span> <span class="igrey">+</span> <span class="sgreen">2</span>
            c[<span class="mblue">'key'</span>] <span class="igrey">=</span> <span class="sgreen">4</span> <span class="igrey">+</span> <span class="sgreen">2</span>
            d.value <span class="igrey">=</span> <span class="sgreen">4</span> <span class="igrey">+</span> <span class="sgreen">2</span></pre>
          <p class="indent">
            Reading a value back from a location is also an expression. For
            example:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0039-02" id="f0039-02"
              >Click here to view code image</a
            >
          </p>
          <pre>value <span class="igrey">=</span> a <span class="igrey">+</span> b[<span class="sgreen">1</span>] <span class="igrey">+</span> c[<span class="mblue">'key'</span>]</pre>
          <p class="indent">
            The assignment of a value and the evaluation of an expression are
            separate concepts. In particular, you can’t include the assignment
            operator as part of an expression:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0039-03" id="f0039-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>while</strong></span> line<span class="igrey">=</span>file.readline():          <span class="hblue"># Syntax Error.</span>
                print(line)</pre>
          <p class="indent">
            However, an “assignment expression” operator (<code>:=</code>) can
            be used to perform this combined action of expression evaluation and
            assignment. For example:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0039-04" id="f0039-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>while</strong></span> (line:<span class="igrey">=</span>file.readline()):
                print(line)</pre>
          <p class="indent">
            The <code>:=</code> operator is usually used in combination with
            statements such as <code>if</code> and <code>while</code>. In fact,
            using it as a normal assignment operator results in a syntax error
            unless you put parentheses around it.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch02lev1sec3">2.3 Standard Operators</h3>
          <p class="noindent">
            Python objects can be made to work with any of the operators in
            <a href="ch02.xhtml#ch02tab01">Table 2.1</a>.<span
              epub:type="pagebreak"
              id="page_40"
            ></span>
          </p>
          <figure class="table" id="ch02tab01">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 2.1</span> Standard Operators
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Operation</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext"><code>x + y</code></p>
                  </td>
                  <td><p class="tabtext">Addition</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x - y</code></p>
                  </td>
                  <td><p class="tabtext">Subtraction</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x * y</code></p>
                  </td>
                  <td><p class="tabtext">Multiplication</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x / y</code></p>
                  </td>
                  <td><p class="tabtext">Division</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x // y</code></p>
                  </td>
                  <td><p class="tabtext">Truncating division</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x @ y</code></p>
                  </td>
                  <td><p class="tabtext">Matrix multiplication</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x ** y</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Power (<code>x</code> to the <code>y</code> power)
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x % y</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Modulo (<code>x</code> mod <code>y</code>). Remainder.
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x &lt;&lt; y</code></p>
                  </td>
                  <td><p class="tabtext">Left shift</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x &gt;&gt; y</code></p>
                  </td>
                  <td><p class="tabtext">Right shift</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x &amp; y</code></p>
                  </td>
                  <td><p class="tabtext">Bitwise and</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x | y</code></p>
                  </td>
                  <td><p class="tabtext">Bitwise or</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x ^ y</code></p>
                  </td>
                  <td><p class="tabtext">Bitwise xor (exclusive or)</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>~x</code></p>
                  </td>
                  <td><p class="tabtext">Bitwise negation</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>–x</code></p>
                  </td>
                  <td><p class="tabtext">Unary minus</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>+x</code></p>
                  </td>
                  <td><p class="tabtext">Unary plus</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>abs(x)</code></p>
                  </td>
                  <td><p class="tabtext">Absolute value</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>divmod(x,y)</code></p>
                  </td>
                  <td>
                    <p class="tabtext">Returns <code>(x // y, x % y)</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>pow(x,y [,modulo])</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Returns <code>(x ** y) % modulo</code>
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>round(x,[n])</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Rounds to the nearest multiple of 10-<code>n</code>
                    </p>
                  </td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            Usually these have a numeric interpretation. However, there are
            notable special cases. For example, the <code>+</code> operator is
            also used to concatenate sequences, <code>*</code> operator
            replicates sequences, <code>-</code> is used for set differences,
            and <code>%</code> performs string formatting:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0039-05" id="f0039-05"
              >Click here to view code image</a
            >
          </p>
          <pre>[<span class="sgreen">1</span>,<span class="sgreen">2</span>,<span class="sgreen">3</span>] <span class="igrey">+</span> [<span class="sgreen">4</span>,<span class="sgreen">5</span>]   <span class="hblue"># [1,2,3,4,5]</span>
            [<span class="sgreen">1</span>,<span class="sgreen">2</span>,<span class="sgreen">3</span>] <span class="igrey">*</span> <span class="sgreen">4</span>       <span class="hblue"># [1,2,3,1,2,3,1,2,3,1,2,3]</span>
            <span class="hblue">'%s has %d messages'</span> <span class="igrey">%</span> (<span class="mblue">'Dave'</span>, <span class="sgreen">37</span>)</pre>
          <p class="indent">
            Checking of operators is a dynamic process. Operations involving
            mixed data types will often “work” if there is an intuitive sense
            for the operation to work. For example, you can add integers and
            fractions:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0039-06" id="f0039-06"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; from fractions import Fraction
            &gt;&gt;&gt; a = Fraction(2, 3)
            &gt;&gt;&gt; b = 5
            &gt;&gt;&gt; a + b
            Fraction(17, 3)
            &gt;&gt;&gt;</pre
          >
          <p class="indent">
            However, it’s not always foolproof. For example, it doesn’t work
            with decimals.
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0040-01" id="f0040-01"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; from decimal import Decimal
            &gt;&gt;&gt; from fractions import Fraction
            &gt;&gt;&gt; a = Fraction(2, 3)
            &gt;&gt;&gt; b = Decimal('5')
            &gt;&gt;&gt; a + b
            Traceback (most recent call last):
              File "&lt;stdin&gt;", line 1, in &lt;module&gt;
            TypeError: unsupported operand type(s) for +: 'Fraction' and 'decimal.Decimal'
            &gt;&gt;&gt;</pre
          >
          <p class="indent">
            For most combinations of numbers, however, Python follows a standard
            numeric hierarchy of Booleans, integers, fractions, floats, and
            complex numbers. Mixed-type operations will simply work—you don’t
            have to worry about it.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch02lev1sec4">
            <span epub:type="pagebreak" id="page_41"></span>2.4 In-Place
            Assignment
          </h3>
          <p class="noindent">
            Python provides the “in-place” or “augmented” assignment operations
            in <a href="ch02.xhtml#ch02tab02">Table 2.2</a>.
          </p>
          <figure class="table" id="ch02tab02">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 2.2</span> Augmented Assignment
                Operators
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Operation</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext"><code>x += y</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>x = x + y</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x -= y</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>x = x - y</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x *= y</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>x = x * y</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x /= y</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>x = x / y</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x //= y</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>x = x // y</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x **= y</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>x = x ** y</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x %= y</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>x = x % y</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x @= y</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>x = x @ y</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x &amp;= y</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>x = x &amp; y</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x |= y</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>x = x | y</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x ^= y</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>x = x ^ y</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x &gt;&gt;= y</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>x = x &gt;&gt; y</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x &lt;&lt;= y</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>x = x &lt;&lt; y</code></p>
                  </td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            These are not considered to be expressions. Instead, they are a
            syntactic convenience for updating a value in place. For example:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0041-01" id="f0041-01"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> <span class="sgreen">3</span>
            a <span class="igrey">=</span> a <span class="igrey">+</span> <span class="sgreen">1</span>                         <span class="hblue"># a = 4</span>
            a <span class="igrey">+=</span> <span class="sgreen">1</span>                            <span class="hblue"># a = 5</span></pre>
          <p class="indent">
            Mutable objects can use these operators to perform an in-place
            mutation of the data as an optimization. Consider this example:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0041-02" id="f0041-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; a = [1, 2, 3]
            &gt;&gt;&gt; b = a              # Creates a new reference to a
            &gt;&gt;&gt; a += [4, 5]        # In-place update (doesn't create a new list)
            &gt;&gt;&gt; a
            [1, 2, 3, 4, 5]
            &gt;&gt;&gt; b
            [1, 2, 3, 4, 5]
            &gt;&gt;&gt;</pre
          >
          <p class="indent">
            In this example, <code>a</code> and <code>b</code> are references to
            the same list. When <code>a += [4, 5]</code> is performed, it
            updates the list object in place without creating a new list. Thus,
            <code>b</code> also sees this update. This is often surprising.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch02lev1sec5">
            <span epub:type="pagebreak" id="page_42"></span>2.5 Object
            Comparison
          </h3>
          <p class="noindent">
            The equality operator (<code>x == y</code>) tests the values of
            <code>x</code> and <code>y</code> for equality. In the case of lists
            and tuples, they must be of equal size, have equal elements, and be
            in the same order. For dictionaries, <code>True</code> is returned
            only if <code>x</code> and <code>y</code> have the same set of keys
            and all the objects with the same key have equal values. Two sets
            are equal if they have the same elements.
          </p>
          <p class="indent">
            An equality comparison between objects of incompatible types, such
            as a file and a floating-point number, does not trigger an error but
            returns <code>False</code>. However, sometimes a comparison between
            objects of different types will produce <code>True</code>. For
            example, comparing an integer and a floating-point number of the
            same value:
          </p>
          <pre>
&gt;&gt;&gt; 2 == 2.0
            True
            &gt;&gt;&gt;</pre
          >
          <p class="indent">
            The identity operators (<code>x is y</code> and
            <code>x is not y</code>) test two values to see whether they refer
            to literally the same object in memory (e.g.,
            <code>id(x) == id(y)</code>). In general, it may be the case that
            <code>x == y</code>, but <code>x is not y</code>. For example:
          </p>
          <pre>
&gt;&gt;&gt; a = [1, 2, 3]
            &gt;&gt;&gt; b = [1, 2, 3]
            &gt;&gt;&gt; a is b
            False
            &gt;&gt;&gt; a == b
            True
            &gt;&gt;&gt;</pre
          >
          <p class="indent">
            In practice, comparing objects with the <code>is</code> operator is
            almost never what you want. Use the <code>==</code> operator for all
            comparisons unless you have a good reason to expect the two objects
            to have the same identity.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch02lev1sec6">2.6 Ordered Comparison Operators</h3>
          <p class="noindent">
            The ordered comparison operators in
            <a href="ch02.xhtml#ch02tab03">Table 2.3</a> have the standard
            mathematical interpretation for numbers. They return a Boolean
            value.
          </p>
          <figure class="table" id="ch02tab03">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 2.3</span> Ordered Comparison Operators
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Operation</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext"><code>x &lt; y</code></p>
                  </td>
                  <td><p class="tabtext">Less than</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x &gt; y</code></p>
                  </td>
                  <td><p class="tabtext">Greater than</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x &gt;= y</code></p>
                  </td>
                  <td><p class="tabtext">Greater than or equal to</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x &lt;= y</code></p>
                  </td>
                  <td><p class="tabtext">Less than or equal to</p></td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            <span epub:type="pagebreak" id="page_43"></span>For sets,
            <code>x &lt; y</code> tests if <code>x</code> is strict subset of
            <code>y</code> (i.e., has fewer elements, but is not equal to
            <code>y</code>).
          </p>
          <p class="indent">
            When comparing two sequences, the first elements of each sequence
            are compared. If they differ, this determines the result. If they’re
            the same, the comparison moves to the second element of each
            sequence. This process continues until two different elements are
            found or no more elements exist in either of the sequences. If the
            end of both sequences is reached, the sequences are considered
            equal. If <code>a</code> is a subsequence of <code>b</code>, then
            <code>a &lt; b</code>.
          </p>
          <p class="indent">
            Strings and bytes are compared using lexicographical ordering. Each
            character is assigned a unique numerical index determined by the
            character set (such as ASCII or Unicode). A character is less than
            another character if its index is less.
          </p>
          <p class="indent">
            Not all types support the ordered comparisons. For example, trying
            to use <code>&lt;</code> on dictionaries is undefined and results in
            a <code>TypeError</code>. Similarly, applying ordered comparisons to
            incompatible types (such as a string and a number) will result in a
            <code>TypeError</code>.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch02lev1sec7">
            2.7 Boolean Expressions and Truth Values
          </h3>
          <p class="noindent">
            The <code>and</code>, <code>or</code>, and
            <code>not</code> operators can form complex Boolean expressions. The
            behavior of these operators is shown in
            <a href="ch02.xhtml#ch02tab04">Table 2.4</a>.
          </p>
          <figure class="table" id="ch02tab04">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 2.4</span> Logical Operators
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Operator</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext"><code>x or y</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      If <code>x</code> is false, return <code>y</code>;
                      otherwise, return <code>x</code>.
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x and y</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      If <code>x</code> is false, return <code>x</code>;
                      otherwise, return <code>y</code>.
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>not x</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      If <code>x</code> is false, return <code>True</code>;
                      otherwise, return <code>False</code>.
                    </p>
                  </td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            When you use an expression to determine a true or false value,
            <code>True</code>, any nonzero number, a nonempty string, list,
            tuple, or dictionary is taken to be true. <code>False</code>, zero,
            <code>None</code>, and empty lists, tuples, and dictionaries
            evaluate as false.
          </p>
          <p class="indent">
            Boolean expressions are evaluated from left to right and consume the
            right operand only if it’s needed to determine the final value. For
            example, <code>a and b</code> evaluates <code>b</code> only if
            <code>a</code> is true. This is known as short-circuit evaluation.
            It can be useful to simplify code involving a test and a subsequent
            operation. For example:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0043-01" id="f0043-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>if</strong></span> y <span class="igrey">!=</span> <span class="sgreen">0</span>:
                result <span class="igrey">=</span> x <span class="igrey">/</span> y
            <span class="lgreen"><strong>else</strong></span>:
                result <span class="igrey">=</span> <span class="sgreen">0</span>
            
            <span class="hblue"># Alternative</span>
            result <span class="igrey">=</span> y <span class="lgreen"><strong>and</strong></span> x <span class="igrey">/</span> y</pre>
          <p class="indent">
            In the second version, the <code>x / y</code> division is only
            performed if <code>y</code> is nonzero.
          </p>
          <p class="indent">
            <span epub:type="pagebreak" id="page_44"></span>Relying on implicit
            “truthiness” of objects may lead to difficult-to-find bugs. For
            example, consider this function:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0044-01" id="f0044-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> f(x, items<span class="igrey">=</span><span class="dblue">None</span>):
                <span class="lgreen"><strong>if not</strong></span> items:
                    items <span class="igrey">=</span> []
                items.append(x)
                <span class="lgreen"><strong>return</strong></span> items</pre>
          <p class="indent">
            This function has an optional argument that, if not given, causes a
            new list to be created and returned. For example,
          </p>
          <pre>
&gt;&gt;&gt; foo(4)
            [4]
            &gt;&gt;&gt;</pre
          >
          <p class="indent">
            However, the function has really strange behavior if you give it an
            existing empty list as an argument:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0044-03" id="f0044-03"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; a = []
            &gt;&gt;&gt; foo(3, a)
            [3]
            &gt;&gt;&gt; a          # Notice how a did NOT update
            []
            &gt;&gt;&gt;</pre
          >
          <p class="indent">
            This is a truth-checking bug. Empty lists evaluate to
            <code>False</code> so the code created a new list instead of using
            the one (<code>a</code>) that was passed in as an argument. To fix
            this, you need to be more precise in your checking against
            <code>None</code>:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0044-04" id="f0044-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> f(x, items<span class="igrey">=</span><span class="dblue">None</span>):
                <span class="lgreen"><strong>if</strong></span> items <span class="lgreen"><strong>is</strong></span> <span class="dblue">None</span>:
                    items <span class="igrey">=</span> []
                items.append(x)
                <span class="lgreen"><strong>return</strong></span> items</pre>
          <p class="indent">
            It’s always good practice to be precise when writing conditional
            checks.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch02lev1sec8">2.8 Conditional Expressions</h3>
          <p class="noindent">
            A common programming pattern is assigning a value conditionally
            based on the result of an expression. For example:
          </p>
          <pre><span class="lgreen"><strong>if</strong></span> a <span class="igrey">&lt;=</span> b:
                minvalue <span class="igrey">=</span> a
            <span class="lgreen"><strong>else</strong></span>:
                minvalue <span class="igrey">=</span> b</pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_45"></span>This code can be
            shortened using a conditional expression. For example:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0045-01" id="f0045-01"
              >Click here to view code image</a
            >
          </p>
          <pre>minvalue <span class="igrey">=</span> a <span class="lgreen"><strong>if</strong></span> a <span class="igrey">&lt;=</span> b <span class="lgreen"><strong>else</strong></span> b</pre>
          <p class="indent">
            In such expressions, the condition in the middle is evaluated first.
            The expression to the left of the <code>if</code> is then evaluated
            if the result is <code>True</code>. Otherwise, the expression after
            the <code>else</code> is evaluated. The <code>else</code> clause is
            always required.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch02lev1sec9">
            2.9 Operations Involving Iterables
          </h3>
          <p class="noindent">
            Iteration is an important Python feature supported by all of
            Python’s containers (lists, tuples, dicts, and so on), files, as
            well as generator functions. The operations in
            <a href="ch02.xhtml#ch02tab05">Table 2.5</a> can be applied to any
            iterable object <code>s</code>.
          </p>
          <figure class="table" id="ch02tab05">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 2.5</span> Operations on Iterables
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Operation</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext"><code>for vars in s:</code></p>
                  </td>
                  <td><p class="tabtext">Iteration</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>v1, v2, ... = s</code></p>
                  </td>
                  <td><p class="tabtext">Variable unpacking</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>x in s</code>, <code>x not in s</code>
                    </p>
                  </td>
                  <td><p class="tabtext">Membership</p></td>
                </tr>
                <tr>
                  <td><code>[a, *s, b], (a, *s, b), {a, *s, b}</code></td>
                  <td>
                    <p class="tabtext">
                      Expansion in list, tuple, or set literals
                    </p>
                  </td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            The most essential operation on an iterable is the
            <code>for</code> loop. This is how you iterate through the values
            one by one. All the other operations build upon this.
          </p>
          <p class="indent">
            The <code>x in s</code> operator tests whether the object
            <code>x</code> appears as one of the items produced by the iterable
            <code>s</code> and returns <code>True</code> or <code>False</code>.
            The <code>x not in s</code> operator is the same as
            <code>not (x in s)</code>. For strings, the <code>in</code> and
            <code>not in</code> operators accept substrings. For example,
            <code>'hello' in 'hello world'</code> produces <code>True</code>.
            Note that the <code>in</code> operator does not support wildcards or
            any kind of pattern matching.
          </p>
          <p class="indent">
            Any object supporting iteration can have its values unpacked into a
            series of locations. For example:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0045-02" id="f0045-02"
              >Click here to view code image</a
            >
          </p>
          <pre>items <span class="igrey">=</span> [ <span class="sgreen">3</span>, <span class="sgreen">4</span>, <span class="sgreen">5</span> ]
            x, y, z <span class="igrey">=</span> items       <span class="hblue"># x = 3, y = 4, z = 5</span>
            
            letters <span class="igrey">=</span> <span class="mblue">"abc"</span>
            x, y, z <span class="igrey">=</span> letters       <span class="hblue"># x = 'a', y = 'b', z = 'c'</span></pre>
          <p class="indent">
            The locations on the left don’t have to be simple variable names.
            Any valid location that could appear on the left-hand side of an
            equal sign is acceptable. So, you could write code like this:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0045-03" id="f0045-03"
              >Click here to view code image</a
            >
          </p>
          <pre>items <span class="igrey">=</span> [<span class="sgreen">3</span>, <span class="sgreen">4</span>, <span class="sgreen">5</span>]
            d <span class="igrey">=</span> { }
            d[<span class="mblue">'x'</span>], d[<span class="mblue">'y'</span>], d[<span class="mblue">'z'</span>] <span class="igrey">=</span> items</pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_46"></span>When unpacking
            values into locations, the number of locations on the left must
            exactly match the number of items in the iterable on the right. For
            nested data structures, match locations and data by following the
            same structural pattern. Consider this example of unpacking two
            nested 3-tuples:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0046-01" id="f0046-01"
              >Click here to view code image</a
            >
          </p>
          <pre>datetime <span class="igrey">=</span> ((<span class="sgreen">5</span>, <span class="sgreen">19</span>, <span class="sgreen">2008</span>), (<span class="sgreen">10</span>, <span class="sgreen">30</span>, <span class="mblue">"am"</span>))
            (month, day, year), (hour, minute, am_pm) <span class="igrey">=</span> datetime</pre>
          <p class="indent">
            Sometimes, the <code>_</code> variable is used to indicate a
            throw-away value when unpacking. For example, if you only care about
            the day and the hour, you can use:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0046-02" id="f0046-02"
              >Click here to view code image</a
            >
          </p>
          <pre>(_, day, _), (hour, _, _) <span class="igrey">=</span> datetime</pre>
          <p class="indent">
            If the number of items being unpacked isn’t known, you can use an
            extended form of unpacking by including a starred variable, such as
            <code>*extra</code> in the following example:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0046-03" id="f0046-03"
              >Click here to view code image</a
            >
          </p>
          <pre>items <span class="igrey">=</span> [<span class="sgreen">1</span>, <span class="sgreen">2</span>, <span class="sgreen">3</span>, <span class="sgreen">4</span>, <span class="sgreen">5</span>]
            a, b, <span class="igrey">*</span>extra <span class="igrey">=</span> items     <span class="hblue"># a = 1, b = 2, extra = [3,4,5]</span>
            <span class="igrey">*</span>extra, a, b             <span class="hblue"># extra = [1,2,3], a = 4, b = 5</span>
            a, <span class="igrey">*</span>extra, b             <span class="hblue"># a = 1, extra = [2,3,4], b = 5</span></pre>
          <p class="indent">
            In this example, <code>*extra</code> receives all of the extra
            items. It is always a list. No more than one starred variable can be
            used when unpacking a single iterable. However, multiple starred
            variables could be used when unpacking more complex data structures
            involving different iterables. For example:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0046-04" id="f0046-04"
              >Click here to view code image</a
            >
          </p>
          <pre>datetime <span class="igrey">=</span> ((<span class="sgreen">5</span>, <span class="sgreen">19</span>, <span class="sgreen">2008</span>), (<span class="sgreen">10</span>, <span class="sgreen">30</span>, <span class="mblue">"am"</span>))
            
            (month, <span class="igrey">*</span>_), (hour, <span class="igrey">*</span>_) <span class="igrey">=</span> datetime</pre>
          <p class="indent">
            Any iterable can be expanded when writing out list, tuple, and set
            literals. This is also done using the star (<code>*</code>). For
            example:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0046-05" id="f0046-05"
              >Click here to view code image</a
            >
          </p>
          <pre>items <span class="igrey">=</span> [<span class="sgreen">1</span>, <span class="sgreen">2</span>, <span class="sgreen">3</span>]
            a <span class="igrey">=</span> [<span class="sgreen">10</span>, <span class="igrey">*</span>items, <span class="sgreen">11</span>]      <span class="hblue"># a = [10, 1, 2, 3, 11]        (list)</span>
            b <span class="igrey">=</span> (<span class="igrey">*</span>items, <span class="sgreen">10</span>, <span class="igrey">*</span>items)  <span class="hblue"># b = [1, 2, 3, 10, 1, 2, 3]  (tuple)</span>
            c <span class="igrey">=</span> {<span class="sgreen">10</span>, <span class="sgreen">11</span>, <span class="igrey">*</span>items}      <span class="hblue"># c = {1, 2, 3, 10, 11}        (set)</span></pre>
          <p class="indent">
            In this example, the contents of <code>items</code> are simply
            pasted into the list, tuple, or set being created as if you typed it
            in place at that location. This expansion is known as “splatting.”
            You can include as many <code>*</code> expansions as you like when
            defining a literal. However, many iterable objects (such as files or
            generators) only support one-time iteration. If you use
            <code>*</code>-expansion, the contents will be consumed and the
            iterable won’t produce any more values on subsequent iterations.
          </p>
          <p class="indent">
            A variety of built-in functions accept any iterable as input.
            <a href="ch02.xhtml#ch02tab06">Table 2.6</a> shows some of these
            operations.<span epub:type="pagebreak" id="page_47"></span>
          </p>
          <figure class="table" id="ch02tab06">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 2.6</span> Functions consuming iterables
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Function</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext"><code>list(s)</code></p>
                  </td>
                  <td>
                    <p class="tabtext">Create a list from <code>s</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>tuple(s)</code></p>
                  </td>
                  <td>
                    <p class="tabtext">Create a tuple from <code>s</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>set(s)</code></p>
                  </td>
                  <td>
                    <p class="tabtext">Create a set from <code>s</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>min(s [,key])</code></p>
                  </td>
                  <td>
                    <p class="tabtext">Minimum item in <code>s</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>max(s [,key])</code></p>
                  </td>
                  <td>
                    <p class="tabtext">Maximum item in <code>s</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>any(s)</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Return <code>True</code> if any item in <code>s</code> is
                      true
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>all(s)</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Return <code>True</code> if all items in
                      <code>s</code> are true
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>sum(s [, initial])</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Sum of items with an optional initial value
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>sorted(s [, key])</code></p>
                  </td>
                  <td><p class="tabtext">Create a sorted list</p></td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            This applies to many other library functions as well—for example,
            functions in the <code>statistics</code> module.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch02lev1sec10">2.10 Operations on Sequences</h3>
          <p class="noindent">
            A sequence is an iterable container that has a size and allows items
            to be accessed by an integer index starting at 0. Examples include
            strings, lists, and tuples. In addition to all of the operations
            involving iteration, the operators in
            <a href="ch02.xhtml#ch02tab07">Table 2.7</a> can be applied to a
            sequence.
          </p>
          <figure class="table" id="ch02tab07">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 2.7</span> Operations on Sequences
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Operation</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext"><code>s + r</code></p>
                  </td>
                  <td><p class="tabtext">Concatenation</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>s * n</code>, <code>n * s</code>
                    </p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Makes <code>n</code> copies of <code>s</code>, where
                      <code>n</code> is an integer
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>s[i]</code></p>
                  </td>
                  <td><p class="tabtext">Indexing</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>s[i:j]</code></p>
                  </td>
                  <td><p class="tabtext">Slicing</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>s[i:j:stride]</code></p>
                  </td>
                  <td><p class="tabtext">Extended slicing</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>len(s)</code></p>
                  </td>
                  <td><p class="tabtext">Length</p></td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            The <code>+</code> operator concatenates two sequences of the same
            type. For example:
          </p>
          <pre>
&gt;&gt;&gt; a = [3, 4, 5]
            &gt;&gt;&gt; b = [6, 7]
            &gt;&gt;&gt; a + b
            [3, 4, 5, 6, 7]
            &gt;&gt;&gt;</pre
          >
          <p class="indent">
            The <code>s * n</code> operator makes <code>n</code> copies of a
            sequence. However, these are shallow copies that replicate elements
            by reference only. Consider the following code:<span
              epub:type="pagebreak"
              id="page_48"
            ></span>
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0048-01" id="f0048-01"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; a = [3, 4, 5]
            &gt;&gt;&gt; b = [a]
            &gt;&gt;&gt; c = 4 * b
            &gt;&gt;&gt; c
            [[3, 4, 5], [3, 4, 5], [3, 4, 5], [3, 4, 5]]
            &gt;&gt;&gt; a[0] = -7
            &gt;&gt;&gt; c
            [[-7, 4, 5], [-7, 4, 5], [-7, 4, 5], [-7, 4, 5]]
            &gt;&gt;&gt;</pre
          >
          <p class="indent">
            Notice how the change to <code>a</code> modifies every element of
            the list <code>c</code>. In this case, a reference to the list
            <code>a</code> was placed in the list <code>b</code>. When
            <code>b</code> was replicated, four additional references to
            <code>a</code> were created. Finally, when <code>a</code> was
            modified, this change was propagated to all the other copies of
            <code>a</code>. This behavior of sequence multiplication is often
            not the intent of the programmer. One way to work around the problem
            is to manually construct the replicated sequence by duplicating the
            contents of <code>a</code>. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0048-02" id="f0048-02"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> [ <span class="sgreen">3</span>, <span class="sgreen">4</span>, <span class="sgreen">5</span> ]
            c <span class="igrey">=</span> [list(a) <span class="lgreen"><strong>for</strong></span> _ <span class="lgreen"><strong>in</strong></span> range(<span class="sgreen">4</span>)]  <span class="hblue"># list() makes a copy of a list</span></pre>
          <p class="indent">
            The indexing operator <code>s[n]</code> returns the <code>n</code>th
            object from a sequence; <code>s[0]</code> is the first object.
            Negative indices can be used to fetch characters from the end of a
            sequence. For example, <code>s[-1]</code> returns the last item.
            Otherwise, attempts to access elements that are out of range result
            in an <code>IndexError</code> exception.
          </p>
          <p class="indent">
            The slicing operator <code>s[i:j]</code> extracts a subsequence from
            <code>s</code> consisting of the elements with index <code>k</code>,
            where <code>i &lt;= k &lt; j</code>. Both <code>i</code> and
            <code>j</code> must be integers. If the starting or ending index is
            omitted, the beginning or end of the sequence is assumed,
            respectively. Negative indices are allowed and assumed to be
            relative to the end of the sequence.
          </p>
          <p class="indent">
            The slicing operator may be given an optional stride,
            <code>s[i:j:stride]</code>, that causes the slice to skip elements.
            However, the behavior is somewhat more subtle. If a stride is
            supplied, <code>i</code> is the starting index, <code>j</code> is
            the ending index, and the produced subsequence is the elements
            <code>s[i]</code>, <code>s[i+stride]</code>,
            <code>s[i+2*stride]</code>, and so forth until index
            <code>j</code> is reached (which is not included). The
            <code>stride</code> may also be negative. If the starting index
            <code>i</code> is omitted, it is set to the beginning of the
            sequence if <code>stride</code> is positive or the end of the
            sequence if <code>stride</code> is negative. If the ending index
            <code>j</code> is omitted, it is set to the end of the sequence if
            <code>stride</code> is positive or the beginning of the sequence if
            <code>stride</code> is negative. Here are some examples:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0048-03" id="f0048-03"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> [<span class="sgreen">0</span>, <span class="sgreen">1</span>, <span class="sgreen">2</span>, <span class="sgreen">3</span>, <span class="sgreen">4</span>, <span class="sgreen">5</span>, <span class="sgreen">6</span>, <span class="sgreen">7</span>, <span class="sgreen">8</span>, <span class="sgreen">9</span>]
            a[<span class="sgreen">2</span>:<span class="sgreen">5</span>]     <span class="hblue"># [2, 3, 4]</span>
            a[:<span class="sgreen">3</span>]      <span class="hblue"># [0, 1, 2]</span>
            a[<span class="igrey">-</span><span class="sgreen">3</span>:]     <span class="hblue"># [7, 8, 9]</span>
            a[::<span class="sgreen">2</span>]     <span class="hblue"># [0, 2, 4, 6, 8 ]</span>
            a[::<span class="igrey">-</span><span class="sgreen">2</span>]    <span class="hblue"># [9, 7, 5, 3, 1 ]</span>
            a[<span class="sgreen">0</span>:<span class="sgreen">5</span>:<span class="sgreen">2</span>]   <span class="hblue"># [0, 2]</span>
            a[<span class="sgreen">5</span>:<span class="sgreen">0</span>:<span class="igrey">-</span><span class="sgreen">2</span>]  <span class="hblue"># [5, 3, 1]</span>
            <span epub:type="pagebreak" id="page_49"></span>a[:<span class="sgreen">5</span>:<span class="sgreen">1</span>]    <span class="hblue"># [0, 1, 2, 3, 4]</span>
            a[:<span class="sgreen">5</span>:<span class="igrey">-</span><span class="sgreen">1</span>]   <span class="hblue"># [9, 8, 7, 6]</span>
            a[<span class="sgreen">5</span>::<span class="sgreen">1</span>]    <span class="hblue"># [5, 6, 7, 8, 9]</span>
            a[<span class="sgreen">5</span>::<span class="igrey">-</span><span class="sgreen">1</span>]   <span class="hblue"># [5, 4, 3, 2, 1, 0]</span>
            a[<span class="sgreen">5</span>:<span class="sgreen">0</span>:<span class="igrey">-</span><span class="sgreen">1</span>]  <span class="hblue"># [5, 4, 3, 2, 1]</span></pre>
          <p class="indent">
            Fancy slices may result in code that is hard to understand later.
            Thus, some judgment is probably warranted. Slices can be named using
            <code>slice()</code>. For example:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0049-02" id="f0049-02"
              >Click here to view code image</a
            >
          </p>
          <pre>firstfive <span class="igrey">=</span> slice(<span class="sgreen">0</span>, <span class="sgreen">5</span>)
            s <span class="igrey">=</span> <span class="mblue">'hello world'</span>
            print(s[firstfive])     <span class="hblue"># Prints 'hello'</span></pre>
        </section>
        <section>
          <h3 class="h3" id="ch02lev1sec11">
            2.11 Operations on Mutable Sequences
          </h3>
          <p class="noindent">
            Strings and tuples are immutable and cannot be modified after
            creation. The contents of a list or other mutable sequence can be
            modified in-place with the operators in
            <a href="ch02.xhtml#ch02tab08">Table 2.8</a>.
          </p>
          <figure class="table" id="ch02tab08">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 2.8</span> Mutable Sequence Operations
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Operation</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext"><code>s[i] = x</code></p>
                  </td>
                  <td><p class="tabtext">Index assignment</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>s[i:j] = r</code></p>
                  </td>
                  <td><p class="tabtext">Slice assignment</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>s[i:j:stride] = r</code></p>
                  </td>
                  <td><p class="tabtext">Extended slice assignment</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>del s[i]</code></p>
                  </td>
                  <td><p class="tabtext">Deletes an element</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>del s[i:j]</code></p>
                  </td>
                  <td><p class="tabtext">Deletes a slice</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>del s[i:j:stride]</code></p>
                  </td>
                  <td><p class="tabtext">Deletes an extended slice</p></td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            The <code>s[i] = x</code> operator changes element <code>i</code> of
            a sequence to refer to object <code>x</code>, increasing the
            reference count of <code>x</code>. Negative indices are relative to
            the end of the list and attempts to assign a value to an
            out-of-range index result in an <code>IndexError</code> exception.
            The slicing assignment operator <code>s[i:j] = r</code> replaces
            elements <code>k</code>, where <code>i &lt;= k &lt; j</code>, with
            elements from sequence <code>r</code>. Indices have the same meaning
            as for slicing. If necessary, the sequence <code>s</code> may be
            expanded or reduced in size to accommodate all the elements in
            <code>r</code>. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0049-03" id="f0049-03"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> [<span class="sgreen">1</span>, <span class="sgreen">2</span>, <span class="sgreen">3</span>, <span class="sgreen">4</span>, <span class="sgreen">5</span>]
            a[<span class="sgreen">1</span>] <span class="igrey">=</span> <span class="sgreen">6</span>               <span class="hblue"># a = [1, 6, 3, 4, 5]</span>
            a[<span class="sgreen">2</span>:<span class="sgreen">4</span>] <span class="igrey">=</span> [<span class="sgreen">10</span>, <span class="sgreen">11</span>]      <span class="hblue"># a = [1, 6, 10, 11, 5]</span>
            a[<span class="sgreen">3</span>:<span class="sgreen">4</span>] <span class="igrey">=</span> [<span class="igrey">-</span><span class="sgreen">1</span>, <span class="igrey">-</span><span class="sgreen">2</span>, <span class="igrey">-</span><span class="sgreen">3</span>]  <span class="hblue"># a = [1, 6, 10, -1, -2, -3, 5]</span>
            a[<span class="sgreen">2</span>:] <span class="igrey">=</span> [<span class="sgreen">0</span>]            <span class="hblue"># a = [1, 6, 0]</span></pre>
          <p class="indent">
            A slicing assignment may be supplied with an optional stride
            argument. However, the behavior is then more restricted in that the
            argument on the right side must have exactly the same number of
            elements as the slice that’s being replaced. Here’s an example:<span
              epub:type="pagebreak"
              id="page_50"
            ></span>
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0050-01" id="f0050-01"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> [<span class="sgreen">1</span>, <span class="sgreen">2</span>, <span class="sgreen">3</span>, <span class="sgreen">4</span>, <span class="sgreen">5</span>]
            a[<span class="sgreen">1</span>::<span class="sgreen">2</span>] <span class="igrey">=</span> [<span class="sgreen">10</span>, <span class="sgreen">11</span>]      <span class="hblue"># a = [1, 10, 3, 11, 5]</span>
            a[<span class="sgreen">1</span>::<span class="sgreen">2</span>] <span class="igrey">=</span> [<span class="sgreen">30</span>, <span class="sgreen">40</span>, <span class="sgreen">50</span>]  <span class="hblue"># ValueError. Only two elements in slice on left</span></pre>
          <p class="indent">
            The <code>del s[i]</code> operator removes element
            <code>i</code> from a sequence and decrements its reference count.
            <code>del s[i:j]</code> removes all the elements in a slice. A
            stride may also be supplied, as in <code>del s[i:j:stride]</code>.
          </p>
          <p class="indent">
            The semantics described here apply to the built-in list type.
            Operations involving sequence slicing is a rich area for
            customization in third-party packages. You may find that slices on
            non-list objects have different rules concerning reassignment,
            deletion, and sharing of objects. For example, the popular
            <code>numpy</code> package has different slicing semantics than
            Python lists.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch02lev1sec12">2.12 Operations on Sets</h3>
          <p class="noindent">
            A set is an unordered collection of unique values. The operations in
            <a href="ch02.xhtml#ch02tab09">Table 2.9</a> can be performed on
            sets.
          </p>
          <figure class="table" id="ch02tab09">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 2.9</span> Operations on Sets
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Operation</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext"><code>s | t</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Union of <code>s</code> and <code>t</code>
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>s &amp; t</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Intersection of <code>s</code> and <code>t</code>
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>s – t</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Set difference (items in <code>s</code>, not in
                      <code>t</code>)
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>s ^ t</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Symmetric difference (items not in both <code>s</code> or
                      <code>t</code>)
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>len(s)</code></p>
                  </td>
                  <td><p class="tabtext">Number of items in the set</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>item in s</code>, <code>item not in s</code>
                    </p>
                  </td>
                  <td><p class="tabtext">Membership test</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>s.add(item)</code></p>
                  </td>
                  <td>
                    <p class="tabtext">Add an item to set <code>s</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>s.remove(item)</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Remove an item from <code>s</code> if it exists (otherwise
                      an error)
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>s.discard(item)</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Discard an item from <code>s</code> if it exists
                    </p>
                  </td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">Here are some examples:</p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0050-02" id="f0050-02"
              >Click here to view code image</a
            >
          </p>
          <pre>&gt;&gt;&gt; a = {'a', 'b', 'c' }
            &gt;&gt;&gt; b = {'c', 'd'}
            &gt;&gt;&gt; a | b
            {'a', 'b', 'c', 'd'}
            &gt;&gt;&gt; a &amp; b
            &gt;&gt;&gt; {'c' }
            &gt;&gt;&gt; a - b
            {'a', 'b'}
            &gt;&gt;&gt; b - a
            {'d'}
            <span epub:type="pagebreak" id="page_51"></span>&gt;&gt;&gt; a ^ b
            {'a', 'b', 'd'}
            &gt;&gt;&gt;</pre>
          <p class="indent">
            Set operations also work on the key-view and item-view objects of
            dictionaries. For example, to find out which keys two dictionaries
            have in common, do this:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0051-02" id="f0051-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; a = { 'x': 1, 'y': 2, 'z': 3 }
            &gt;&gt;&gt; b = { 'z': 3, 'w': 4, 'q': 5 }
            &gt;&gt;&gt; a.keys() &amp; b.keys()
            { 'z' }
            &gt;&gt;&gt;</pre
          >
        </section>
        <section>
          <h3 class="h3" id="ch02lev1sec13">2.13 Operations on Mappings</h3>
          <p class="noindent">
            A mapping is an association between keys and values. The built-in
            <code>dict</code> type is an example. The operations in
            <a href="ch02.xhtml#ch02tab10">Table 2.10</a> may be applied to
            mappings.
          </p>
          <figure class="table" id="ch02tab10">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 2.10</span> Operations on Mappings
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Operation</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext"><code>x = m[k]</code></p>
                  </td>
                  <td><p class="tabtext">Indexing by key</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>m[k] = x</code></p>
                  </td>
                  <td><p class="tabtext">Assignment by key</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>del m[k]</code></p>
                  </td>
                  <td><p class="tabtext">Deletes an item by key</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>k in m</code></p>
                  </td>
                  <td><p class="tabtext">Membership testing</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>len(m)</code></p>
                  </td>
                  <td><p class="tabtext">Number of items in the mapping</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>m.keys()</code></p>
                  </td>
                  <td><p class="tabtext">Return the keys</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>m.values()</code></p>
                  </td>
                  <td><p class="tabtext">Return the values</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>m.items()</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Return <code>(key, value)</code> pairs
                    </p>
                  </td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            Key values can be any immutable object, such as strings, numbers,
            and tuples. When using a tuple as the key, you can omit the
            parentheses and write comma-separated values like this:
          </p>
          <pre>d <span class="igrey">=</span> { }
            d[<span class="sgreen">1</span>,<span class="sgreen">2</span>,<span class="sgreen">3</span>] <span class="igrey">=</span> <span class="mblue">"foo"</span>
            d[<span class="sgreen">1</span>,<span class="sgreen">0</span>,<span class="sgreen">3</span>] <span class="igrey">=</span> <span class="mblue">"bar"</span></pre>
          <p class="indent">
            In this case, the key values represent a tuple, making these
            assignments equivalent to the following:
          </p>
          <pre>d[(<span class="sgreen">1</span>,<span class="sgreen">2</span>,<span class="sgreen">3</span>)] <span class="igrey">=</span> <span class="mblue">"foo"</span>
            d[(<span class="sgreen">1</span>,<span class="sgreen">0</span>,<span class="sgreen">3</span>)] <span class="igrey">=</span> <span class="mblue">"bar"</span></pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_52"></span>Using a tuple as a
            key is a common technique for creating composite keys in a mapping.
            For example, a key may consist of a “first name” and “last name.”
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch02lev1sec14">
            2.14 List, Set, and Dictionary Comprehensions
          </h3>
          <p class="noindent">
            One of the most common operations involving data is transforming a
            collection of data into another data structure. For example, here we
            take all the items in a list, apply an operation, and create a new
            list:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0052-01" id="f0052-01"
              >Click here to view code image</a
            >
          </p>
          <pre>nums <span class="igrey">=</span> [<span class="sgreen">1</span>, <span class="sgreen">2</span>, <span class="sgreen">3</span>, <span class="sgreen">4</span>, <span class="sgreen">5</span>]
            squares <span class="igrey">=</span> []
            <span class="lgreen"><strong>for</strong></span> n <span class="lgreen"><strong>in</strong></span> nums:
                nums.append(n <span class="igrey">*</span> n)</pre>
          <p class="indent">
            Since this kind of operation is so common, it is available as an
            operator known as a list comprehension. Here is a more compact
            version of this code:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0052-02" id="f0052-02"
              >Click here to view code image</a
            >
          </p>
          <pre>nums <span class="igrey">=</span> [<span class="sgreen">1</span>, <span class="sgreen">2</span>, <span class="sgreen">3</span>, <span class="sgreen">4</span>, <span class="sgreen">5</span>]
            squares <span class="igrey">=</span> [n <span class="igrey">*</span> n <span class="lgreen"><strong>for</strong></span> n <span class="lgreen"><strong>in</strong></span> nums]</pre>
          <p class="indent">
            It is also possible to apply a filter to the operation:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0052-03" id="f0052-03"
              >Click here to view code image</a
            >
          </p>
          <pre>squares <span class="igrey">=</span> [n <span class="igrey">*</span> n <span class="lgreen"><strong>for</strong></span> n <span class="lgreen"><strong>in</strong></span> nums <span class="lgreen"><strong>if</strong></span> n <span class="igrey">&gt;</span> <span class="sgreen">2</span>]     <span class="hblue"># [9, 16, 25]</span></pre>
          <p class="indent">
            The general syntax for a list comprehension is as follows:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0052-04" id="f0052-04"
              >Click here to view code image</a
            >
          </p>
          <pre>[expression <span class="lgreen"><strong>for</strong></span> item1 <span class="lgreen"><strong>in</strong></span> iterable1 <span class="lgreen"><strong>if</strong></span> condition1
                        <span class="lgreen"><strong>for</strong></span> item2 <span class="lgreen"><strong>in</strong></span> iterable2 <span class="lgreen"><strong>if</strong></span> condition2
                        ...
                        <span class="lgreen"><strong>for</strong></span> itemN <span class="lgreen"><strong>in</strong></span> iterableN <span class="lgreen"><strong>if</strong></span> conditionN ]</pre>
          <p class="indent">This syntax is equivalent to the following code:</p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0052-05" id="f0052-05"
              >Click here to view code image</a
            >
          </p>
          <pre>result <span class="igrey">=</span> []
            <span class="lgreen"><strong>for</strong></span> item1 <span class="lgreen"><strong>in</strong></span> iterable1:
                <span class="lgreen"><strong>if</strong></span> condition1:
                    <span class="lgreen"><strong>for</strong></span> item2 <span class="lgreen"><strong>in</strong></span> iterable2:
                       <span class="lgreen"><strong>if</strong></span> condition2:
                           ...
                           <span class="lgreen"><strong>for</strong></span> itemN <span class="lgreen"><strong>in</strong></span> iterableN:
                               <span class="lgreen"><strong>if</strong></span> conditionN:
                                   result.append(expression)</pre>
          <p class="indent">
            List comprehensions are a very useful way to process list data of
            various forms. Here are some practical examples:<span
              epub:type="pagebreak"
              id="page_53"
            ></span>
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0053-01" id="f0053-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># Some data (a list of dictionaries)</span>
            portfolio <span class="igrey">=</span> [
              {<span class="mblue">'name'</span>: <span class="mblue">'IBM'</span>, <span class="mblue">'shares'</span>: <span class="sgreen">100</span>, <span class="mblue">'price'</span>: <span class="sgreen">91.1</span> },
              {<span class="mblue">'name'</span>: <span class="mblue">'MSFT'</span>, <span class="mblue">'shares'</span>: <span class="sgreen">50</span>, <span class="mblue">'price'</span>: <span class="sgreen">45.67</span> },
              {<span class="mblue">'name'</span>: <span class="mblue">'HPE'</span>, <span class="mblue">'shares'</span>: <span class="sgreen">75</span>, <span class="mblue">'price'</span>: <span class="sgreen">34.51</span> },
              {<span class="mblue">'name'</span>: <span class="mblue">'CAT'</span>, <span class="mblue">'shares'</span>: <span class="sgreen">60</span>, <span class="mblue">'price'</span>: <span class="sgreen">67.89</span> },
              {<span class="mblue">'name'</span>: <span class="mblue">'IBM'</span>, <span class="mblue">'shares'</span>: <span class="sgreen">200</span>, <span class="mblue">'price'</span>: <span class="sgreen">95.25</span> }
            ]
            
            <span class="hblue"># Collect all names ['IBM', 'MSFT', 'HPE', 'CAT', 'IBM' ]</span>
            names <span class="igrey">=</span> [s[<span class="mblue">'name'</span>] <span class="lgreen"><strong>for</strong></span> s <span class="lgreen"><strong>in</strong></span> portfolio]
            
            <span class="hblue"># Find all entries with more than 100 shares ['IBM']</span>
            more100 <span class="igrey">=</span> [s[<span class="mblue">'name'</span>] <span class="lgreen"><strong>for</strong></span> s <span class="lgreen"><strong>in</strong></span> portfolio <span class="lgreen"><strong>if</strong></span> s[<span class="mblue">'shares'</span>] <span class="igrey">&gt;</span> <span class="sgreen">100</span> ]
            
            <span class="hblue"># Find the total shares*price</span>
            cost <span class="igrey">=</span> sum([s[<span class="mblue">'shares'</span>]<span class="igrey">*</span>s[<span class="mblue">'price'</span>] <span class="lgreen"><strong>for</strong></span> s <span class="lgreen"><strong>in</strong></span> portfolio])
            
            <span class="hblue"># Collect (name, shares) tuples</span>
            name_shares <span class="igrey">=</span> [ (s[<span class="mblue">'name'</span>], s[<span class="mblue">'shares'</span>]) <span class="lgreen"><strong>for</strong></span> s <span class="lgreen"><strong>in</strong></span> portfolio ]</pre>
          <p class="indent">
            All of the variables used inside a list comprehension are private to
            the comprehension. You don’t need to worry about such variables
            overwriting other variables with the same name. For example:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0053-02" id="f0053-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; x = 42
            &gt;&gt;&gt; squares = [x*x for x in [1,2,3]]
            &gt;&gt;&gt; squares
            [1, 4, 9]
            &gt;&gt;&gt; x
            42
            &gt;&gt;&gt;</pre
          >
          <p class="indent">
            Instead of creating a list, you can also create a set by changing
            the brackets into curly braces. This is known as a set
            comprehension. A set comprehension will give you a set of distinct
            values. For example:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0053-03" id="f0053-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># Set comprehension</span>
            names <span class="igrey">=</span> { s[<span class="mblue">'name'</span>] <span class="lgreen"><strong>for</strong></span> s <span class="lgreen"><strong>in</strong></span> portfolio }
            <span class="hblue"># names = { 'IBM', 'MSFT', 'HPE', 'CAT' }</span></pre>
          <p class="indent">
            If you specify <code>key:value</code> pairs, you’ll create a
            dictionary instead. This is known as a dictionary comprehension. For
            example:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0053-04" id="f0053-04"
              >Click here to view code image</a
            >
          </p>
          <pre>prices <span class="igrey">=</span> { s[<span class="mblue">'name'</span>]:s[<span class="mblue">'price'</span>] <span class="lgreen"><strong>for</strong></span> s <span class="lgreen"><strong>in</strong></span> portfolio }
            <span class="hblue"># prices = { 'IBM': 95.25, 'MSFT': 45.67, 'HPE': 34.51, 'CAT': 67.89 }</span></pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_54"></span>When creating sets
            and dictionaries, be aware that later entries might overwrite
            earlier entries. For example, in the <code>prices</code> dictionary
            you get the last price for <code>'IBM'</code>. The first price is
            lost.
          </p>
          <p class="indent">
            Within a comprehension, it’s not possible to include any sort of
            exception handling. If this is a concern, consider wrapping
            exceptions with a function, as shown here:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0054-01" id="f0054-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> toint(x):
                <span class="lgreen"><strong>try</strong></span>:
                    <span class="lgreen"><strong>return</strong></span> int(x)
                <span class="lgreen"><strong>except</strong></span><span class="pgold">ValueError</span>:
                    <span class="lgreen"><strong>return</strong></span> <span class="dblue">None</span>
            
            values <span class="igrey">=</span> [ <span class="mblue">'1'</span>, <span class="mblue">'2'</span>, <span class="mblue">'-4'</span>, <span class="mblue">'n/a'</span>, <span class="mblue">'-3'</span>, <span class="mblue">'5'</span> ]
            data1 <span class="igrey">=</span> [ toint(x) <span class="lgreen"><strong>for</strong></span> x <span class="lgreen"><strong>in</strong></span> values ]
            <span class="hblue"># data1 = [1, 2, -4, None, -3, 5]</span>
            
            data2 <span class="igrey">=</span> [ toint(x) <span class="lgreen"><strong>for</strong></span> x <span class="lgreen"><strong>in</strong></span> values <span class="lgreen"><strong>if</strong></span> toint(x) <span class="lgreen"><strong>is not</strong></span> <span class="dblue">None</span> ]
            <span class="hblue"># data2 = [1, 2, -4, -3, 5]</span></pre>
          <p class="indent">
            The double evaluation of <code>toint(x)</code> in the last example
            can be avoided by using the <code>:=</code> operator. For example:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0054-02" id="f0054-02"
              >Click here to view code image</a
            >
          </p>
          <pre>data3 <span class="igrey">=</span> [ v <span class="lgreen"><strong>for</strong></span> x <span class="lgreen"><strong>in</strong></span> values <span class="lgreen"><strong>if</strong></span> (v:<span class="igrey">=</span>toint(x)) <span class="lgreen"><strong>is not</strong></span> <span class="dblue">None</span> ]
            <span class="hblue"># data3 = [1, 2, -4, -3, 5]</span>
            
            data4 <span class="igrey">=</span> [ v <span class="lgreen"><strong>for</strong></span> x <span class="lgreen"><strong>in</strong></span> values <span class="lgreen"><strong>if</strong></span> (v:<span class="igrey">=</span>toint(x)) <span class="lgreen"><strong>is not</strong></span> <span class="dblue">None</span> <span class="lgreen"><strong>and</strong></span> v <span class="igrey">&gt;=</span> <span class="sgreen">0</span> ]
            <span class="hblue"># data4 = [1, 2, 5]</span></pre>
        </section>
        <section>
          <h3 class="h3" id="ch02lev1sec15">2.15 Generator Expressions</h3>
          <p class="noindent">
            A generator expression is an object that carries out the same
            computation as a list comprehension but produces the result
            iteratively. The syntax is the same as for a list comprehension
            except that you use parentheses instead of square brackets. Here’s
            an example:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0054-03" id="f0054-03"
              >Click here to view code image</a
            >
          </p>
          <pre>nums <span class="igrey">=</span> [<span class="sgreen">1</span>,<span class="sgreen">2</span>,<span class="sgreen">3</span>,<span class="sgreen">4</span>]
            squares <span class="igrey">=</span> (x<span class="igrey">*</span>x <span class="lgreen"><strong>for</strong></span> x <span class="lgreen"><strong>in</strong></span> nums)</pre>
          <p class="indent">
            Unlike a list comprehension, a generator expression does not
            actually create a list or immediately evaluate the expression inside
            the parentheses. Instead, it creates a generator object that
            produces the values on demand via iteration. If you look at the
            result of the above example, you’ll see the following:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0054-04" id="f0054-04"
              >Click here to view code image</a
            >
          </p>
          <pre>&gt;&gt;&gt; squares
            &lt;generator object at 0x590a8&gt;
            &gt;&gt;&gt; next(squares)
            <span epub:type="pagebreak" id="page_55"></span>1
            &gt;&gt;&gt; next(squares)
            4
            ...
            &gt;&gt;&gt; for n in squares:
            ...     print(n)
            9
            16
            &gt;&gt;&gt;</pre>
          <p class="indent">
            A generator expression can only be used once. If you try to iterate
            a second time, you’ll get nothing:
          </p>
          <pre>
&gt;&gt;&gt; for n in squares:
            ...     print(n)
            ...
            &gt;&gt;&gt;</pre
          >
          <p class="indent">
            The difference between list comprehensions and generator expressions
            is important but subtle. With a list comprehension, Python actually
            creates a list that contains the resulting data. With a generator
            expression, Python creates a generator that merely knows how to
            produce data on demand. In certain applications, this can greatly
            improve performance and memory use. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0055-03" id="f0055-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># Read a file</span>
            f <span class="igrey">=</span> open(<span class="mblue">'data.txt'</span>)                         <span class="hblue"># Open a file</span>
            lines <span class="igrey">=</span> (t.strip() <span class="lgreen"><strong>for</strong></span> t <span class="lgreen"><strong>in</strong></span> f)               <span class="hblue"># Read lines, strip</span>
                                                         <span class="hblue"># trailing/leading whitespace</span>
            comments <span class="igrey">=</span> (t <span class="lgreen"><strong>for</strong></span> t <span class="lgreen"><strong>in</strong></span> lines <span class="lgreen"><strong>if</strong></span> t[<span class="sgreen">0</span>] <span class="igrey">==</span> <span class="mblue">'#'</span>) <span class="hblue"># All comments</span>
            <span class="lgreen"><strong>for</strong></span> c <span class="lgreen"><strong>in</strong></span> comments:
                 print(c)</pre>
          <p class="indent">
            In this example, the generator expression that extracts lines and
            strips whitespace does not actually read and hold the entire file in
            memory. The same is true of the expression that extracts comments.
            Instead, the lines of the file are read one-by-one when the program
            starts iterating in the for loop that follows. During this
            iteration, the lines of the file are produced upon demand and
            filtered accordingly. In fact, at no time will the entire file be
            loaded into memory during this process. This is therefore a highly
            efficient way to extract comments from a gigabyte-sized Python
            source file.
          </p>
          <p class="indent">
            Unlike a list comprehension, a generator expression does not create
            an object that works like a sequence. It can’t be indexed, and none
            of the usual list operations (such as <code>append()</code>) will
            work. However, the items produced by a generator expression can be
            converted into a list using <code>list()</code>:
          </p>
          <pre>clist <span class="igrey">=</span> list(comments)</pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_56"></span>When passed as a
            single function argument, one set of parentheses can be removed. For
            example, the following statements are equivalent:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0056-01" id="f0056-01"
              >Click here to view code image</a
            >
          </p>
          <pre>sum((x<span class="igrey">*</span>x <span class="lgreen"><strong>for</strong></span> x <span class="lgreen"><strong>in</strong></span> values))
            sum(x<span class="igrey">*</span>x <span class="lgreen"><strong>for</strong></span> x <span class="lgreen"><strong>in</strong></span> values)      <span class="hblue"># Extra parens removed</span></pre>
          <p class="indent">
            In both cases, a generator <code>(x*x for x in values)</code> is
            created and passed to the <code>sum()</code> function.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch02lev1sec16">
            2.16 The Attribute (<code>.</code>) Operator
          </h3>
          <p class="noindent">
            The dot (<code>.</code>) operator is used to access the attributes
            of an object. Here’s an example:
          </p>
          <pre>foo.x <span class="igrey">=</span> <span class="sgreen">3</span>
            print(foo.y)
            a <span class="igrey">=</span> foo.bar(<span class="sgreen">3</span>,<span class="sgreen">4</span>,<span class="sgreen">5</span>)</pre>
          <p class="indent">
            More than one dot operator can appear in a single expression, for
            example <code>foo.y.a.b</code>. The dot operator can also be applied
            to the intermediate results of functions, as in
            <code>a = foo.bar(3,4,5).spam</code>. Stylistically, however, it is
            not so common for programs to create long chains of attribute
            lookups.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch02lev1sec17">
            2.17 The Function Call <code>()</code> Operator
          </h3>
          <p class="noindent">
            The <code>f(args)</code> operator is used to make a function call on
            <code>f</code>. Each argument to a function is an expression. Prior
            to calling the function, all of the argument expressions are fully
            evaluated from left to right. This is known as applicative order
            evaluation. More information about functions can be found in
            <a href="ch05.xhtml#ch05">Chapter 5</a>.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch02lev1sec18">2.18 Order of Evaluation</h3>
          <p class="noindent">
            <a href="ch02.xhtml#ch02tab11">Table 2.11</a> lists the order of
            operation (precedence rules) for Python operators. All operators
            except the power (<code>**</code>) operator are evaluated from left
            to right and are listed in the table from highest to lowest
            precedence. That is, operators listed first in the table are
            evaluated before operators listed later. Operators included together
            within subsections, such as <code>x * y</code>, <code>x / y</code>,
            <code>x // y</code>, <code>x @ y</code>, and <code>x % y</code>,
            have equal precedence.<span
              epub:type="pagebreak"
              id="page_57"
            ></span>
          </p>
          <figure class="table" id="ch02tab11">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 2.11</span> Order of Evaluation (Highest
                Precedence to Lowest)
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Operator</p></th>
                  <th><p class="tabtext">Name</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>(...)</code>, <code>[...]</code>, <code>{...}</code>
                    </p>
                  </td>
                  <td>
                    <p class="tabtext">Tuple, list, and dictionary creation</p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>s[i]</code>, <code>s[i:j]</code>
                    </p>
                  </td>
                  <td><p class="tabtext">Indexing and slicing</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>s.attr</code></p>
                  </td>
                  <td><p class="tabtext">Attribute lookup</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>f(...)</code></p>
                  </td>
                  <td><p class="tabtext">Function calls</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>+x</code>, <code>-x</code>, <code>~x</code>
                    </p>
                  </td>
                  <td><p class="tabtext">Unary operators</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x ** y</code></p>
                  </td>
                  <td><p class="tabtext">Power (right associative)</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>x * y</code>, <code>x / y</code>,
                      <code>x // y</code>, <code>x % y</code>,
                      <code>x @ y</code>
                    </p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Multiplication, division, floor division, modulo, matrix
                      multiplication
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>x + y</code>, <code>x - y</code>
                    </p>
                  </td>
                  <td><p class="tabtext">Addition, subtraction</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>x &lt;&lt; y</code>, <code>x &gt;&gt; y</code>
                    </p>
                  </td>
                  <td><p class="tabtext">Bit-shifting</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x &amp; y</code></p>
                  </td>
                  <td><p class="tabtext">Bitwise and</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x ^ y</code></p>
                  </td>
                  <td><p class="tabtext">Bitwise exclusive or</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x | y</code></p>
                  </td>
                  <td><p class="tabtext">Bitwise or</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>x &lt; y</code>, <code>x &lt;= y</code>,
                      <code>x &gt; y</code>, <code>x &gt;= y</code>,
                      <code>x == y</code>, <code>x !=y</code>,
                      <code>x is y</code>, <code>x is not y</code>,
                      <code>x in y</code>, <code>x not in y</code>
                    </p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Comparison, identity, and sequence membership tests
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>not x</code></p>
                  </td>
                  <td><p class="tabtext">Logical negation</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x and y</code></p>
                  </td>
                  <td><p class="tabtext">Logical and</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>x or y</code></p>
                  </td>
                  <td><p class="tabtext">Logical or</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>lambda args: expr</code></p>
                  </td>
                  <td><p class="tabtext">Anonymous function</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>expr if expr else expr</code></p>
                  </td>
                  <td><p class="tabtext">Conditional expression</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>name := expr</code></p>
                  </td>
                  <td><p class="tabtext">Assignment expression</p></td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            The order of evaluation in
            <a href="ch02.xhtml#ch02tab11">Table 2.11</a> does not depend on the
            types of <code>x</code> and <code>y</code>. So, even though
            user-defined objects can redefine individual operators, it is not
            possible to customize the underlying evaluation order, precedence,
            and associativity rules.
          </p>
          <p class="indent">
            A common confusion with precedence rules is when bitwise-and
            (<code>&amp;</code>) and bitwise-or (<code>|</code>) operators are
            used to mean logical-and (<code>and</code>) and logical-or
            (<code>or</code>). For example:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0057-04" id="f0057-04"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; a = 10
            &gt;&gt;&gt; a &lt;= 10 and 1 &lt; a
            True
            &gt;&gt;&gt; a &lt;= 10 &amp; 1 &lt; a
            False
            &gt;&gt;&gt;</pre
          >
          <p class="indent">
            The latter expression gets evaluated as
            <code>a &lt;= (10 &amp; 1) &lt; a</code> or
            <code>a &lt;= 0 &lt; a</code>. You can fix it by adding parentheses:
          </p>
          <p class="codelink">
            <a href="ch02_images.xhtml#rf0057-05" id="f0057-05"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; (a &lt;= 10) &amp; (1 &lt; a)
            True
            &gt;&gt;&gt;</pre
          >
          <p class="indent">
            <span epub:type="pagebreak" id="page_58"></span>This might seem like
            an esoteric edge case, but it arises with some frequency in
            data-oriented packages such as <code>numpy</code> and
            <code>pandas</code>. The logical operators <code>and</code> and
            <code>or</code> can’t be customized so the bitwise operators are
            used instead—even though they have a higher precedence level and
            evaluate differently when used in Boolean relations.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch02lev1sec19">
            2.19 Final Words: The Secret Life of Data
          </h3>
          <p class="noindent">
            One of the most frequent uses of Python is in applications involving
            data manipulation and analysis. Here, Python provides a kind of
            “domain language” for thinking about your problem. The built-in
            operators and expressions are at the core of that language and
            everything else builds from it. Thus, once you build a kind of
            intuition around Python’s built-in objects and operations, you will
            find that your intuition applies everywhere.
          </p>
          <p class="indent">
            As an example, suppose you’re working with a database and you want
            to iterate over the records returned by a query. Chances are, you
            will use the <code>for</code> statement to do just that. Or, suppose
            you’re working with numeric arrays and want to perform
            element-by-element mathematics on arrays. You might think that the
            standard math operators would work— and your intuition would be
            correct. Or, suppose you’re using a library to fetch data over HTTP
            and you want to access the contents of the HTTP headers. There’s a
            good chance that data will be presented in a way that looks like a
            dictionary.
          </p>
          <p class="indent">
            More information about Python’s internal protocols and how to
            customize them is given in <a href="ch04.xhtml#ch04">Chapter 4</a>.
          </p>
        </section>
      </section>
    </div>
    <div id="sbo-rt-content">
      <section epub:type="chapter">
        <h2 class="h2" id="ch03">
          <span epub:type="pagebreak" id="page_59"></span
          ><span class="ash">3.</span> Program Structure and Control Flow
        </h2>
        <p class="noindent">
          This chapter covers the details of program structure and control flow.
          Topics include conditionals, looping, exceptions, and context
          managers.
        </p>
        <section>
          <h3 class="h3" id="ch03lev1sec1">
            3.1 Program Structure and Execution
          </h3>
          <p class="noindent">
            Python programs are structured as a sequence of statements. All
            language features, including variable assignment, expressions,
            function definitions, classes, and module imports, are statements
            that have equal status with all other statements—meaning that any
            statement can be placed almost anywhere in a program (although
            certain statements such as <code>return</code> can only appear
            inside a function). For example, this code defines two different
            versions of a function inside a conditional:
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0059-01" id="f0059-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>if</strong></span> debug:
                    <span class="lgreen"><strong>def</strong></span> square(x):
                        <span class="lgreen"><strong>if not</strong></span> isinstance(x,float):
                            <span class="lgreen"><strong>raise</strong></span> <span class="pgold">TypeError</span>(<span class="mblue">'Expected a float'</span>)
                        <span class="lgreen"><strong>return</strong></span> x <span class="igrey">*</span> x
                <span class="lgreen"><strong>else</strong></span>:
                    <span class="lgreen"><strong>def</strong></span> square(x):
                        <span class="lgreen"><strong>return</strong></span> x <span class="igrey">*</span> x</pre>
          <p class="indent">
            When loading source files, the interpreter executes statements in
            the order they appear until there are no more statements to execute.
            This execution model applies both to files you run as the main
            program and to library files that are loaded via
            <code>import</code>.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch03lev1sec2">3.2 Conditional Execution</h3>
          <p class="noindent">
            The <code>if</code>, <code>else</code>, and
            <code>elif</code> statements control conditional code execution. The
            general format of a conditional statement is<span
              epub:type="pagebreak"
              id="page_60"
            ></span>
          </p>
          <pre><span class="lgreen"><strong>if</strong></span> expression:
                    statements
                <span class="lgreen"><strong>elif</strong></span> expression:
                    statements
                <span class="lgreen"><strong>elif</strong></span> expression:
                    statements
                ...
                <span class="lgreen"><strong>else</strong></span>:
                    statements</pre>
          <p class="indent">
            If no action is to be taken, you can omit both the
            <code>else</code> and <code>elif</code> clauses of a conditional.
            Use the <code>pass</code> statement if no statements exist for a
            particular clause:
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0060-02" id="f0060-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>if</strong></span> expression:
                    <span class="lgreen"><strong>pass</strong></span>            <span class="hblue"># To do: please implement</span>
                <span class="lgreen"><strong>else</strong></span>:
                    statements</pre>
        </section>
        <section>
          <h3 class="h3" id="ch03lev1sec3">3.3 Loops and Iteration</h3>
          <p class="noindent">
            You implement loops using the <code>for</code> and
            <code>while</code> statements. Here’s an example:
          </p>
          <pre><span class="lgreen"><strong>while</strong></span> expression:
                    statements
                
                <span class="lgreen"><strong>for</strong></span> i <span class="lgreen"><strong>in</strong></span> s:
                    statements</pre>
          <p class="indent">
            The <code>while</code> statement executes statements until the
            associated expression evaluates to false. The
            <code>for</code> statement iterates over all the elements of
            <code>s</code> until no more elements are available. The
            <code>for</code> statement works with any object that supports
            iteration. This includes the built-in sequence types such as lists,
            tuples, and strings, but also any object that implements the
            iterator protocol.
          </p>
          <p class="indent">
            In the statement <code>for i in s</code>, the variable
            <code>i</code> is known as the iteration variable. On each iteration
            of the loop, it receives a new value from <code>s</code>. The scope
            of the iteration variable is not private to the
            <code>for</code> statement. If a previously defined variable has the
            same name, that value will be overwritten. Moreover, the iteration
            variable retains the last value after the loop has completed.
          </p>
          <p class="indent">
            If the elements produced by iteration are iterables of identical
            size, you can unpack their values into separate iteration variables
            using a statement such as this:
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0060-04" id="f0060-04"
              >Click here to view code image</a
            >
          </p>
          <pre>s <span class="igrey">=</span> [ (<span class="sgreen">1</span>, <span class="sgreen">2</span>, <span class="sgreen">3</span>), (<span class="sgreen">4</span>, <span class="sgreen">5</span>, <span class="sgreen">6</span>) ]
                
                <span class="lgreen"><strong>for</strong></span> x, y, z <span class="lgreen"><strong>in</strong></span> s:
                    statements</pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_61"></span>In this example,
            <code>s</code> must contain or produce iterables, each with three
            elements. On each iteration, the contents of the variables
            <code>x</code>, <code>y</code>, and <code>z</code> are assigned the
            items of the corresponding iterable. Although it is most common to
            see this used when <code>s</code> is a sequence of tuples, unpacking
            works when the items in <code>s</code> are any kind of iterable,
            including lists, generators, and strings.
          </p>
          <p class="indent">
            Sometimes a throw-away variable such as <code>_</code> is used while
            unpacking. For example:
          </p>
          <pre><span class="lgreen"><strong>for</strong></span> x, _, z <span class="lgreen"><strong>in</strong></span> s:
                    statements</pre>
          <p class="indent">
            In this example, a value is still placed into the
            <code>_</code> variable, but the variable’s name implies that it’s
            not interesting or of use in the statements that follow.
          </p>
          <p class="indent">
            If the items produced by an iterable have varying sizes, you can use
            wildcard unpacking to place multiple values into a variable. For
            example:
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0061-02" id="f0061-02"
              >Click here to view code image</a
            >
          </p>
          <pre>s <span class="igrey">=</span> [ (<span class="sgreen">1</span>, <span class="sgreen">2</span>), (<span class="sgreen">3</span>, <span class="sgreen">4</span>, <span class="sgreen">5</span>), (<span class="sgreen">6</span>, <span class="sgreen">7</span>, <span class="sgreen">8</span>, <span class="sgreen">9</span>) ]
                
                <span class="lgreen"><strong>for</strong></span> x, y, <span class="igrey">*</span>extra <span class="lgreen"><strong>in</strong></span> s:
                    statements            <span class="hblue"># x = 1, y = 2, extra = []</span>
                                          <span class="hblue"># x = 3, y = 4, extra = [5]</span>
                                          <span class="hblue"># x = 6, y = 7, extra = [8, 9]</span>
                                          <span class="hblue"># ...</span></pre>
          <p class="indent">
            In this example, at least two values <code>x</code> and
            <code>y</code> are required, but <code>*extra</code> receives any
            extra values that might also be present. These values are always
            placed in a list. At most, only one starred variable can appear in a
            single unpacking, but it can appear in any position. So, both of
            these variants are legal:
          </p>
          <pre><span class="lgreen"><strong>for</strong></span> <span class="igrey">*</span>first, x, y <span class="lgreen"><strong>in</strong></span> s:
                    ...
                
                <span class="lgreen"><strong>for</strong></span> x, <span class="igrey">*</span>middle, y <span class="lgreen"><strong>in</strong></span> s:
                    ...</pre>
          <p class="indent">
            When looping, it is sometimes useful to keep track of a numerical
            index in addition to the data values. Here’s an example:
          </p>
          <pre>i <span class="igrey">=</span> <span class="sgreen">0</span>
                <span class="lgreen"><strong>for</strong></span> x <span class="lgreen"><strong>in</strong></span> s:
                    statements
                    i <span class="igrey">+=</span> <span class="sgreen">1</span></pre>
          <p class="indent">
            Python provides a built-in function, <code>enumerate()</code>, that
            can be used to simplify this code:
          </p>
          <pre><span class="lgreen"><strong>for</strong></span> i, x <span class="lgreen"><strong>in</strong></span> enumerate(s):
                    statements</pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_62"></span
            ><code>enumerate(s)</code> creates an iterator that produces tuples
            <code>(0, s[0])</code>, <code>(1, s[1])</code>,
            <code>(2, s[2])</code>, and so on. A different starting value for
            the count can be provided with the <code>start</code> keyword
            argument to <code>enumerate()</code>:
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0062-01" id="f0062-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>for</strong></span> i, x <span class="lgreen"><strong>in</strong></span> enumerate(s, start<span class="igrey">=</span><span class="sgreen">100</span>):
                    statements</pre>
          <p class="indent">
            In this case, tuples of the form <code>(100, s[0])</code>,
            <code>(101, s[1])</code>, and so on will be produced.
          </p>
          <p class="indent">
            Another common looping problem is iterating in parallel over two or
            more iterables— for example, writing a loop where you take items
            from different sequences on each iteration:
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0062-02" id="f0062-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># s and t are two sequences</span>
                i <span class="igrey">=</span> <span class="sgreen">0</span>
                <span class="lgreen"><strong>while</strong></span> i <span class="igrey">&lt;</span> len(s) <span class="lgreen"><strong>and</strong></span> i <span class="igrey">&lt;</span> len(t):
                    x <span class="igrey">=</span> s[i]     <span class="hblue"># Take an item from s</span>
                    y <span class="igrey">=</span> t[i]     <span class="hblue"># Take an item from t</span>
                    statements
                    i <span class="igrey">+=</span> <span class="sgreen">1</span></pre>
          <p class="indent">
            This code can be simplified using the <code>zip()</code> function.
            For example:
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0062-03" id="f0062-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># s and t are two sequences</span>
                <span class="lgreen"><strong>for</strong></span> x, y <span class="lgreen"><strong>in</strong></span> zip(s, t):
                    statements</pre>
          <p class="indent">
            <code>zip(s, t)</code> combines iterables <code>s</code> and
            <code>t</code> into an iterable of tuples <code>(s[0], t[0])</code>,
            <code>(s[1], t[1])</code>, <code>(s[2], t[2])</code>, and so forth,
            stopping with the shortest of <code>s</code> and
            <code>t</code> should they be of unequal length. The result of
            <code>zip()</code> is an iterator that produces the results when
            iterated. If you want the result converted to a list, use
            <code>list(zip(s, t))</code>.
          </p>
          <p class="indent">
            To break out of a loop, use the <code>break</code> statement. For
            example, this code reads lines of text from a file until an empty
            line of text is encountered:
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0062-04" id="f0062-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>with</strong></span> open(<span class="mblue">'foo.txt'</span>) as file:
                    <span class="lgreen"><strong>for</strong></span> line <span class="lgreen"><strong>in</strong></span> file:
                        stripped <span class="igrey">=</span> line.strip()
                        <span class="lgreen"><strong>if not</strong></span> stripped:
                            <span class="lgreen"><strong>break</strong></span>          <span class="hblue"># A blank line, stop reading</span>
                        <span class="hblue"># process the stripped line</span>
                        ...</pre>
          <p class="indent">
            To jump to the next iteration of a loop (skipping the remainder of
            the loop body), use the <code>continue</code> statement. This
            statement is useful when reversing a test and indenting another
            level would make the program too deeply nested or unnecessarily
            complicated. As an example, the following loop skips all of the
            blank lines in a file:<span
              epub:type="pagebreak"
              id="page_63"
            ></span>
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0063-01" id="f0063-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>with</strong></span> open(<span class="mblue">'foo.txt'</span>) as file:
                    <span class="lgreen"><strong>for</strong></span> line <span class="lgreen"><strong>in</strong></span> file:
                        stripped <span class="igrey">=</span> line.strip()
                        <span class="lgreen"><strong>if not</strong></span> stripped:
                            <span class="lgreen"><strong>continue</strong></span>      <span class="hblue"># Skip the blank line</span>
                        <span class="hblue"># process the stripped line</span>
                        ...</pre>
          <p class="indent">
            The <code>break</code> and <code>continue</code> statements apply
            only to the innermost loop being executed. If you need to break out
            of a deeply nested loop structure, you can use an exception. Python
            doesn’t provide a “goto” statement. You can also attach the
            <code>else</code> statement to loop constructs, as in the following
            example:
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0063-02" id="f0063-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># for-else</span>
                <span class="lgreen"><strong>with</strong></span> open(<span class="mblue">'foo.txt'</span>) as file:
                    <span class="lgreen"><strong>for</strong></span> line <span class="lgreen"><strong>in</strong></span> file:
                        stripped <span class="igrey">=</span> line.strip()
                        <span class="lgreen"><strong>if not</strong></span> stripped:
                            <span class="lgreen"><strong>break</strong></span>
                        <span class="hblue"># process the stripped line</span>
                        ...
                    <span class="lgreen"><strong>else</strong></span>:
                        <span class="lgreen"><strong>raise</strong></span> <span class="pgold">RuntimeError</span>(<span class="mblue">'Missing section separator'</span>)</pre>
          <p class="indent">
            The <code>else</code> clause of a loop executes only if the loop
            runs to completion. This either occurs immediately (if the loop
            wouldn’t execute at all) or after the last iteration. If the loop is
            terminated early using the <code>break</code> statement, the
            <code>else</code> clause is skipped.
          </p>
          <p class="indent">
            The primary use case for the looping <code>else</code> clause is in
            code that iterates over data but needs to set or check some kind of
            flag or condition if the loop breaks prematurely. For example, if
            you didn’t use <code>else</code>, the previous code might have to be
            rewritten with a flag variable as follows:
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0063-03" id="f0063-03"
              >Click here to view code image</a
            >
          </p>
          <pre>found_separator <span class="igrey">=</span> <span class="dblue">False</span>
                
                <span class="lgreen"><strong>with</strong></span> open(<span class="mblue">'foo.txt'</span>) as file:
                    <span class="lgreen"><strong>for</strong></span> line <span class="lgreen"><strong>in</strong></span> file:
                        stripped <span class="igrey">=</span> line.strip()
                        <span class="lgreen"><strong>if not</strong></span> stripped:
                            found_separator <span class="igrey">=</span> <span class="dblue">True</span>
                            <span class="lgreen"><strong>break</strong></span>
                        <span class="hblue"># process the stripped line</span>
                        ...
                    <span class="lgreen"><strong>if not</strong></span> found_separator:
                        <span class="lgreen"><strong>raise</strong></span> <span class="pgold">RuntimeError</span>(<span class="mblue">'Missing section separator'</span>)</pre>
        </section>
        <section>
          <h3 class="h3" id="ch03lev1sec4">
            <span epub:type="pagebreak" id="page_64"></span>3.4 Exceptions
          </h3>
          <p class="noindent">
            Exceptions indicate errors and break out of the normal control flow
            of a program. An exception is raised using the
            <code>raise</code> statement. The general format of the
            <code>raise</code> statement is
            <code>raise Exception([value])</code>, where
            <code>Exception</code> is the exception type and
            <code>value</code> is an optional value giving specific details
            about the exception. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0064-01" id="f0064-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>raise</strong></span> <span class="pgold">RuntimeError</span>(<span class="mblue">'Unrecoverable Error'</span>)</pre>
          <p class="indent">
            To catch an exception, use the <code>try</code> and
            <code>except</code> statements, as shown here:
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0064-02" id="f0064-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>try</strong></span>:
                    file <span class="igrey">=</span> open(<span class="mblue">'foo.txt'</span>, <span class="mblue">'rt'</span>)
                <span class="lgreen"><strong>except</strong></span> <span class="pgold">FileNotFoundError</span> as e:
                    statements</pre>
          <p class="indent">
            When an exception occurs, the interpreter stops executing statements
            in the <code>try</code> block and looks for an
            <code>except</code> clause that matches the exception type that has
            occurred. If one is found, control is passed to the first statement
            in the except clause. After the except clause is executed, control
            continues with the first statement that appears after the entire
            <code>try-except</code> block.
          </p>
          <p class="indent">
            It is not necessary for a <code>try</code> statement to match all
            possible exceptions that might occur. If no matching
            <code>except</code> clause can be found, an exception continues to
            propagate and might be caught in a different
            <code>try-except</code> block that can actually handle the exception
            elsewhere. As a matter of programming style, you should only catch
            exceptions from which your code can actually recover. If recovery is
            not possible, it’s often better to let the exception propagate.
          </p>
          <p class="indent">
            If an exception works its way up to the top level of a program
            without being caught, the interpreter aborts with an error message.
          </p>
          <p class="indent">
            If the <code>raise</code> statement is used by itself, the last
            exception generated is raised again. This works only while handling
            a previously raised exception. For example:
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0064-03" id="f0064-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>try</strong></span>:
                    file <span class="igrey">=</span> open(<span class="mblue">'foo.txt'</span>, <span class="mblue">'rt'</span>)
                <span class="lgreen"><strong>except</strong></span> <span class="pgold">FileNotFoundError</span>:
                    print(<span class="mblue">"Well, that didn't work."</span>)
                    <span class="lgreen"><strong>raise</strong></span>       <span class="hblue"># Re-raises current exception</span></pre>
          <p class="indent">
            Each <code>except</code> clause may be used with an
            <code>as var</code> modifier that gives the name of a variable into
            which an instance of the exception type is placed if an exception
            occurs. Exception handlers can examine this value to find out more
            about the cause of the exception. For example, you can use
            <code>isinstance()</code> to check the exception type.
          </p>
          <p class="indent">
            Exceptions have a few standard attributes that might be useful in
            code that needs to perform further actions in response to an error:
          </p>
          <pre>e.args</pre>
          <p class="indent1">
            The tuple of arguments supplied when raising the exception. In most
            cases, this is a one-item tuple with a string describing the error.
            For <code>OSError</code> exceptions, the value
            <span epub:type="pagebreak" id="page_65"></span>is a 2-tuple or
            3-tuple containing an integer error number, string error message,
            and an optional filename.
          </p>
          <pre>e.__cause__</pre>
          <p class="indent1">
            Previous exception if the exception was intentionally raised in
            response to handling another exception. See the later section on
            chained exceptions.
          </p>
          <pre>e.__context__</pre>
          <p class="indent1">
            Previous exception if the exception was raised while handling
            another exception.
          </p>
          <pre>e.__traceback__</pre>
          <p class="indent1">
            Stack traceback object associated with the exception.
          </p>
          <p class="indent">
            The variable used to hold an exception value is only accessible
            inside the associated <code>except</code> block. Once control leaves
            the block, the variable becomes undefined. For example:
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0065-01" id="f0065-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>try</strong></span>:
                    int(<span class="mblue">'N/A'</span>)               <span class="hblue"># Raises ValueError</span>
                <span class="lgreen"><strong>except</strong></span> <span class="pgold">ValueError</span> as e:
                    print(<span class="mblue">'Failed:'</span>, e)
                
                print(e)     <span class="hblue"># Fails -&gt; NameError. 'e' not defined.</span></pre>
          <p class="indent">
            Multiple exception-handling blocks can be specified using multiple
            <code>except</code> clauses:
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0065-02" id="f0065-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>try</strong></span>:
                    do something
                <span class="lgreen"><strong>except</strong></span> <span class="pgold">TypeError</span> as e:
                    <span class="hblue"># Handle Type error</span>
                    ...
                <span class="lgreen"><strong>except</strong></span> <span class="pgold">ValueError</span> as e:
                    <span class="hblue"># Handle Value error</span>
                    ...</pre>
          <p class="indent">
            A single handler clause can catch multiple exception types like
            this:
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0065-03" id="f0065-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>try</strong></span>:
                    do something
                <span class="lgreen"><strong>except</strong></span> (<span class="pgold">TypeError</span>, <span class="pgold">ValueError</span>) as e:
                    <span class="hblue"># Handle Type or Value errors</span>
                    ...</pre>
          <p class="indent">
            To ignore an exception, use the <code>pass</code> statement as
            follows:
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0065-04" id="f0065-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>try</strong></span>:
                    do something
                <span class="lgreen"><strong>except</strong></span> <span class="pgold">ValueError</span>:
                    <span class="lgreen"><strong>pass</strong></span>              <span class="hblue"># Do nothing (shrug).</span></pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_66"></span>Silently ignoring
            errors is often dangerous and a source of hard-to-find mistakes.
            Even if ignored, it is often wise to optionally report the error in
            a log or some other place where you can inspect it later.
          </p>
          <p class="indent">
            To catch all exceptions except those related to program exit, use
            <code>Exception</code> like this:
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0066-01" id="f0066-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>try</strong></span>:
                    do something
                <span class="lgreen"><strong>except</strong></span> <span class="pgold">Exception</span> as e:
                    print(<span class="trose">f'An error occurred :</span> <span class="mblue">{e!r}</span><span class="trose">'</span>)</pre>
          <p class="indent">
            When catching all exceptions, you should take great care to report
            accurate error information to the user. For example, in the previous
            code, an error message and the associated exception value are being
            printed. If you don’t include any information about the exception
            value, it can make it very difficult to debug code that is failing
            for reasons you don’t expect.
          </p>
          <p class="indent">
            The <code>try</code> statement also supports an
            <code>else</code> clause, which must follow the last
            <code>except</code> clause. This code is executed if the code in the
            <code>try</code> block doesn’t raise an exception. Here’s an
            example:
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0066-02" id="f0066-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>try</strong></span>:
                    file <span class="igrey">=</span> open(<span class="mblue">'foo.txt'</span>, <span class="mblue">'rt'</span>)
                <span class="lgreen"><strong>except</strong></span> <span class="pgold">FileNotFoundError</span> as e:
                    print(<span class="trose">f'Unable to open foo :</span> <span class="mblue">{e}</span><span class="trose">'</span>)
                    data <span class="igrey">=</span> <span class="mblue">''</span>
                <span class="lgreen"><strong>else</strong></span>:
                    data <span class="igrey">=</span> file.read()
                    file.close()</pre>
          <p class="indent">
            The <code>finally</code> statement defines a cleanup action that
            must execute regardless of what happens in a
            <code>try-except</code> block. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0066-03" id="f0066-03"
              >Click here to view code image</a
            >
          </p>
          <pre>file <span class="igrey">=</span> open(<span class="mblue">'foo.txt'</span>, <span class="mblue">'rt'</span>)
                <span class="lgreen"><strong>try</strong></span>:
                    <span class="hblue"># Do some stuff</span>
                    ...
                <span class="lgreen"><strong>finally</strong></span>:
                    file.close()
                    <span class="hblue"># File closed regardless of what happened</span></pre>
          <p class="indent">
            The <code>finally</code> clause isn’t used to catch errors. Rather,
            it’s used for code that must always be executed, regardless of
            whether an error occurs. If no exception is raised, the code in the
            <code>finally</code> clause is executed immediately after the code
            in the <code>try</code> block. If an exception occurs, a matching
            <code>except</code> block (if any) is executed first and then
            control is passed to the first statement of the
            <code>finally</code> clause. If, after this code has executed, an
            exception is still pending, that exception is reraised to be caught
            by another exception handler.
          </p>
          <section>
            <h4 class="h4" id="ch03lev2sec1">
              <span epub:type="pagebreak" id="page_67"></span>3.4.1 The
              Exception Hierarchy
            </h4>
            <p class="noindent">
              One challenge of working with exceptions is managing the vast
              number of exceptions that might potentially occur in your program.
              For example, there are more than 60 built-in exceptions alone.
              Factor in the rest of the standard library and it turns into
              hundreds of possible exceptions. Moreover, there is often no way
              to easily determine in advance what kind of exceptions any portion
              of code might raise. Exceptions aren’t recorded as part of a
              function’s calling signature nor is there any sort of compiler to
              verify correct exception handling in your code. As a result,
              exception handling can sometimes feel haphazard and disorganized.
            </p>
            <p class="indent">
              It helps to realize that exceptions are organized into a hierarchy
              via inheritance. Instead of targeting specific errors, it might be
              easier to focus on more general categories of errors. For example,
              consider the different errors that might arise when looking values
              up in a container:
            </p>
            <p class="codelink">
              <a href="ch03_images.xhtml#rf0067-01" id="f0067-01"
                >Click here to view code image</a
              >
            </p>
            <pre><span class="lgreen"><strong>try</strong></span>:
                    item <span class="igrey">=</span> items[index]
                <span class="lgreen"><strong>except</strong></span> <span class="pgold">IndexError</span>:      <span class="hblue"># Raised if items is a sequence</span>
                    ...
                <span class="lgreen"><strong>except</strong></span> <span class="pgold">KeyError</span>:        <span class="hblue"># Raised if items is a mapping</span>
                    ...</pre>
            <p class="indent">
              Instead of writing code to handle two highly specific exceptions,
              it might be easier to do this:
            </p>
            <p class="codelink">
              <a href="ch03_images.xhtml#rf0067-02" id="f0067-02"
                >Click here to view code image</a
              >
            </p>
            <pre><span class="lgreen"><strong>try</strong></span>:
                    item <span class="igrey">=</span> items[index]
                <span class="lgreen"><strong>except</strong></span> <span class="pgold">LookupError</span>:
                    ...</pre>
            <p class="indent">
              <code>LookupError</code> is a class that represents a higher-level
              grouping of exceptions. <code>IndexError</code> and
              <code>KeyError</code> both inherit from <code>LookupError</code>,
              so this <code>except</code> clause would catch either one. Yet,
              <code>LookupError</code> isn’t so broad as to include errors
              unrelated to the lookup.
            </p>
            <p class="indent">
              <a href="ch03.xhtml#ch03tab01">Table 3.1</a> describes the most
              common categories of built-in exceptions.
            </p>
            <figure class="table" id="ch03tab01">
              <figcaption>
                <p class="tab-caption">
                  <span class="ash">Table 3.1</span> Exception Categories
                </p>
              </figcaption>
              <table>
                <thead>
                  <tr>
                    <th><p class="tabtext">Exception Class</p></th>
                    <th><p class="tabtext">Description</p></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <p class="tabtext"><code>BaseException</code></p>
                    </td>
                    <td>
                      <p class="tabtext">The root class for all exceptions</p>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <p class="tabtext"><code>Exception</code></p>
                    </td>
                    <td>
                      <p class="tabtext">
                        Base class for all program-related errors
                      </p>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <p class="tabtext"><code>ArithmeticError</code></p>
                    </td>
                    <td>
                      <p class="tabtext">
                        Base class for all math-related errors
                      </p>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <p class="tabtext"><code>ImportError</code></p>
                    </td>
                    <td>
                      <p class="tabtext">
                        Base class for <code>import</code>-related errors
                      </p>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <p class="tabtext"><code>LookupError</code></p>
                    </td>
                    <td>
                      <p class="tabtext">
                        Base class for all container lookup errors
                      </p>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <p class="tabtext"><code>OSError</code></p>
                    </td>
                    <td>
                      <p class="tabtext">
                        Base class for all system-related errors.
                        <code>IOError</code> and
                        <code>EnvironmentError</code> are aliases.
                      </p>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <p class="tabtext"><code>ValueError</code></p>
                    </td>
                    <td>
                      <p class="tabtext">
                        Base class for value-related errors, including Unicode
                      </p>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <p class="tabtext"><code>UnicodeError</code></p>
                    </td>
                    <td>
                      <p class="tabtext">
                        Base class for a Unicode string encoding-related errors
                      </p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </figure>
            <p class="indent">
              The <code>BaseException</code> class is rarely used directly in
              exception handling because it matches all possible exceptions
              whatsoever. This includes special exceptions that affect the
              control flow such as <code>SystemExit</code>,
              <code>KeyboardInterrupt</code>, and <code>StopIteration</code>.
              Catching these is rarely what you want. Instead, all normal
              program-related errors inherit from <code>Exception</code>.
              <code>ArithmeticError</code> is the base for all math-related
              errors such as <code>ZeroDivisionError</code>,
              <code>FloatingPointError</code>, and <code>OverflowError</code>.
              <code>ImportError</code> is a base for all import-related errors.
              <code>LookupError</code> is a base for all container
              lookup-related errors. <code>OSError</code> is a base for all
              errors originating from the operating system and environment.
              <code>OSError</code> encompasses a wide range of exceptions
              related to files, network connections, permissions, pipes,
              timeouts, and more. The <code>ValueError</code> exception is
              commonly raised when a bad input value is given to an operation.
              <code>UnicodeError</code> is a subclass of
              <code>ValueError</code> grouping all Unicode-related encoding and
              decoding errors.<span epub:type="pagebreak" id="page_68"></span>
            </p>
            <p class="indent">
              <a href="ch03.xhtml#ch03tab02">Table 3.2</a> shows some common
              built-in exceptions that inherit directly from
              <code>Exception</code> but aren’t part of a larger exception
              group.
            </p>
            <figure class="table" id="ch03tab02">
              <figcaption>
                <p class="tab-caption">
                  <span class="ash">Table 3.2</span> Other Built-in Exceptions
                </p>
              </figcaption>
              <table>
                <thead>
                  <tr>
                    <th><p class="tabtext">Exception Class</p></th>
                    <th><p class="tabtext">Description</p></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <p class="tabtext"><code>AssertionError</code></p>
                    </td>
                    <td>
                      <p class="tabtext">
                        Failed <code>assert</code> statement
                      </p>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <p class="tabtext"><code>AttributeError</code></p>
                    </td>
                    <td>
                      <p class="tabtext">Bad attribute lookup on an object</p>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <p class="tabtext"><code>EOFError</code></p>
                    </td>
                    <td><p class="tabtext">End of file</p></td>
                  </tr>
                  <tr>
                    <td>
                      <p class="tabtext"><code>MemoryError</code></p>
                    </td>
                    <td>
                      <p class="tabtext">Recoverable out-of-memory error</p>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <p class="tabtext"><code>NameError</code></p>
                    </td>
                    <td>
                      <p class="tabtext">
                        Name not found in the local or global namespace
                      </p>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <p class="tabtext"><code>NotImplementedError</code></p>
                    </td>
                    <td><p class="tabtext">Unimplemented feature</p></td>
                  </tr>
                  <tr>
                    <td>
                      <p class="tabtext"><code>RuntimeError</code></p>
                    </td>
                    <td>
                      <p class="tabtext">
                        A generic “something bad happened” error
                      </p>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <p class="tabtext"><code>TypeError</code></p>
                    </td>
                    <td>
                      <p class="tabtext">
                        Operation applied to an object of the wrong type
                      </p>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <p class="tabtext"><code>UnboundLocalError</code></p>
                    </td>
                    <td>
                      <p class="tabtext">
                        Usage of a local variable before a value is assigned
                      </p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </figure>
          </section>
          <section>
            <h4 class="h4" id="ch03lev2sec2">
              3.4.2 Exceptions and Control Flow
            </h4>
            <p class="noindent">
              Normally, exceptions are reserved for the handling of errors.
              However, a few exceptions are used to alter the control flow.
              These exceptions, shown in
              <a href="ch03.xhtml#ch03tab03">Table 3.3</a>, inherit from
              <code>BaseException</code> directly.
            </p>
            <figure class="table" id="ch03tab03">
              <figcaption>
                <p class="tab-caption">
                  <span class="ash">Table 3.3</span> Exceptions Used for Control
                  Flow
                </p>
              </figcaption>
              <table>
                <thead>
                  <tr>
                    <th><p class="tabtext">Exception Class</p></th>
                    <th><p class="tabtext">Description</p></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <p class="tabtext"><code>SystemExit</code></p>
                    </td>
                    <td>
                      <p class="tabtext">Raised to indicate program exit</p>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <p class="tabtext"><code>KeyboardInterrupt</code></p>
                    </td>
                    <td>
                      <p class="tabtext">
                        Raised when a program is interrupted via Control-C
                      </p>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <p class="tabtext"><code>StopIteration</code></p>
                    </td>
                    <td>
                      <p class="tabtext">
                        Raised to signal the end of iteration
                      </p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </figure>
            <p class="indent">
              <span epub:type="pagebreak" id="page_69"></span>The
              <code>SystemExit</code> exception is used to make a program
              terminate on purpose. As an argument, you can either provide an
              integer exit code or a string message. If a string is given, it is
              printed to <code>sys.stderr</code> and the program is terminated
              with an exit code of 1.
            </p>
            <p class="codelink">
              <a href="ch03_images.xhtml#rf0069-01" id="f0069-01"
                >Click here to view code image</a
              >
            </p>
            <pre>import sys
                
                <span class="lgreen"><strong>if</strong></span> len(sys.argv) <span class="igrey">!=</span> <span class="sgreen">2</span>:
                    <span class="lgreen"><strong>raise</strong></span> <span class="pgold">SystemExit</span>(<span class="trose">f'Usage:</span> <span class="mblue">{</span>sys<span class="mblue">.</span>argv[<span class="sgreen">0</span>]<span class="mblue">}</span> <span class="trose">filename)</span>
                
                filename = sys.argv[1]</pre>
            <p class="indent">
              The <code>KeyboardInterrupt</code> exception is raised when the
              program receives a <code>SIGINT</code> signal (typically by
              pressing Control-C in a terminal). This exception is a bit unusual
              in that it is asynchronous—meaning that it could occur at almost
              any time and on any statement in your program. The default
              behavior of Python is to simply terminate when this happens. If
              you want to control the delivery of <code>SIGINT</code>, the
              <code>signal</code> library module can be used (see
              <a href="ch09.xhtml#ch09">chapter 9</a>).
            </p>
            <p class="indent">
              The <code>StopIteration</code> exception is part of the iteration
              protocol and signals the end of iteration.
            </p>
          </section>
          <section>
            <h4 class="h4" id="ch03lev2sec3">3.4.3 Defining New Exceptions</h4>
            <p class="noindent">
              All the built-in exceptions are defined in terms of classes. To
              create a new exception, create a new class definition that
              inherits from <code>Exception</code>, such as the following:
            </p>
            <p class="codelink">
              <a href="ch03_images.xhtml#rf0069-02" id="f0069-02"
                >Click here to view code image</a
              >
            </p>
            <pre><span class="lgreen"><strong>class</strong></span> NetworkError(<span class="pgold">Exception</span>):
                    <span class="lgreen"><strong>pass</strong></span></pre>
            <p class="indent">
              To use your new exception, use the <code>raise</code> statement as
              follows:
            </p>
            <p class="codelink">
              <a href="ch03_images.xhtml#rf0069-03" id="f0069-03"
                >Click here to view code image</a
              >
            </p>
            <pre><span class="lgreen"><strong>raise</strong></span> NetworkError(<span class="mblue">'Cannot find host'</span>)</pre>
            <p class="indent">
              When raising an exception, the optional values supplied with the
              <code>raise</code> statement are used as the arguments to the
              exception’s class constructor. Most of the time, this is a string
              containing some kind of error message. However, user-defined
              exceptions can be written to take one or more exception values, as
              shown in this example:
            </p>
            <p class="codelink">
              <a href="ch03_images.xhtml#rf0069-04" id="f0069-04"
                >Click here to view code image</a
              >
            </p>
            <pre><span class="lgreen"><strong>class</strong></span> DeviceError(<span class="pgold">Exception</span>):
                     <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, errno, msg):
                         <span class="dblue">self</span>.args <span class="igrey">=</span> (errno, msg)
                         <span class="dblue">self</span>.errno <span class="igrey">=</span> errno
                         <span class="dblue">self</span>.errmsg <span class="igrey">=</span> msg
                
                <span class="hblue"># Raises an exception (multiple arguments)</span>
                <span class="lgreen"><strong>raise</strong></span> DeviceError(<span class="sgreen">1</span>, <span class="mblue">'Not Responding'</span>)</pre>
            <p class="indent">
              <span epub:type="pagebreak" id="page_70"></span>When you create a
              custom exception class that redefines <code>__init__()</code>, it
              is important to assign a tuple containing the arguments of
              <code>__init__()</code> to the attribute <code>self.args</code> as
              shown. This attribute is used when printing exception traceback
              messages. If you leave it undefined, users won’t be able to see
              any useful information about the exception when an error occurs.
            </p>
            <p class="indent">
              Exceptions can be organized into a hierarchy using inheritance.
              For instance, the <code>NetworkError</code> exception defined
              earlier could serve as a base class for a variety of more specific
              errors. Here’s an example:
            </p>
            <p class="codelink">
              <a href="ch03_images.xhtml#rf0070-01" id="f0070-01"
                >Click here to view code image</a
              >
            </p>
            <pre><span class="lgreen"><strong>class</strong></span> HostnameError(NetworkError):
                    <span class="lgreen"><strong>pass</strong></span>
                
                <span class="lgreen"><strong>class</strong></span> <span class="pgold">TimeoutError</span>(NetworkError):
                    <span class="lgreen"><strong>pass</strong></span>
                
                <span class="lgreen"><strong>def</strong></span> error1():
                    <span class="lgreen"><strong>raise</strong></span> HostnameError(<span class="mblue">'Unknown host'</span>)
                
                <span class="lgreen"><strong>def</strong></span> error2():
                    <span class="lgreen"><strong>raise</strong></span> <span class="pgold">TimeoutError</span>(<span class="mblue">'Timed out'</span>)
                
                <span class="lgreen"><strong>try</strong></span>:
                    error1()
                <span class="lgreen"><strong>except</strong></span> NetworkError as e:
                    <span class="lgreen"><strong>if</strong></span> type(e) <span class="lgreen"><strong>is</strong></span> HostnameError:
                        <span class="hblue"># Perform special actions for this kind of error</span>
                        ...</pre>
            <p class="indent">
              In this case, the <code>except NetworkError</code> clause catches
              any exception derived from <code>NetworkError</code>. To find the
              specific type of error that was raised, examine the type of the
              execution value with <code>type()</code>.
            </p>
          </section>
          <section>
            <h4 class="h4" id="ch03lev2sec4">3.4.4 Chained Exceptions</h4>
            <p class="noindent">
              Sometimes, in response to an exception, you might want to raise a
              different exception. To do this, raise a chained exception:
            </p>
            <p class="codelink">
              <a href="ch03_images.xhtml#rf0070-02" id="f0070-02"
                >Click here to view code image</a
              >
            </p>
            <pre><span class="lgreen"><strong>class</strong></span> ApplicationError(<span class="pgold">Exception</span>):
                    <span class="lgreen"><strong>pass</strong></span>
                
                <span class="lgreen"><strong>def</strong></span> do_something():
                    x <span class="igrey">=</span> int(<span class="mblue">'N/A'</span>)    <span class="hblue"># raises ValueError</span>
                
                <span class="lgreen"><strong>def</strong></span> spam():
                    <span class="lgreen"><strong>try</strong></span>:
                        do_something()
                <span epub:type="pagebreak" id="page_71"></span>    <span class="lgreen"><strong>except</strong></span> <span class="pgold">Exception</span> as e:
                        <span class="lgreen"><strong>raise</strong></span> ApplicationError(<span class="mblue">'It failed'</span>) from e</pre>
            <p class="indent">
              If an uncaught <code>ApplicationError</code> occurs, you will get
              a message that includes both exceptions. For example:
            </p>
            <p class="codelink">
              <a href="ch03_images.xhtml#rf0071-02" id="f0071-02"
                >Click here to view code image</a
              >
            </p>
            <pre>
&gt;&gt;&gt; spam()
                Traceback (most recent call last):
                  File "c.py", line 9, in spam
                    do_something()
                  File "c.py", line 5, in do_something
                    x = int('N/A')
                ValueError: invalid literal for int() with base 10: 'N/A'
                
                The above exception was the direct cause of the following exception:
                
                Traceback (most recent call last):
                  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
                  File "c.py", line 11, in spam
                    raise ApplicationError('It failed') from e
                __main__.ApplicationError: It failed
                &gt;&gt;&gt;</pre
            >
            <p class="indent">
              If you catch an <code>ApplicationError</code>, the
              <code>__cause__</code> attribute of the resulting exception will
              contain the other exception. For example:
            </p>
            <p class="codelink">
              <a href="ch03_images.xhtml#rf0071-03" id="f0071-03"
                >Click here to view code image</a
              >
            </p>
            <pre><span class="lgreen"><strong>try</strong></span>:
                    spam()
                <span class="lgreen"><strong>except</strong></span> ApplicationError as e:
                    print(<span class="mblue">'It failed. Reason:'</span>, e.__cause__)</pre>
            <p class="indent">
              If you want to raise a new exception without including the chain
              of other exceptions, raise an error from <code>None</code> like
              this:
            </p>
            <p class="codelink">
              <a href="ch03_images.xhtml#rf0071-04" id="f0071-04"
                >Click here to view code image</a
              >
            </p>
            <pre><span class="lgreen"><strong>def</strong></span> spam():
                    <span class="lgreen"><strong>try</strong></span>:
                        do_something()
                    <span class="lgreen"><strong>except</strong></span> <span class="pgold">Exception</span> as e:
                        <span class="lgreen"><strong>raise</strong></span> ApplicationError(<span class="mblue">'It failed'</span>) from <span class="dblue">None</span></pre>
            <p class="indent">
              A programming mistake that appears in an <code>except</code> block
              will also result in a chained exception, but that works in a
              slightly different way. For example, suppose you have some buggy
              code like this:
            </p>
            <p class="codelink">
              <a href="ch03_images.xhtml#rf0071-05" id="f0071-05"
                >Click here to view code image</a
              >
            </p>
            <pre><span class="lgreen"><strong>def</strong></span> spam():
                    <span class="lgreen"><strong>try</strong></span>:
                        do_something()
                <span epub:type="pagebreak" id="page_72"></span>    <span class="lgreen"><strong>except</strong></span> <span class="pgold">Exception</span> as e:
                        print(<span class="mblue">'It failed:'</span>, err)      <span class="hblue"># err undefined (typo)</span></pre>
            <p class="indent">
              The resulting exception traceback message is slightly different:
            </p>
            <p class="codelink">
              <a href="ch03_images.xhtml#rf0072-02" id="f0072-02"
                >Click here to view code image</a
              >
            </p>
            <pre>
&gt;&gt;&gt; spam()
                Traceback (most recent call last):
                  File "d.py", line 9, in spam
                    do_something()
                  File "d.py", line 5, in do_something
                    x = int('N/A')
                ValueError: invalid literal for int() with base 10: 'N/A'
                
                During handling of the above exception, another exception occurred:
                
                Traceback (most recent call last):
                  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
                  File "d.py", line 11, in spam
                    print('It failed. Reason:', err)
                NameError: name 'err' is not defined
                &gt;&gt;&gt;</pre
            >
            <p class="indent">
              If an unexpected exception is raised while handling another
              exception, the <code>__context__</code> attribute (instead of
              <code>__cause__</code>) holds information about the exception that
              was being handled when the error occurred. For example:
            </p>
            <p class="codelink">
              <a href="ch03_images.xhtml#rf0072-03" id="f0072-03"
                >Click here to view code image</a
              >
            </p>
            <pre><span class="lgreen"><strong>try</strong></span>:
                    spam()
                <span class="lgreen"><strong>except</strong></span> <span class="pgold">Exception</span> as e:
                    print(<span class="mblue">'It failed. Reason:'</span>, e)
                    <span class="lgreen"><strong>if</strong></span> e.__context__:
                        print(<span class="mblue">'While handling:'</span>, e.__context__)</pre>
            <p class="indent">
              There is an important distinction between expected and unexpected
              exceptions in exception chains. In the first example, the code was
              written so that the possibility of an exception was anticipated.
              For example, code was explicitly wrapped in a
              <code>try-except</code> block:
            </p>
            <p class="codelink">
              <a href="ch03_images.xhtml#rf0072-04" id="f0072-04"
                >Click here to view code image</a
              >
            </p>
            <pre><span class="lgreen"><strong>try</strong></span>:
                    do_something()
                <span class="lgreen"><strong>except</strong></span> <span class="pgold">Exception</span> as e:
                    <span class="lgreen"><strong>raise</strong></span> ApplicationError(<span class="mblue">'It failed'</span>) from e</pre>
            <p class="indent">
              In the second case, there was a programming mistake in the
              <code>except</code> block:
            </p>
            <p class="codelink">
              <a href="ch03_images.xhtml#rf0072-05" id="f0072-05"
                >Click here to view code image</a
              >
            </p>
            <pre><span class="lgreen"><strong>try</strong></span>:
                    do_something()
                <span epub:type="pagebreak" id="page_73"></span><span class="lgreen"><strong>except</strong></span> <span class="pgold">Exception</span> as e:
                    print(<span class="mblue">'It failed:'</span>, err)     <span class="hblue"># err undefined</span></pre>
            <p class="indent">
              The difference between these two cases is subtle but important.
              That is why exception chaining information is placed into either
              the <code>__cause__</code> or the
              <code>__context__</code> attribute. The
              <code>__cause__</code> attribute is reserved for when you’re
              expecting the possibility of a failure. The
              <code>__context__</code> attribute is set in both cases, but would
              be the only source of information for an unexpected exception
              raised while handling another exception.
            </p>
          </section>
          <section>
            <h4 class="h4" id="ch03lev2sec5">3.4.5 Exception Tracebacks</h4>
            <p class="noindent">
              Exceptions have an associated stack traceback that provides
              information about where an error occurred. The traceback is stored
              in the <code>__traceback__</code> attribute of an exception. For
              the purposes of reporting or debugging, you might want to produce
              the traceback message yourself. The <code>traceback</code> module
              can be used to do this. For example:
            </p>
            <p class="codelink">
              <a href="ch03_images.xhtml#rf0073-02" id="f0073-02"
                >Click here to view code image</a
              >
            </p>
            <pre>import traceback
                
                <span class="lgreen"><strong>try</strong></span>:
                    spam()
                <span class="lgreen"><strong>except</strong></span> <span class="pgold">Exception</span> as e:
                    tblines <span class="igrey">=</span> traceback.format_exception(type(e), e, e.__traceback__)
                    tbmsg <span class="igrey">=</span> <span class="mblue">''</span>.join(tblines)
                    print(<span class="mblue">'It failed:'</span>)
                    print(tbmsg)</pre>
            <p class="indent">
              In this code, <code>format_exception()</code> produces a list of
              strings containing the output Python would normally produce in a
              traceback message. As input, you provide the exception type,
              value, and traceback.
            </p>
          </section>
          <section>
            <h4 class="h4" id="ch03lev2sec6">
              3.4.6 Exception Handling Advice
            </h4>
            <p class="noindent">
              Exception handling is one of the most difficult things to get
              right in larger programs. However, there are a few rules of thumb
              that make it easier.
            </p>
            <p class="indent">
              The first rule is to not catch exceptions that can’t be handled at
              that specific location in the code. Consider a function like this:
            </p>
            <p class="codelink">
              <a href="ch03_images.xhtml#rf0073-03" id="f0073-03"
                >Click here to view code image</a
              >
            </p>
            <pre><span class="lgreen"><strong>def</strong></span> read_data(filename):
                    <span class="lgreen"><strong>with</strong></span> open(filename, <span class="mblue">'rt'</span>) as file:
                         rows <span class="igrey">=</span> []
                         <span class="lgreen"><strong>for</strong></span> line <span class="lgreen"><strong>in</strong></span> file:
                             row <span class="igrey">=</span> line.split()
                             rows.append((row[<span class="sgreen">0</span>], int(row[<span class="sgreen">1</span>]), float(row[<span class="sgreen">2</span>]))
                    <span class="lgreen"><strong>return</strong></span> rows</pre>
            <p class="indent">
              Suppose the <code>open()</code> function fails due to a bad
              filename. Is this an error that should be caught with a
              <code>try-except</code> statement in this function? Probably not.
              If the caller gives a bad
              <span epub:type="pagebreak" id="page_74"></span>filename, there is
              no sensible way to recover. There is no file to open, no data to
              read, and nothing else that’s possible. It’s better to let the
              operation fail and report an exception back to the caller.
              Avoiding an error check in <code>read_data()</code> doesn’t mean
              that the exception would never be handled anywhere—it just means
              that it’s not the role of <code>read_data()</code> to do it.
              Perhaps the code that prompted a user for a filename would handle
              this exception.
            </p>
            <p class="indent">
              This advice might seem contrary to the experience of programmers
              accustomed to languages that rely upon special error codes or
              wrapped result types. In those languages, great care is made to
              make sure you always check return codes for errors on all
              operations. You don’t do this in Python. If an operation can fail
              and there’s nothing you can do to recover, it’s better to just let
              it fail. The exception will propagate to upper levels of the
              program where it is usually the responsibility of some other code
              to handle it.
            </p>
            <p class="indent">
              On the other hand, a function might be able to recover from bad
              data. For example:
            </p>
            <p class="codelink">
              <a href="ch03_images.xhtml#rf0074-01" id="f0074-01"
                >Click here to view code image</a
              >
            </p>
            <pre><span class="lgreen"><strong>def</strong></span> read_data(filename):
                    <span class="lgreen"><strong>with</strong></span> open(filename, <span class="mblue">'rt'</span>) as file:
                         rows <span class="igrey">=</span> []
                         <span class="lgreen"><strong>for</strong></span> line <span class="lgreen"><strong>in</strong></span> file:
                             row <span class="igrey">=</span> line.split()
                             <span class="lgreen"><strong>try</strong></span>:
                                 rows.append((row[<span class="sgreen">0</span>], int(row[<span class="sgreen">1</span>]), float(row[<span class="sgreen">2</span>]))
                             <span class="lgreen"><strong>except</strong></span> <span class="pgold">ValueError</span> as e:
                                 print(<span class="mblue">'Bad row:'</span>, row)
                                 print(<span class="mblue">'Reason:'</span>, e)
                    <span class="lgreen"><strong>return</strong></span> rows</pre>
            <p class="indent">
              When catching errors, try to make your <code>except</code> clauses
              as narrow as reasonable. The above code could have been written to
              catch all errors by using <code>except Exception</code>. However,
              doing that would make the code catch legitimate programming errors
              that probably shouldn’t be ignored. Don’t do that—it will make
              debugging difficult.
            </p>
            <p class="indent">
              Finally, if you’re explicitly raising an exception, consider
              making your own exception types. For example:
            </p>
            <p class="codelink">
              <a href="ch03_images.xhtml#rf0074-02" id="f0074-02"
                >Click here to view code image</a
              >
            </p>
            <pre><span class="lgreen"><strong>class</strong></span> ApplicationError(<span class="pgold">Exception</span>):
                    <span class="lgreen"><strong>pass</strong></span>
                
                <span class="lgreen"><strong>class</strong></span> UnauthorizedUserError(ApplicationError):
                    <span class="lgreen"><strong>pass</strong></span>
                
                <span class="lgreen"><strong>def</strong></span> spam():
                    ...
                    <span class="lgreen"><strong>raise</strong></span> UnauthorizedUserError(<span class="mblue">'Go away'</span>)
                    ...</pre>
            <p class="indent">
              One of the more challenging problems in large code bases is
              assigning blame for program failures. If you make your own
              exceptions, you’ll be better able to distinguish between
              intentionally raised errors and legitimate programming mistakes.
              If your program
              <span epub:type="pagebreak" id="page_75"></span>crashes with some
              kind of <code>ApplicationError</code> defined above, you’ll know
              immediately why that error got raised—because you wrote the code
              to do it. On the other hand, if the program crashes with one of
              Python’s built-in exceptions (such as <code>TypeError</code> or
              <code>ValueError</code>), that might indicate a more serious
              problem.
            </p>
          </section>
        </section>
        <section>
          <h3 class="h3" id="ch03lev1sec5">
            3.5 Context Managers and the <code>with</code> Statement
          </h3>
          <p class="noindent">
            Proper management of system resources such as files, locks, and
            connections is often a tricky problem when combined with exceptions.
            For example, a raised exception can cause control flow to bypass
            statements responsible for releasing critical resources, such as a
            lock.
          </p>
          <p class="indent">
            The <code>with</code> statement allows a series of statements to
            execute inside a runtime context that is controlled by an object
            serving as a context manager. Here is an example:
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0075-01" id="f0075-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>with</strong></span> open(<span class="mblue">'debuglog'</span>, <span class="mblue">'wt'</span>) as file:
                     file.write(<span class="mblue">'Debugging\n'</span>)
                     statements
                     file.write(<span class="mblue">'Done\n'</span>)
                
                import threading
                lock <span class="igrey">=</span> threading.Lock()
                <span class="lgreen"><strong>with</strong></span> lock:
                     <span class="hblue"># Critical section</span>
                     statements
                     <span class="hblue"># End critical section</span></pre>
          <p class="indent">
            In the first example, the <code>with</code> statement automatically
            causes the opened file to be closed when the control flow leaves the
            block of statements that follow. In the second example, the
            <code>with</code> statement automatically acquires and releases a
            lock when control enters and leaves the block of statements that
            follow.
          </p>
          <p class="indent">
            The <code>with obj</code> statement allows the object
            <code>obj</code> to manage what happens when the control flow enters
            and exits the associated block of statements that follow. When the
            <code>with obj</code> statement executes, it calls the method
            <code>obj.__enter__()</code> to signal that a new context is being
            entered. When control flow leaves the context, the method
            <code>obj.__exit__(type, value, traceback)</code> executes. If no
            exception has been raised, the three arguments to
            <code>__exit__()</code> are all set to <code>None</code>. Otherwise,
            they contain the type, value, and traceback associated with the
            exception that has caused the control flow to leave the context. If
            the <code>__exit__()</code> method returns <code>True</code>, it
            indicates that the raised exception was handled and should no longer
            be propagated. Returning <code>None</code> or
            <code>False</code> will cause the exception to propagate.
          </p>
          <p class="indent">
            The <code>with obj</code> statement accepts an optional
            <code>as var</code> specifier. If given, the value returned by
            <code>obj.__enter__()</code> is placed into <code>var</code>. This
            value is commonly the same as <code>obj</code> because this allows
            an object to be constructed and used as a context manager in the
            same step. For example, consider this class:<span
              epub:type="pagebreak"
              id="page_76"
            ></span>
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0076-01" id="f0076-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Manager:
                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, x):
                        <span class="dblue">self</span>.x <span class="igrey">=</span> x
                
                    <span class="lgreen"><strong>def</strong></span> yow(<span class="dblue">self</span>):
                        <span class="lgreen"><strong>pass</strong></span>
                
                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__enter__</span>(<span class="dblue">self</span>):
                        <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>
                
                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__exit__</span>(<span class="dblue">self</span>, ty, val, tb):
                        <span class="lgreen"><strong>pass</strong></span></pre>
          <p class="indent">
            With it, you can create and use an instance as a context manager in
            a single step:
          </p>
          <pre><span class="lgreen"><strong>with</strong></span> Manager(<span class="sgreen">42</span>) as m:
                    m.yow()</pre>
          <p class="indent">
            Here is a more interesting example involving list transactions:
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0076-03" id="f0076-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> ListTransaction:
                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>,thelist):
                        <span class="dblue">self</span>.thelist <span class="igrey">=</span> thelist
                
                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__enter__</span>(<span class="dblue">self</span>):
                        <span class="dblue">self</span>.workingcopy <span class="igrey">=</span> list(<span class="dblue">self</span>.thelist)
                        <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>.workingcopy
                
                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__exit__</span>(<span class="dblue">self</span>,type,value,tb):
                        <span class="lgreen"><strong>if</strong></span> type <span class="lgreen"><strong>is</strong></span> <span class="dblue">None</span>:
                            <span class="dblue">self</span>.thelist[:] <span class="igrey">=</span> <span class="dblue">self</span>.workingcopy
                        <span class="lgreen"><strong>return</strong></span> <span class="dblue">False</span></pre>
          <p class="indent">
            This class allows you to make a sequence of modifications to an
            existing list. However, the modifications only take effect if no
            exceptions occur. Otherwise, the original list is left unmodified.
            For example:
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0076-04" id="f0076-04"
              >Click here to view code image</a
            >
          </p>
          <pre>items <span class="igrey">=</span> [<span class="sgreen">1</span>,<span class="sgreen">2</span>,<span class="sgreen">3</span>]
                
                <span class="lgreen"><strong>with</strong></span> ListTransaction(items) as working:
                    working.append(<span class="sgreen">4</span>)
                    working.append(<span class="sgreen">5</span>)
                print(items)       <span class="hblue"># Produces [1,2,3,4,5]</span>
                
                <span class="lgreen"><strong>try</strong></span>:
                    <span class="lgreen"><strong>with</strong></span> ListTransaction(items) as working:
                        working.append(<span class="sgreen">6</span>)
                <span epub:type="pagebreak" id="page_77"></span>        working.append(<span class="sgreen">7</span>)
                        <span class="lgreen"><strong>raise</strong></span> <span class="pgold">RuntimeError</span>(<span class="mblue">"We're hosed!"</span>)
                <span class="lgreen"><strong>except</strong></span> <span class="pgold">RuntimeError</span>:
                    <span class="lgreen"><strong>pass</strong></span>
                
                print(items)   <span class="hblue"># Produces [1,2,3,4,5]</span></pre>
          <p class="indent">
            The <code>contextlib</code> standard library module contains
            functionality related to more advanced uses of context managers. If
            you find yourself regularly creating context managers, it might be
            worth a look.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch03lev1sec6">
            3.6 Assertions and <code>__debug__</code>
          </h3>
          <p class="noindent">
            The <code>assert</code> statement can introduce debugging code into
            a program. The general form of <code>assert</code> is
          </p>
          <pre><span class="lgreen"><strong>assert</strong></span> test [, msg]</pre>
          <p class="indent">
            where <code>test</code> is an expression that should evaluate to
            <code>True</code> or <code>False</code>. If
            <code>test</code> evaluates to <code>False</code>,
            <code>assert</code> raises an <code>AssertionError</code> exception
            with the optional message <code>msg</code> supplied to the
            <code>assert</code> statement. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0077-03" id="f0077-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> write_data(file, data):
                    <span class="lgreen"><strong>assert</strong></span> file, <span class="mblue">'write_data: file not defined!'</span>
                    ...</pre>
          <p class="indent">
            The <code>assert</code> statement should not be used for code that
            must be executed to make the program correct, because it won’t be
            executed if Python is run in optimized mode (specified with the
            <code>-O</code> option to the interpreter). In particular, it’s an
            error to use <code>assert</code> to check user input or the success
            of some important operation. Instead, <code>assert</code> statements
            are used to check invariants that should always be true; if one is
            violated, it represents a bug in the program, not an error by the
            user.
          </p>
          <p class="indent">
            For example, if the function <code>write_data()</code>, shown
            previously, were intended for use by an end user, the
            <code>assert</code> statement should be replaced by a conventional
            <code>if</code> statement and the desired error handling.
          </p>
          <p class="indent">
            A common use of <code>assert</code> is in testing. For example, you
            might use it to include a minimal test of a function:
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0077-04" id="f0077-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> factorial(n):
                    result <span class="igrey">=</span> <span class="sgreen">1</span>
                    <span class="lgreen"><strong>while</strong></span> n <span class="igrey">&gt;</span> <span class="sgreen">1</span>:
                        result <span class="igrey">*=</span> n
                        n <span class="igrey">-=</span> <span class="sgreen">1</span>
                    <span class="lgreen"><strong>return</strong></span> result
                
                <span class="lgreen"><strong>assert</strong></span> factorial(<span class="sgreen">5</span>) <span class="igrey">==</span> <span class="sgreen">120</span></pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_78"></span>The purpose of such
            a test is not to be exhaustive, but to serve as a kind of “smoke
            test.” If something obvious is broken in the function, the code will
            crash immediately with a failed assertion upon import.
          </p>
          <p class="indent">
            Assertions can also be useful in specifying a kind of programming
            contract on expected inputs and outputs. For example:
          </p>
          <p class="codelink">
            <a href="ch03_images.xhtml#rf0078-01" id="f0078-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> factorial(n):
                    <span class="lgreen"><strong>assert</strong></span> n <span class="igrey">&gt;</span> <span class="sgreen">0</span>, <span class="mblue">"must supply a positive value"</span>
                    result <span class="igrey">=</span> <span class="sgreen">1</span>
                    <span class="lgreen"><strong>while</strong></span> n <span class="igrey">&gt;</span> <span class="sgreen">1</span>:
                        result <span class="igrey">*=</span> n
                        n <span class="igrey">-=</span> <span class="sgreen">1</span>
                    <span class="lgreen"><strong>return</strong></span> result</pre>
          <p class="indent">
            Again, this is not meant to check for user input. It’s more of a
            check for internal program consistency. If some other code tries to
            compute negative factorials, the assertion will fail and point at
            the offending code so that you could debug it.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch03lev1sec7">3.7 Final Words</h3>
          <p class="noindent">
            Although Python supports a variety of different programming styles
            involving functions and objects, the fundamental model of program
            execution is that of imperative programming. That is, programs are
            made up of statements that execute one after the other in the order
            they appear within a source file. There are only three basic control
            flow constructs: the <code>if</code> statement, the
            <code>while</code> loop, and the <code>for</code> loop. There are
            few mysteries when it comes to understanding how Python executes
            your program.
          </p>
          <p class="indent">
            By far the most complicated and potentially error-prone feature is
            the exceptions. In fact, much of this chapter focused on how to
            properly think about exception handling. Even if you follow this
            advice, exceptions remain a delicate part of designing libraries,
            frameworks, and APIs. Exceptions can also play havoc with proper
            management of resources—this is a problem addressed via the use of
            context managers and the <code>with</code> statement.
          </p>
          <p class="indent">
            Not covered in this chapter are the techniques that can be used to
            customize almost every Python language feature—including the
            built-in operators and even aspects of the control flow described in
            this chapter. Although Python programs often appear superficially
            simple in structure, a surprising amount of magic can often be at
            work behind the scenes. Much of this is described in the next
            chapter.
          </p>
        </section>
      </section>
    </div>
    <div id="sbo-rt-content">
      <section epub:type="chapter">
        <h2 class="h2" id="ch04">
          <span epub:type="pagebreak" id="page_79"></span
          ><span class="ash">4.</span> Objects, Types, and Protocols
        </h2>
        <p class="noindent">
          Python programs manipulate objects of various types. There are a
          variety of built-in types such as numbers, strings, lists, sets, and
          dictionaries. In addition, you can make your own types using classes.
          This chapter describes the underlying Python object model and
          mechanisms that make all objects work. Particular attention is given
          to the “protocols” that define the core behavior of various objects.
        </p>
        <section>
          <h3 class="h3" id="ch04lev1sec1">4.1 Essential Concepts</h3>
          <p class="noindent">
            Every piece of data stored in a program is an object. Each object
            has an identity, a type (also known as its class), and a value. For
            example, when you write <code>a = 42</code>, an integer object is
            created with the value of 42. The identity of the object is a number
            representing its location in memory; <code>a</code> is a label that
            refers to this specific location although the label is not part of
            the object itself.
          </p>
          <p class="indent">
            The type of an object, also known as the object’s class, defines the
            object’s internal data representation as well as supported methods.
            When an object of a particular type is created, that object is
            called an <em>instance</em> of that type. After an instance is
            created, its identity does not change. If an object’s value can be
            modified, the object is said to be mutable. If the value cannot be
            modified, the object is said to be immutable. An object that holds
            references to other objects is said to be a container.
          </p>
          <p class="indent">
            Objects are characterized by their attributes. An attribute is a
            value associated with an object that is accessed using the dot
            operator (<code>.</code>). An attribute might be a simple data value
            such as a number. However, an attribute could also be a function
            that is invoked to carry out some operation. Such functions are
            called methods. The following example illustrates access to
            attributes:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0079-01" id="f0079-01"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> <span class="sgreen">34</span>                <span class="hblue"># Create an integer</span>
                    n <span class="igrey">=</span> a.numerator       <span class="hblue"># Get the numerator (an attribute)</span>
                    
                    b <span class="igrey">=</span> [<span class="sgreen">1</span>, <span class="sgreen">2</span>, <span class="sgreen">3</span>]         <span class="hblue"># Create a list</span>
                    b.append(<span class="sgreen">7</span>)           <span class="hblue"># Add a new element using the append method</span></pre>
          <p class="indent">
            Objects may also implement various operators, such as the
            <code>+</code> operator. For example:<span
              epub:type="pagebreak"
              id="page_80"
            ></span>
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0080-01" id="f0080-01"
              >Click here to view code image</a
            >
          </p>
          <pre>c <span class="igrey">=</span> a <span class="igrey">+</span> <span class="sgreen">10</span>            <span class="hblue"># c = 13 + 4j</span>
                    d <span class="igrey">=</span> b <span class="igrey">+</span> [<span class="sgreen">4</span>, <span class="sgreen">5</span>]        <span class="hblue"># d = [1, 2, 3, 4, 5]</span></pre>
          <p class="indent">
            Although operators use a different syntax, they are ultimately
            mapped to methods. For example, writing <code>a + 10</code> executes
            a method <code>a.__add__(10)</code>.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch04lev1sec2">4.2 Object Identity and Type</h3>
          <p class="noindent">
            The built-in function <code>id()</code> returns the identity of an
            object. The identity is an integer that usually corresponds to the
            object’s location in memory. The <code>is</code> and
            <code>is not</code> operators compare the identities of two objects.
            <code>type()</code> returns the type of an object. Here’s an example
            of different ways you might compare two objects:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0080-02" id="f0080-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># Compare two objects</span>
                    <span class="lgreen"><strong>def</strong></span> compare(a, b):
                        <span class="lgreen"><strong>if</strong></span> a <span class="lgreen"><strong>is</strong></span> b:
                            print(<span class="mblue">'same object'</span>)
                        <span class="lgreen"><strong>if</strong></span> a <span class="igrey">==</span> b:
                            print(<span class="mblue">'same value'</span>)
                        <span class="lgreen"><strong>if</strong></span> type(a) <span class="lgreen"><strong>is</strong></span> type(b):
                            print(<span class="mblue">'same type'</span>)</pre>
          <p class="indent">Here is how this function works:</p>
          <pre>
&gt;&gt;&gt; a = [1, 2, 3]
                    &gt;&gt;&gt; b = [1, 2, 3]
                    &gt;&gt;&gt; compare(a, a)
                    same object
                    same value
                    same type
                    &gt;&gt;&gt; compare(a, b)
                    same value
                    same type
                    &gt;&gt;&gt; compare(a, [4,5,6])
                    same type
                    &gt;&gt;&gt;</pre
          >
          <p class="indent">
            The type of an object is itself an object, known as object’s class.
            This object is uniquely defined and is always the same for all
            instances of a given type. Classes usually have names
            (<code>list</code>, <code>int</code>, <code>dict</code>, and so on)
            that can be used to create instances, perform type checking, and
            provide type hints. For example:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0080-04" id="f0080-04"
              >Click here to view code image</a
            >
          </p>
          <pre>items <span class="igrey">=</span> list()
                    
                    <span class="lgreen"><strong>if</strong></span> isinstance(items, list):
                        items.append(item)
                    <span epub:type="pagebreak" id="page_81"></span><span class="lgreen"><strong>def</strong></span> removeall(items: list, item) <span class="igrey">-&gt;</span> list:
                        <span class="lgreen"><strong>return</strong></span> [i <span class="lgreen"><strong>for</strong></span> i <span class="lgreen"><strong>in</strong></span> items <span class="lgreen"><strong>if</strong></span> i <span class="igrey">!=</span> item]</pre>
          <p class="indent">
            A <em>subtype</em> is a type defined by inheritance. It carries all
            of the features of the original type plus additional and/or
            redefined methods. Inheritance is discussed in more detail in
            <a href="ch07.xhtml#ch07">Chapter 7</a>, but here is an example of
            defining a subtype of list with a new method added to it:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0081-02" id="f0081-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> mylist(list):
                        <span class="lgreen"><strong>def</strong></span> removeall(<span class="dblue">self</span>, val):
                            <span class="lgreen"><strong>return</strong></span> [i <span class="lgreen"><strong>for</strong></span> i <span class="lgreen"><strong>in</strong></span> <span class="dblue">self</span> <span class="lgreen"><strong>if</strong></span> i <span class="igrey">!=</span> val]
                    
                    <span class="hblue"># Example</span>
                    items <span class="igrey">=</span> mylist([<span class="sgreen">5</span>, <span class="sgreen">8</span>, <span class="sgreen">2</span>, <span class="sgreen">7</span>, <span class="sgreen">2</span>, <span class="sgreen">13</span>, <span class="sgreen">9</span>])
                    x <span class="igrey">=</span> items.removeall(<span class="sgreen">2</span>)
                    print(x)      <span class="hblue"># [5, 8, 7, 13, 9]</span></pre>
          <p class="indent">
            The <code>isinstance(instance, type)</code> function is the
            preferred way to check a value against a type because it is aware of
            subtypes. It can also check against many possible types. For
            example:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0081-03" id="f0081-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>if</strong></span> isinstance(items, (list, tuple)):
                        maxval <span class="igrey">=</span> max(items)</pre>
          <p class="indent">
            Although type checks can be added to a program, this is often not as
            useful as you might imagine. For one, excessive checking impacts
            performance. Second, programs don’t always define objects that
            neatly fit into a nice type hierarchy. For instance, if the purpose
            of the <code>isinstance(items, list)</code> statement above is to
            test whether <code>items</code> is “list-like,” it won’t work with
            objects that have the same programming interface as a list but don’t
            directly inherit from the built-in <code>list</code> type (one
            example is <code>deque</code> from the
            <code>collections</code> module).
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch04lev1sec3">
            4.3 Reference Counting and Garbage Collection
          </h3>
          <p class="noindent">
            Python manages objects through automatic garbage collection. All
            objects are reference-counted. An object’s reference count is
            increased whenever it’s assigned to a new name or placed in a
            container such as a list, tuple, or dictionary:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0081-04" id="f0081-04"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> <span class="sgreen">37</span>       <span class="hblue"># Creates an object with value 37</span>
                    b <span class="igrey">=</span> a        <span class="hblue"># Increases reference count on 37</span>
                    c <span class="igrey">=</span> []
                    c.append(b)  <span class="hblue"># Increases reference count on 37</span></pre>
          <p class="indent">
            This example creates a single object containing the value 37.
            <code>a</code> is a name that initially refers to the newly created
            object. When <code>b</code> is assigned <code>a</code>,
            <code>b</code> becomes a new name for the
            <span epub:type="pagebreak" id="page_82"></span>same object, and the
            object’s reference count increases. When you place
            <code>b</code> into a list, the object’s reference count increases
            again. Throughout the example, only one object corresponds to 37.
            All other operations are creating references to that object.
          </p>
          <p class="indent">
            An object’s reference count is decreased by the
            <code>del</code> statement or whenever a reference goes out of scope
            or is reassigned. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0082-01" id="f0082-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>del</strong></span> a      <span class="hblue"># Decrease reference count of 37</span>
                    b <span class="igrey">=</span> <span class="sgreen">42</span>     <span class="hblue"># Decrease reference count of 37</span>
                    c[<span class="sgreen">0</span>] <span class="igrey">=</span> <span class="sgreen">2.0</span> <span class="hblue"># Decrease reference count of 37</span></pre>
          <p class="indent">
            The current reference count of an object can be obtained using the
            <code>sys.getrefcount()</code> function. For example:
          </p>
          <pre>
&gt;&gt;&gt; a = 37
                    &gt;&gt;&gt; import sys
                    &gt;&gt;&gt; sys.getrefcount(a)
                    7
                    &gt;&gt;&gt;</pre
          >
          <p class="indent">
            The reference count is often much higher than you might expect. For
            immutable data such as numbers and strings, the interpreter
            aggressively shares objects between different parts of the program
            in order to conserve memory. You just don’t notice that because the
            objects are immutable.
          </p>
          <p class="indent">
            When an object’s reference count reaches zero, it is
            garbage-collected. However, in some cases a circular dependency may
            exist in a collection of objects that are no longer in use. Here’s
            an example:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0082-03" id="f0082-03"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> { }
                    b <span class="igrey">=</span> { }
                    a[<span class="mblue">'b'</span>] <span class="igrey">=</span> b      <span class="hblue"># a contains reference to b</span>
                    b[<span class="mblue">'a'</span>] <span class="igrey">=</span> a      <span class="hblue"># b contains reference to a</span>
                    <span class="lgreen"><strong>del</strong></span> a
                    <span class="lgreen"><strong>del</strong></span> b</pre>
          <p class="indent">
            In this example, the <code>del</code> statements decrease the
            reference count of <code>a</code> and <code>b</code> and destroy the
            names used to refer to the underlying objects. However, since each
            object contains a reference to the other, the reference count
            doesn’t drop to zero and the objects remain allocated. The
            interpreter won’t leak memory, but the destruction of the objects
            will be delayed until a cycle detector executes to find and delete
            the inaccessible objects. The cycle-detection algorithm runs
            periodically as the interpreter allocates more and more memory
            during execution. The exact behavior can be fine-tuned and
            controlled using functions in the <code>gc</code> standard library
            module. The <code>gc.collect()</code> function can be used to
            immediately invoke the cyclic garbage collector.
          </p>
          <p class="indent">
            In most programs, garbage collection is something that simply
            happens without you having to think much about it. However, there
            are certain situations where manually deleting objects might make
            sense. One such scenario arises when working with gigantic data
            structures. For example, consider this code:<span
              epub:type="pagebreak"
              id="page_83"
            ></span>
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0083-01" id="f0083-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> some_calculation():
                        data <span class="igrey">=</span> create_giant_data_structure()
                        <span class="hblue"># Use data for some part of a calculation</span>
                        ...
                        <span class="hblue"># Release the data</span>
                        <span class="lgreen"><strong>del</strong></span> data
                    
                        <span class="hblue"># Calculation continues</span>
                        ...</pre>
          <p class="indent">
            In this code, the use of the <code>del data</code> statement
            indicates that the <code>data</code> variable is no longer needed.
            If this causes the reference count to reach 0, the object is
            garbage-collected at that point. Without the
            <code>del</code> statement, the object persists for some
            indeterminate amount of time until the <code>data</code> variable
            goes out of scope at the end of the function. You might only notice
            this when trying to figure out why your program is using more memory
            than it ought to.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch04lev1sec4">4.4 References and Copies</h3>
          <p class="noindent">
            When a program makes an assignment such as <code>b = a</code>, a new
            reference to <code>a</code> is created. For immutable objects such
            as numbers and strings, this assignment appears to create a copy of
            <code>a</code> (even though this is not the case). However, the
            behavior appears quite different for mutable objects such as lists
            and dictionaries. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0083-02" id="f0083-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; a = [1,2,3,4]
                    &gt;&gt;&gt; b = a                 # b is a reference to a
                    &gt;&gt;&gt; b is a
                    True
                    &gt;&gt;&gt; b[2] = -100           # Change an element in b
                    &gt;&gt;&gt; a                     # Notice how a also changed
                    [1, 2, -100, 4]
                    &gt;&gt;&gt;</pre
          >
          <p class="indent">
            Since <code>a</code> and <code>b</code> refer to the same object in
            this example, a change made to one of the variables is reflected in
            the other. To avoid this, you have to create a copy of an object
            rather than a new reference.
          </p>
          <p class="indent">
            Two types of copy operations are applied to container objects such
            as lists and dictionaries: a shallow copy and a deep copy. A shallow
            copy creates a new object, but populates it with references to the
            items contained in the original object. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0083-03" id="f0083-03"
              >Click here to view code image</a
            >
          </p>
          <pre>&gt;&gt;&gt; a = [ 1, 2, [3,4] ]
                    &gt;&gt;&gt; b = list(a)           # Create a shallow copy of a.
                    &gt;&gt;&gt; b is a
                    False
                    <span epub:type="pagebreak" id="page_84"></span>&gt;&gt;&gt; b.append(100)         # Append element to b.
                    &gt;&gt;&gt; b
                    [1, 2, [3, 4], 100]
                    &gt;&gt;&gt; a                     # Notice that a is unchanged
                    [1, 2, [3, 4]]
                    &gt;&gt;&gt; b[2][0] = -100        # Modify an element inside b
                    &gt;&gt;&gt; b
                    [1, 2, [-100, 4], 100]
                    &gt;&gt;&gt; a                     # Notice the change inside a
                    [1, 2, [-100, 4]]
                    &gt;&gt;&gt;</pre>
          <p class="indent">
            In this case, <code>a</code> and <code>b</code> are separate list
            objects, but the elements they contain are shared. Therefore, a
            modification to one of the elements of <code>a</code> also modifies
            an element of <code>b</code>, as shown.
          </p>
          <p class="indent">
            A deep copy creates a new object and recursively copies all the
            objects it contains. There is no built-in operator to create deep
            copies of objects, but you can use the
            <code>copy.deepcopy()</code> function in the standard library:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0084-02" id="f0084-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; import copy
                    &gt;&gt;&gt; a = [1, 2, [3, 4]]
                    &gt;&gt;&gt; b = copy.deepcopy(a)
                    &gt;&gt;&gt; b[2][0] = -100
                    &gt;&gt;&gt; b
                    [1, 2, [-100, 4]]
                    &gt;&gt;&gt; a                  # Notice that a is unchanged
                    [1, 2, [3, 4]]
                    &gt;&gt;&gt;</pre
          >
          <p class="indent">
            Use of <code>deepcopy()</code> is actively discouraged in most
            programs. Copying of an object is slow and often unnecessary.
            Reserve <code>deepcopy()</code> for situations where you actually
            need a copy because you’re about to mutate data and you don’t want
            your changes to affect the original object. Also, be aware that
            <code>deepcopy()</code> will fail with objects that involve system
            or runtime state (such as open files, network connections, threads,
            generators, and so on).
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch04lev1sec5">
            4.5 Object Representation and Printing
          </h3>
          <p class="noindent">
            Programs often need to display objects—for example, to show data to
            the user or print it for the purposes of debugging. If you supply an
            object <code>x</code> to the <code>print(x)</code> function or
            convert it to a string using <code>str(x)</code>, you will generally
            get a “nice” human-readable representation of the object’s value.
            For example, consider an example involving dates:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0084-03" id="f0084-03"
              >Click here to view code image</a
            >
          </p>
          <pre>&gt;&gt;&gt; from datetime import date
                    &gt;&gt;&gt; d = date(2012, 12, 21)
                    &gt;&gt;&gt; print(d)
                    <span epub:type="pagebreak" id="page_85"></span>2012-12-21
                    &gt;&gt;&gt; str(d)
                    '2012-12-21'
                    &gt;&gt;&gt;</pre>
          <p class="indent">
            This “nice” representation of an object may not be sufficient for
            debugging. For example, in the output of the above code, there is no
            obvious way to know if the variable <code>d</code> is a
            <code>date</code> instance or a simple string containing the text
            <code>'2012-12-21'</code>. To get more information, use the
            <code>repr(x)</code> function that creates a string with a
            representation of the object that you would have to type out in
            source code to create it. For example:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0085-02" id="f0085-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; d = date(2012, 12, 21)
                    &gt;&gt;&gt; repr(d)
                    'datetime.date(2012, 12, 21)'
                    &gt;&gt;&gt; print(repr(d))
                    datetime.date(2012, 12, 21)
                    &gt;&gt;&gt; print(f'The date is: {d!r}')
                    The date is: datetime.date(2012, 12, 21)
                    &gt;&gt;&gt;</pre
          >
          <p class="indent">
            In string formatting, the <code>!r</code> suffix can be added to a
            value to produce its <code>repr()</code> value instead of the normal
            string conversion.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch04lev1sec6">4.6 First-Class Objects</h3>
          <p class="noindent">
            All objects in Python are said to be <em>first-class</em>. This
            means that all objects that can be assigned to a name can also be
            treated as data. As data, objects can be stored as variables, passed
            as arguments, returned from functions, compared against other
            objects, and more. For example, here is a simple dictionary
            containing two values:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0085-03" id="f0085-03"
              >Click here to view code image</a
            >
          </p>
          <pre>items <span class="igrey">=</span> {
                        <span class="mblue">'number'</span> : <span class="sgreen">42</span>
                        <span class="mblue">'text'</span> : <span class="mblue">"Hello World"</span>
                    }</pre>
          <p class="indent">
            The first-class nature of objects can be seen by adding some more
            unusual items to this dictionary:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0085-04" id="f0085-04"
              >Click here to view code image</a
            >
          </p>
          <pre>items[<span class="mblue">'func'</span>]  <span class="igrey">=</span> abs            <span class="hblue"># Add the abs() function</span>
                    import math
                    items[<span class="mblue">'mod'</span>]   <span class="igrey">=</span> math           <span class="hblue"># Add a module</span>
                    items[<span class="mblue">'error'</span>] <span class="igrey">=</span> <span class="pgold">ValueError</span>     <span class="hblue"># Add an exception type</span>
                    nums <span class="igrey">=</span> [<span class="sgreen">1</span>,<span class="sgreen">2</span>,<span class="sgreen">3</span>,<span class="sgreen">4</span>]
                    items[<span class="mblue">'append'</span>] <span class="igrey">=</span> nums.append   <span class="hblue"># Add a method of another object</span></pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_86"></span>In this example, the
            <code>items</code> dictionary now contains a function, a module, an
            exception, and a method of another object. If you want, you can use
            dictionary lookups on <code>items</code> in place of the original
            names and the code will still work. For example:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0086-01" id="f0086-01"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; items['func'](-45)         # Executes abs(-45)
                    45
                    &gt;&gt;&gt; items['mod'].sqrt(4)       # Executes math.sqrt(4)
                    2.0
                    &gt;&gt;&gt; try:
                    ...     x = int('a lot')
                    ... except items['error'] as e:   # Same as except ValueError as e
                    ...     print("Couldn't convert")
                    ...
                    Couldn't convert
                    &gt;&gt;&gt; items['append'](100)       # Executes nums.append(100)
                    &gt;&gt;&gt; nums
                    [1, 2, 3, 4, 100]
                    &gt;&gt;&gt;</pre
          >
          <p class="indent">
            The fact that everything in Python is first-class is often not fully
            appreciated by newcomers. However, it can be used to write very
            compact and flexible code.
          </p>
          <p class="indent">
            For example, suppose you have a line of text such as
            “ACME,100,490.10” and you want to convert it into a list of values
            with appropriate type conversions. Here’s a clever way to do it by
            creating a list of types (which are first-class objects) and
            executing a few common list-processing operations:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0086-02" id="f0086-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; line = 'ACME,100,490.10'
                    &gt;&gt;&gt; column_types = [str, int, float]
                    &gt;&gt;&gt; parts = line.split(',')
                    &gt;&gt;&gt; row = [ty(val) for ty, val in zip(column_types, parts)]
                    &gt;&gt;&gt; row
                    ['ACME', 100, 490.1]
                    &gt;&gt;&gt;</pre
          >
          <p class="indent">
            Placing functions or classes in a dictionary is a common technique
            for eliminating complex <code>if-elif-else</code> statements. For
            example, if you have code like this:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0086-03" id="f0086-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>if</strong></span> format <span class="igrey">==</span> <span class="mblue">'text'</span>:
                        formatter <span class="igrey">=</span> TextFormatter()
                    <span class="lgreen"><strong>elif</strong></span> format <span class="igrey">==</span> <span class="mblue">'csv'</span>:
                        formatter <span class="igrey">=</span> CSVFormatter()
                    <span class="lgreen"><strong>elif</strong></span> format <span class="igrey">==</span> <span class="mblue">'html'</span>:
                        formatter <span class="igrey">=</span> HTMLFormatter()
                    <span class="lgreen"><strong>else</strong></span>:
                        <span class="lgreen"><strong>raise</strong></span> <span class="pgold">RuntimeError</span>(<span class="mblue">'Bad format'</span>)</pre>
          <p class="indent">
            you could rewrite it using a dictionary:<span
              epub:type="pagebreak"
              id="page_87"
            ></span>
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0087-01" id="f0087-01"
              >Click here to view code image</a
            >
          </p>
          <pre>_formats <span class="igrey">=</span> {
                       <span class="mblue">'text'</span>: TextFormatter,
                       <span class="mblue">'csv'</span>: CSVFormatter,
                       <span class="mblue">'html'</span>: HTMLFormatter
                    }
                    
                    <span class="lgreen"><strong>if</strong></span> format <span class="lgreen"><strong>in</strong></span> _formats:
                       formatter <span class="igrey">=</span> _formats[format]()
                    <span class="lgreen"><strong>else</strong></span>:
                       <span class="lgreen"><strong>raise</strong></span> <span class="pgold">RuntimeError</span>(<span class="mblue">'Bad format'</span>)</pre>
          <p class="indent">
            This latter form is also more flexible as new cases can be added by
            inserting more entries into the dictionary without having to modify
            a large <code>if-elif-else</code> statement block.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch04lev1sec7">
            4.7 Using <code>None</code> for Optional or Missing Data
          </h3>
          <p class="noindent">
            Sometimes programs need to represent an optional or missing value.
            <code>None</code> is a special instance reserved for this purpose.
            <code>None</code> is returned by functions that don’t explicitly
            return a value. <code>None</code> is also frequently used as the
            default value of optional arguments, so that the function can detect
            whether the caller has actually passed a value for that argument.
            <code>None</code> has no attributes and evaluates to
            <code>False</code> in Boolean expressions.
          </p>
          <p class="indent">
            Internally, <code>None</code> is stored as a singleton—that is,
            there is only one <code>None</code> value in the interpreter.
            Therefore, a common way to test a value against <code>None</code> is
            to use the <code>is</code> operator like this:
          </p>
          <pre><span class="lgreen">if</span> value <span class="lgreen">is</span> None:
                       statements
                       ...</pre>
          <p class="indent">
            Testing for <code>None</code> using the <code>==</code> operator
            also works, but it’s not recommended and might be flagged as a style
            error by code-checking tools.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch04lev1sec8">
            4.8 Object Protocols and Data Abstraction
          </h3>
          <p class="noindent">
            Most Python language features are defined by <em>protocols</em>.
            Consider the following function:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0087-03" id="f0087-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> compute_cost(unit_price, num_units):
                        <span class="lgreen"><strong>return</strong></span> unit_price <span class="igrey">*</span> num_units</pre>
          <p class="indent">
            Now, ask yourself the question: What inputs are allowed? The answer
            is deceptively simple—everything is allowed! At first glance, this
            function looks like it might apply to numbers:<span
              epub:type="pagebreak"
              id="page_88"
            ></span>
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0088-01" id="f0088-01"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; compute_cost(1.25, 50)
                    62.5
                    &gt;&gt;&gt;</pre
          >
          <p class="indent">
            Indeed, it works as expected. However, the function works with much
            more. You can use specialized numbers such as fractions or decimals:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0088-02" id="f0088-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; from fractions import Fraction
                    &gt;&gt;&gt; compute_cost(Fraction(5, 4), 50)
                    Fraction(125, 2)
                    &gt;&gt;&gt; from decimal import Decimal
                    &gt;&gt;&gt; compute_cost(Decimal('1.25'), Decimal('50'))
                    Decimal('62.50')
                    &gt;&gt;&gt;</pre
          >
          <p class="indent">
            Not only that—the function works with arrays and other complex
            structures from packages such as <code>numpy</code>. For example:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0088-03" id="f0088-03"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; import numpy as np
                    &gt;&gt;&gt; prices = np.array([1.25, 2.10, 3.05])
                    &gt;&gt;&gt; units = np.array([50, 20, 25])
                    &gt;&gt;&gt; compute_cost(prices, quantities)
                    array([62.5 , 42.  , 76.25])
                    &gt;&gt;&gt;</pre
          >
          <p class="indent">The function might even work in unexpected ways:</p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0088-04" id="f0088-04"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; compute_cost('a lot', 10)
                    'a lota lota lota lota lota lota lota lota lota lot'
                    &gt;&gt;&gt;</pre
          >
          <p class="indent">And yet, certain combinations of types fail:</p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0088-05" id="f0088-05"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; compute_cost(Fraction(5, 4), Decimal('50'))
                    Traceback (most recent call last):
                      File "&lt;stdin&gt;", line 1, in &lt;module&gt;
                      File "&lt;stdin&gt;", line 2, in compute_cost
                    TypeError: unsupported operand type(s) for *: 'Fraction' and 'decimal.Decimal'
                    &gt;&gt;&gt;</pre
          >
          <p class="indent">
            Unlike a compiler for a static language, Python does not verify
            correct program behavior in advance. Instead, the behavior of an
            object is determined by a dynamic process that involves the dispatch
            of so-called “special” or “magic” methods. The names of these
            special methods are always preceded and followed by double
            underscores (<code>__</code>). The methods are automatically
            triggered by the interpreter as a program executes. For example, the
            operation <code>x * y</code> is carried out by a method
            <code>x.__mul__(y)</code>. The names of these methods and their
            corresponding operators are hard-wired. The behavior of any given
            object depends entirely on the set of special methods that it
            implements.
          </p>
          <p class="indent">
            <span epub:type="pagebreak" id="page_89"></span>The next few
            sections describe the special methods associated with different
            categories of core interpreter features. These categories are
            sometimes called “protocols.” An object, including a user-defined
            class, may define any combination of these features to make the
            object behave in different ways.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch04lev1sec9">4.9 Object Protocol</h3>
          <p class="noindent">
            The methods in <a href="ch04.xhtml#ch04tab01">Table 4.1</a> are
            related to the overall management of objects. This includes object
            creation, initialization, destruction, and representation.
          </p>
          <figure class="table" id="ch04tab01">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 4.1</span> Methods for Object Management
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Method</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>__new__(cls [,*args [,**kwargs]])</code>
                    </p>
                  </td>
                  <td>
                    <p class="tabtext">
                      A static method called to create a new instance.
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>__init__(self [,*args [,**kwargs]])</code>
                    </p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Called to initialize a new instance after it’s been
                      created.
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__del__(self)</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Called when an instance is being destroyed.
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__repr__(self)</code></p>
                  </td>
                  <td>
                    <p class="tabtext">Create a string representation.</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            The <code>__new__()</code> and <code>__init__()</code> methods are
            used together to create and initialize instances. When an object is
            created by calling <code>SomeClass(args)</code>, it is translated
            into the following steps:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0089-01" id="f0089-01"
              >Click here to view code image</a
            >
          </p>
          <pre>x <span class="igrey">=</span> SomeClass.<span class="cblue">__new__</span>(SomeClass, args)
                    <span class="lgreen"><strong>if</strong></span> isinstance(x, SomeClass):
                        x.<span class="cblue">__init__</span>(args)</pre>
          <p class="indent">
            Normally, these steps are handled behind the scenes and you don’t
            need to worry about it. The most common method implemented in a
            class is <code>__init__()</code>. Use of
            <code>__new__()</code> almost always indicates the presence of
            advanced magic related to instance creation (for example, it is used
            in class methods that want to bypass <code>__init__()</code> or in
            certain creational design patterns such as singletons or caching).
            The implementation of <code>__new__()</code> doesn’t necessarily
            need to return an instance of the class in question—if not, the
            subsequent call to <code>__init__()</code> on creation is skipped.
          </p>
          <p class="indent">
            The <code>__del__()</code> method is invoked when an instance is
            about to be garbage-collected. This method is invoked only when an
            instance is no longer in use. Note that the statement
            <code>del x</code> only decrements the instance reference count and
            doesn’t necessarily result in a call to this function.
            <code>__del__()</code> is almost never defined unless an instance
            needs to perform additional resource management steps upon
            destruction.
          </p>
          <p class="indent">
            The <code>__repr__()</code> method, called by the built-in
            <code>repr()</code> function, creates a string representation of an
            object that can be useful for debugging and printing. This is also
            the method responsible for creating the output of values you see
            when inspecting variables in the interactive interpreter. The
            convention is for <code>__repr__()</code> to return an expression
            string that can be evaluated to re-create the object using
            <code>eval()</code>. For example:<span
              epub:type="pagebreak"
              id="page_90"
            ></span>
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0090-01" id="f0090-01"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> [<span class="sgreen">2</span>, <span class="sgreen">3</span>, <span class="sgreen">4</span>, <span class="sgreen">5</span>]   <span class="hblue"># Create a list</span>
                    s <span class="igrey">=</span> repr(a)        <span class="hblue"># s = '[2, 3, 4, 5]'</span>
                    b <span class="igrey">=</span> eval(s)        <span class="hblue"># Turns s back into a list</span></pre>
          <p class="indent">
            If a string expression cannot be created, the convention is for
            <code>__repr__()</code> to return a string of the form
            <code>&lt;...message...&gt;</code>, as shown here:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0090-02" id="f0090-02"
              >Click here to view code image</a
            >
          </p>
          <pre>f <span class="igrey">=</span> open(<span class="mblue">'foo.txt'</span>)
                    a <span class="igrey">=</span> repr(f)
                    <span class="hblue"># a = "&lt;_io.TextIOWrapper name='foo.txt' mode='r' encoding='UTF-8'&gt;</span></pre>
        </section>
        <section>
          <h3 class="h3" id="ch04lev1sec10">4.10 Number Protocol</h3>
          <p class="noindent">
            <a href="ch04.xhtml#ch04tab02">Table 4.2</a> lists special methods
            that objects must implement to provide mathematical operations.
          </p>
          <figure class="table" id="ch04tab02">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 4.2</span> Methods for Mathematical
                Operations
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Method</p></th>
                  <th><p class="tabtext">Operation</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext"><code>__add__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self + other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__sub__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self - other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__mul__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self * other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__truediv__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self / other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>__floordiv__(self, other)</code>
                    </p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self // other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__mod__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self % other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__matmul__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self @ other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__divmod__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>divmod(self, other)</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>__pow__(self, other [, modulo])</code>
                    </p>
                  </td>
                  <td>
                    <p class="tabtext">
                      <code>self ** other</code>,
                      <code>pow(self, other, modulo)</code>
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__lshift__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self &lt;&lt; other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__rshift__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self &gt;&gt; other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__and__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self &amp; other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__or__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self | other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__xor__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self ^ other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__radd__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>other + self</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__rsub__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>other - self</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__rmul__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>other * self</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>__rtruediv__(self, other)</code>
                    </p>
                  </td>
                  <td>
                    <p class="tabtext"><code>other / self</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>__rfloordiv__(self, other)</code>
                    </p>
                  </td>
                  <td>
                    <p class="tabtext"><code>other // self</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__rmod__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>other % self</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__rmatmul__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>other @ self</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__rdivmod__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>divmod(other, self)</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext">
                      <span epub:type="pagebreak" id="page_91"></span
                      ><code>__rpow__(self, other)</code>
                    </p>
                  </td>
                  <td>
                    <p class="tabtext"><code>other ** self</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__rlshift__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>other &lt;&lt; self</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__rrshift__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>other &gt;&gt; self</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__rand__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>other &amp; self</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__ror__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>other | self</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__rxor__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>other ^ self</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__iadd__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self += other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__isub__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self -= other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__imul__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self *= other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>__itruediv__(self, other)</code>
                    </p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self /= other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>__ifloordiv__(self, other)</code>
                    </p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self //= other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__imod__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self %= other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__imatmul__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self @= other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__ipow__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self **= other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__iand__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self &amp;= other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__ior__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self |= other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__ixor__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self ^= other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__ilshift__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self &lt;&lt;= other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__irshift__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self &gt;&gt;= other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__neg__(self)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>–self</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__pos__(self)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>+self</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__invert__(self)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>~self</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__abs__(self)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>abs(self)</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__round__(self, n)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>round(self, n)</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__floor__(self)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>math.floor(self)</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__ceil__(self)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>math.ceil(self)</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__trunc__(self)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>math.trunc(self)</code></p>
                  </td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            When presented with an expression such as <code>x + y</code>, the
            interpreter invokes a combination of the methods
            <code>x.__add__(y)</code> or <code>y.__radd__(x)</code> to carry out
            the operation. The initial choice is to try
            <code>x.__add__(y)</code> in all cases except for the special case
            where <code>y</code> happens to be a subtype of <code>x</code>; in
            that case, <code>y.__radd__(x)</code> executes first. If the initial
            method fails by returning <code>NotImplemented</code>, an attempt is
            made to invoke the operation with reversed operands such as
            <code>y.__radd__(x)</code>. If this second attempt fails, the entire
            operation fails. Here is an example:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0091-01" id="f0091-01"
              >Click here to view code image</a
            >
          </p>
          <pre>&gt;&gt;&gt; a = 42       # int
                    &gt;&gt;&gt; b = 3.7      # float
                    &gt;&gt;&gt; a.__add__(b)
                    NotImplemented
                    <span epub:type="pagebreak" id="page_92"></span>&gt;&gt;&gt; b.__radd__(a)
                    45.7
                    &gt;&gt;&gt;</pre>
          <p class="indent">
            This example might seem surprising but it reflects the fact that
            integers don’t actually know anything about floating-point numbers.
            However, floating-point numbers do know about integers—as integers
            are, mathematically, a special kind of floating-point numbers. Thus,
            the reversed operand produces the correct answer.
          </p>
          <p class="indent">
            The methods <code>__iadd__()</code>, <code>__isub__()</code>, and so
            forth are used to support in-place arithmetic operators such as
            <code>a += b</code> and <code>a -= b</code> (also known as augmented
            assignment). A distinction is made between these operators and the
            standard arithmetic methods because the implementation of the
            in-place operators might be able to provide certain customizations
            or performance optimizations. For instance, if the object is not
            shared, the value of an object could be modified in place without
            allocating a newly created object for the result. If the in-place
            operators are left undefined, an operation such as
            <code>a += b</code> is evaluated using
            <code>a = a + b</code> instead.
          </p>
          <p class="indent">
            There are no methods that can be used to define the behavior of the
            logical <code>and</code>, <code>or</code>, or
            <code>not</code> operators. The <code>and</code> and
            <code>or</code> operators implement short-circuit evaluation where
            evaluation stops if the final result can already be determined. For
            example:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0092-02" id="f0092-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; True <strong>or</strong> 1 /0      # Does not evaluate 1/0
                    True
                    &gt;&gt;&gt;</pre
          >
          <p class="indent">
            This behavior involving unevaluated subexpressions can’t be
            expressed using the evaluation rules of a normal function or method.
            Thus, there is no protocol or set of methods for redefining it.
            Instead, it is handled as a special case deep inside the
            implementation of Python itself.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch04lev1sec11">4.11 Comparison Protocol</h3>
          <p class="noindent">
            Objects can be compared in various ways. The most basic check is an
            identity check with the <code>is</code> operator. For example,
            <code>a is b</code>. Identity does not consider the values stored
            inside of an object, even if they happen to be the same. For
            example:
          </p>
          <pre>
&gt;&gt;&gt; a = [1, 2, 3]
                    &gt;&gt;&gt; b = a
                    &gt;&gt;&gt; a is b
                    True
                    &gt;&gt;&gt; c = [1, 2, 3]
                    &gt;&gt;&gt; a is c
                    False
                    &gt;&gt;&gt;</pre
          >
          <p class="indent">
            The <code>is</code> operator is an internal part of Python that
            can’t be redefined. All other comparisons on objects are implemented
            by the methods in <a href="ch04.xhtml#ch04tab03">Table 4.3</a>.<span
              epub:type="pagebreak"
              id="page_93"
            ></span>
          </p>
          <figure class="table" id="ch04tab03">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 4.3</span> Methods for Instance
                Comparison and Hashing
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Method</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext"><code>__bool__(self)</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Returns <code>False</code> or <code>True</code> for
                      truth-value testing
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__eq__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self == other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__ne__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self != other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__lt__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self &lt; other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__le__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self &lt;= other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__gt__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self &gt; other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__ge__(self, other)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>self &gt;= other</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__hash__(self)</code></p>
                  </td>
                  <td><p class="tabtext">Computes an integer hash index</p></td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            The <code>__bool__()</code> method, if present, is used to determine
            the truth value when an object is tested as part of a condition or
            conditional expression. For example:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0093-01" id="f0093-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>if</strong></span> a:              <span class="hblue"># Executes a.__bool__()</span>
                       ...
                    <span class="lgreen"><strong>else</strong></span>:
                       ...</pre>
          <p class="indent">
            If <code>__bool__()</code> is undefined, then
            <code>__len__()</code> is used as a fallback. If both
            <code>__bool__()</code> and <code>__len__()</code> are undefined, an
            object is simply considered to be <code>True</code>.
          </p>
          <p class="indent">
            The <code>__eq__()</code> method is used to determine basic equality
            for use with the <code>==</code> and <code>!=</code> operators. The
            default implementation of <code>__eq__()</code> compares objects by
            identity using the <code>is</code> operator. The
            <code>__ne__()</code> method, if present, can be used to implement
            special processing for <code>!=</code>, but is usually not required
            as long as <code>__eq__()</code> is defined.
          </p>
          <p class="indent">
            Ordering is determined by the relational operators
            (<code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, and
            <code>&gt;=</code>) using methods such as <code>__lt__()</code> and
            <code>__gt__()</code>. As with other mathematical operations, the
            evaluation rules are subtle. To evaluate <code>a &lt; b</code>, the
            interpreter will first try to execute
            <code>a.__lt__(b)</code> except where <code>b</code> is a subtype of
            <code>a</code>. In that one specific case,
            <code>b.__gt__(a)</code> executes instead. If this initial method is
            not defined or returns <code>NotImplemented</code>, the interpreter
            tries a reversed comparison, calling <code>b.__gt__(a)</code>.
            Similar rules apply to operators such as <code>&lt;=</code> and
            <code>&gt;=</code>. For example, evaluating <code>&lt;=</code> first
            tries to evaluate <code>a.__le__(b)</code>. If not implemented,
            <code>b.__ge__(a)</code> is tried.
          </p>
          <p class="indent">
            Each of the comparison methods takes two arguments and is allowed to
            return any kind of value, including a Boolean value, a list, or any
            other Python type. For instance, a numerical package might use this
            to perform an element-wise comparison of two matrices, returning a
            matrix with the results. If comparison is not possible, the methods
            should return the built-in object <code>NotImplemented</code>. This
            is not the same as the <code>NotImplementedError</code> exception.
            For example:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0093-02" id="f0093-02"
              >Click here to view code image</a
            >
          </p>
          <pre>&gt;&gt;&gt; a = 42      # int
                    &gt;&gt;&gt; b = 52.3    # float
                    &gt;&gt;&gt; a.__lt__(b)
                    NotImplemented
                    <span epub:type="pagebreak" id="page_94"></span>&gt;&gt;&gt; b.__gt__(a)
                    True
                    &gt;&gt;&gt;</pre>
          <p class="indent">
            It is not necessary for an ordered object to implement all of the
            comparison operations in
            <a href="ch04.xhtml#ch04tab03">Table 4.3</a>. If you want to be able
            to sort objects or use functions such as <code>min()</code> or
            <code>max()</code>, then <code>__lt__()</code> must be minimally
            defined. If you are adding comparison operators to a user-defined
            class, the <code>@total_ordering</code> class decorator in the
            <code>functools</code> module may be of some use. It can generate
            all of the methods as long as you minimally implement
            <code>__eq__()</code> and one of the other comparisons.
          </p>
          <p class="indent">
            The <code>__hash__()</code> method is defined on instances that are
            to be placed into a set or be used as keys in a mapping
            (dictionary). The value returned is an integer that should be the
            same for two instances that compare as equal. Moreover,
            <code>__eq__()</code> should always be defined together with
            <code>__hash__()</code> because the two methods work together. The
            value returned by <code>__hash__()</code> is typically used as an
            internal implementation detail of various data structures. However,
            it’s possible for two different objects to have the same hash value.
            Therefore, <code>__eq__()</code> is necessary to resolve potential
            collisions.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch04lev1sec12">4.12 Conversion Protocols</h3>
          <p class="noindent">
            Sometimes, you must convert an object to a built-in type such as a
            string or a number. The methods in
            <a href="ch04.xhtml#ch04tab04">Table 4.4</a> can be defined for this
            purpose.
          </p>
          <figure class="table" id="ch04tab04">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 4.4</span> Methods for Conversions
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Method</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext"><code>__str__(self)</code></p>
                  </td>
                  <td><p class="tabtext">Conversion to a string</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__bytes__(self)</code></p>
                  </td>
                  <td><p class="tabtext">Conversion to bytes</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>__format__(self, format_spec)</code>
                    </p>
                  </td>
                  <td>
                    <p class="tabtext">Creates a formatted representation</p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__bool__(self)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>bool(self)</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__int__(self)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>int(self)</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__float__(self)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>float(self)</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__complex__(self)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>complex(self)</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__index__(self)</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Conversion to a integer index <code>[self]</code>
                    </p>
                  </td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            The <code>__str__()</code> method is called by the built-in
            <code>str()</code> function and by functions related to printing.
            The <code>__format__()</code> method is called by the
            <code>format()</code> function or the <code>format()</code> method
            of strings. The <code>format_spec</code> argument is a string
            containing the format specification. This string is the same as the
            <code>format_spec</code> argument to <code>format()</code>. For
            example:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0094-02" id="f0094-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="trose">f'</span><span class="mblue">{x:</span>spec<span class="mblue">}</span><span class="trose">'</span>                 <span class="hblue"># Calls x.__format__('spec')</span>
                    format(x, <span class="mblue">'spec'</span>)           <span class="hblue"># Calls x.__format__('spec')</span>
                    <span class="hblue">'x is {0:spec}'</span> .format(x)  <span class="hblue"># Calls x.__format__('spec')</span></pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_95"></span>The syntax of the
            format specification is arbitrary and can be customized on an
            object-by-object basis. However, there is a standard set of
            conventions used for the built-in types. More information about
            string formatting, including the general format of the specifier,
            can be found in <a href="ch09.xhtml#ch09">Chapter 9</a>.
          </p>
          <p class="indent">
            The <code>__bytes__()</code> method is used to create a byte
            representation if an instance is passed to <code>bytes()</code>. Not
            all types support byte conversion.
          </p>
          <p class="indent">
            The numeric conversions <code>__bool__()</code>,
            <code>__int__()</code>, <code>__float__()</code>, and
            <code>__complex__()</code> are expected to produce a value of the
            corresponding built-in type.
          </p>
          <p class="indent">
            Python never performs implicit type conversions using these methods.
            Thus, even if an object <code>x</code> implements an
            <code>__int__()</code> method, the expression
            <code>3 + x</code> will still produce a <code>TypeError</code>. The
            only way to execute <code>__int__()</code> is through an explicit
            use of the <code>int()</code> function.
          </p>
          <p class="indent">
            The <code>__index__()</code> method performs an integer conversion
            of an object when it’s used in an operation that requires an integer
            value. This includes indexing in sequence operations. For example,
            if <code>items</code> is a list, performing an operation such as
            <code>items[x]</code> will attempt to execute
            <code>items[x.__index__()]</code> if <code>x</code> is not an
            integer. <code>__index__()</code> is also used in various base
            conversions such as <code>oct(x)</code> and <code>hex(x)</code>.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch04lev1sec13">4.13 Container Protocol</h3>
          <p class="noindent">
            The methods in <a href="ch04.xhtml#ch04tab05">Table 4.5</a> are used
            by objects that want to implement containers of various kinds—lists,
            dicts, sets, and so on.
          </p>
          <figure class="table" id="ch04tab05">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 4.5</span> Methods for Containers
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Method</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext"><code>__len__(self)</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Returns the length of <code>self</code>
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__getitem__(self, key)</code></p>
                  </td>
                  <td>
                    <p class="tabtext">Returns <code>self[key]</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>__setitem__(self, key, value)</code>
                    </p>
                  </td>
                  <td>
                    <p class="tabtext">Sets <code>self[key] = value</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__delitem__(self, key)</code></p>
                  </td>
                  <td>
                    <p class="tabtext">Deletes <code>self[key]</code></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__contains__(self, obj)</code></p>
                  </td>
                  <td>
                    <p class="tabtext"><code>obj in self</code></p>
                  </td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">Here’s an example:</p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0095-01" id="f0095-01"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> [<span class="sgreen">1</span>, <span class="sgreen">2</span>, <span class="sgreen">3</span>, <span class="sgreen">4</span>, <span class="sgreen">5</span>, <span class="sgreen">6</span>]
                    len(a)               <span class="hblue"># a.__len__()</span>
                    x <span class="igrey">=</span> a[<span class="sgreen">2</span>]             <span class="hblue"># x = a.__getitem__(2)</span>
                    a[<span class="sgreen">1</span>] <span class="igrey">=</span> <span class="sgreen">7</span>             <span class="hblue"># a.__setitem__(1,7)</span>
                    <span class="lgreen"><strong>del</strong></span> a[<span class="sgreen">2</span>]             <span class="hblue"># a.__delitem__(2)</span>
                    <span class="sgreen">5</span> <span class="lgreen"><strong>in</strong></span> a               <span class="hblue"># a.__contains__(5)</span></pre>
          <p class="indent">
            The <code>__len__()</code> method is called by the built-in
            <code>len()</code> function to return a nonnegative length. This
            function also determines truth values unless the
            <code>__bool__()</code> method has also been defined.
          </p>
          <p class="indent">
            <span epub:type="pagebreak" id="page_96"></span>For accessing
            individual items, the <code>__getitem__()</code> method can return
            an item by key value. The key can be any Python object, but it is
            expected to be an integer for ordered sequences such as lists and
            arrays. The <code>__setitem__()</code> method assigns a value to an
            element. The <code>__delitem__()</code> method is invoked whenever
            the <code>del</code> operation is applied to a single element. The
            <code>__contains__()</code> method is used to implement the
            <code>in</code> operator.
          </p>
          <p class="indent">
            Slicing operations such as <code>x = s[i:j]</code> are also
            implemented using <code>__getitem__()</code>,
            <code>__setitem__()</code>, and <code>__delitem__()</code>. For
            slices, a special <code>slice</code> instance is passed as the key.
            This instance has attributes that describe the range of the slice
            being requested. For example:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0096-01" id="f0096-01"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> [<span class="sgreen">1</span>,<span class="sgreen">2</span>,<span class="sgreen">3</span>,<span class="sgreen">4</span>,<span class="sgreen">5</span>,<span class="sgreen">6</span>]
                    x <span class="igrey">=</span> a[<span class="sgreen">1</span>:<span class="sgreen">5</span>]           <span class="hblue"># x = a.__getitem__(slice(1, 5, None))</span>
                    a[<span class="sgreen">1</span>:<span class="sgreen">3</span>] <span class="igrey">=</span> [<span class="sgreen">10</span>,<span class="sgreen">11</span>,<span class="sgreen">12</span>]  <span class="hblue"># a.__setitem__(slice(1, 3, None), [10, 11, 12])</span>
                    <span class="lgreen"><strong>del</strong></span> a[<span class="sgreen">1</span>:<span class="sgreen">4</span>]           <span class="hblue"># a.__delitem__(slice(1, 4, None))</span></pre>
          <p class="indent">
            The slicing features of Python are more powerful than many
            programmers realize. For example, the following variations of
            extended slicing are all supported and may be useful for working
            with multidimensional data structures such as matrices and arrays:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0096-02" id="f0096-02"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> m[<span class="sgreen">0</span>:<span class="sgreen">100</span>:<span class="sgreen">10</span>]          <span class="hblue"># Strided slice (step=10)</span>
                    b <span class="igrey">=</span> m[<span class="sgreen">1</span>:<span class="sgreen">10</span>, <span class="sgreen">3</span>:<span class="sgreen">20</span>]        <span class="hblue"># Multidimensional slice</span>
                    c <span class="igrey">=</span> m[<span class="sgreen">0</span>:<span class="sgreen">100</span>:<span class="sgreen">10</span>, <span class="sgreen">50</span>:<span class="sgreen">75</span>:<span class="sgreen">5</span>] <span class="hblue"># Multiple dimensions with strides</span>
                    m[<span class="sgreen">0</span>:<span class="sgreen">5</span>, <span class="sgreen">5</span>:<span class="sgreen">10</span>] <span class="igrey">=</span> n         <span class="hblue"># extended slice assignment</span>
                    <span class="lgreen"><strong>del</strong></span> m[:<span class="sgreen">10</span>, <span class="sgreen">15</span>:]          <span class="hblue"># extended slice deletion</span></pre>
          <p class="indent">
            The general format for each dimension of an extended slice is
            <code>i:j[:stride]</code>, where <code>stride</code> is optional. As
            with ordinary slices, you can omit the starting or ending values for
            each part of a slice.
          </p>
          <p class="indent">
            In addition, the <code>Ellipsis</code> (written as <code>...</code>)
            is available to denote any number of trailing or leading dimensions
            in an extended slice:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0096-03" id="f0096-03"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> m[..., <span class="sgreen">10</span>:<span class="sgreen">20</span>]    <span class="hblue"># extended slice access with Ellipsis</span>
                    m[<span class="sgreen">10</span>:<span class="sgreen">20</span>, ...] <span class="igrey">=</span> n</pre>
          <p class="indent">
            When using extended slices, the <code>__getitem__()</code>,
            <code>__setitem__()</code>, and <code>__delitem__()</code> methods
            implement access, modification, and deletion, respectively. However,
            instead of an integer, the value passed to these methods is a tuple
            containing a combination of slice or <code>Ellipsis</code> objects.
            For example,
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0096-04" id="f0096-04"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> m[<span class="sgreen">0</span>:<span class="sgreen">10</span>, <span class="sgreen">0</span>:<span class="sgreen">100</span>:<span class="sgreen">5</span>, ...]</pre>
          <p class="indent">invokes <code>__getitem__()</code> as follows:</p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0096-05" id="f0096-05"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> m.<span class="cblue">__getitem__</span>((slice(<span class="sgreen">0</span>,<span class="sgreen">10</span>,<span class="dblue">None</span>), slice(<span class="sgreen">0</span>,<span class="sgreen">100</span>,<span class="sgreen">5</span>), <span class="dblue">Ellipsis</span>))</pre>
          <p class="indent">
            Python strings, tuples, and lists currently provide some support for
            extended slices. No part of Python or its standard library make use
            of multidimensional slicing or the <code>Ellipsis</code>. Those
            features are reserved purely for third-party libraries and
            frameworks. Perhaps the most common place you would see them used is
            in a library such as <code>numpy</code>.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch04lev1sec14">
            <span epub:type="pagebreak" id="page_97"></span>4.14 Iteration
            Protocol
          </h3>
          <p class="noindent">
            If an instance, <code>obj</code>, supports iteration, it provides a
            method, <code>obj.__iter__()</code>, that returns an iterator. An
            iterator <code>iter</code>, in turn, implements a single method,
            <code>iter.__next__()</code>, that returns the next object or raises
            <code>StopIteration</code> to signal the end of iteration. These
            methods are used by the implementation of the
            <code>for</code> statement as well as other operations that
            implicitly perform iteration. For example, the statement
            <code>for x in s</code> is carried out by performing these steps:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0097-01" id="f0097-01"
              >Click here to view code image</a
            >
          </p>
          <pre>_iter <span class="igrey">=</span> s.<span class="cblue">__iter__</span>()
                    <span class="lgreen"><strong>while</strong></span> <span class="dblue">True</span>:
                        <span class="lgreen"><strong>try</strong></span>:
                             x <span class="igrey">=</span> _iter.<span class="cblue">__next__</span>()
                        <span class="lgreen"><strong>except</strong></span> <span class="pgold">StopIteration</span>:
                             <span class="lgreen"><strong>break</strong></span>
                        <span class="hblue"># Do statements in body of for loop</span>
                        ...</pre>
          <p class="indent">
            An object may optionally provide a reversed iterator if it
            implements the <code>__reversed__()</code> special method. This
            method should return an iterator object with the same interface as a
            normal iterator (that is, a <code>__next__()</code> method that
            raises <code>StopIteration</code> at the end of iteration). This
            method is used by the built-in <code>reversed()</code> function. For
            example:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0097-02" id="f0097-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; for x in reversed([1,2,3]):
                    ...     print(x)
                    3
                    2
                    1
                    &gt;&gt;&gt;</pre
          >
          <p class="indent">
            A common implementation technique for iteration is to use a
            generator function involving <code>yield</code>. For example:
          </p>
          <p class="codelink">
            <a href="ch04_images.xhtml#rf0097-03" id="f0097-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> FRange:
                        <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, start, stop, step):
                            <span class="dblue">self</span>.start <span class="igrey">=</span> start
                            <span class="dblue">self</span>.stop <span class="igrey">=</span> stop
                            <span class="dblue">self</span>.step <span class="igrey">=</span> step
                    
                        <span class="lgreen"><strong>def</strong></span> <span class="cblue">__iter__</span>(<span class="dblue">self</span>):
                            x <span class="igrey">=</span> <span class="dblue">self</span>.start
                            <span class="lgreen"><strong>while</strong></span> x <span class="igrey">&lt;</span> <span class="dblue">self</span>.stop:
                                <span class="lgreen"><strong>yield</strong></span> x
                                x <span class="igrey">+=</span> <span class="dblue">self</span>.step
                    
                    <span class="hblue"># Example use:</span>
                    <span epub:type="pagebreak" id="page_98"></span>nums <span class="igrey">=</span> FRange(<span class="sgreen">0.0</span>, <span class="sgreen">1.0</span>, <span class="sgreen">0.1</span>)
                    <span class="lgreen"><strong>for</strong></span> x <span class="lgreen"><strong>in</strong></span> nums:
                        print(x)     <span class="hblue"># 0.0, 0.1, 0.2, 0.3, ...</span></pre>
          <p class="indent">
            This works because generator functions conform to the iteration
            protocol themselves. It’s a bit easier to implement an iterator in
            this way since you only have to worry about the
            <code>__iter__()</code> method. The rest of the iteration machinery
            is already provided by the generator.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch04lev1sec15">4.15 Attribute Protocol</h3>
          <p class="noindent">
            The methods in <a href="ch04.xhtml#ch04tab06">Table 4.6</a> read,
            write, and delete the attributes of an object using the dot
            (<code>.</code>) operator and the <code>del</code> operator,
            respectively.
          </p>
          <figure class="table" id="ch04tab06">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 4.6</span> Methods for Attribute Access
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Method</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>__getattribute__(self, name)</code>
                    </p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Returns the attribute <code>self.name</code>
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__getattr__(self, name)</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Returns the attribute <code>self.name</code> if it’s not
                      found through <code>__getattribute__()</code>
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>__setattr__(self, name, value)</code>
                    </p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Sets the attribute <code>self.name = value</code>
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__delattr__(self, name)</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Deletes the attribute <code>del self.name</code>
                    </p>
                  </td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            Whenever an attribute is accessed, the
            <code>__getattribute__()</code> method is invoked. If the attribute
            is located, its value is returned. Otherwise, the
            <code>__getattr__()</code> method is invoked. The default behavior
            of <code>__getattr__()</code> is to raise an
            <code>AttributeError</code> exception. The
            <code>__setattr__()</code> method is always invoked when setting an
            attribute, and the <code>__delattr__()</code> method is always
            invoked when deleting an attribute.
          </p>
          <p class="indent">
            These methods are fairly blunt—in that they allow a type to
            completely redefine attribute access for all attributes.
            User-defined classes can define properties and descriptors which
            allow for more fine-grained control of attribute access. This is
            discussed further in <a href="ch07.xhtml#ch07">Chapter 7</a>.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch04lev1sec16">4.16 Function Protocol</h3>
          <p class="noindent">
            An object can emulate a function by providing the
            <code>__call__()</code> method. If an object, <code>x</code>,
            provides this method, it can be invoked like a function. That is,
            <code>x(arg1, arg2, ...)</code> invokes
            <code>x.__call__(arg1, arg2, ...)</code>.
          </p>
          <p class="indent">
            There are many built-in types that support function calls. For
            example, types implement <code>__call__()</code> to create new
            instances. Bound methods implement <code>__call__()</code> to pass
            the <code>self</code> argument to instance methods. Library
            functions such as <code>functools.partial()</code> also create
            objects that emulate functions.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch04lev1sec17">
            <span epub:type="pagebreak" id="page_99"></span>4.17 Context Manager
            Protocol
          </h3>
          <p class="noindent">
            The <code>with</code> statement allows a sequence of statements to
            execute under the control of an instance known as a context manager.
            The general syntax is as follows:
          </p>
          <pre><span class="lgreen"><strong>with</strong></span> context [ as var]:
                         statements</pre>
          <p class="indent">
            A context object shown here is expected to implement the methods
            listed in <a href="ch04.xhtml#ch04tab07">Table 4.7</a>.
          </p>
          <figure class="table" id="ch04tab07">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 4.7</span> Methods for Context Managers
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Method</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext"><code>__enter__(self)</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Called when entering a new context. The return value is
                      placed in the variable listed with the
                      <code>as</code> specifier to the
                      <code>with</code> statement.
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext">
                      <code>__exit__(self, type, value, tb)</code>
                    </p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Called when leaving a context. If an exception occurred,
                      <code>type</code>, <code>value</code>, and
                      <code>tb</code> have the exception type, value, and
                      traceback information.
                    </p>
                  </td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            The <code>__enter__()</code> method is invoked when the
            <code>with</code> statement executes. The value returned by this
            method is placed into the variable specified with the optional
            <code>as var</code> specifier. The <code>__exit__()</code> method is
            called as soon as control flow leaves the block of statements
            associated with the <code>with</code> statement. As arguments,
            <code>__exit__()</code> receives the current exception type, value,
            and a traceback if an exception has been raised. If no errors are
            being handled, all three values are set to <code>None</code>. The
            <code>__exit__()</code> method should return <code>True</code> or
            <code>False</code> to indicate if a raised exception was handled or
            not. If <code>True</code> is returned, any pending exception is
            cleared and program execution continues normally with the first
            statement after the <code>with</code> block.
          </p>
          <p class="indent">
            The primary use of the context management interface is to allow for
            simplified resource control on objects involving system state such
            as open files, network connections, and locks. By implementing this
            interface, an object can safely clean up resources when execution
            leaves a context in which an object is being used. Further details
            are found in <a href="ch03.xhtml#ch03">Chapter 3</a>.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch04lev1sec18">
            4.18 Final Words: On Being Pythonic
          </h3>
          <p class="noindent">
            A commonly cited design goal is to write code that is “Pythonic.”
            That can mean many things, but basically it encourages you to follow
            established idioms used by the rest of Python. That means knowing
            Python’s protocols for containers, iterables, resource management,
            and so forth. Many of Python’s most popular frameworks use these
            protocols to provide good user experience. You should strive for
            that as well.
          </p>
          <p class="indent">
            Of the different protocols, three deserve special attention because
            of their widespread use. One is creating a proper object
            representation using the <code>__repr__()</code> method. Python
            <span epub:type="pagebreak" id="page_100"></span>programs are often
            debugged and experimented with at the interactive REPL. It is also
            common to output objects using <code>print()</code> or a logging
            library. If you make it easy to observe the state of your objects,
            it will make all of these things easier.
          </p>
          <p class="indent">
            Second, iterating over data is one of the most common programming
            tasks. If you’re going to do it, you should make your code work with
            Python’s <code>for</code> statement. Many core parts of Python and
            the standard library are designed to work with iterable objects. By
            supporting iteration in the usual way, you’ll automatically get a
            significant amount of extra functionality and your code will be
            intuitive to other programmers.
          </p>
          <p class="indent">
            Finally, use context managers and the <code>with</code> statement
            for the common programming pattern where statements get sandwiched
            between some kind of startup and teardown steps—for example, opening
            and closing resources, acquiring and releasing locks, subscribing
            and unsubscribing, and so on.
          </p>
        </section>
      </section>
    </div>
    <div id="sbo-rt-content">
      <section epub:type="chapter">
        <h2 class="h2" id="ch05">
          <span epub:type="pagebreak" id="page_101"></span
          ><span class="ash">5.</span> Functions
        </h2>
        <p class="noindent">
          Functions are a fundamental building block of most Python programs.
          This chapter describes function definitions, function application,
          scoping rules, closures, decorators, and other functional programming
          features. Particular attention is given to different programming
          idioms, evaluation models, and patterns associated with functions.
        </p>
        <section>
          <h3 class="h3" id="ch05lev1sec1">5.1 Function Definitions</h3>
          <p class="noindent">
            Functions are defined with the <code>def</code> statement:
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> add(x, y):
                            <span class="lgreen"><strong>return</strong></span> x <span class="igrey">+</span> y</pre>
          <p class="indent">
            The first part of a function definition specifies the function name
            and parameter names that represent input values. The body of a
            function is a sequence of statements that execute when the function
            is called or applied. You apply a function to arguments by writing
            the function name followed by the arguments enclosed in parentheses:
            <code>a = add(3, 4)</code>. Arguments are fully evaluated
            left-to-right before executing the function body. For example,
            <code>add(1+1, 2+2)</code> is first reduced to
            <code>add(2, 4)</code> before calling the function. This is known as
            <em>applicative evaluation order</em>. The order and number of
            arguments must match the parameters given in the function
            definition. If a mismatch exists, a <code>TypeError</code> exception
            is raised. The structure of calling a function (such as the number
            of required arguments) is known as the function’s call signature.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch05lev1sec2">5.2 Default Arguments</h3>
          <p class="noindent">
            You can attach default values to function parameters by assigning
            values in the function definition. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0101-02" id="f0101-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> split(line, delimiter<span class="igrey">=</span><span class="mblue">','</span>):
                            statements</pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_102"></span>When a function
            defines a parameter with a default value, that parameter and all the
            parameters that follow it are optional. It is not possible to
            specify a parameter with no default value after any parameter with a
            default value.
          </p>
          <p class="indent">
            Default parameter values are evaluated once when the function is
            first defined, not each time the function is called. This often
            leads to surprising behavior if mutable objects are used as a
            default:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0102-01" id="f0102-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> func(x, items<span class="igrey">=</span>[]):
                            items.append(x)
                            <span class="lgreen"><strong>return</strong></span> items
                        
                        func(<span class="sgreen">1</span>)       <span class="hblue"># returns [1]</span>
                        func(<span class="sgreen">2</span>)       <span class="hblue"># returns [1, 2]</span>
                        func(<span class="sgreen">3</span>)       <span class="hblue"># returns [1, 2, 3]</span></pre>
          <p class="indent">
            Notice how the default argument retains the modifications made from
            previous invocations. To prevent this, it is better to use
            <code>None</code> and add a check as follows:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0102-02" id="f0102-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> func(x, items<span class="igrey">=</span><span class="dblue">None</span>):
                             <span class="lgreen"><strong>if</strong></span> items <span class="lgreen"><strong>is</strong></span> <span class="dblue">None</span>:
                                 items <span class="igrey">=</span> []
                             items.append(x)
                             <span class="lgreen"><strong>return</strong></span> items</pre>
          <p class="indent">
            As a general practice, to avoid such surprises, only use immutable
            objects for default argument values—numbers, strings, Booleans,
            <code>None</code>, and so on.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch05lev1sec3">5.3 Variadic Arguments</h3>
          <p class="noindent">
            A function can accept a variable number of arguments if an asterisk
            (<code>*</code>) is used as a prefix on the last parameter name. For
            example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0102-03" id="f0102-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> product(first, <span class="igrey">*</span>args):
                            result <span class="igrey">=</span> first
                            <span class="lgreen"><strong>for</strong></span> x <span class="lgreen"><strong>in</strong></span> args:
                                result <span class="igrey">=</span> result <span class="igrey">*</span> x
                            <span class="lgreen"><strong>return</strong></span> result
                        
                        product(<span class="sgreen">10</span>, <span class="sgreen">20</span>)       <span class="hblue"># -&gt; 200</span>
                        product(<span class="sgreen">2</span>, <span class="sgreen">3</span>, <span class="sgreen">4</span>, <span class="sgreen">5</span>)   <span class="hblue"># -&gt; 120</span></pre>
          <p class="indent">
            In this case, all of the extra arguments are placed into the
            <code>args</code> variable as a tuple. You can then work with the
            arguments using the standard sequence operations—iteration, slicing,
            unpacking, and so on.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch05lev1sec4">
            <span epub:type="pagebreak" id="page_103"></span>5.4 Keyword
            Arguments
          </h3>
          <p class="noindent">
            Function arguments can be supplied by explicitly naming each
            parameter and specifying a value. These are known as keyword
            arguments. Here is an example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0103-01" id="f0103-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> func(w, x, y, z):
                            statements
                        
                        <span class="hblue"># Keyword argument invocation</span>
                        func(x<span class="igrey">=</span><span class="sgreen">3</span>, y<span class="igrey">=</span><span class="sgreen">22</span>, w<span class="igrey">=</span><span class="mblue">'hello'</span>, z<span class="igrey">=</span>[<span class="sgreen">1</span>, <span class="sgreen">2</span>])</pre>
          <p class="indent">
            With keyword arguments, the order of the arguments doesn’t matter as
            long as each required parameter gets a single value. If you omit any
            of the required arguments or if the name of a keyword doesn’t match
            any of the parameter names in the function definition, a
            <code>TypeError</code> exception is raised. Keyword arguments are
            evaluated in the same order as they are specified in the function
            call.
          </p>
          <p class="indent">
            Positional arguments and keyword arguments can appear in the same
            function call, provided that all the positional arguments appear
            first, values are provided for all nonoptional arguments, and no
            argument receives more than one value. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0103-02" id="f0103-02"
              >Click here to view code image</a
            >
          </p>
          <pre>func(<span class="mblue">'hello'</span>, <span class="sgreen">3</span>, z<span class="igrey">=</span>[<span class="sgreen">1</span>, <span class="sgreen">2</span>], y<span class="igrey">=</span><span class="sgreen">22</span>)
                        func(<span class="sgreen">3</span>, <span class="sgreen">22</span>, w<span class="igrey">=</span><span class="mblue">'hello'</span>, z<span class="igrey">=</span>[<span class="sgreen">1</span>, <span class="sgreen">2</span>])    <span class="hblue"># TypeError. Multiple values for w</span></pre>
          <p class="indent">
            If desired, it is possible to force the use of keyword arguments.
            This is done by listing parameters after a <code>*</code> argument
            or just by including a single <code>*</code> in the definition. For
            example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0103-03" id="f0103-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> read_data(filename, <span class="igrey">*</span>, debug<span class="igrey">=</span><span class="dblue">False</span>):
                            ...
                        
                        <span class="lgreen"><strong>def</strong></span> product(first, <span class="igrey">*</span>values, scale<span class="igrey">=</span><span class="sgreen">1</span>):
                            result <span class="igrey">=</span> first <span class="igrey">*</span> scale
                            <span class="lgreen"><strong>for</strong></span> val <span class="lgreen"><strong>in</strong></span> values:
                                result <span class="igrey">=</span> result <span class="igrey">*</span> val
                            <span class="lgreen"><strong>return</strong></span> result</pre>
          <p class="indent">
            In this example, the <code>debug</code> argument to
            <code>read_data()</code> can only be specified by keyword. This
            restriction often improves code readability:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0103-04" id="f0103-04"
              >Click here to view code image</a
            >
          </p>
          <pre>data <span class="igrey">=</span> read_data(<span class="mblue">'Data.csv'</span>, <span class="dblue">True</span>)        <span class="hblue"># NO. TypeError</span>
                        data <span class="igrey">=</span> read_data(<span class="mblue">'Data.csv'</span>, debug<span class="igrey">=</span><span class="dblue">True</span>)  <span class="hblue"># Yes.</span></pre>
          <p class="indent">
            The <code>product()</code> function takes any number of positional
            arguments and an optional keyword-only argument. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0103-05" id="f0103-05"
              >Click here to view code image</a
            >
          </p>
          <pre>result <span class="igrey">=</span> product(<span class="sgreen">2</span>,<span class="sgreen">3</span>,<span class="sgreen">4</span>)             <span class="hblue"># Result = 24</span>
                        result <span class="igrey">=</span> product(<span class="sgreen">2</span>,<span class="sgreen">3</span>,<span class="sgreen">4</span>, scale<span class="igrey">=</span><span class="sgreen">10</span>)   <span class="hblue"># Result = 240</span></pre>
        </section>
        <section>
          <h3 class="h3" id="ch05lev1sec5">
            <span epub:type="pagebreak" id="page_104"></span>5.5 Variadic
            Keyword Arguments
          </h3>
          <p class="noindent">
            If the last argument of a function definition is prefixed with
            <code>**</code>, all the additional keyword arguments (those that
            don’t match any of the other parameter names) are placed in a
            dictionary and passed to the function. The order of items in this
            dictionary is guaranteed to match the order in which keyword
            arguments were provided.
          </p>
          <p class="indent">
            Arbitrary keyword arguments might be useful for defining functions
            that accept a large number of potentially open-ended configuration
            options that would be too unwieldy to list as parameters. Here’s an
            example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0104-01" id="f0104-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> make_table(data, <span class="igrey">**</span>parms):
                            <span class="hblue"># Get configuration parameters from parms (a dict)</span>
                            fgcolor <span class="igrey">=</span> parms.pop(<span class="mblue">'fgcolor'</span>, <span class="mblue">'black'</span>)
                            bgcolor <span class="igrey">=</span> parms.pop(<span class="mblue">'bgcolor'</span>, <span class="mblue">'white'</span>)
                            width <span class="igrey">=</span> parms.pop(<span class="mblue">'width'</span>, <span class="dblue">None</span>)
                            ...
                            <span class="hblue"># No more options</span>
                            <span class="lgreen"><strong>if</strong></span> parms:
                                 <span class="lgreen"><strong>raise</strong></span> <span class="pgold">TypeError</span>(<span class="trose">f'Unsupported configuration options</span> <span class="mblue">{</span>list(parms)<span class="mblue">}</span><span class="trose">'</span>)
                        
                        make_table(items, fgcolor<span class="igrey">=</span><span class="mblue">'black'</span>, bgcolor<span class="igrey">=</span><span class="mblue">'white'</span>, border<span class="igrey">=</span><span class="sgreen">1</span>,
                                          borderstyle<span class="igrey">=</span><span class="mblue">'grooved'</span>, cellpadding<span class="igrey">=</span><span class="sgreen">10</span>,
                                          width<span class="igrey">=</span><span class="sgreen">400</span>)</pre>
          <p class="indent">
            The <code>pop()</code> method of a dictionary removes an item from a
            dictionary, returning a possible default value if it’s not defined.
            The <code>parms.pop('fgcolor', 'black')</code> expression used in
            this code mimics the behavior of a keyword argument specified with a
            default value.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch05lev1sec6">
            5.6 Functions Accepting All Inputs
          </h3>
          <p class="noindent">
            By using both <code>*</code> and <code>**</code>, you can write a
            function that accepts any combination of arguments. The positional
            arguments are passed as a tuple and the keyword arguments are passed
            as a dictionary. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0104-02" id="f0104-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># Accept variable number of positional or keyword arguments</span>
                        <span class="lgreen"><strong>def</strong></span> func(<span class="igrey">*</span>args, <span class="igrey">**</span>kwargs):
                            <span class="hblue"># args is a tuple of positional args</span>
                            <span class="hblue"># kwargs is dictionary of keyword args</span>
                            ...</pre>
          <p class="indent">
            This combined use of <code>*args</code> and <code>**kwargs</code> is
            commonly used to write wrappers, decorators, proxies, and similar
            functions. For example, suppose you have a function to parse lines
            of text taken from an iterable:<span
              epub:type="pagebreak"
              id="page_105"
            ></span>
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0105-01" id="f0105-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> parse_lines(lines, separator<span class="igrey">=</span><span class="mblue">','</span>, types<span class="igrey">=</span>(), debug<span class="igrey">=</span><span class="dblue">False</span>):
                            <span class="lgreen"><strong>for</strong></span> line <span class="lgreen"><strong>in</strong></span> lines:
                                ...
                                statements
                                ...</pre>
          <p class="indent">
            Now, suppose you want to make a special-case function that parses
            data from a file specified by filename instead. To do that, you
            could write:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0105-02" id="f0105-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> parse_file(filename, <span class="igrey">*</span>args, <span class="igrey">**</span>kwargs):
                            <span class="lgreen"><strong>with</strong></span> open(filename, <span class="mblue">'rt'</span>) as file:
                                <span class="lgreen"><strong>return</strong></span> parse_lines(file, <span class="igrey">*</span>args, <span class="igrey">**</span>kwargs)</pre>
          <p class="indent">
            The benefit of this approach is that the
            <code>parse_file()</code> function doesn’t need to know anything
            about the arguments of <code>parse_lines()</code>. It accepts any
            extra arguments the caller provides and passes them along. This also
            simplifies the maintenance of the
            <code>parse_file()</code> function. For example, if new arguments
            are added to <code>parse_lines()</code>, those arguments will
            magically work with the <code>parse_file()</code> function too.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch05lev1sec7">5.7 Positional-Only Arguments</h3>
          <p class="noindent">
            Many of Python’s built-in functions only accept arguments by
            position. You’ll see this indicated by the presence of a slash
            (<code>/</code>) in the calling signature of a function shown by
            various help utilities and IDEs. For example, you might see
            something like <code>func(x, y, /)</code>. This means that all
            arguments appearing before the slash can only be specified by
            position. Thus, you could call the function as
            <code>func(2, 3)</code> but not as <code>func(x=2, y=3)</code>. For
            completeness, this syntax may also be used when defining functions.
            For example, you can write the following:
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> func(x, y, <span class="igrey">/</span>):
                            <span class="lgreen"><strong>pass</strong></span>
                        
                        func(<span class="sgreen">1</span>, <span class="sgreen">2</span>)     <span class="hblue"># Ok</span>
                        func(<span class="sgreen">1</span>, y<span class="igrey">=</span><span class="sgreen">2</span>)   <span class="hblue"># Error</span></pre>
          <p class="indent">
            This definition form is rarely found in code since it was first
            supported only in Python 3.8. However, it can be a useful way to
            avoid potential name clashes between argument names. For example,
            consider the following code:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0105-04" id="f0105-04"
              >Click here to view code image</a
            >
          </p>
          <pre>import time
                        
                        <span class="lgreen"><strong>def</strong></span> after(seconds, func, <span class="igrey">/</span>, <span class="igrey">*</span>args, <span class="igrey">**</span>kwargs):
                            time.sleep(seconds)
                            <span class="lgreen"><strong>return</strong></span> func(<span class="igrey">*</span>args, <span class="igrey">**</span>kwargs)
                        
                        <span epub:type="pagebreak" id="page_106"></span><span class="lgreen"><strong>def</strong></span> duration(<span class="igrey">*</span>, seconds, minutes, hours):
                            <span class="lgreen"><strong>return</strong></span> seconds <span class="igrey">+</span> <span class="sgreen">60</span> <span class="igrey">*</span> minutes <span class="igrey">+</span> <span class="sgreen">3600</span> <span class="igrey">*</span> hours
                        
                        after(<span class="sgreen">5</span>, duration, seconds<span class="igrey">=</span><span class="sgreen">20</span>, minutes<span class="igrey">=</span><span class="sgreen">3</span>, hours<span class="igrey">=</span><span class="sgreen">2</span>)</pre>
          <p class="indent">
            In this code, <code>seconds</code> is being passed as a keyword
            argument, but it’s intended to be used with the
            <code>duration</code> function that’s passed to
            <code>after()</code>. The use of positional-only arguments in
            <code>after()</code> prevents a name clash with the
            <code>seconds</code> argument that appears first.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch05lev1sec8">
            5.8 Names, Documentation Strings, and Type Hints
          </h3>
          <p class="noindent">
            The standard naming convention for functions is to use lowercase
            letters with an underscore ( <code>_</code> ) used as a word
            separator—for example, <code>read_data()</code> and not
            <code>readData()</code>. If a function is not meant to be used
            directly because it’s a helper or some kind of internal
            implementation detail, its name usually has a single underscore
            prepended to it—for example, <code>_helper()</code>. These are only
            conventions, however. You are free to name a function whatever you
            want as long as the name is a valid identifier.
          </p>
          <p class="indent">
            The name of a function can be obtained via the
            <code>__name__</code> attribute. This is sometimes useful for
            debugging.
          </p>
          <pre>
&gt;&gt;&gt; def square(x):
                        ...    return x * x
                        ...
                        &gt;&gt;&gt; square.__name__
                        'square'
                        &gt;&gt;&gt;</pre
          >
          <p class="indent">
            It is common for the first statement of a function to be a
            documentation string describing its usage. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0106-03" id="f0106-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> factorial(n):
                            <span class="hblue">'''</span>
                            <span class="hblue">Computes n factorial. For example:</span>
                        
                            <span class="hblue">&gt;&gt;&gt; factorial(6)</span>
                            <span class="hblue">120</span>
                            <span class="hblue">&gt;&gt;&gt;</span>
                            <span class="hblue">'''</span>
                            <span class="lgreen"><strong>if</strong></span> n <span class="igrey">&lt;=</span> <span class="sgreen">1</span>:
                                <span class="lgreen"><strong>return</strong></span> <span class="sgreen">1</span>
                            <span class="lgreen"><strong>else</strong></span>:
                                <span class="lgreen"><strong>return</strong></span> n<span class="igrey">*</span>factorial(n<span class="igrey">-</span><span class="sgreen">1</span>)</pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_107"></span>The documentation
            string is stored in the <code>__doc__</code> attribute of the
            function. It’s often accessed by IDEs to provide interactive help.
          </p>
          <p class="indent">
            Functions can also be annotated with type hints. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0107-01" id="f0107-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> factorial(n: int) <span class="igrey">-&gt;</span> int:
                            <span class="lgreen"><strong>if</strong></span> n <span class="igrey">&lt;=</span> <span class="sgreen">1</span>:
                                <span class="lgreen"><strong>return</strong></span> <span class="sgreen">1</span>
                            <span class="lgreen"><strong>else</strong></span>:
                                <span class="lgreen"><strong>return</strong></span> n <span class="igrey">*</span> factorial(n <span class="igrey">-</span> <span class="sgreen">1</span>)</pre>
          <p class="indent">
            The type hints don’t change anything about how the function
            evaluates. That is, the presence of hints provides no performance
            benefits or extra runtime error checking. The hints are merely
            stored in the <code>__annotations__</code> attribute of the function
            which is a dictionary mapping argument names to the supplied hints.
            Third-party tools such as IDEs and code checkers might use the hints
            for various purposes.
          </p>
          <p class="indent">
            Sometimes you will see type hints attached to local variables within
            a function. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0107-02" id="f0107-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> factorial(n:int) <span class="igrey">-&gt;</span> int:
                            result: int <span class="igrey">=</span> <span class="sgreen">1</span>        <span class="hblue"># Type hinted local variable</span>
                            <span class="lgreen"><strong>while</strong></span> n <span class="igrey">&gt;</span> <span class="sgreen">1</span>:
                                result <span class="igrey">*=</span> n
                                n <span class="igrey">-=</span> <span class="sgreen">1</span>
                            <span class="lgreen"><strong>return</strong></span> result</pre>
          <p class="indent">
            Such hints are completely ignored by the interpreter. They’re not
            checked, stored, or even evaluated. Again, the purpose of the hints
            is to help third-party code-checking tools. Adding type hints to
            functions is not advised unless you are actively using code-checking
            tools that make use of them. It is easy to specify type hints
            incorrectly—and, unless you’re using a tool that checks them, errors
            will go undiscovered until someone else decides to run a
            type-checking tool on your code.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch05lev1sec9">
            5.9 Function Application and Parameter Passing
          </h3>
          <p class="noindent">
            When a function is called, the function parameters are local names
            that get bound to the passed input objects. Python passes the
            supplied objects to the function “as is” without any extra copying.
            Care is required if mutable objects, such as lists or dictionaries,
            are passed. If changes are made, those changes are reflected in the
            original object. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0107-03" id="f0107-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> square(items):
                            <span class="lgreen"><strong>for</strong></span> i, x <span class="lgreen"><strong>in</strong></span> enumerate(items):
                                items[i] <span class="igrey">=</span> x <span class="igrey">*</span> x    <span class="hblue"># Modify items in-place</span>
                        <span epub:type="pagebreak" id="page_108"></span>a <span class="igrey">=</span> [<span class="sgreen">1</span>, <span class="sgreen">2</span>, <span class="sgreen">3</span>, <span class="sgreen">4</span>, <span class="sgreen">5</span>]
                        square(a)         <span class="hblue"># Changes a to [1, 4, 9, 16, 25]</span></pre>
          <p class="indent">
            Functions that mutate their input values, or change the state of
            other parts of the program behind the scenes, are said to have “side
            effects.” As a general rule, side effects are best avoided. They can
            become a source of subtle programming errors as programs grow in
            size and complexity—it may not be obvious from reading a function
            call if a function has side effects or not. Such functions also
            interact poorly with programs involving threads and concurrency
            since side effects typically need to be protected by locks.
          </p>
          <p class="indent">
            It’s important to make a distinction between modifying an object and
            reassigning a variable name. Consider this function:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0108-02" id="f0108-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> sum_squares(items):
                            items <span class="igrey">=</span> [x<span class="igrey">*</span>x <span class="lgreen"><strong>for</strong></span> x <span class="lgreen"><strong>in</strong></span> items]    <span class="hblue"># Reassign "items" name</span>
                            <span class="lgreen"><strong>return</strong></span> sum(items)
                        
                        a <span class="igrey">=</span> [<span class="sgreen">1</span>, <span class="sgreen">2</span>, <span class="sgreen">3</span>, <span class="sgreen">4</span>, <span class="sgreen">5</span>]
                        result <span class="igrey">=</span> sum_squares(a)
                        print(a)        <span class="hblue"># [1, 2, 3, 4, 5]    (Unchanged)</span></pre>
          <p class="indent">
            In this example, it appears as if the
            <code>sum_squares()</code> function might be overwriting the passed
            <code>items</code> variable. Yes, the local <code>items</code> label
            is reassigned to a new value. But the original input value
            (<code>a</code>) is not changed by that operation. Instead, the
            local variable name <code>items</code> is bound to a completely
            different object—the result of the internal list comprehension.
            There is a difference between assigning a variable name and
            modifying an object. When you assign a value to a name, you’re not
            overwriting the object that was already there—you’re just
            reassigning the name to a different object.
          </p>
          <p class="indent">
            Stylistically, it is common for functions with side effects to
            return <code>None</code> as a result. As an example, consider the
            <code>sort()</code> method of a list:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0108-03" id="f0108-03"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; items = [10, 3, 2, 9, 5]
                        &gt;&gt;&gt; items.sort()      # Observe: no return value
                        &gt;&gt;&gt; items
                        [2, 3, 5, 9, 10]
                        &gt;&gt;&gt;</pre
          >
          <p class="indent">
            The <code>sort()</code> method performs an in-place sort of list
            items. It returns no result. The lack of a result is a strong
            indicator of a side effect—in this case, the elements of the list
            got rearranged.
          </p>
          <p class="indent">
            Sometimes you already have data in a sequence or a mapping that
            you’d like to pass to a function. To do this, you can use
            <code>*</code> and <code>**</code> in function invocations. For
            example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0108-04" id="f0108-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> func(x, y, z):
                            ...
                        
                        s <span class="igrey">=</span> (<span class="sgreen">1</span>, <span class="sgreen">2</span>, <span class="sgreen">3</span>)
                        <span epub:type="pagebreak" id="page_109"></span><span class="hblue"># Pass a sequence as arguments</span>
                        result <span class="igrey">=</span> func(<span class="igrey">*</span>s)
                        
                        <span class="hblue"># Pass a mapping as keyword arguments</span>
                        d <span class="igrey">=</span> { <span class="mblue">'x'</span>:<span class="sgreen">1</span>, <span class="mblue">'y'</span>:<span class="sgreen">2</span>, <span class="mblue">'z'</span>:<span class="sgreen">3</span> }
                        result <span class="igrey">=</span> func(<span class="igrey">**</span>d)</pre>
          <p class="indent">
            You may be taking data from multiple sources or even supplying some
            of the arguments explicitly, and it will all work as long as the
            function gets all of its required arguments, there is no
            duplication, and everything in its calling signature aligns
            properly. You can even use <code>*</code> and <code>**</code> more
            than once in the same function call. If you’re missing an argument
            or specify duplicate values for an argument, you’ll get an error.
            Python will never let you call a function with arguments that don’t
            satisfy its signature.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch05lev1sec10">5.10 Return Values</h3>
          <p class="noindent">
            The <code>return</code> statement returns a value from a function.
            If no value is specified or you omit the return statement,
            <code>None</code> is returned. To return multiple values, place them
            in a tuple:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0109-02" id="f0109-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> parse_value(text):
                            <span class="hblue">'''</span>
                            <span class="hblue">Split text of the form name=val into (name, val)</span>
                            <span class="hblue">'''</span>
                            parts <span class="igrey">=</span> text.split(<span class="mblue">'='</span>, <span class="sgreen">1</span>)
                            <span class="lgreen"><strong>return</strong></span> (parts[<span class="sgreen">0</span>].strip(), parts[<span class="sgreen">1</span>].strip())</pre>
          <p class="indent">
            Values returned in a tuple can be unpacked to individual variables:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0109-03" id="f0109-03"
              >Click here to view code image</a
            >
          </p>
          <pre>name, value <span class="igrey">=</span> parse_value(<span class="mblue">'url=http://www.python.org'</span>)</pre>
          <p class="indent">
            Sometimes named tuples are used as an alternative:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0109-04" id="f0109-04"
              >Click here to view code image</a
            >
          </p>
          <pre>from typing import NamedTuple
                        
                        <span class="lgreen"><strong>class</strong></span> ParseResult(NamedTuple):
                            name: str
                            value: str
                        
                        <span class="lgreen"><strong>def</strong></span> parse_value(text):
                            <span class="hblue">'''</span>
                            <span class="hblue">Split text of the form name=val into (name, val)</span>
                            <span class="hblue">'''</span>
                            parts <span class="igrey">=</span> text.split(<span class="mblue">'='</span>, <span class="sgreen">1</span>)
                            <span class="lgreen"><strong>return</strong></span> ParseResult(parts[<span class="sgreen">0</span>].strip(), parts[<span class="sgreen">1</span>].strip())</pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_110"></span>A named tuple works
            the same way as a normal tuple (you can perform all the same
            operations and unpacking), but you can also reference the returned
            values using named attributes:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0110-01" id="f0110-01"
              >Click here to view code image</a
            >
          </p>
          <pre>r <span class="igrey">=</span> parse_value(<span class="mblue">'url=http://www.python.org'</span>)
                        print(r.name, r.value)</pre>
        </section>
        <section>
          <h3 class="h3" id="ch05lev1sec11">5.11 Error Handling</h3>
          <p class="noindent">
            One problem with the <code>parse_value()</code> function in the
            previous section is error handling. What course of action should be
            taken if the input text is malformed and no correct result can be
            returned?
          </p>
          <p class="indent">
            One approach is to treat the result as optional—that is, the
            function either works by returning an answer or returns
            <code>None</code> which is commonly used to indicate a missing
            value. For example, the function could be modified like this:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0110-02" id="f0110-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> parse_value(text):
                            parts <span class="igrey">=</span> text.split(<span class="mblue">'='</span>, <span class="sgreen">1</span>)
                            <span class="lgreen"><strong>if</strong></span> len(parts) <span class="igrey">==</span> <span class="sgreen">2</span>:
                                <span class="lgreen"><strong>return</strong></span> ParseResult(parts[<span class="sgreen">0</span>].strip(), parts[<span class="sgreen">1</span>].strip())
                            <span class="lgreen"><strong>else</strong></span>:
                                <span class="lgreen"><strong>return</strong></span> <span class="dblue">None</span></pre>
          <p class="indent">
            With this design, the burden of checking for the optional result is
            placed on the caller:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0110-03" id="f0110-03"
              >Click here to view code image</a
            >
          </p>
          <pre>result <span class="igrey">=</span> parse_value(text)
                        <span class="lgreen"><strong>if</strong></span> result:
                            name, value <span class="igrey">=</span> result</pre>
          <p class="indent">Or, in Python 3.8+, more compactly as follows:</p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0110-03a" id="f0110-03a"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>if</strong></span> result :<span class="igrey">=</span> parse_value(text):
                            name, value <span class="igrey">=</span> result</pre>
          <p class="indent">
            Instead of returning <code>None</code>, you could treat malformed
            text as an error by raising an exception. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0110-04" id="f0110-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> parse_value(text):
                            parts <span class="igrey">=</span> text.split(<span class="mblue">'='</span>, <span class="sgreen">1</span>)
                            <span class="lgreen"><strong>if</strong></span> len(parts) <span class="igrey">==</span> <span class="sgreen">2</span>:
                                <span class="lgreen"><strong>return</strong></span> ParseResult(parts[<span class="sgreen">0</span>].strip(), parts[<span class="sgreen">1</span>].strip())
                            <span class="lgreen"><strong>else</strong></span>:
                                <span class="lgreen"><strong>raise</strong></span> <span class="pgold">ValueError</span>(<span class="mblue">'Bad value'</span>)</pre>
          <p class="indent">
            In this case, the caller is given the option of handling bad values
            with <code>try-except</code>. For example:<span
              epub:type="pagebreak"
              id="page_111"
            ></span>
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0111-01" id="f0111-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>try</strong></span>:
                            name, value <span class="igrey">=</span> parse_value(text)
                            ...
                        <span class="lgreen"><strong>except</strong></span> <span class="pgold">ValueError</span>:
                            ...</pre>
          <p class="indent">
            The choice of whether or not to use an exception is not always
            clear-cut. As a general rule, exceptions are the more common way to
            handle an abnormal result. However, exceptions are also expensive if
            they frequently occur. If you’re writing code where performance
            matters, returning <code>None</code>, <code>False</code>,
            <code>-1</code>, or some other special value to indicate failure
            might be better.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch05lev1sec12">5.12 Scoping Rules</h3>
          <p class="noindent">
            Each time a function executes, a local namespace is created. This
            namespace is an environment that contains the names and values of
            the function parameters as well as all variables that are assigned
            inside the function body. The binding of names is known in advance
            when a function is defined and all names assigned within the
            function body are bound to the local environment. All other names
            that are used but not assigned in the function body (the free
            variables) are dynamically found in the global namespace which is
            always the enclosing module where a function was defined.
          </p>
          <p class="indent">
            There are two types of name-related errors that can occur during
            function execution. Looking up an undefined name of a free variable
            in the global environment results in a
            <code>NameError</code> exception. Looking up a local variable that
            hasn’t been assigned a value yet results in an
            <code>UnboundLocalError</code> exception. This latter error is often
            a result of control flow bugs. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0111-02" id="f0111-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> func(x):
                            <span class="lgreen"><strong>if</strong></span> x <span class="igrey">&gt;</span> <span class="sgreen">0</span>:
                                y <span class="igrey">=</span> <span class="sgreen">42</span>
                            <span class="lgreen"><strong>return</strong></span> x <span class="igrey">+</span> y    <span class="hblue"># y not assigned if conditional is false</span>
                        
                        func(<span class="sgreen">10</span>)    <span class="hblue"># Returns 52</span>
                        func(<span class="igrey">-</span><span class="sgreen">10</span>)   <span class="hblue"># UnboundLocalError:   y referenced before assignment</span></pre>
          <p class="indent">
            <code>UnboundLocalError</code> is also sometimes caused by a
            careless use of in-place assignment operators. A statement such as
            <code>n += 1</code> is handled as <code>n = n + 1</code>. If used
            before <code>n</code> is assigned an initial value, it will fail.
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0111-03" id="f0111-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> func():
                            n <span class="igrey">+=</span> <span class="sgreen">1</span>    <span class="hblue"># Error: UnboundLocalError</span></pre>
          <p class="indent">
            It’s important to emphasize that variable names never change their
            scope—they are either global variables or local variables, and this
            is determined at function definition time. Here is an example that
            illustrates this:<span epub:type="pagebreak" id="page_112"></span>
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0112-01" id="f0112-01"
              >Click here to view code image</a
            >
          </p>
          <pre>x <span class="igrey">=</span> <span class="sgreen">42</span>
                        <span class="lgreen"><strong>def</strong></span> func():
                            print(x)    <span class="hblue"># Fails. UnboundLocalError</span>
                            x <span class="igrey">=</span> <span class="sgreen">13</span>
                        
                        func()</pre>
          <p class="indent">
            In this example, it might look as though the
            <code>print()</code> function would output the value of the global
            variable <code>x</code>. However, the assignment of
            <code>x</code> that appears later marks <code>x</code> as a local
            variable. The error is a result of accessing a local variable that
            hasn’t yet been assigned a value.
          </p>
          <p class="indent">
            If you remove the <code>print()</code> function, you get code that
            looks like it might be reassigning the value of a global variable.
            For example, consider this:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0112-02" id="f0112-02"
              >Click here to view code image</a
            >
          </p>
          <pre>x <span class="igrey">=</span> <span class="sgreen">42</span>
                        <span class="lgreen"><strong>def</strong></span> func():
                            x <span class="igrey">=</span> <span class="sgreen">13</span>
                        func()
                        <span class="hblue"># x is still 42</span></pre>
          <p class="indent">
            When this code executes, <code>x</code> retains its value of
            <code>42</code>, despite the appearance that it might be modifying
            the global variable <code>x</code> from inside the function
            <code>func</code>. When variables are assigned inside a function,
            they’re always bound as local variables; as a result, the variable
            <code>x</code> in the function body refers to an entirely new object
            containing the value <code>13</code>, not the outer variable. To
            alter this behavior, use the <code>global</code> statement.
            <code>global</code> declares names as belonging to the global
            namespace, and it’s necessary when a global variable needs to be
            modified. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0112-03" id="f0112-03"
              >Click here to view code image</a
            >
          </p>
          <pre>x <span class="igrey">=</span> <span class="sgreen">42</span>
                        y <span class="igrey">=</span> <span class="sgreen">37</span>
                        <span class="lgreen"><strong>def</strong></span> func():
                            <span class="lgreen"><strong>global</strong></span> x        <span class="hblue"># 'x' is in global namespace</span>
                            x <span class="igrey">=</span> <span class="sgreen">13</span>
                            y <span class="igrey">=</span> <span class="sgreen">0</span>
                        func()
                        <span class="hblue"># x is now 13. y is still 37.</span></pre>
          <p class="indent">
            It should be noted that use of the <code>global</code> statement is
            usually considered poor Python style. If you’re writing code where a
            function needs to mutate state behind the scenes, consider using a
            class definition and modify state by mutating an instance or class
            variable instead. For example:
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Config:
                            x <span class="igrey">=</span> <span class="sgreen">42</span>
                        
                        <span class="lgreen"><strong>def</strong></span> func():
                            Config.x <span class="igrey">=</span> <span class="sgreen">13</span></pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_113"></span>Python allows
            nested function definitions. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0113-01" id="f0113-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> countdown(start):
                            n <span class="igrey">=</span> start
                        
                            <span class="lgreen"><strong>def</strong></span> display():        <span class="hblue"># Nested function definition</span>
                                print(<span class="mblue">'T-minus'</span>, n)
                            <span class="lgreen"><strong>while</strong></span> n <span class="igrey">&gt;</span> <span class="sgreen">0</span>:
                                display()
                                n <span class="igrey">-=</span> <span class="sgreen">1</span></pre>
          <p class="indent">
            Variables in nested functions are bound using lexical scoping. That
            is, names are resolved first in the local scope and then in
            successive enclosing scopes from the innermost scope to the
            outermost scope. Again, this is not a dynamic process—the binding of
            names is determined once at function definition time based on
            syntax. As with global variables, inner functions can’t reassign the
            value of a local variable defined in an outer function. For example,
            this code does not work:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0113-02" id="f0113-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> countdown(start):
                            n <span class="igrey">=</span> start
                            <span class="lgreen"><strong>def</strong></span> display():
                                print(<span class="mblue">'T-minus'</span>, n)
                            <span class="lgreen"><strong>def</strong></span> decrement():
                                n <span class="igrey">-=</span> <span class="sgreen">1</span>            <span class="hblue"># Fails: UnboundLocalError</span>
                            <span class="lgreen"><strong>while</strong></span> n <span class="igrey">&gt;</span> <span class="sgreen">0</span>:
                                 display()
                                 decrement()</pre>
          <p class="indent">
            To fix this, you can declare <code>n</code> as
            <code>nonlocal</code> like this:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0113-03" id="f0113-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> countdown(start):
                            n <span class="igrey">=</span> start
                            <span class="lgreen"><strong>def</strong></span> display():
                                print(<span class="mblue">'T-minus'</span>, n)
                            <span class="lgreen"><strong>def</strong></span> decrement():
                                <span class="lgreen"><strong>nonlocal</strong></span> n
                                n <span class="igrey">-=</span> <span class="sgreen">1</span>        <span class="hblue"># Modifies the outer n</span>
                            <span class="lgreen"><strong>while</strong></span> n <span class="igrey">&gt;</span> <span class="sgreen">0</span>:
                                 display()
                                 decrement()</pre>
          <p class="indent">
            <code>nonlocal</code> cannot be used to refer to a global
            variable—it must reference a local variable in an outer scope. Thus,
            if a function is assigning to a global, you should still use the
            <code>global</code> declaration as previously described.
          </p>
          <p class="indent">
            Use of nested functions and <code>nonlocal</code> declarations is
            not a common programming style. For example, inner functions have no
            outside visibility, which can complicate testing and debugging.
            Nevertheless, nested functions are sometimes useful for breaking
            complex calculations into smaller parts and hiding internal
            implementation details.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch05lev1sec13">
            <span epub:type="pagebreak" id="page_114"></span>5.13 Recursion
          </h3>
          <p class="noindent">
            Python supports recursive functions. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0114-01" id="f0114-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> sumn(n):
                            <span class="lgreen"><strong>if</strong></span> n <span class="igrey">==</span> <span class="sgreen">0</span>:
                                <span class="lgreen"><strong>return</strong></span> <span class="sgreen">0</span>
                            <span class="lgreen"><strong>else</strong></span>:
                                <span class="lgreen"><strong>return</strong></span> n <span class="igrey">+</span> sumn(n<span class="igrey">-</span><span class="sgreen">1</span>)</pre>
          <p class="indent">
            However, there is a limit on the depth of recursive function calls.
            The function <code>sys.getrecursionlimit()</code> returns the
            current maximum recursion depth, and the function
            <code>sys.setrecursionlimit()</code> can be used to change the
            value. The default value is 1000. Although it is possible to
            increase the value, programs are still limited by the stack size
            enforced by the host operating system. When the recursion depth
            limit is exceeded, a <code>RuntimeError</code> exception is raised.
            If the limit is increased too much, Python might crash with a
            segmentation fault or another operating system error.
          </p>
          <p class="indent">
            In practice, issues with the recursion limit only arise when you
            work with deeply nested recursive data structures such as trees and
            graphs. Many algorithms involving trees naturally lend themselves to
            recursive solutions—and, if your data structure is too large, you
            might blow the stack limit. However, there are some clever
            workarounds; see <a href="ch06.xhtml#ch06">Chapter 6</a> on
            generators for an example.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch05lev1sec14">
            5.14 The <code>lambda</code> Expression
          </h3>
          <p class="noindent">
            An anonymous—unnamed—function can be defined with a
            <code>lambda</code> expression:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0114-02" id="f0114-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>lambda</strong></span> args: expression</pre>
          <p class="indent">
            <code>args</code> is a comma-separated list of arguments, and
            <code>expression</code> is an expression involving those arguments.
            Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0114-03" id="f0114-03"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> <span class="lgreen"><strong>lambda</strong></span> x, y: x <span class="igrey">+</span> y
                        r <span class="igrey">=</span> a(<span class="sgreen">2</span>, <span class="sgreen">3</span>)            <span class="hblue"># r gets 5</span></pre>
          <p class="indent">
            The code defined with <code>lambda</code> must be a valid
            expression. Multiple statements, or nonexpression statements such as
            <code>try</code> and <code>while</code>, cannot appear in a
            <code>lambda</code> expression.
          </p>
          <p class="indent">
            One of the main uses of <code>lambda</code> is to define small
            callback functions. For example, you may see it used with built-in
            operations such as <code>sorted()</code>. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0114-04" id="f0114-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># Sort a list of words by the number of unique letters</span>
                        result <span class="igrey">=</span> sorted(words, key<span class="igrey">=</span><span class="lgreen"><strong>lambda</strong></span> word: len(set(word)))</pre>
          <p class="indent">
            Caution is required when a <code>lambda</code> expression contains
            free variables (not specified as parameters). Consider this
            example:<span epub:type="pagebreak" id="page_115"></span>
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0115-01" id="f0115-01"
              >Click here to view code image</a
            >
          </p>
          <pre>x <span class="igrey">=</span> <span class="sgreen">2</span>
                        f <span class="igrey">=</span> <span class="lgreen"><strong>lambda</strong></span> y: x <span class="igrey">*</span> y
                        x <span class="igrey">=</span> <span class="sgreen">3</span>
                        g <span class="igrey">=</span> <span class="lgreen"><strong>lambda</strong></span> y: x <span class="igrey">*</span> y
                        print(f(<span class="sgreen">10</span>))       <span class="hblue"># --&gt; prints 30</span>
                        print(g(<span class="sgreen">10</span>))       <span class="hblue"># --&gt; prints 30</span></pre>
          <p class="indent">
            In this example, you might expect the call <code>f(10)</code> to
            print <code>20</code>, reflecting the fact that <code>x</code> was
            <code>2</code> at the time of definition. However, this is not the
            case. As a free variable, the evaluation of <code>f(10)</code> uses
            whatever value <code>x</code> happens to have at the time of
            evaluation. It could be different from the value it had when the
            <code>lambda</code> function was defined. Sometimes this behavior is
            referred to as <em>late binding</em>.
          </p>
          <p class="indent">
            If it’s important to capture the value of a variable at the time of
            definition, use a default argument:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0115-02" id="f0115-02"
              >Click here to view code image</a
            >
          </p>
          <pre>x <span class="igrey">=</span> <span class="sgreen">2</span>
                        f <span class="igrey">=</span> <span class="lgreen"><strong>lambda</strong></span> y, x<span class="igrey">=</span>x: x <span class="igrey">*</span> y
                        x <span class="igrey">=</span> <span class="sgreen">3</span>
                        g <span class="igrey">=</span> <span class="lgreen"><strong>lambda</strong></span> y, x<span class="igrey">=</span>x: x <span class="igrey">*</span> y
                        print(f(<span class="sgreen">10</span>))       <span class="hblue"># --&gt; prints 20</span>
                        print(g(<span class="sgreen">10</span>))       <span class="hblue"># --&gt; prints 30</span></pre>
          <p class="indent">
            This works because default argument values are only evaluated at the
            time of function definition and thus would capture the current value
            of <code>x</code>.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch05lev1sec15">5.15 Higher-Order Functions</h3>
          <p class="noindent">
            Python supports the concept of <em>higher-order functions</em>. This
            means that functions can be passed as arguments to other functions,
            placed in data structures, and returned by a function as a result.
            Functions are said to be <em>first-class objects</em>, meaning there
            is no difference between how you might handle a function and any
            other kind of data. Here is an example of a function that accepts
            another function as input and calls it after a time delay—for
            example, to emulate the performance of a microservice in the cloud:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0115-03" id="f0115-03"
              >Click here to view code image</a
            >
          </p>
          <pre>import time
                        
                        <span class="lgreen"><strong>def</strong></span> after(seconds, func):
                            time.sleep(seconds)
                            func()
                        
                        <span class="hblue"># Example usage</span>
                        <span class="lgreen"><strong>def</strong></span> greeting():
                            print(<span class="mblue">'Hello World'</span>)
                        
                        after(<span class="sgreen">10</span>, greeting)    <span class="hblue"># Prints 'Hello World' after 10 seconds</span></pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_116"></span>Here, the
            <code>func</code> argument to <code>after()</code> is an example of
            what’s known as a <em>callback function</em>. This refers to the
            fact that the <code>after()</code> function “calls back” to the
            function supplied as an argument.
          </p>
          <p class="indent">
            When a function is passed as data, it implicitly carries information
            related to the environment in which the function was defined. For
            example, suppose the <code>greeting()</code> function makes use of a
            variable like this:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0116-01" id="f0116-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> main():
                            name <span class="igrey">=</span> <span class="mblue">'Guido'</span>
                            <span class="lgreen"><strong>def</strong></span> greeting():
                                print(<span class="mblue">'Hello'</span>, name)
                            after(<span class="sgreen">10</span>, greeting)        <span class="hblue"># Produces: 'Hello Guido'</span>
                        
                        main()</pre>
          <p class="indent">
            In this example, the variable <code>name</code> is used by
            <code>greeting()</code>, but it’s a local variable of the outer
            <code>main()</code> function. When <code>greeting</code> is passed
            to <code>after()</code>, the function remembers its environment and
            uses the value of the required <code>name</code> variable. This
            relies on a feature known as a <em>closure</em>. A closure is a
            function along with an environment containing all of the variables
            needed to execute the function body.
          </p>
          <p class="indent">
            Closures and nested functions are useful when you write code based
            on the concept of lazy or delayed evaluation. The
            <code>after()</code> function, shown above, is an illustration of
            this concept. It receives a function that is not evaluated right
            away—that only happens at some later point in time. This is a common
            programming pattern that arises in other contexts. For example, a
            program might have functions that only execute in response to
            events— key presses, mouse movement, arrival of network packets, and
            so on. In all of these cases, function evaluation is deferred until
            something interesting happens. When the function finally executes, a
            closure ensures that the function gets everything that it needs.
          </p>
          <p class="indent">
            You can also write functions that create and return other functions.
            For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0116-02" id="f0116-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> make_greeting(name):
                            <span class="lgreen"><strong>def</strong></span> greeting():
                                print(<span class="mblue">'Hello'</span>, name)
                            <span class="lgreen"><strong>return</strong></span> greeting
                        
                        
                        f <span class="igrey">=</span> make_greeting(<span class="mblue">'Guido'</span>)
                        g <span class="igrey">=</span> make_greeting(<span class="mblue">'Ada'</span>)
                        
                        f() <span class="hblue"># Produces: 'Hello Guido'</span>
                        g() <span class="hblue"># Produces: 'Hello Ada'</span></pre>
          <p class="indent">
            In this example, the <code>make_greeting()</code> function doesn’t
            carry out any interesting computations. Instead, it creates and
            returns a function <code>greeting()</code> that does the actual
            work. That only happens when that function gets evaluated later.
          </p>
          <p class="indent">
            In this example, the two variables <code>f</code> and
            <code>g</code> hold two different versions of the
            <code>greeting()</code> function. Even though the
            <code>make_greeting()</code> function that created those functions
            is no <span epub:type="pagebreak" id="page_117"></span>longer
            executing, the <code>greeting()</code> functions still remember the
            <code>name</code> variable that was defined—it’s part of each
            function’s closure.
          </p>
          <p class="indent">
            One caution about closures is that binding to variable names is not
            a “snapshot” but a dynamic process—meaning the closure points to the
            <code>name</code> variable and the value that it was most recently
            assigned. This is subtle, but here’s an example that illustrates
            where trouble can arise:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0117-01" id="f0117-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> make_greetings(names):
                            funcs <span class="igrey">=</span> []
                            <span class="lgreen"><strong>for</strong></span> name <span class="lgreen"><strong>in</strong></span> names:
                                func.append(<span class="lgreen"><strong>lambda</strong></span>: print(<span class="mblue">'Hello'</span>, name))
                            <span class="lgreen"><strong>return</strong></span> funcs
                        
                        <span class="hblue"># Try it</span>
                        a, b, c <span class="igrey">=</span> make_greetings([<span class="mblue">'Guido'</span>, <span class="mblue">'Ada'</span>, <span class="mblue">'Margaret'</span>])
                        a()    <span class="hblue"># Prints 'Hello Margaret'</span>
                        b()    <span class="hblue"># Prints 'Hello Margaret'</span>
                        c()    <span class="hblue"># Prints 'Hello Margaret'</span></pre>
          <p class="indent">
            In this example, a list of different functions is made (using
            <code>lambda</code>). It may appear as if they are all using a
            unique value of <code>name</code>, as it changes on each iteration
            of a <code>for</code> loop. This is not the case. All functions end
            up using the same value of <code>name</code> —the value it has when
            the outer <code>make_greetings()</code> function returns.
          </p>
          <p class="indent">
            This is probably unexpected and not what you want. If you want to
            capture a copy of a variable, capture it as a default argument, as
            previously described:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0117-02" id="f0117-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> make_greetings(names):
                            funcs <span class="igrey">=</span> []
                            <span class="lgreen"><strong>for</strong></span> name <span class="lgreen"><strong>in</strong></span> names:
                                funcs.append(<span class="lgreen"><strong>lambda</strong></span> name<span class="igrey">=</span>name: print(<span class="mblue">'Hello'</span>, name))
                            <span class="lgreen"><strong>return</strong></span> funcs
                        
                        <span class="hblue"># Try it</span>
                        a, b, c <span class="igrey">=</span> make_greetings([<span class="mblue">'Guido'</span>, <span class="mblue">'Ada'</span>, <span class="mblue">'Margaret'</span>])
                        a()    <span class="hblue"># Prints 'Hello Guido'</span>
                        b()    <span class="hblue"># Prints 'Hello Ada'</span>
                        c()    <span class="hblue"># Prints 'Hello Margaret'</span></pre>
          <p class="indent">
            In the last two examples, functions have been defined using
            <code>lambda</code>. This is often used as a shortcut for creating
            small callback functions. However, it’s not a strict requirement.
            You could have rewritten it like this:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0117-03" id="f0117-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> make_greetings(names):
                            funcs <span class="igrey">=</span> []
                            <span class="lgreen"><strong>for</strong></span> name <span class="lgreen"><strong>in</strong></span> names:
                                <span class="lgreen"><strong>def</strong></span> greeting(name<span class="igrey">=</span>name):
                                    print(<span class="mblue">'Hello'</span>, name)
                        <span epub:type="pagebreak" id="page_118"></span>        funcs.append(greeting)
                            <span class="lgreen"><strong>return</strong></span> funcs</pre>
          <p class="indent">
            The choice of when and where to use <code>lambda</code> is one of
            personal preference and a matter of code clarity. If it makes code
            harder to read, perhaps it should be avoided.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch05lev1sec16">
            5.16 Argument Passing in Callback Functions
          </h3>
          <p class="noindent">
            One challenging problem with callback functions is that of passing
            arguments to the supplied function. Consider the
            <code>after()</code> function written earlier:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0118-01" id="f0118-01"
              >Click here to view code image</a
            >
          </p>
          <pre>import time
                        
                        <span class="lgreen"><strong>def</strong></span> after(seconds, func):
                            time.sleep(seconds)
                            func()</pre>
          <p class="indent">
            In this code, <code>func()</code> is hardwired to be called with no
            arguments. If you want to pass extra arguments, you’re out of luck.
            For example, you might try this:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0118-02" id="f0118-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> add(x, y):
                            print(<span class="trose">f'</span><span class="mblue">{x}</span> <span class="trose">+</span> <span class="mblue">{y}</span> <span class="trose">-&gt;</span> <span class="mblue">{x</span><span class="igrey">+</span><span class="mblue">y}</span><span class="trose">'</span>)
                            <span class="lgreen"><strong>return</strong></span> x <span class="igrey">+</span> y
                        
                        after(<span class="sgreen">10</span>, add(<span class="sgreen">2</span>, <span class="sgreen">3</span>))    <span class="hblue"># Fails: add() called immediately</span></pre>
          <p class="indent">
            In this example, the <code>add(2, 3)</code> function runs
            immediately, returning <code>5</code>. The
            <code>after()</code> function then crashes 10 seconds later as it
            tries to execute <code>5()</code>. That is definitely not what you
            intended. Yet there seems to be no obvious way to make it work if
            <code>add()</code> is called with its desired arguments.
          </p>
          <p class="indent">
            This problem hints towards a greater design issue concerning the use
            of functions and functional programming in general—function
            composition. When functions are mixed together in various ways, you
            need to think about how function inputs and outputs connect
            together. It is not always simple.
          </p>
          <p class="indent">
            In this case, one solution is to package up computation into a
            zero-argument function using <code>lambda</code>. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0118-03" id="f0118-03"
              >Click here to view code image</a
            >
          </p>
          <pre>after(<span class="sgreen">10</span>, <span class="lgreen"><strong>lambda</strong></span>: add(<span class="sgreen">2</span>, <span class="sgreen">3</span>))</pre>
          <p class="indent">
            A small zero-argument function like this is sometimes known as a
            <em>thunk</em>. Basically, it’s an expression that will be evaluated
            later when it’s eventually called as a zero-argument function. This
            can be a general-purpose way to delay the evaluation of any
            expression to a later point in time: put the expression in a
            <code>lambda</code> and call the function when you actually need the
            value.
          </p>
          <p class="indent">
            <span epub:type="pagebreak" id="page_119"></span>As an alternative
            to using <code>lambda</code>, you could use
            <code>functools.partial()</code> to create a partially evaluated
            function like this:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0119-01" id="f0119-01"
              >Click here to view code image</a
            >
          </p>
          <pre>from functools import partial
                        
                        after(<span class="sgreen">10</span>, partial(add, <span class="sgreen">2</span>, <span class="sgreen">3</span>))</pre>
          <p class="indent">
            <code>partial()</code> creates a callable where one or more of the
            arguments have already been specified and are cached. It can be a
            useful way to make nonconforming functions match expected calling
            signatures in callbacks and other applications. Here are a few more
            examples of using <code>partial()</code>:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0119-02" id="f0119-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> func(a, b, c, d):
                            print(a, b, c, d)
                        
                        f <span class="igrey">=</span> partial(func, <span class="sgreen">1</span>, <span class="sgreen">2</span>)        <span class="hblue"># Fix a=1, b=2</span>
                        f(<span class="sgreen">3</span>, <span class="sgreen">4</span>)                        <span class="hblue"># func(1, 2, 3, 4)</span>
                        f(<span class="sgreen">10</span>, <span class="sgreen">20</span>)                      <span class="hblue"># func(1, 2, 10, 20)</span>
                        
                        g <span class="igrey">=</span> partial(func, <span class="sgreen">1</span>, <span class="sgreen">2</span>, d<span class="igrey">=</span><span class="sgreen">4</span>)   <span class="hblue"># Fix a=1, b=2, d=4</span>
                        g(<span class="sgreen">3</span>)                           <span class="hblue"># func(1, 2, 3, 4)</span>
                        g(<span class="sgreen">10</span>)                          <span class="hblue"># func(1, 2, 10, 4)</span></pre>
          <p class="indent">
            <code>partial()</code> and <code>lambda</code> can be used for
            similar purposes, but there is an important semantic distinction
            between the two techniques. With <code>partial()</code>, the
            arguments are evaluated and bound at the time the partial function
            is first defined. With a zero-argument <code>lambda</code>, the
            arguments are evaluated and bound when the
            <code>lambda</code> function actually executes later (the evaluation
            of everything is delayed). To illustrate:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0119-03" id="f0119-03"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; def func(x, y):
                        ...    return x + y
                        ...
                        &gt;&gt;&gt; a = 2
                        &gt;&gt;&gt; b = 3
                        &gt;&gt;&gt; f = lambda: func(a, b)
                        &gt;&gt;&gt; g = partial(func, a, b)
                        &gt;&gt;&gt; a = 10
                        &gt;&gt;&gt; b = 20
                        &gt;&gt;&gt; f()    # Uses current values of a, b
                        30
                        &gt;&gt;&gt; g()    # Uses initial values of a, b
                        5
                        &gt;&gt;&gt;</pre
          >
          <p class="indent">
            Since partials are fully evaluated, the callables created by
            <code>partial()</code> are objects that can be serialized into
            bytes, saved in files, and even transmitted across network
            connections (for example, using the <code>pickle</code> standard
            library module). This is not possible with a <code>lambda</code>
            <span epub:type="pagebreak" id="page_120"></span>function. Thus, in
            applications where functions are passed around, possibly to Python
            interpreters running in different processes or on different
            machines, you’ll find <code>partial()</code> to be a bit more
            adaptable.
          </p>
          <p class="indent">
            As an aside, partial function application is closely related to a
            concept known as <em>currying</em>. Currying is a functional
            programming technique where a multiple-argument function is
            expressed as a chain of nested single-argument functions. Here is an
            example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0120-01" id="f0120-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># Three-argument function</span>
                        <span class="lgreen"><strong>def</strong></span> f(x, y, z):
                            <span class="lgreen"><strong>return</strong></span> x <span class="igrey">+</span> y <span class="igrey">+</span> z
                        
                        <span class="hblue"># Curried version</span>
                        <span class="lgreen"><strong>def</strong></span> fc(x):
                            <span class="lgreen"><strong>return lambda</strong></span> y: (<span class="lgreen"><strong>lambda</strong></span> z: x <span class="igrey">+</span> y <span class="igrey">+</span> z)
                        
                        <span class="hblue"># Example use</span>
                        a <span class="igrey">=</span> f(<span class="sgreen">2</span>, <span class="sgreen">3</span>, <span class="sgreen">4</span>)      <span class="hblue"># 3-argument function</span>
                        b <span class="igrey">=</span> fc(<span class="sgreen">2</span>)(<span class="sgreen">3</span>)(<span class="sgreen">4</span>)     <span class="hblue"># Curried version</span></pre>
          <p class="indent">
            This is not a common Python programming style and there are few
            practical reasons for doing it. However, sometimes you’ll hear the
            word “currying” thrown about in conversations with coders who’ve
            spent too much time warping their brains with things like
            <code>lambda</code> calculus. This technique of handling multiple
            arguments is named in honor of the famous logician Haskell Curry.
            Knowing what it is might be useful—should you stumble into a group
            of functional programmers having a heated flamewar at a social
            event.
          </p>
          <p class="indent">
            Getting back to the original problem of argument passing, another
            option for passing arguments to a callback function is to accept
            them separately as arguments to the outer calling function. Consider
            this version of the <code>after()</code> function:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0120-02" id="f0120-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> after(seconds, func, <span class="igrey">*</span>args):
                            time.sleep(seconds)
                            func(<span class="igrey">*</span>args)
                        
                        after(<span class="sgreen">10</span>, add, <span class="sgreen">2</span>, <span class="sgreen">3</span>)   <span class="hblue"># Calls add(2, 3) after 10 seconds</span></pre>
          <p class="indent">
            You will notice that passing keyword arguments to
            <code>func()</code> is not supported. This is by design. One issue
            with keyword arguments is that the argument names of the given
            function might clash with argument names already in use (that is,
            <code>seconds</code> and <code>func</code>). Keyword arguments might
            also be reserved for specifying options to the
            <code>after()</code> function itself. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0120-03" id="f0120-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> after(seconds, func, <span class="igrey">*</span>args, debug<span class="igrey">=</span><span class="dblue">False</span>):
                            time.sleep(seconds)
                            <span class="lgreen"><strong>if</strong></span> debug:
                                print(<span class="mblue">'About to call'</span>, func, args)
                            func(<span class="igrey">*</span>args)</pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_121"></span>All is not lost,
            however. If you need to specify keyword arguments to
            <code>func()</code>, you can still do it using
            <code>partial()</code>. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0121-01" id="f0121-01"
              >Click here to view code image</a
            >
          </p>
          <pre>after(<span class="sgreen">10</span>, partial(add, y<span class="igrey">=</span><span class="sgreen">3</span>), <span class="sgreen">2</span>)</pre>
          <p class="indent">
            If you wanted the <code>after()</code> function to accept keyword
            arguments, a safe way to do it might be to use positional-only
            arguments. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0121-02" id="f0121-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> after(seconds, func, debug<span class="igrey">=</span><span class="dblue">False</span>, <span class="igrey">/</span>, <span class="igrey">*</span>args, <span class="igrey">**</span>kwargs):
                            time.sleep(seconds)
                            <span class="lgreen"><strong>if</strong></span> debug:
                                print(<span class="mblue">'About to call'</span>, func, args, kwargs)
                            func(<span class="igrey">*</span>args, <span class="igrey">**</span>kwargs)
                        
                        after(<span class="sgreen">10</span>, add, <span class="sgreen">2</span>, y<span class="igrey">=</span><span class="sgreen">3</span>)</pre>
          <p class="indent">
            Another possibly unsettling insight is that
            <code>after()</code> actually represents two different function
            calls merged together. Perhaps the problem of passing arguments can
            be decomposed into two functions like this:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0121-03" id="f0121-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> after(seconds, func, debug<span class="igrey">=</span><span class="dblue">False</span>):
                            <span class="lgreen"><strong>def</strong></span> call(<span class="igrey">*</span>args, <span class="igrey">**</span>kwargs):
                                time.sleep(seconds)
                                <span class="lgreen"><strong>if</strong></span> debug:
                                    print(<span class="mblue">'About to call'</span>, func, args, kwargs)
                                func(<span class="igrey">*</span>args, <span class="igrey">**</span>kwargs)
                            <span class="lgreen"><strong>return</strong></span> call
                        
                        after(<span class="sgreen">10</span>, add)(<span class="sgreen">2</span>, y<span class="igrey">=</span><span class="sgreen">3</span>)</pre>
          <p class="indent">
            Now, there are no conflicts whatsoever between the arguments to
            <code>after()</code> and the arguments to <code>func</code>.
            However, there is a chance that doing this will introduce a conflict
            between you and your coworkers.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch05lev1sec17">
            5.17 Returning Results from Callbacks
          </h3>
          <p class="noindent">
            Another problem not addressed in the previous section is that of
            returning the results of the calculation. Consider this modified
            <code>after()</code> function:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0121-04" id="f0121-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> after(seconds, func, <span class="igrey">*</span>args):
                            time.sleep(seconds)
                            <span class="lgreen"><strong>return</strong></span> func(<span class="igrey">*</span>args)</pre>
          <p class="indent">
            This works, but there are some subtle corner cases that arise from
            the fact that two separate functions are involved—the
            <code>after()</code> function itself and the supplied callback
            <code>func</code>.
          </p>
          <p class="indent">
            One issue concerns exception handling. For example, try these two
            examples:<span epub:type="pagebreak" id="page_122"></span>
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0122-01" id="f0122-01"
              >Click here to view code image</a
            >
          </p>
          <pre>after(<span class="mblue">"1"</span>, add, <span class="sgreen">2</span>, <span class="sgreen">3</span>)   <span class="hblue"># Fails: TypeError (integer is expected)</span>
                        after(<span class="sgreen">1</span>, add, <span class="mblue">"2"</span>, <span class="sgreen">3</span>)   <span class="hblue"># Fails: TypeError (can't concatenate int to str)</span></pre>
          <p class="indent">
            A <code>TypeError</code> is raised in both cases, but it’s for very
            different reasons and in different functions. The first error is due
            to a problem in the <code>after()</code> function itself: A bad
            argument is being given to <code>time.sleep()</code>. The second
            error is due to a problem with the execution of the callback
            function <code>func(*args)</code>.
          </p>
          <p class="indent">
            If it’s important to distinguish between these two cases, there are
            a few options for that. One option is to rely on chained exceptions.
            The idea is to package errors from the callback in a different way
            that allows them to be handled separately from other kinds of
            errors. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0122-02" id="f0122-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> CallbackError(<span class="pgold">Exception</span>):
                            <span class="lgreen"><strong>pass</strong></span>
                        
                        <span class="lgreen"><strong>def</strong></span> after(seconds, func, <span class="igrey">*</span>args):
                            time.sleep(seconds)
                            <span class="lgreen"><strong>try</strong></span>:
                                <span class="lgreen"><strong>return</strong></span> func(<span class="igrey">*</span>args)
                            <span class="lgreen"><strong>except</strong></span> <span class="pgold">Exception</span> as err:
                                <span class="lgreen"><strong>raise</strong></span> CallbackError(<span class="mblue">'Callback function failed'</span>) from err</pre>
          <p class="indent">
            This modified code isolates errors from the supplied callback into
            its own exception category. Use it like this:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0122-03" id="f0122-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>try</strong></span>:
                            r <span class="igrey">=</span> after(delay, add, x, y)
                        <span class="lgreen"><strong>except</strong></span> CallbackError as err:
                            print(<span class="mblue">"It failed. Reason"</span>, err.__cause__)</pre>
          <p class="indent">
            If there was a problem with the execution of
            <code>after()</code> itself, that exception would propagate out,
            uncaught. On the other hand, problems related to the execution of
            the supplied callback function would be caught and reported as a
            <code>CallbackError</code>. All of this is quite subtle, but in
            practice, managing errors is hard. This approach makes the
            attribution of blame more precise and the behavior of
            <code>after()</code> easier to document. Specifically, if there is a
            problem in the callback, it’s always reported as a
            <code>CallbackError</code>.
          </p>
          <p class="indent">
            Another option is to package the result of the callback function
            into some kind of result instance that holds both a value and an
            error. For example, define a class like this:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0122-04" id="f0122-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Result:
                            <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, value<span class="igrey">=</span><span class="dblue">None</span>, exc<span class="igrey">=</span><span class="dblue">None</span>):
                                <span class="dblue">self</span>._value <span class="igrey">=</span> value
                                <span class="dblue">self</span>._exc <span class="igrey">=</span> exc
                            <span class="lgreen"><strong>def</strong></span> result(<span class="dblue">self</span>):
                                <span class="lgreen"><strong>if</strong></span> <span class="dblue">self</span>._exc:
                                    <span class="lgreen"><strong>raise</strong></span> <span class="dblue">self</span>._exc
                        <span epub:type="pagebreak" id="page_123"></span>        <span class="lgreen"><strong>else</strong></span>:
                                    <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>._value</pre>
          <p class="indent">
            Then, use this class to return results from the
            <code>after()</code> function:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0123-02" id="f0123-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> after(seconds, func, <span class="igrey">*</span>args):
                            time.sleep(seconds)
                            <span class="lgreen"><strong>try</strong></span>:
                                <span class="lgreen"><strong>return</strong></span> Result(value<span class="igrey">=</span>func(<span class="igrey">*</span>args))
                            <span class="lgreen"><strong>except</strong></span> <span class="pgold">Exception</span> as err:
                                <span class="lgreen"><strong>return</strong></span> Result(exc<span class="igrey">=</span>err)
                        
                        <span class="hblue"># Example use:</span>
                        
                        r <span class="igrey">=</span> after(<span class="sgreen">1</span>, add, <span class="sgreen">2</span>, <span class="sgreen">3</span>)
                        print(r.result())            <span class="hblue"># Prints 5</span>
                        
                        s <span class="igrey">=</span> after(<span class="mblue">"1"</span>, add, <span class="sgreen">2</span>, <span class="sgreen">3</span>)    <span class="hblue"># Immediately raises TypeError. Bad sleep() arg.</span>
                        
                        t <span class="igrey">=</span> after(<span class="sgreen">1</span>, add, <span class="mblue">"2"</span>, <span class="sgreen">3</span>)    <span class="hblue"># Returns a "Result"</span>
                        print(t.result())            <span class="hblue"># Raises TypeError</span></pre>
          <p class="indent">
            This second approach works by deferring the result reporting of the
            callback function to a separate step. If there is a problem with
            <code>after()</code>, it gets reported immediately. If there is a
            problem with the callback <code>func()</code>, that gets reported
            when a user tries to obtain the result by calling the
            <code>result()</code> method.
          </p>
          <p class="indent">
            This style of boxing a result into a special instance to be
            unwrapped later is an increasingly common pattern found in modern
            programming languages. One reason for its use is that it facilitates
            type checking. For example, if you were to put a type hint on
            <code>after()</code>, its behavior is fully defined—it always
            returns a <code>Result</code> and nothing else:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0123-03" id="f0123-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> after(seconds, func, <span class="igrey">*</span>args) <span class="igrey">-&gt;</span> Result:
                            ...</pre>
          <p class="indent">
            Although it’s not so common to see this kind of pattern in Python
            code, it does arise with some regularity when working with
            concurrency primitives such as threads and processes. For example,
            instances of a so-called <code>Future</code> behave like this when
            working with thread pools. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0123-04" id="f0123-04"
              >Click here to view code image</a
            >
          </p>
          <pre>from concurrent.futures import ThreadPoolExecutor
                        
                        pool <span class="igrey">=</span> ThreadPoolExecutor(<span class="sgreen">16</span>)
                        r <span class="igrey">=</span> pool.submit(add, <span class="sgreen">2</span>, <span class="sgreen">3</span>)     <span class="hblue"># Returns a Future</span>
                        print(r.result())              <span class="hblue"># Unwrap the Future result</span></pre>
        </section>
        <section>
          <h3 class="h3" id="ch05lev1sec18">
            <span epub:type="pagebreak" id="page_124"></span>5.18 Decorators
          </h3>
          <p class="noindent">
            A decorator is a function that creates a wrapper around another
            function. The primary purpose of this wrapping is to alter or
            enhance the behavior of the object being wrapped. Syntactically,
            decorators are denoted using the special <code>@</code> symbol as
            follows:
          </p>
          <pre><span class="wasabi">@decorate</span>
                        <span class="lgreen"><strong>def</strong></span> func(x):
                             ...</pre>
          <p class="indent">
            The preceding code is shorthand for the following:
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> func(x):
                             ...
                        func <span class="igrey">=</span> decorate(func)</pre>
          <p class="indent">
            In the example, a function <code>func()</code> is defined. However,
            immediately after its definition, the function object itself is
            passed to the function <code>decorate()</code>, which returns an
            object that replaces the original <code>func</code>.
          </p>
          <p class="indent">
            As an example of a concrete implementation, here is a decorator
            <code>@trace</code> that adds debugging messages to a function:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0124-03" id="f0124-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> trace(func):
                            <span class="lgreen"><strong>def</strong></span> call(<span class="igrey">*</span>args, <span class="igrey">**</span>kwargs):
                                print(<span class="mblue">'Calling'</span>, func.<span class="dblue">__name__</span>)
                                <span class="lgreen"><strong>return</strong></span> func(<span class="igrey">*</span>args, <span class="igrey">**</span>kwargs)
                            <span class="lgreen"><strong>return</strong></span> call
                        
                        <span class="hblue"># Example use</span>
                        <span class="wasabi">@trace</span>
                        <span class="lgreen"><strong>def</strong></span> square(x):
                            <span class="lgreen"><strong>return</strong></span> x <span class="igrey">*</span> x</pre>
          <p class="indent">
            In this code, <code>trace()</code> creates a wrapper function that
            writes some debugging output and then calls the original function
            object. Thus, if you call <code>square()</code>, you will see the
            output of the <code>print()</code> function in the wrapper.
          </p>
          <p class="indent">
            If only it were so easy! In practice, functions also contain
            metadata such as the function name, doc string, and type hints. If
            you put a wrapper around a function, this information gets hidden.
            When writing a decorator, it’s considered best practice to use the
            <code>@wraps()</code> decorator as shown in this example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0124-04" id="f0124-04"
              >Click here to view code image</a
            >
          </p>
          <pre>from functools import wraps
                        
                        <span class="lgreen"><strong>def</strong></span> trace(func):
                            <span class="wasabi">@wraps</span>(func)
                            <span class="lgreen"><strong>def</strong></span> call(<span class="igrey">*</span>args, <span class="igrey">**</span>kwargs):
                                print(<span class="mblue">'Calling'</span>, func.<span class="dblue">__name__</span>)
                        <span epub:type="pagebreak" id="page_125"></span>        <span class="lgreen"><strong>return</strong></span> func(<span class="igrey">*</span>args, <span class="igrey">**</span>kwargs)
                            <span class="lgreen"><strong>return</strong></span> call</pre>
          <p class="indent">
            The <code>@wraps()</code> decorator copies various function metadata
            to the replacement function. In this case, metadata from the given
            function <code>func()</code> is copied to the returned wrapper
            function <code>call()</code>.
          </p>
          <p class="indent">
            When decorators are applied, they must appear on their own line
            immediately prior to the function. More than one decorator can be
            applied. Here’s an example:
          </p>
          <pre><span class="wasabi">@decorator1</span>
                        <span class="wasabi">@decorator2</span>
                        <span class="lgreen"><strong>def</strong></span> func(x):
                            <span class="lgreen"><strong>pass</strong></span></pre>
          <p class="indent">
            In this case, the decorators are applied as follows:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0125-02" id="f0125-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> func(x):
                            <span class="lgreen"><strong>pass</strong></span>
                        
                        func <span class="igrey">=</span> decorator1(decorator2(func))</pre>
          <p class="indent">
            The order in which decorators appear might matter. For example, in
            class definitions, decorators such as <code>@classmethod</code> and
            <code>@staticmethod</code> often have to be placed at the outermost
            level. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0125-03" id="f0125-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> SomeClass(object):
                            <span class="wasabi">@classmethod</span>            <span class="hblue"># Yes</span>
                            <span class="wasabi">@trace</span>
                            <span class="lgreen"><strong>def</strong></span> a(cls):
                                <span class="lgreen"><strong>pass</strong></span>
                        
                            <span class="wasabi">@trace</span>                  <span class="hblue"># No. Fails.</span>
                            <span class="wasabi">@classmethod</span>
                            <span class="lgreen"><strong>def</strong></span> b(cls):
                                <span class="lgreen"><strong>pass</strong></span></pre>
          <p class="indent">
            The reason for this placement restriction has to do with the values
            returned by <code>@classmethod</code>. Sometimes a decorator returns
            an object that’s different than a normal function. If the outermost
            decorator isn’t expecting this, things can break. In this case,
            <code>@classmethod</code> creates a
            <code>classmethod</code> descriptor object (see
            <a href="ch07.xhtml#ch07">Chapter 7</a>). Unless the
            <code>@trace</code> decorator was written to account for this, it
            will fail if decorators are listed in the wrong order.
          </p>
          <p class="indent">
            A decorator can also accept arguments. Suppose you want to change
            the <code>@trace</code> decorator to allow for a custom message like
            this:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0125-04" id="f0125-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="wasabi">@trace</span>(<span class="mblue">"You called {func.__name__}"</span>)
                        <span class="lgreen"><strong>def</strong></span> func():
                            <span class="lgreen"><strong>pass</strong></span></pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_126"></span>If arguments are
            supplied, the semantics of the decoration process is as follows:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0126-01" id="f0126-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> func():
                            <span class="lgreen"><strong>pass</strong></span>
                        
                        <span class="hblue"># Create the decoration function</span>
                        temp <span class="igrey">=</span> trace(<span class="mblue">"You called {func.__name__}"</span>)
                        
                        <span class="hblue"># Apply it to func</span>
                        func <span class="igrey">=</span> temp(func)</pre>
          <p class="indent">
            In this case, the outermost function that accepts the arguments is
            responsible for creating a decoration function. That function is
            then called with the function to be decorated to obtain the final
            result. Here’s what the decorator implementation might look like:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0126-02" id="f0126-02"
              >Click here to view code image</a
            >
          </p>
          <pre>from functools import wraps
                        
                        <span class="lgreen"><strong>def</strong></span> trace(message):
                            <span class="lgreen"><strong>def</strong></span> decorate(func):
                                <span class="wasabi">@wraps</span>(func)
                                <span class="lgreen"><strong>def</strong></span> wrapper(<span class="igrey">*</span>args, <span class="igrey">**</span>kwargs):
                                    print(message.format(func<span class="igrey">=</span>func))
                                    <span class="lgreen"><strong>return</strong></span> func(<span class="igrey">*</span>args, <span class="igrey">**</span>kwargs)
                                <span class="lgreen"><strong>return</strong></span> wrapper
                            <span class="lgreen"><strong>return</strong></span> decorate</pre>
          <p class="indent">
            One interesting feature of this implementation is that the outer
            function is actually a kind of a “decorator factory.” Suppose you
            found yourself writing code like this:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0126-03" id="f0126-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="wasabi">@trace</span>(<span class="mblue">'You called {func.__name__}'</span>)
                        <span class="lgreen"><strong>def</strong></span> func1():
                            <span class="lgreen"><strong>pass</strong></span>
                        
                        <span class="wasabi">@trace</span>(<span class="mblue">'You called {func.__name__}'</span>)
                        <span class="lgreen"><strong>def</strong></span> func2():
                            <span class="lgreen"><strong>pass</strong></span></pre>
          <p class="indent">
            That would quickly get tedious. You could simplify it by calling the
            outer decorator function once and reusing the result like this:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0126-04" id="f0126-04"
              >Click here to view code image</a
            >
          </p>
          <pre>logged <span class="igrey">=</span> trace(<span class="mblue">'You called {func.__name__}'</span>)
                        
                        <span class="wasabi">@logged</span>
                        <span class="lgreen"><strong>def</strong></span> func1():
                            <span class="lgreen"><strong>pass</strong></span>
                        
                        <span epub:type="pagebreak" id="page_127"></span><span class="wasabi">@logged</span>
                        <span class="lgreen"><strong>def</strong></span> func2():
                            <span class="lgreen"><strong>pass</strong></span></pre>
          <p class="indent">
            Decorators don’t necessarily have to replace the original function.
            Sometimes a decorator merely performs an action such as
            registration. For example, if you are building a registry of event
            handlers, you could define a decorator that works like this:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0127-02" id="f0127-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="wasabi">@eventhandler</span>(<span class="mblue">'BUTTON'</span>)
                        <span class="lgreen"><strong>def</strong></span> handle_button(msg):
                             ...
                        <span class="wasabi">@eventhandler</span>(<span class="mblue">'RESET'</span>)
                        <span class="lgreen"><strong>def</strong></span> handle_reset(msg):
                             ...</pre>
          <p class="indent">Here’s a decorator that manages it:</p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0127-03" id="f0127-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># Event handler decorator</span>
                        _event_handlers <span class="igrey">=</span> { }
                        <span class="lgreen"><strong>def</strong></span> eventhandler(event):
                            <span class="lgreen"><strong>def</strong></span> register_function(func):
                                _event_handlers[event] <span class="igrey">=</span> func
                                <span class="lgreen"><strong>return</strong></span> func
                            <span class="lgreen"><strong>return</strong></span> register_function</pre>
        </section>
        <section>
          <h3 class="h3" id="ch05lev1sec19">5.19 Map, Filter, and Reduce</h3>
          <p class="noindent">
            Programmers familiar with functional languages often inquire about
            common list operations such as map, filter, and reduce. Much of this
            functionality is provided by list comprehensions and generator
            expressions. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0127-04" id="f0127-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> square(x):
                            <span class="lgreen"><strong>return</strong></span> x <span class="igrey">*</span> x
                        
                        nums <span class="igrey">=</span> [<span class="sgreen">1</span>, <span class="sgreen">2</span>, <span class="sgreen">3</span>, <span class="sgreen">4</span>, <span class="sgreen">5</span>]
                        squares <span class="igrey">=</span> [ square(x) <span class="lgreen"><strong>for</strong></span> x <span class="lgreen"><strong>in</strong></span> nums ]    <span class="hblue"># [1, 4, 9, 16, 25]</span></pre>
          <p class="indent">
            Technically, you don’t even need the short one-line function. You
            could write:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0127-05" id="f0127-05"
              >Click here to view code image</a
            >
          </p>
          <pre>squares <span class="igrey">=</span> [ x <span class="igrey">*</span> x <span class="lgreen"><strong>for</strong></span> x <span class="lgreen"><strong>in</strong></span> nums ]</pre>
          <p class="indent">
            Filtering can also be performed with a list comprehension:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0127-06" id="f0127-06"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> [ x <span class="lgreen"><strong>for</strong></span> x <span class="lgreen"><strong>in</strong></span> nums <span class="lgreen"><strong>if</strong></span> x <span class="igrey">&gt;</span> <span class="sgreen">2</span> ]    <span class="hblue"># [3, 4, 5]</span></pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_128"></span>If you use a
            generator expression, you’ll get a generator that produces the
            results incrementally through iteration. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0128-01" id="f0128-01"
              >Click here to view code image</a
            >
          </p>
          <pre>squares <span class="igrey">=</span> (x<span class="igrey">*</span>x <span class="lgreen"><strong>for</strong></span> x <span class="lgreen"><strong>in</strong></span> nums)    <span class="hblue"># Creates a generator</span>
                        <span class="lgreen"><strong>for</strong></span> n <span class="lgreen"><strong>in</strong></span> squares:
                            print(n)</pre>
          <p class="indent">
            Python provides a built-in <code>map()</code> function that is the
            same as mapping a function with a generator expression. For example,
            the above example could be written:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0128-02" id="f0128-02"
              >Click here to view code image</a
            >
          </p>
          <pre>squares <span class="igrey">=</span> map(<span class="lgreen"><strong>lambda</strong></span> x: x<span class="igrey">*</span>x, nums)
                        <span class="lgreen"><strong>for</strong></span> n <span class="lgreen"><strong>in</strong></span> squares:
                            print(n)</pre>
          <p class="indent">
            The built-in <code>filter()</code> function creates a generator that
            filters values:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0128-03" id="f0128-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>for</strong></span> n <span class="lgreen"><strong>in</strong></span> filter(<span class="lgreen"><strong>lambda</strong></span> x: x <span class="igrey">&gt;</span> <span class="sgreen">2</span>, nums):
                            print(n)</pre>
          <p class="indent">
            If you want to accumulate or reduce values, you can use
            <code>functools.reduce()</code>. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0128-04" id="f0128-04"
              >Click here to view code image</a
            >
          </p>
          <pre>from functools import reduce
                        total <span class="igrey">=</span> reduce(<span class="lgreen"><strong>lambda</strong></span> x, y: x <span class="igrey">+</span> y, nums)</pre>
          <p class="indent">
            In its general form, <code>reduce()</code> accepts a two-argument
            function, an iterable, and an initial value. Here are a few
            examples:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0128-05" id="f0128-05"
              >Click here to view code image</a
            >
          </p>
          <pre>nums <span class="igrey">=</span> [<span class="sgreen">1</span>, <span class="sgreen">2</span>, <span class="sgreen">3</span>, <span class="sgreen">4</span>, <span class="sgreen">5</span>]
                        total <span class="igrey">=</span> reduce(<span class="lgreen"><strong>lambda</strong></span> x, y: x <span class="igrey">+</span> y, nums)         <span class="hblue"># 15</span>
                        product <span class="igrey">=</span> reduce(<span class="lgreen"><strong>lambda</strong></span> x, y: x <span class="igrey">*</span> y, nums, <span class="sgreen">1</span>)    <span class="hblue"># 120</span>
                        
                        pairs <span class="igrey">=</span> reduce(<span class="lgreen"><strong>lambda</strong></span> x, y: (x, y), nums, <span class="dblue">None</span>)
                        <span class="hblue"># (((((None, 1), 2), 3), 4), 5)</span></pre>
          <p class="indent">
            <code>reduce()</code> accumulates values left-to-right on the
            supplied iterable. This is known as a left-fold operation. Here is
            pseudocode for <code>reduce(func, items, initial)</code>:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0128-06" id="f0128-06"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> reduce(func, items, initial):
                            result <span class="igrey">=</span> initial
                            <span class="lgreen"><strong>for</strong></span> item <span class="lgreen"><strong>in</strong></span> items:
                                result <span class="igrey">=</span> func(result, item)
                            <span class="lgreen"><strong>return</strong></span> result</pre>
          <p class="indent">
            Using <code>reduce()</code> in practice may be confusing. Moreover,
            common reduction operations such as <code>sum()</code>,
            <code>min()</code>, and <code>max()</code> are already built-in.
            Your code will be easier to follow (and likely run faster) if you
            use one of those instead of trying to implement common operations
            with <code>reduce()</code>.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch05lev1sec20">
            <span epub:type="pagebreak" id="page_129"></span>5.20 Function
            Introspection, Attributes, and Signatures
          </h3>
          <p class="noindent">
            As you have seen, functions are objects—which means they can be
            assigned to variables, placed in data structures, and used in the
            same way as any other kind of data in a program. They can also be
            inspected in various ways.
            <a href="ch05.xhtml#ch05tab01">Table 5.1</a> shows some common
            attributes of functions. Many of these attributes are useful in
            debugging, logging, and other operations involving functions.
          </p>
          <figure class="table" id="ch05tab01">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 5.1</span> Function Attributes
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Attribute</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext"><code>f.__name__</code></p>
                  </td>
                  <td><p class="tabtext">Function name</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>f.__qualname__</code></p>
                  </td>
                  <td>
                    <p class="tabtext">Fully qualified name (if nested)</p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>f.__module__</code></p>
                  </td>
                  <td>
                    <p class="tabtext">Name of module in which defined</p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>f.__doc__</code></p>
                  </td>
                  <td><p class="tabtext">Documentation string</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>f.__annotations__</code></p>
                  </td>
                  <td><p class="tabtext">Type hints</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>f.__globals__</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Dictionary that is the global namespace
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>f.__closure__</code></p>
                  </td>
                  <td><p class="tabtext">Closure variables (if any)</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>f.__code__</code></p>
                  </td>
                  <td><p class="tabtext">Underlying code object</p></td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            The <code>f.__name__</code> attribute contains the name that was
            used when defining a function. <code>f.__qualname__</code> is a
            longer name that includes additional information about the
            surrounding definition environment.
          </p>
          <p class="indent">
            The <code>f.__module__</code> attribute is a string that holds the
            module name in which the function was defined. The
            <code>f.__globals__</code> attribute is a dictionary that serves as
            the global namespace for the function. It is normally the same
            dictionary that’s attached to the associated module object.
          </p>
          <p class="indent">
            <code>f.__doc__</code> holds the function documentation string. The
            <code>f.__annotations__</code> attribute is a dictionary that holds
            type hints, if any.
          </p>
          <p class="indent">
            <code>f.__closure__</code> holds references to the values of closure
            variables for nested functions. These are a bit buried, but the
            following example shows how to view them:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0129-01" id="f0129-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> add(x, y):
                            <span class="lgreen"><strong>def</strong></span> do_add():
                                <span class="lgreen"><strong>return</strong></span> x <span class="igrey">+</span> y
                            <span class="lgreen"><strong>return</strong></span> do_add
                        
                        <span class="igrey">&gt;&gt;&gt;</span> a <span class="igrey">=</span> add(<span class="sgreen">2</span>, <span class="sgreen">3</span>)
                        <span class="igrey">&gt;&gt;&gt;</span> a.__closure__
                        (<span class="igrey">&lt;</span>cell at <span class="sgreen">0x10edf1e20</span>: int object at <span class="sgreen">0x10ecc1950</span><span class="igrey">&gt;</span>,
                         <span class="igrey">&lt;</span>cell at <span class="sgreen">0x10edf1d90</span>: int object at <span class="sgreen">0x10ecc1970</span><span class="igrey">&gt;</span>)
                        <span class="igrey">&gt;&gt;&gt;</span> a.__closure__[<span class="sgreen">0</span>].cell_contents
                        <span epub:type="pagebreak" id="page_130"></span><span class="sgreen">2</span>
                        <span class="igrey">&gt;&gt;&gt;</span></pre>
          <p class="indent">
            The <code>f.__code__</code> object represents the compiled
            interpreter bytecode for the function body.
          </p>
          <p class="indent">
            Functions can have arbitrary attributes attached to them. Here’s an
            example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0130-02" id="f0130-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> func():
                            statements
                        
                        func.secure <span class="igrey">=</span> <span class="sgreen">1</span>
                        func.private <span class="igrey">=</span> <span class="sgreen">1</span></pre>
          <p class="indent">
            Attributes are not visible within the function body—they are not
            local variables and do not appear as names in the execution
            environment. The main use of function attributes is to store extra
            metadata. Sometimes frameworks or various metaprogramming techniques
            utilize function tagging—that is, attaching attributes to functions.
            One example is the <code>@abstractmethod</code> decorator that’s
            used on methods within abstract base classes. All that decorator
            does is attach an attribute:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0130-03" id="f0130-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> abstractmethod(func):
                            func.__isabstractmethod__ <span class="igrey">=</span> <span class="dblue">True</span>
                            <span class="lgreen"><strong>return</strong></span> func</pre>
          <p class="indent">
            Some other bit of code (in this case, a metaclass) looks for this
            attribute and uses it to add extra checks to instance creation.
          </p>
          <p class="indent">
            If you want to know more about a function’s parameters, you can
            obtain its signature using the
            <code>inspect.signature()</code> function:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0130-04" id="f0130-04"
              >Click here to view code image</a
            >
          </p>
          <pre>import inspect
                        
                        <span class="lgreen"><strong>def</strong></span> func(x: int, y:float, debug<span class="igrey">=</span><span class="dblue">False</span>) <span class="igrey">-&gt;</span> float:
                            <span class="lgreen"><strong>pass</strong></span>
                        
                        sig <span class="igrey">=</span> inspect.signature(func)</pre>
          <p class="indent">
            Signature objects provide many convenient features for printing and
            obtaining detailed information about the parameters. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0130-05" id="f0130-05"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># Print out the signature in a nice form</span>
                        print(sig)  <span class="hblue"># Produces (x: int, y: float, debug=False) -&gt; float</span>
                        
                        <span class="hblue"># Get a list of argument names</span>
                        print(list(sig.parmeters))   <span class="hblue"># Produces [ 'x', 'y', 'debug']</span>
                        
                        <span class="hblue"># Iterate over the parameters and print various metadata</span>
                        <span class="lgreen"><strong>for</strong></span> p <span class="lgreen"><strong>in</strong></span> sig.parameters.values():
                            print(<span class="mblue">'name'</span>, p.name)
                        <span epub:type="pagebreak" id="page_131"></span>    print(<span class="mblue">'annotation'</span>, p.annotation)
                            print(<span class="mblue">'kind'</span>, p.kind)
                            print(<span class="mblue">'default'</span>, p.default)</pre>
          <p class="indent">
            A signature is metadata that describes the nature of a function—how
            you would call it, type hints, and so on. There are various things
            that you might do with a signature. One useful operation on
            signatures is comparison. For example, here’s how you check to see
            if two functions have the same signature:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0131-02" id="f0131-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> func1(x, y):
                            <span class="lgreen"><strong>pass</strong></span>
                        
                        <span class="lgreen"><strong>def</strong></span> func2(x, y):
                            <span class="lgreen"><strong>pass</strong></span>
                        
                        <span class="lgreen"><strong>assert</strong></span> inspect.signature(func1) <span class="igrey">==</span> inspect.signature(func2)</pre>
          <p class="indent">
            This kind of comparison might be useful in frameworks. For example,
            a framework could use signature comparison to see if you’re writing
            functions or methods that conform to an expected prototype.
          </p>
          <p class="indent">
            If stored in the <code>__signature__</code> attribute of a function,
            a signature will be shown in help messages and returned on further
            uses of <code>inspect.signature()</code>. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0131-03" id="f0131-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> func(x, y, z<span class="igrey">=</span><span class="dblue">None</span>):
                            ...
                        
                        func.__signature__ <span class="igrey">=</span> inspect.signature(<span class="lgreen"><strong>lambda</strong></span> x,y: <span class="dblue">None</span>)</pre>
          <p class="indent">
            In this example, the optional argument <code>z</code> would be
            hidden in further inspection of <code>func</code>. Instead, the
            attached signature would be returned by
            <code>inspect.signature()</code>.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch05lev1sec21">5.21 Environment Inspection</h3>
          <p class="noindent">
            Functions can inspect their execution environment using the built-in
            functions <code>globals()</code> and <code>locals()</code>.
            <code>globals()</code> returns the dictionary that’s serving as the
            global namespace. This is the same as the
            <code>func.__globals__</code> attribute. This is usually the same
            dictionary that’s holding the contents of the enclosing module.
            <code>locals()</code> returns a dictionary containing the values of
            all local and closure variables. This dictionary is not the actual
            data structure used to hold these variables. Local variables can
            come from outer functions (via a closure) or be defined internally.
            <code>locals()</code> collects all of these variables and puts them
            into a dictionary for you. Changing an item in the
            <code>locals()</code> dictionary has no effect on the underlying
            variable. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0131-04" id="f0131-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> func():
                            y <span class="igrey">=</span> <span class="sgreen">20</span>
                            locs <span class="igrey">=</span> locals()
                        <span epub:type="pagebreak" id="page_132"></span>    locs[<span class="mblue">'y'</span>] <span class="igrey">=</span> <span class="sgreen">30</span>       <span class="hblue"># Try to change y</span>
                            print(locs[<span class="mblue">'y'</span>])     <span class="hblue"># Prints 30</span>
                            print(y)             <span class="hblue"># Prints 20</span></pre>
          <p class="indent">
            If you wanted a change to take effect, you’d have to copy it back
            into the local variable using normal assignment.
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0132-02" id="f0132-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> func():
                            y <span class="igrey">=</span> <span class="sgreen">20</span>
                            locs <span class="igrey">=</span> locals()
                            locs[<span class="mblue">'y'</span>] <span class="igrey">=</span> <span class="sgreen">30</span>
                            y <span class="igrey">=</span> locs[<span class="mblue">'y'</span>]</pre>
          <p class="indent">
            A function can obtain its own stack frame using
            <code>inspect.currentframe()</code>. A function can obtain the stack
            frame of its caller by following the stack trace through
            <code>f.f_back</code> attributes on the frame. Here is an example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0132-03" id="f0132-03"
              >Click here to view code image</a
            >
          </p>
          <pre>import inspect
                        
                        <span class="lgreen"><strong>def</strong></span> spam(x, y):
                            z <span class="igrey">=</span> x <span class="igrey">+</span> y
                            grok(z)
                        
                        <span class="lgreen"><strong>def</strong></span> grok(a):
                            b <span class="igrey">=</span> a <span class="igrey">*</span> <span class="sgreen">10</span>
                        
                            <span class="hblue"># outputs: {'a':5, 'b':50 }</span>
                            print(inspect.currentframe().f_locals)
                        
                            <span class="hblue"># outputs: {'x':2, 'y':3, 'z':5 }</span>
                            print(inspect.currentframe().f_back.f_locals)
                        
                        spam(<span class="sgreen">2</span>, <span class="sgreen">3</span>)</pre>
          <p class="indent">
            Sometimes you will see stack frames obtained using the
            <code>sys._getframe()</code> function instead. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0132-04" id="f0132-04"
              >Click here to view code image</a
            >
          </p>
          <pre>import sys
                        <span class="lgreen"><strong>def</strong></span> grok(a):
                            b <span class="igrey">=</span> a <span class="igrey">*</span> <span class="sgreen">10</span>
                            print(sys._getframe(<span class="sgreen">0</span>).f_locals)    <span class="hblue"># myself</span>
                            print(sys._getframe(<span class="sgreen">1</span>).f_locals)    <span class="hblue"># my caller</span></pre>
          <p class="indent">
            The attributes in <a href="ch05.xhtml#ch05tab02">Table 5.2</a> can
            be useful for inspecting frames.<span
              epub:type="pagebreak"
              id="page_133"
            ></span>
          </p>
          <figure class="table" id="ch05tab02">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 5.2</span> Frame Attributes
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Attribute</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext"><code>f.f_back</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Previous stack frame (toward the caller)
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>f.f_code</code></p>
                  </td>
                  <td><p class="tabtext">Code object being executed</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>f.f_locals</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Dictionary of local variables (<code>locals()</code>)
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>f.f_globals</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Dictionary used for global variables
                      (<code>globals()</code>)
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>f.f_builtins</code></p>
                  </td>
                  <td>
                    <p class="tabtext">Dictionary used for built-in names</p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>f.f_lineno</code></p>
                  </td>
                  <td><p class="tabtext">Line number</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>f.f_lasti</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Current instruction. This is an index into the bytecode
                      string of <code>f_code</code>.
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>f.f_trace</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Function called at start of each source code line
                    </p>
                  </td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            Looking at stack frames is useful for debugging and code inspection.
            For example, here’s an interesting debug function that lets you view
            the values of the selected variables of the caller:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0133-01" id="f0133-01"
              >Click here to view code image</a
            >
          </p>
          <pre>import inspect
                        from collections import ChainMap
                        
                        <span class="lgreen"><strong>def</strong></span> debug(<span class="igrey">*</span>varnames):
                            f <span class="igrey">=</span> inspect.currentframe().f_back
                            vars <span class="igrey">=</span> ChainMap(f.f_locals, f.f_globals)
                            print(<span class="trose">f'</span><span class="mblue">{f.</span>f_code<span class="mblue">.</span>co_filename<span class="mblue">}</span><span class="trose">:</span><span class="mblue">{f.</span>f_lineno<span class="mblue">}</span><span class="trose">'</span>)
                            <span class="lgreen"><strong>for</strong></span> name <span class="lgreen"><strong>in</strong></span> varnames:
                                print(<span class="trose">f'</span>    <span class="mblue">{</span>name<span class="mblue">}</span> <span class="trose">=</span> <span class="mblue">{</span>vars[name]<span class="mblue">!r}</span><span class="trose">'</span>)
                        
                        <span class="hblue"># Example use</span>
                        <span class="lgreen"><strong>def</strong></span> func(x, y):
                            z <span class="igrey">=</span> x <span class="igrey">+</span> y
                            debug(<span class="mblue">'x'</span>,<span class="mblue">'y'</span>)  <span class="hblue"># Shows x and y along with file/line</span>
                            <span class="lgreen"><strong>return</strong></span> z</pre>
        </section>
        <section>
          <h3 class="h3" id="ch05lev1sec22">
            5.22 Dynamic Code Execution and Creation
          </h3>
          <p class="noindent">
            The <code>exec(str [, globals [, locals]])</code> function executes
            a string containing arbitrary Python code. The code supplied to
            <code>exec()</code> is executed as if the code actually appeared in
            place of the <code>exec</code> operation. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0133-02" id="f0133-02"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> [<span class="sgreen">3</span>, <span class="sgreen">5</span>, <span class="sgreen">10</span>, <span class="sgreen">13</span>]
                        exec(<span class="mblue">'for i in a: print(i)'</span>)</pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_134"></span>The code given to
            <code>exec()</code> executes within the local and global namespace
            of the caller. However, be aware that changes to local variables
            have no effect. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0134-01" id="f0134-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> func():
                            x <span class="igrey">=</span> <span class="sgreen">10</span>
                            exec(<span class="mblue">"x = 20"</span>)
                            print(x)      <span class="hblue"># Prints 10</span></pre>
          <p class="indent">
            The reasons for this have to do with the locals being a dictionary
            of collected local variables, not the actual local variables (see
            the previous section for more detail).
          </p>
          <p class="indent">
            Optionally, <code>exec()</code> can accept one or two dictionary
            objects that serve as the global and local namespaces for the code
            to be executed, respectively. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0134-02" id="f0134-02"
              >Click here to view code image</a
            >
          </p>
          <pre>globs <span class="igrey">=</span> {<span class="mblue">'x'</span>: <span class="sgreen">7</span>,
                                   <span class="mblue">'y'</span>: <span class="sgreen">10</span>,
                                   <span class="mblue">'birds'</span>: [<span class="mblue">'Parrot'</span>, <span class="mblue">'Swallow'</span>, <span class="mblue">'Albatross'</span>]
                                   }
                        
                        locs <span class="igrey">=</span> { }
                        
                        <span class="hblue"># Execute using the above dictionaries as the global and local namespace</span>
                        exec(<span class="mblue">'z = 3 * x + 4 * y'</span>, globs, locs)
                        exec(<span class="mblue">'for b in birds: print(b)'</span>, globs, locs)</pre>
          <p class="indent">
            If you omit one or both namespaces, the current values of the global
            and local namespaces are used. If you only provide a dictionary for
            <code>globals</code>, it’s used for both the globals and locals.
          </p>
          <p class="indent">
            A common use of dynamic code execution is for creating functions and
            methods. For example, here’s a function that creates an
            <code>__init__()</code> method for a class given a list of names:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0134-03" id="f0134-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> make_init(<span class="igrey">*</span>names):
                            parms <span class="igrey">=</span> <span class="mblue">','</span>.join(names)
                            code <span class="igrey">=</span> <span class="trose">f'def __init__(self,</span> <span class="mblue">{</span>parms<span class="mblue">}</span><span class="trose">):</span><span class="mblue">\n</span><span class="trose">'</span>
                            <span class="lgreen"><strong>for</strong></span> name <span class="lgreen"><strong>in</strong></span> names:
                                code <span class="igrey">+=</span> <span class="trose">f' self.</span><span class="mblue">{</span>name<span class="mblue">}</span> <span class="trose">=</span> <span class="mblue">{</span>name<span class="mblue">}\n</span><span class="trose">'</span>
                            d <span class="igrey">=</span> { }
                            exec(code, d)
                            <span class="lgreen"><strong>return</strong></span> d[<span class="mblue">'__init__'</span>]
                        
                        <span class="hblue"># Example use</span>
                        <span class="lgreen"><strong>class</strong></span> Vector:
                            <span class="cblue">__init__</span> <span class="igrey">=</span> make_init(<span class="mblue">'x'</span>,<span class="mblue">'y'</span>,<span class="mblue">'z'</span>)</pre>
          <p class="indent">
            This technique is used in various parts of the standard library. For
            example, <code>namedtuple()</code>, <code>@dataclass</code>, and
            similar features all rely on dynamic code creation with
            <code>exec()</code>.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch05lev1sec23">
            <span epub:type="pagebreak" id="page_135"></span>5.23 Asynchronous
            Functions and <code>await</code>
          </h3>
          <p class="noindent">
            Python provides a number of language features related to the
            asynchronous execution of code. These include so-called
            <em>async functions</em> (or coroutines) and <em>awaitables</em>.
            They are mostly used by programs involving concurrency and the
            <code>asyncio</code> module. However, other libraries may also build
            upon these.
          </p>
          <p class="indent">
            An asynchronous function, or coroutine function, is defined by
            prefacing a normal function definition with the extra keyword
            <code>async</code>. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0135-01" id="f0135-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>async def</strong></span> greeting(name):
                            print(<span class="trose">f'Hello</span> <span class="mblue">{</span>name<span class="mblue">}</span><span class="trose">'</span>)</pre>
          <p class="indent">
            If you call such a function, you’ll find that it doesn’t execute in
            the usual way—in fact, it doesn’t execute at all. Instead, you get
            an instance of a coroutine object in return. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0135-02" id="f0135-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; greeting('Guido')
                        &lt;coroutine object greeting at 0x104176dc8&gt;
                        &gt;&gt;&gt;</pre
          >
          <p class="indent">
            To make the function run, it must execute under the supervision of
            other code. A common option is <code>asyncio</code>. For example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0135-03" id="f0135-03"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; import asyncio
                        &gt;&gt;&gt; asyncio.run(greeting('Guido'))
                        Hello Guido
                        &gt;&gt;&gt;</pre
          >
          <p class="indent">
            This example brings up the most important feature of asynchronous
            functions—that they never execute on their own. Some kind of manager
            or library code is always required for their execution. It’s not
            necessarily <code>asyncio</code> as shown, but something is always
            involved in making async functions run.
          </p>
          <p class="indent">
            Aside from being managed, an asynchronous function evaluates in the
            same manner as any other Python function. Statements run in order
            and all of the usual control-flow features work. If you want to
            return a result, use the usual <code>return</code> statement. For
            example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0135-04" id="f0135-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>async def</strong></span> make_greeting(name):
                            <span class="lgreen"><strong>return</strong></span> <span class="trose">f'Hello</span> <span class="mblue">{</span>name<span class="mblue">}</span><span class="trose">'</span></pre>
          <p class="indent">
            The value given to <code>return</code> is returned by the outer
            <code>run()</code> function used to execute the async function. For
            example:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0135-05" id="f0135-05"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; import asyncio
                        &gt;&gt;&gt; a = asyncio.run(make_greeting('Paula'))
                        &gt;&gt;&gt; a
                        'Hello Paula'
                        &gt;&gt;&gt;</pre
          >
          <p class="indent">
            Async functions can call other async functions using an
            <code>await</code> expression like this:<span
              epub:type="pagebreak"
              id="page_136"
            ></span>
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0136-01" id="f0136-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>async def</strong></span> make_greeting(name):
                            <span class="lgreen"><strong>return</strong></span> <span class="trose">f'Hello</span> <span class="mblue">{</span>name<span class="mblue">}</span><span class="trose">'</span>
                        
                        <span class="lgreen"><strong>async def</strong></span> main():
                            <span class="lgreen"><strong>for</strong></span> name <span class="lgreen"><strong>in</strong></span> [<span class="mblue">'Paula'</span>, <span class="mblue">'Thomas'</span>, <span class="mblue">'Lewis'</span>]:
                                a <span class="igrey">=</span> <span class="lgreen"><strong>await</strong></span> make_greeting(name)
                                print(a)
                        
                        <span class="hblue"># Run it. Will see greetings for Paula, Thomas, and Lewis</span>
                        asyncio.run(main())</pre>
          <p class="indent">
            Use of <code>await</code> is only valid within an enclosing
            <code>async</code> function definition. It’s also a required part of
            making async functions execute. If you leave off the
            <code>await</code>, you’ll find that the code breaks.
          </p>
          <p class="indent">
            The requirement of using <code>await</code> hints at a general usage
            issue with asynchronous functions. Namely, their different
            evaluation model prevents them from being used in combination with
            other parts of Python. Specifically, it is never possible to write
            code that calls an async function from a non-async function:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0136-02" id="f0136-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>async def</strong></span> twice(x):
                            <span class="lgreen"><strong>return</strong></span> <span class="sgreen">2</span> <span class="igrey">*</span> x
                        
                        <span class="lgreen"><strong>def</strong></span> main():
                            print(twice(<span class="sgreen">2</span>))         <span class="hblue"># Error. Doesn't execute the function</span>
                            print(<span class="lgreen"><strong>await</strong></span> twice(<span class="sgreen">2</span>))   <span class="hblue"># Error. Can't use await here.</span></pre>
          <p class="indent">
            Combining async and non-async functionality in the same application
            is a complex topic, especially if you consider some of the
            programming techniques involving higher-order functions, callbacks,
            and decorators. In most cases, support for asynchronous functions
            has to be built as a special case.
          </p>
          <p class="indent">
            Python does precisely this for the iterator and context manager
            protocols. For example, an asynchronous context manager can be
            defined using <code>__aenter__()</code> and
            <code>__aexit__()</code> methods on a class like this:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0136-03" id="f0136-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> AsyncManager(object):
                            <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, x):
                                <span class="dblue">self</span>.x <span class="igrey">=</span> x
                        
                            <span class="lgreen"><strong>async def</strong></span> yow(<span class="dblue">self</span>):
                                <span class="lgreen"><strong>pass</strong></span>
                        
                            <span class="lgreen"><strong>async def</strong></span> <span class="cblue">__aenter__</span>(<span class="dblue">self</span>):
                                <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>
                        
                            <span class="lgreen"><strong>async def</strong></span> <span class="cblue">__aexit__</span>(<span class="dblue">self</span>, ty, val, tb):
                                <span class="lgreen"><strong>pass</strong></span></pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_137"></span>Note that these
            methods are async functions and can thus execute other async
            functions using <code>await</code>. To use such a manager, you must
            use the special <code>async with</code> syntax that is only legal
            within an async function:
          </p>
          <p class="codelink">
            <a href="ch05_images.xhtml#rf0137-01" id="f0137-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># Example use</span>
                        <span class="lgreen"><strong>async def</strong></span> main():
                            <span class="lgreen"><strong>async with</strong></span> AsyncManager(<span class="sgreen">42</span>) as m:
                                 <span class="lgreen"><strong>await</strong></span> m.yow()
                        
                        asyncio.run(main())</pre>
          <p class="indent">
            A class can similarly define an async iterator by defining methods
            <code>__aiter__()</code> and <code>__anext__()</code>. These are
            used by the <code>async for</code> statement which also may only
            appear inside an async function.
          </p>
          <p class="indent">
            From a practical point of view, an async function behaves exactly
            the same as a normal function—it’s just that it has to execute
            within a managed environment such as <code>asyncio</code>. Unless
            you’ve made a conscious decision to work in such an environment, you
            should move along and ignore async functions. You’ll be a lot
            happier.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch05lev1sec24">
            5.24 Final Words: Thoughts on Functions and Composition
          </h3>
          <p class="noindent">
            Any system is built as a composition of components. In Python, these
            components include various sorts of libraries and objects. However,
            underlying everything are functions. Functions are the glue by which
            a system is put together and the basic mechanism of moving data
            around.
          </p>
          <p class="indent">
            Much of the discussion in this chapter focused on the nature of
            functions and their interfaces. How are the inputs presented to a
            function? How are the outputs handled? How are errors reported? How
            can all of these things be more tightly controlled and better
            understood?
          </p>
          <p class="indent">
            The interaction of functions as a potential source of complexity is
            worth thinking about when working on larger projects. It can often
            mean the difference between an intuitive easy-to-use API and a
            mess.<span epub:type="pagebreak" id="page_138"></span>
          </p>
        </section>
      </section>
    </div>
    <div id="sbo-rt-content">
      <section epub:type="chapter">
        <h2 class="h2" id="ch06">
          <span epub:type="pagebreak" id="page_139"></span
          ><span class="ash">6.</span> Generators
        </h2>
        <p class="noindent">
          Generator functions are one of Python’s most interesting and powerful
          features. Generators are often presented as a convenient way to define
          new kinds of iteration patterns. However, there is much more to them:
          Generators can also fundamentally change the whole execution model of
          functions. This chapter discusses generators, generator delegation,
          generator-based coroutines, and common applications of generators.
        </p>
        <section>
          <h3 class="h3" id="ch06lev1sec1">
            6.1 Generators and <code>yield</code>
          </h3>
          <p class="noindent">
            If a function uses the <code>yield</code> keyword, it defines an
            object known as a generator. The primary use of a generator is to
            produce values for use in iteration. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0139-01" id="f0139-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> countdown(n):
                                 print(<span class="mblue">'Counting down from'</span>, n)
                                 <span class="lgreen"><strong>while</strong></span> n <span class="igrey">&gt;</span> <span class="sgreen">0</span>:
                                      <span class="lgreen"><strong>yield</strong></span> n
                                      n <span class="igrey">-=</span> <span class="sgreen">1</span>
                            
                            <span class="hblue"># Example use</span>
                            <span class="lgreen"><strong>for</strong></span> x <span class="lgreen"><strong>in</strong></span> countdown(<span class="sgreen">10</span>):
                                print(<span class="mblue">'T-minus'</span>, x)</pre>
          <p class="indent">
            If you call this function, you will find that none of its code
            starts executing. For example:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0139-02" id="f0139-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; c = countdown(10)
                            &gt;&gt;&gt; c
                            &lt;generator object countdown at 0x105f73740
                            &gt; &gt;&gt;&gt;</pre
          >
          <p class="indent">
            Instead, a generator object is created. The generator object, in
            turn, only executes the function when you start iterating on it. One
            way to do that is to call <code>next()</code> on it:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0139-03" id="f0139-03"
              >Click here to view code image</a
            >
          </p>
          <pre>&gt;&gt;&gt; next(c)
                            Counting down from 10
                            <span epub:type="pagebreak" id="page_140"></span>10
                            &gt;&gt;&gt; next(c)
                             9</pre>
          <p class="indent">
            When <code>next()</code> is called, the generator function executes
            statements until it reaches a <code>yield</code> statement. The
            <code>yield</code> statement returns a result, at which point
            execution of the function is suspended until <code>next()</code> is
            invoked again. While it’s suspended, the function retains all of its
            local variables and execution environment. When resumed, execution
            continues with the statement following the <code>yield</code>.
          </p>
          <p class="indent">
            <code>next()</code> is a shorthand for invoking the
            <code>__next__()</code> method on a generator. For example, you
            could also do this:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0140-02" id="f0140-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; c.__next__()
                            8
                            &gt;&gt;&gt; c.__next__()
                            7
                            &gt;&gt;&gt;</pre
          >
          <p class="indent">
            You normally don’t call <code>next()</code> on a generator directly,
            but use the <code>for</code> statement or some other operation that
            consumes the items. For example:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0140-03" id="f0140-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>for</strong></span> n <span class="lgreen"><strong>in</strong></span> countdown(<span class="sgreen">10</span>):
                                 statements
                            
                            a <span class="igrey">=</span> sum(countdown(<span class="sgreen">10</span>))</pre>
          <p class="indent">
            A generator function produces items until it returns—by reaching the
            end of the function or by using a <code>return</code> statement.
            This raises a <code>StopIteration</code> exception that terminates a
            <code>for</code> loop. If a generator function returns a non-<code
              >None</code
            >
            value, it is attached to the <code>StopIteration</code> exception.
            For example, this generator function uses both
            <code>yield</code> and <code>return</code>:
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> func():
                                <span class="lgreen"><strong>yield</strong></span> <span class="sgreen">37</span>
                                <span class="lgreen"><strong>return</strong></span> <span class="sgreen">42</span></pre>
          <p class="indent">Here’s how the code would execute:</p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0140-04" id="f0140-04"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; f = func()
                            &gt;&gt;&gt; f
                            &lt;generator object func at 0x10b7cd480&gt;
                            &gt;&gt;&gt; next(f)
                            37
                            &gt;&gt;&gt; next(f)
                            Traceback (most recent call last):
                              File "&lt;stdin&gt;", line 1, in &lt;module&gt;
                            StopIteration: 42
                            &gt;&gt;&gt;</pre
          >
          <p class="indent">
            <span epub:type="pagebreak" id="page_141"></span>Observe that the
            return value is attached to <code>StopIteration</code>. To collect
            this value, you need to explicitly catch
            <code>StopIteration</code> and extract the value:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0141-01" id="f0141-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>try</strong></span>:
                                next(f)
                            <span class="lgreen"><strong>except</strong></span> <span class="pgold">StopIteration</span> as e:
                                value <span class="igrey">=</span> e.value</pre>
          <p class="indent">
            Normally, generator functions don’t return a value. Generators are
            almost always consumed by a <code>for</code> loop where there is no
            way to obtain the exception value. This means the only practical way
            to get the value is to drive the generator manually with explicit
            <code>next()</code> calls. Most code involving generators just
            doesn’t do that.
          </p>
          <p class="indent">
            A subtle issue with generators is where a generator function is only
            partially consumed. For example, consider this code that abandons a
            loop early:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0141-02" id="f0141-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>for</strong></span> n <span class="lgreen"><strong>in</strong></span> countdown(<span class="sgreen">10</span>):
                                 <span class="lgreen"><strong>if</strong></span> n <span class="igrey">==</span> <span class="sgreen">2</span>:
                                     <span class="lgreen"><strong>break</strong></span>
                                 statements</pre>
          <p class="indent">
            In this example, the <code>for</code> loop aborts by calling
            <code>break</code> and the associated generator never runs to full
            completion. If it’s important for your generator function to perform
            some kind of cleanup action, make sure you use
            <code>try-finally</code> or a context manager. For example:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0141-03" id="f0141-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> countdown(n):
                                print(<span class="mblue">'Counting down from'</span>, n)
                                <span class="lgreen"><strong>try</strong></span>:
                                     <span class="lgreen"><strong>while</strong></span> n <span class="igrey">&gt;</span> <span class="sgreen">0</span>:
                                          <span class="lgreen"><strong>yield</strong></span> n
                                          n <span class="igrey">=</span> n <span class="igrey">-</span> <span class="sgreen">1</span>
                                <span class="lgreen"><strong>finally</strong></span>:
                                     print(<span class="mblue">'Only made it to'</span>, n)</pre>
          <p class="indent">
            Generators are guaranteed to execute the <code>finally</code> block
            code even if the generator is not fully consumed—it will execute
            when the abandoned generator is garbage-collected. Similarly, any
            cleanup code involving a context manager is also guaranteed to
            execute when a generator terminates:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0141-04" id="f0141-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> func(filename):
                                <span class="lgreen"><strong>with</strong></span> open(filename) as file:
                                     ...
                                     <span class="lgreen"><strong>yield</strong></span> data
                                     ...
                                <span class="hblue"># file closed here even if generator is abandoned</span></pre>
          <p class="indent">
            Proper cleanup of resources is a tricky problem. As long as you use
            constructs such as <code>try-finally</code> or context managers,
            generators are guaranteed to do the right thing even if they are
            terminated early.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch06lev1sec2">
            <span epub:type="pagebreak" id="page_142"></span>6.2 Restartable
            Generators
          </h3>
          <p class="noindent">
            Normally a generator function executes only once. For example:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0142-01" id="f0142-01"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; c = countdown(3)
                            &gt;&gt;&gt; for n in c:
                            ...    print('T-minus', n)
                            ...
                            T-minus 3
                            T-minus 2
                            T-minus 1
                            &gt;&gt;&gt; for n in c:
                            ...    print('T-minus', n)
                            ...
                            &gt;&gt;&gt;</pre
          >
          <p class="indent">
            If you want an object that allows repeated iteration, define it as a
            class and make the <code>__iter__()</code> method a generator:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0142-02" id="f0142-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> countdown:
                                <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, start):
                                    <span class="dblue">self</span>.start <span class="igrey">=</span> start
                            
                                <span class="lgreen"><strong>def</strong></span> <span class="cblue">__iter__</span>(<span class="dblue">self</span>):
                                    n <span class="igrey">=</span> <span class="dblue">self</span>.start
                                    <span class="lgreen"><strong>while</strong></span> n <span class="igrey">&gt;</span> <span class="sgreen">0</span>:
                                        <span class="lgreen"><strong>yield</strong></span> n
                                        n <span class="igrey">-=</span> <span class="sgreen">1</span></pre>
          <p class="indent">
            This works because each time you iterate, a fresh generator is
            created by <code>__iter__()</code>.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch06lev1sec3">6.3 Generator Delegation</h3>
          <p class="noindent">
            An essential feature of generators is that a function involving
            <code>yield</code> never executes by itself—it always has to be
            driven by some other code using a <code>for</code> loop or explicit
            <code>next()</code> calls. This makes it somewhat difficult to write
            library functions involving <code>yield</code> because calling a
            generator function is not enough to make it execute. To address
            this, the <code>yield from</code> statement can be used. For
            example:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0142-03" id="f0142-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> countup(stop):
                                n <span class="igrey">=</span> <span class="sgreen">1</span>
                                <span class="lgreen"><strong>while</strong></span> n <span class="igrey">&lt;=</span> stop:
                                    <span class="lgreen"><strong>yield</strong></span> n
                                    n <span class="igrey">+=</span> <span class="sgreen">1</span>
                            
                            <span epub:type="pagebreak" id="page_143"></span><span class="lgreen"><strong>def</strong></span> countdown(start):
                                n <span class="igrey">=</span> start
                                <span class="lgreen"><strong>while</strong></span> n <span class="igrey">&gt;</span> <span class="sgreen">0</span>:
                                    <span class="lgreen"><strong>yield</strong></span> n
                                    n <span class="igrey">-=</span> <span class="sgreen">1</span>
                            
                            <span class="lgreen"><strong>def</strong></span> up_and_down(n):
                                <span class="lgreen"><strong>yield</strong></span> from countup(n)
                                <span class="lgreen"><strong>yield</strong></span> from countdown(n)</pre>
          <p class="indent">
            <code>yield from</code> effectively delegates the iteration process
            to an outer iteration. For example, you would write code like this
            to drive the iteration:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0143-02" id="f0143-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; for x in up_and_down(5):
                            ...    print(x, end=' ')
                            1 2 3 4 5 5 4 3 2 1
                            &gt;&gt;&gt;</pre
          >
          <p class="indent">
            <code>yield from</code> mainly saves you from having to drive
            iteration yourself. Without this feature, you would have to write
            <code>up_and_down(n)</code> as follows:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0143-03" id="f0143-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> up_and_down(n):
                                <span class="lgreen"><strong>for</strong></span> x <span class="lgreen"><strong>in</strong></span> countup(n):
                                    <span class="lgreen"><strong>yield</strong></span> x
                                <span class="lgreen"><strong>for</strong></span> x <span class="lgreen"><strong>in</strong></span> countdown(n):
                                    <span class="lgreen"><strong>yield</strong></span> x</pre>
          <p class="indent">
            <code>yield from</code> is especially useful when writing code that
            must recursively iterate through nested iterables. For example, this
            code flattens nested lists:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0143-04" id="f0143-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> flatten(items):
                                <span class="lgreen"><strong>for</strong></span> i <span class="lgreen"><strong>in</strong></span> items:
                                    <span class="lgreen"><strong>if</strong></span> isinstance(i, list):
                                        <span class="lgreen"><strong>yield</strong></span> from flatten(i)
                                    <span class="lgreen"><strong>else</strong></span>:
                                        <span class="lgreen"><strong>yield</strong></span> i</pre>
          <p class="indent">Here is an example of how this works:</p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0143-05" id="f0143-05"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; a = [1, 2, [3, [4, 5], 6, 7], 8]
                            &gt;&gt;&gt; for x in flatten(a):
                            ...    print(x, end=' ')
                            ...
                            1 2 3 4 5 6 7 8
                            &gt;&gt;&gt;</pre
          >
          <p class="indent">
            <span epub:type="pagebreak" id="page_144"></span>One limitation of
            this implementation is that it is still subject to Python’s
            recursion limit, so it would not be able to handle deeply nested
            structures. This will be addressed in the next section.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch06lev1sec4">6.4 Using Generators in Practice</h3>
          <p class="noindent">
            At first glance, it might not be obvious how to use generators for
            practical problems beyond defining simple iterators. However,
            generators are particularly effective at structuring various data
            handling problems related to pipelines and workflows.
          </p>
          <p class="indent">
            One useful application of generators is as a tool for restructuring
            code that consists of deeply nested <code>for</code> loops and
            conditionals. Consider this script that searches a directory of
            Python files for all comments containing the word “spam”:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0144-01" id="f0144-01"
              >Click here to view code image</a
            >
          </p>
          <pre>import pathlib
                            import re
                            
                            
                            <span class="lgreen"><strong>for</strong></span> path <span class="lgreen"><strong>in</strong></span> pathlib.Path(<span class="mblue">'.'</span>).rglob(<span class="mblue">'*.py'</span>):
                                <span class="lgreen"><strong>if</strong></span> path.exists():
                                    <span class="lgreen"><strong>with</strong></span> path.open(<span class="mblue">'rt'</span>, encoding<span class="igrey">=</span><span class="mblue">'latin-1'</span>) as file:
                                        <span class="lgreen"><strong>for</strong></span> line <span class="lgreen"><strong>in</strong></span> file:
                                            m <span class="igrey">=</span> re.match(<span class="mblue">'.*(#.*)$'</span>, line)
                                            <span class="lgreen"><strong>if</strong></span> m:
                                                 comment <span class="igrey">=</span> m.group(<span class="sgreen">1</span>)
                                                 <span class="lgreen"><strong>if</strong></span> <span class="mblue">'spam'</span> <span class="lgreen"><strong>in</strong></span> comment:
                                                     print(comment)</pre>
          <p class="indent">
            Notice the number of levels of nested control flow. Your eyes are
            already starting to hurt as you look at the code. Now, consider this
            version using generators:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0144-02" id="f0144-02"
              >Click here to view code image</a
            >
          </p>
          <pre>import pathlib
                            import re
                            
                            <span class="lgreen"><strong>def</strong></span> get_paths(topdir, pattern):
                                <span class="lgreen"><strong>for</strong></span> path <span class="lgreen"><strong>in</strong></span> pathlib.Path(topdir).rglob(pattern)
                                    <span class="lgreen"><strong>if</strong></span> path.exists():
                                        <span class="lgreen"><strong>yield</strong></span> path
                            
                            <span class="lgreen"><strong>def</strong></span> get_files(paths):
                                <span class="lgreen"><strong>for</strong></span> path <span class="lgreen"><strong>in</strong></span> paths:
                                    <span class="lgreen"><strong>with</strong></span> path.open(<span class="mblue">'rt'</span>, encoding<span class="igrey">=</span><span class="mblue">'latin-1'</span>) as file:
                                         <span class="lgreen"><strong>yield</strong></span> file
                            
                            <span class="lgreen"><strong>def</strong></span> get_lines(files):
                                <span class="lgreen"><strong>for</strong></span> file <span class="lgreen"><strong>in</strong></span> files:
                                    <span class="lgreen"><strong>yield</strong></span> from file
                            
                            <span epub:type="pagebreak" id="page_145"></span><span class="lgreen"><strong>def</strong></span> get_comments(lines):
                                <span class="lgreen"><strong>for</strong></span> line <span class="lgreen"><strong>in</strong></span> lines:
                                    m <span class="igrey">=</span> re.match(<span class="mblue">'.*(#.*)$'</span>, line)
                                    <span class="lgreen"><strong>if</strong></span> m:
                                        <span class="lgreen"><strong>yield</strong></span> m.group(<span class="sgreen">1</span>)
                            
                            <span class="lgreen"><strong>def</strong></span> print_matching(lines, substring):
                                <span class="lgreen"><strong>for</strong></span> line <span class="lgreen"><strong>in</strong></span> lines:
                                    <span class="lgreen"><strong>if</strong></span> substring <span class="lgreen"><strong>in</strong></span> lines:
                                        print(substring)
                            
                            paths <span class="igrey">=</span> get_paths(<span class="mblue">'.'</span>, <span class="mblue">'*.py'</span>)
                            files <span class="igrey">=</span> get_files(pypaths)
                            lines <span class="igrey">=</span> get_lines(pyfiles)
                            comments <span class="igrey">=</span> get_comments(lines)
                            print_matching(comments, <span class="mblue">'spam'</span>)</pre>
          <p class="indent">
            In this section, the problem is broken down into smaller
            self-contained components. Each component only concerns itself with
            a specific task. For example, the <code>get_paths()</code> generator
            is only concerned with path names, the
            <code>get_files()</code> generator is only concerned with opening
            files, and so forth. It is only at the end that these generators are
            hooked together into a workflow to solve a problem.
          </p>
          <p class="indent">
            Making each component small and isolated is a good abstraction
            technique. For example, consider the
            <code>get_comments()</code> generator. As input, it takes any
            iterable producing lines of text. This text could come from almost
            anywhere—a file, a list, a generator, and so on. As a result, this
            functionality is much more powerful and adaptable than it was when
            it was embedded into a deeply nested <code>for</code> loop involving
            files. Generators thus encourage code reuse by breaking problems
            into small well-defined computational tasks. Smaller tasks are also
            easier to reason about, debug, and test.
          </p>
          <p class="indent">
            Generators are also useful for altering the normal evaluation rules
            of function application. Normally, when you apply a function, it
            executes immediately, producing a result. Generators don’t do that.
            When a generator function is applied, its execution is delayed until
            some other bit of code invokes <code>next()</code> on it (either
            explicitly or by a <code>for</code> loop).
          </p>
          <p class="indent">
            As an example, consider again the generator function for flattening
            nested lists:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0145-02" id="f0145-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> flatten(items):
                                <span class="lgreen"><strong>for</strong></span> i <span class="lgreen"><strong>in</strong></span> items:
                                    <span class="lgreen"><strong>if</strong></span> isinstance(i, list):
                                        <span class="lgreen"><strong>yield</strong></span> from flatten(i)
                                    <span class="lgreen"><strong>else</strong></span>:
                                        <span class="lgreen"><strong>yield</strong></span> i</pre>
          <p class="indent">
            One problem with this implementation is that, due to Python’s
            recursion limit, it won’t work with deeply nested structures. This
            can be fixed by driving iteration in a different way using a stack.
            Consider this version:<span
              epub:type="pagebreak"
              id="page_146"
            ></span>
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0146-01" id="f0146-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> flatten(items):
                                stack <span class="igrey">=</span> [ iter(items) ]
                                <span class="lgreen"><strong>while</strong></span> stack:
                                    <span class="lgreen"><strong>try</strong></span>:
                                        item <span class="igrey">=</span> next(stack[<span class="igrey">-</span><span class="sgreen">1</span>])
                                        <span class="lgreen"><strong>if</strong></span> isinstance(item, list):
                                            stack.append(iter(item))
                                        <span class="lgreen"><strong>else</strong></span>:
                                            <span class="lgreen"><strong>yield</strong></span> item
                                    <span class="lgreen"><strong>except</strong></span> <span class="pgold">StopIteration</span>:
                                        stack.pop()</pre>
          <p class="indent">
            This implementation builds an internal stack of iterators. It is not
            subject to Python’s recursion limit because it’s putting data on an
            internal list as opposed to building frames on the internal
            interpreter stack. Thus, if you find yourself in need of flattening
            a few million layers of some uncommonly deep data structure, you’ll
            find that this version works fine.
          </p>
          <p class="indent">
            Do these examples mean that you should rewrite all of your code
            using wild generator patterns? No. The main point is that the
            delayed evaluation of generators allows you to alter the spacetime
            dimensions of normal function evaluation. There are various
            real-world scenarios where these techniques can be useful and
            applied in unexpected ways.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch06lev1sec5">
            6.5 Enhanced Generators and <code>yield</code> Expressions
          </h3>
          <p class="noindent">
            Inside a generator function, the <code>yield</code> statement can
            also be used as an expression that appears on the right-hand side of
            an assignment operator. For example:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0146-02" id="f0146-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> receiver():
                                print(<span class="mblue">'Ready to receive'</span>)
                                <span class="lgreen"><strong>while</strong></span> <span class="dblue">True</span>:
                                      n <span class="igrey">=</span> <span class="lgreen"><strong>yield</strong></span>
                                      print(<span class="mblue">'Got'</span>, n)</pre>
          <p class="indent">
            A function that uses <code>yield</code> in this manner is sometimes
            known as an “enhanced generator” or “generator-based coroutine.”
            Sadly, this terminology is a bit imprecise and made even more
            confusing since “coroutines” are more recently associated with async
            functions. To avoid this confusion, we’ll use the term “enhanced
            generator” to make it clear that we’re still talking about standard
            functions that use <code>yield</code>.
          </p>
          <p class="indent">
            A function that uses <code>yield</code> as an expression is still a
            generator, but its usage is different. Instead of producing values,
            it executes in response to values sent to it. For example:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0146-03" id="f0146-03"
              >Click here to view code image</a
            >
          </p>
          <pre>&gt;&gt;&gt; r = receiver()
                            &gt;&gt;&gt; r.send(None)        # Advances to the first yield
                            Ready to receive
                            <span epub:type="pagebreak" id="page_147"></span>&gt;&gt;&gt; r.send(1)
                            Got 1
                            &gt;&gt;&gt; r.send(2)
                            Got 2
                            &gt;&gt;&gt; r.send('Hello')
                            Got Hello
                            &gt;&gt;&gt;</pre>
          <p class="indent">
            In this example, the initial call to <code>r.send(None)</code> is
            necessary so that the generator executes statements leading to the
            first <code>yield</code> expression. At this point, the generator
            suspends, waiting for a value to be sent to it using the
            <code>send()</code> method of the associated generator object
            <code>r</code>. The value passed to <code>send()</code> is returned
            by the <code>yield</code> expression in the generator. Upon
            receiving a value, a generator executes statements until the next
            <code>yield</code> is encountered.
          </p>
          <p class="indent">
            As written, the function runs indefinitely. The
            <code>close()</code> method can be used to shut down the generator
            as follows:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0147-02" id="f0147-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; r.close()
                            &gt;&gt;&gt; r.send(4)
                            Traceback (most recent call last):
                              File "&lt;stdin&gt;", line 1, <strong>in</strong> &lt;module&gt;
                            StopIteration
                            &gt;&gt;&gt;</pre
          >
          <p class="indent">
            The <code>close()</code> operation raises a
            <code>GeneratorExit</code> exception inside the generator at the
            current <code>yield</code>. Normally, this causes the generator to
            terminate silently; if you’re so inclined, you can catch it to
            perform cleanup actions. Once closed, a
            <code>StopIteration</code> exception will be raised if further
            values are sent to a generator.
          </p>
          <p class="indent">
            Exceptions can be raised inside a generator using the
            <code>throw(ty [,val [,tb]])</code> method where <code>ty</code> is
            the exception type, <code>val</code> is the exception argument (or
            tuple of arguments), and <code>tb</code> is an optional traceback.
            For example:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0147-03" id="f0147-03"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; r = receiver()
                            Ready to receive
                            &gt;&gt;&gt; r.throw(RuntimeError,  "Dead")
                            Traceback (most recent call last):
                              File "&lt;stdin&gt;", line 1, <strong>in</strong> &lt;module&gt;
                              File "receiver.py", line 14, <strong>in</strong> receiver
                                n = <strong>yield</strong>
                            RuntimeError: Dead
                            &gt;&gt;&gt;</pre
          >
          <p class="indent">
            Exceptions raised in either manner will propagate from the currently
            executing <code>yield</code> statement in the generator. A generator
            can elect to catch the exception and handle it as is appropriate. If
            a generator doesn’t handle the exception, it propagates out of the
            generator to be handled at a higher level.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch06lev1sec6">
            <span epub:type="pagebreak" id="page_148"></span>6.6 Applications of
            Enhanced Generators
          </h3>
          <p class="noindent">
            Enhanced generators are an odd programming construct. Unlike a
            simple generator which naturally feeds a <code>for</code> loop,
            there is no core language feature that drives an enhanced generator.
            Why, then, would you ever want a function that needs values to be
            sent to it? Is it purely academic?
          </p>
          <p class="indent">
            Historically, enhanced generators have been used in the context of
            concurrency libraries—especially those based on asynchronous I/O. In
            that context, they’re usually referred to as “coroutines” or
            “generator-based coroutines.” However, much of that functionality
            has been folded into the <code>async</code> and
            <code>await</code> features of Python. There is little practical
            reason to use <code>yield</code> for that specific use case. That
            said, there are still some practical applications.
          </p>
          <p class="indent">
            Like generators, an enhanced generator can be used to implement
            different kinds of evaluation and control flow. One example is the
            <code>@contextmanager</code> decorator found in the
            <code>contextlib</code> module. For example:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0148-01" id="f0148-01"
              >Click here to view code image</a
            >
          </p>
          <pre>from contextlib import contextmanager
                            
                            <span class="wasabi">@contextmanager</span>
                            <span class="lgreen"><strong>def</strong></span> manager():
                                print(<span class="mblue">"Entering"</span>)
                                <span class="lgreen"><strong>try</strong></span>:
                                     <span class="lgreen"><strong>yield</strong></span> <span class="mblue">'somevalue'</span>
                                <span class="lgreen"><strong>except</strong></span> <span class="pgold">Exception</span> as e:
                                     print(<span class="mblue">"An error occurred"</span>, e)
                                <span class="lgreen"><strong>finally</strong></span>:
                                     print(<span class="mblue">"Leaving"</span>)</pre>
          <p class="indent">
            Here, a generator is being used to glue together the two halves of a
            context manager. Recall that context managers are defined by objects
            implementing the following protocol:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0148-02" id="f0148-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Manager:
                                <span class="lgreen"><strong>def</strong></span> <span class="cblue">__enter__</span>(<span class="dblue">self</span>):
                                    <span class="lgreen"><strong>return</strong></span> somevalue
                            
                                <span class="lgreen"><strong>def</strong></span> <span class="cblue">__exit__</span>(<span class="dblue">self</span>, ty, val, tb):
                                    <span class="lgreen"><strong>if</strong></span> ty:
                                        <span class="hblue"># An exception occurred</span>
                                        ...
                                        <span class="hblue"># Return True/ if handled. False otherwise</span></pre>
          <p class="indent">
            With the <code>@contextmanager</code> generator, everything prior to
            the <code>yield</code> statement executes when the manager enters
            (via the <code>__enter__()</code> method). Everything after the
            <code>yield</code> executes when the manager exits (via the
            <code>__exit__()</code> method). If an error took place, it is
            reported as an exception on the <code>yield</code> statement. Here
            is an example:<span epub:type="pagebreak" id="page_149"></span>
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0149-01" id="f0149-01"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; with manager() as val:
                            ...        print(val)
                            ...
                            Entering
                            somevalue
                            Leaving
                            &gt;&gt;&gt; with manager() as val:
                            ...        print(int(val))
                            ...
                            Entering
                            An error occurred invalid literal for int() with base 10: 'somevalue'
                            Leaving
                            &gt;&gt;&gt;</pre
          >
          <p class="indent">
            To implement this, a wrapper class is used. This is a simplified
            implementation that illustrates the basic idea:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0149-02" id="f0149-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Manager:
                                <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, gen):
                                    <span class="dblue">self</span>.gen <span class="igrey">=</span> gen
                            
                                <span class="lgreen"><strong>def</strong></span> <span class="cblue">__enter__</span>(<span class="dblue">self</span>):
                                    <span class="hblue"># Run to the yield</span>
                                    <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>.gen.send(<span class="dblue">None</span>)
                            
                                <span class="lgreen"><strong>def</strong></span> <span class="cblue">__exit__</span>(<span class="dblue">self</span>, ty, val, tb):
                                    <span class="hblue"># Propagate an exception (if any)</span>
                                    <span class="lgreen"><strong>try</strong></span>:
                                        <span class="lgreen"><strong>if</strong></span> ty:
                                            <span class="lgreen"><strong>try</strong></span>:
                                                <span class="dblue">self</span>.gen.throw(ty, val, tb)
                                            <span class="lgreen"><strong>except</strong></span> ty:
                                                <span class="lgreen"><strong>return</strong></span> <span class="dblue">False</span>
                                        <span class="lgreen"><strong>else</strong></span>:
                                                    <span class="dblue">self</span>.gen.send(<span class="dblue">None</span>)
                                            <span class="lgreen"><strong>except</strong></span> <span class="pgold">StopIteration</span>:
                                                <span class="lgreen"><strong>return</strong></span> <span class="dblue">True</span></pre>
          <p class="indent">
            Another application of extended generators is using functions to
            encapsulate a “worker” task. One of the central features of a
            function call is that it sets up an environment of local variables.
            Access to those variables is highly optimized—it’s much faster than
            accessing attributes of classes and instances. Since generators stay
            alive until explicitly closed or destroyed, one might use a
            generator to set up a long-lived task. Here is an example of a
            generator that receives byte fragments and assembles them into
            lines:<span epub:type="pagebreak" id="page_150"></span>
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0150-01" id="f0150-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="wasabi">@consumer</span>
                            <span class="lgreen"><strong>def</strong></span> line_receiver():
                                data <span class="igrey">=</span> bytearray()
                                line <span class="igrey">=</span> <span class="dblue">None</span>
                                linecount <span class="igrey">=</span> <span class="sgreen">0</span>
                                <span class="lgreen"><strong>while</strong></span> <span class="dblue">True</span>:
                                    part <span class="igrey">=</span> <span class="lgreen"><strong>yield</strong></span> line
                                    linecount <span class="igrey">+=</span> part.count(b<span class="mblue">'\n'</span>)
                                    data.extend(part)
                                    <span class="lgreen"><strong>if</strong></span> linecount <span class="igrey">&gt;</span> <span class="sgreen">0</span>:
                                        index <span class="igrey">=</span> data.index(b<span class="mblue">'\n'</span>)
                                        line <span class="igrey">=</span> bytes(data[:index<span class="igrey">+</span><span class="sgreen">1</span>])
                                        data <span class="igrey">=</span> data[index<span class="igrey">+</span><span class="sgreen">1</span>:]
                                        linecount <span class="igrey">-=</span> <span class="sgreen">1</span>
                                    <span class="lgreen"><strong>else</strong></span>:
                                        line <span class="igrey">=</span> <span class="dblue">None</span></pre>
          <p class="indent">
            In this example, a generator receives byte fragments that are
            collected into a byte array. If the array contains a newline, a line
            is extracted and returned. Otherwise, <code>None</code> is returned.
            Here’s an example illustrating how it works:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0150-02" id="f0150-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; r = line_receiver()
                            &gt;&gt;&gt; r.send(b'hello')
                            &gt;&gt;&gt; r.send(b'world\nit ')
                            b'hello world\n'
                            &gt;&gt;&gt; r.send(b'works!')
                            &gt;&gt;&gt; r.send(b'\n')
                            b'it works!\n''
                            &gt;&gt;&gt;</pre
          >
          <p class="indent">
            Similar code could be written as a class such as this:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0150-03" id="f0150-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> LineReceiver:
                                <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>):
                                    <span class="dblue">self</span>.data <span class="igrey">=</span> bytearray()
                                    <span class="dblue">self</span>.linecount <span class="igrey">=</span> <span class="sgreen">0</span>
                            
                                <span class="lgreen"><strong>def</strong></span> send(<span class="dblue">self</span>, part):
                                    <span class="dblue">self</span>.linecount <span class="igrey">+=</span> part.count(b<span class="mblue">'\n'</span>)
                                    <span class="dblue">self</span>.data.extend(part)
                                    <span class="lgreen"><strong>if</strong></span> <span class="dblue">self</span>.linecount <span class="igrey">&gt;</span> <span class="sgreen">0</span>:
                                        index <span class="igrey">=</span> <span class="dblue">self</span>.data.index(b<span class="mblue">'\n'</span>)
                                        line <span class="igrey">=</span> bytes(<span class="dblue">self</span>.data[:index<span class="igrey">+</span><span class="sgreen">1</span>])
                                        <span class="dblue">self</span>.data <span class="igrey">=</span> <span class="dblue">self</span>.data[index<span class="igrey">+</span><span class="sgreen">1</span>:]
                                        <span class="dblue">self</span>.linecount <span class="igrey">-=</span> <span class="sgreen">1</span>
                                        <span class="lgreen"><strong>return</strong></span> line
                            <span epub:type="pagebreak" id="page_151"></span>        <span class="lgreen"><strong>else</strong></span>:
                                        <span class="lgreen"><strong>return</strong></span> <span class="dblue">None</span></pre>
          <p class="indent">
            Although writing a class might be more familiar, the code is more
            complex and runs slower. Tested on the author’s machine, feeding a
            large collection of chunks into a receiver is about 40–50% faster
            with a generator than with this class code. Most of those savings
            are due to the elimination of instance attribute lookup—local
            variables are faster.
          </p>
          <p class="indent">
            Although there are many other potential applications, the important
            thing to keep in mind is that if you see <code>yield</code> being
            used in a context that is not involving iteration, it is probably
            using the enhanced features such as <code>send()</code> or
            <code>throw()</code>.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch06lev1sec7">
            6.7 Generators and the Bridge to Awaiting
          </h3>
          <p class="noindent">
            A classic use of generator functions is in libraries related to
            asynchronous I/O such as in the standard
            <code>asyncio</code> module. However, since Python 3.5 much of this
            functionality has been moved into a different language feature
            related to <code>async</code> functions and the
            <code>await</code> statement (see the last part of
            <a href="ch05.xhtml#ch05">Chapter 5</a>).
          </p>
          <p class="indent">
            The <code>await</code> statement involves interacting with a
            generator in disguise. Here is an example that illustrates the
            underlying protocol used by <code>await</code>:
          </p>
          <p class="codelink">
            <a href="ch06_images.xhtml#rf0151-02" id="f0151-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Awaitable:
                                <span class="lgreen"><strong>def</strong></span> <span class="cblue">__await__</span>(<span class="dblue">self</span>):
                                    print(<span class="mblue">'About to await'</span>)
                                    <span class="lgreen"><strong>yield</strong></span>    <span class="hblue"># Must be a generator</span>
                                    print(<span class="mblue">'Resuming'</span>)
                            
                            <span class="hblue"># Function compatible with "await". Returns an "awaitable"</span>
                            <span class="lgreen"><strong>def</strong></span> function():
                                <span class="lgreen"><strong>return</strong></span> Awaitable()
                            
                            <span class="lgreen"><strong>async def</strong></span> main():
                                <span class="lgreen"><strong>await</strong></span> function()</pre>
          <p class="indent">
            Here is how you might try the code using <code>asyncio</code>:
          </p>
          <pre>
&gt;&gt;&gt; import asyncio
                            &gt;&gt;&gt; asyncio.run(main())
                            About to await
                            Resuming
                            &gt;&gt;&gt;</pre
          >
          <p class="indent">
            Is it absolutely essential to know how this works? Probably not. All
            of this machinery is normally hidden from view. However, if you ever
            find yourself using async functions, just know that there is a
            generator function buried somewhere inside. You’ll eventually find
            it if you just keep on digging the hole of technical debt deep
            enough.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch06lev1sec8">
            <span epub:type="pagebreak" id="page_152"></span>6.8 Final Words: A
            Brief History of Generators and Looking Forward
          </h3>
          <p class="noindent">
            Generators are one of Python’s more interesting success stories.
            They are also part of a greater story concerning iteration.
            Iteration is one of the most common programming tasks of all. In
            early versions of Python, iteration was implemented via sequence
            indexing and the <code>__getitem__()</code> method. This later
            evolved into the current iteration protocol based on
            <code>__iter__()</code> and <code>__next__()</code> methods.
            Generators appeared shortly thereafter as a more convenient way to
            implement an iterator. In modern Python, there is almost no reason
            to ever implement an iterator using anything other than a generator.
            Even on iterable objects that you might define yourself, the
            <code>__iter__()</code> method itself is conveniently implemented in
            this way.
          </p>
          <p class="indent">
            In later versions of Python, generators took on a new role as they
            evolved enhanced features related to coroutines—the
            <code>send()</code> and <code>throw()</code> methods. These were no
            longer limited to iteration but opened up possibilities for using
            generators in other contexts. Most notably, this formed the basis of
            many so-called “async” frameworks used for network programming and
            concurrency. However, as asynchronous programming has evolved, most
            of this has transformed into later features that use the
            <code>async</code>/<code>await</code> syntax. Thus, it’s not so
            common to see generator functions used outside of the context of
            iteration—their original purpose. In fact, if you find yourself
            defining a generator function and you’re <em>not</em> performing
            iteration, you should probably reconsider your approach. There may
            be a better or more modern way to accomplish what you’re doing.
          </p>
        </section>
      </section>
    </div>
    <div id="sbo-rt-content">
      <section epub:type="chapter">
        <h2 class="h2" id="ch07">
          <span epub:type="pagebreak" id="page_153"></span
          ><span class="ash">7.</span> Classes and Object-Oriented Programming
        </h2>
        <p class="noindent">
          Classes are used to create new kinds of objects. This chapter covers
          the details of classes—but is not intended to be an in-depth reference
          on object-oriented programming and design. Some programming patterns
          common in Python are discussed, as well as ways that you can customize
          classes to behave in interesting ways. The overall structure of this
          chapter is top-down. High-level concepts and techniques for using
          classes are described first. In later parts of the chapter, the
          material gets more technical and focused on internal implementation.
        </p>
        <section>
          <h3 class="h3" id="ch07lev1sec1">7.1 Objects</h3>
          <p class="noindent">
            Almost all code in Python involves creating and performing actions
            on <em>objects</em>. For example, you might make a string object and
            manipulate it as follows:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0153-01" id="f0153-01"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; s = "Hello World"
                                &gt;&gt;&gt; s.upper()
                                'HELLO WORLD'
                                &gt;&gt;&gt; s.replace('Hello', 'Hello Cruel')
                                'Hello Cruel World'
                                &gt;&gt;&gt; s.split()
                                ['Hello', 'World']
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">or a list object:</p>
          <pre>
&gt;&gt;&gt; names = ['Paula', 'Thomas']
                                &gt;&gt;&gt; names.append('Lewis')
                                &gt;&gt;&gt; names
                                ['Paula', 'Thomas', 'Lewis']
                                &gt;&gt;&gt; names[1] = 'Tom'
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            <span epub:type="pagebreak" id="page_154"></span>An essential
            feature of each object is that it usually has some kind of state—the
            characters of a string, the elements of a list, and so on, as well
            as methods that operate on that state. The methods are invoked
            through the object itself—as if they are functions attached to the
            object via the dot (<code>.</code>) operator.
          </p>
          <p class="indent">
            Objects always have an associated type. You can view it using
            <code>type()</code>:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0154-01" id="f0154-01"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; type(names)
                                &lt;<strong>class</strong> 'list'&gt;
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            An object is said to be an <em>instance</em> of its type. For
            example, <code>names</code> is an instance of <code>list</code>.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec2">
            7.2 The <code>class</code> Statement
          </h3>
          <p class="noindent">
            New objects are defined using the <code>class</code> statement. A
            class typically consists of a collection of functions that make up
            the methods. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0154-02" id="f0154-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Account:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, owner, balance):
                                        <span class="dblue">self</span>.owner <span class="igrey">=</span> owner
                                        <span class="dblue">self</span>.balance <span class="igrey">=</span> balance
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__repr__</span>(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="trose">f'Account(</span><span class="mblue">{</span><span class="dblue">self</span><span class="mblue">.</span>owner<span class="mblue">!r}</span><span class="trose">,</span> <span class="mblue">{</span><span class="dblue">self</span><span class="mblue">.</span>balance<span class="mblue">!r}</span><span class="trose">)'</span>
                                
                                    <span class="lgreen"><strong>def</strong></span> deposit(<span class="dblue">self</span>, amount):
                                        <span class="dblue">self</span>.balance <span class="igrey">+=</span> amount
                                
                                    <span class="lgreen"><strong>def</strong></span> withdraw(<span class="dblue">self</span>, amount):
                                        <span class="dblue">self</span>.balance <span class="igrey">-=</span> amount
                                
                                    <span class="lgreen"><strong>def</strong></span> inquiry(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>.balance</pre>
          <p class="indent">
            It’s important to note that a <code>class</code> statement by itself
            doesn’t create any instances of the class. For example, no accounts
            are actually created in the preceding example. Rather, a class
            merely holds the methods that will be available on the instances
            created later. You might think of it as a blueprint.
          </p>
          <p class="indent">
            The functions defined inside a class are known as methods. An
            instance method is a function that operates on an instance of the
            class, which is passed as the first argument. By convention, this
            argument is called <code>self</code>. In the preceding example,
            <code>deposit()</code>, <code>withdraw()</code>, and
            <code>inquiry()</code> are examples of instance methods.
          </p>
          <p class="indent">
            The <code>__init__()</code> and <code>__repr__()</code> methods of
            the class are examples of so-called <em>special</em> or
            <em>magic</em> methods. These methods have special meaning to the
            interpreter runtime. The <code>__init__()</code> method is used to
            initialize state when a new instance is created. The
            <span epub:type="pagebreak" id="page_155"></span
            ><code>__repr__()</code> method returns a string for viewing an
            object. Defining this method is optional, but doing so simplifies
            debugging and makes it easier to view objects from the interactive
            prompt.
          </p>
          <p class="indent">
            A class definition may optionally include a documentation string and
            type hints. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0155-01" id="f0155-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Account:
                                    <span class="hblue">'''</span>
                                    <span class="hblue">A simple bank account</span>
                                    <span class="hblue">'''</span>
                                    owner: str
                                    balance: float
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, owner:str, balance:float):
                                        <span class="dblue">self</span>.owner <span class="igrey">=</span> owner
                                        <span class="dblue">self</span>.balance <span class="igrey">=</span> balance
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__repr__</span>(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="trose">f'Account(</span><span class="mblue">{</span><span class="dblue">self</span><span class="mblue">.</span>owner<span class="mblue">!r}</span><span class="trose">,</span> <span class="mblue">{</span><span class="dblue">self</span><span class="mblue">.</span>balance<span class="mblue">!r}</span><span class="trose">)'</span>
                                
                                    <span class="lgreen"><strong>def</strong></span> deposit(<span class="dblue">self</span>, amount:float):
                                        <span class="dblue">self</span>.balance <span class="igrey">+=</span> amount
                                
                                    <span class="lgreen"><strong>def</strong></span> withdraw(<span class="dblue">self</span>, amount:float):
                                        <span class="dblue">self</span>.balance <span class="igrey">-=</span> amount
                                
                                    <span class="lgreen"><strong>def</strong></span> inquiry(<span class="dblue">self</span>) <span class="igrey">-&gt;</span> float:
                                        <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>.balance</pre>
          <p class="indent">
            Type hints do not change any aspect of how a class works—that is,
            they do not introduce any extra checking or validation. It is purely
            metadata that might be useful for third-party tools or IDEs, or used
            by certain advanced programming techniques. They are not used in
            most examples that follow.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec3">7.3 Instances</h3>
          <p class="noindent">
            Instances of a class are created by calling a class object as a
            function. This creates a new instance that is then passed to the
            <code>__init__()</code> method. The arguments to
            <code>__init__()</code> consist of the newly created instance
            <code>self</code> along with the arguments supplied in calling the
            class object. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0155-02" id="f0155-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># Create a few accounts</span>
                                
                                a <span class="igrey">=</span> Account(<span class="mblue">'Guido'</span>, <span class="sgreen">1000.0</span>)
                                <span class="hblue"># Calls Account.__init__(a, 'Guido', 1000.0)</span>
                                
                                <span epub:type="pagebreak" id="page_156"></span>b <span class="igrey">=</span> Account(<span class="mblue">'Eva'</span>, <span class="sgreen">10.0</span>)
                                <span class="hblue"># Calls Account.__init__(b, 'Eva', 10.0)</span></pre>
          <p class="indent">
            Inside <code>__init__()</code>, attributes are saved on the instance
            by assigning to <code>self</code>. For example,
            <code>self.owner = owner</code> is saving an attribute on the
            instance. Once the newly created instance has been returned, these
            attributes, as well as methods of the class, are accessed using the
            dot (<code>.</code>) operator:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0156-02" id="f0156-02"
              >Click here to view code image</a
            >
          </p>
          <pre>a.deposit(<span class="sgreen">100.0</span>)        <span class="hblue"># Calls Account.deposit(a, 100.0)</span>
                                b.withdraw(<span class="sgreen">50.00</span>        <span class="hblue"># Calls Account.withdraw(b, 50.0)</span>
                                owner <span class="igrey">=</span> a.owner         <span class="hblue"># Get account owner</span></pre>
          <p class="indent">
            It’s important to emphasize that each instance has its own state.
            You can view instance variables using the
            <code>vars()</code> function. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0156-03" id="f0156-03"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; a = Account('Guido', 1000.0)
                                &gt;&gt;&gt; b = Account('Eva', 10.0)
                                &gt;&gt;&gt; vars(a)
                                {'owner': 'Guido', 'balance': 1000.0}
                                &gt;&gt;&gt; vars(b)
                                {'owner': 'Eva', 'balance': 10.0}
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            Notice that the methods do not appear here. The methods are found on
            the class instead. Every instance keeps a link to its class via its
            associated type. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0156-04" id="f0156-04"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; type(a)
                                &lt;class 'Account'&gt;
                                &gt;&gt;&gt; type(b)
                                &lt;class 'Account'&gt;
                                &gt;&gt;&gt; type(a).deposit
                                &lt;function Account.deposit at 0x10a032158&gt;
                                &gt;&gt;&gt; type(a).inquiry
                                &lt;function Account.inquiry at 0x10a032268&gt;
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            A later section discusses the implementation details of attribute
            binding and the relationship between instances and classes.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec4">7.4 Attribute Access</h3>
          <p class="noindent">
            There are only three basic operations that can be performed on an
            instance: getting, setting, and deleting an attribute. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0156-05" id="f0156-05"
              >Click here to view code image</a
            >
          </p>
          <pre>&gt;&gt;&gt; a = Account('Guido', 1000.0)
                                &gt;&gt;&gt; a.owner               # get
                                <span epub:type="pagebreak" id="page_157"></span>'Guido'
                                &gt;&gt;&gt; a.balance = 750.0    # set
                                &gt;&gt;&gt; del a.balance        # delete
                                &gt;&gt;&gt; a.balance
                                Traceback (most recent call last):
                                  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
                                AttributeError: 'Account' object has no attribute 'balance'
                                &gt;&gt;&gt;</pre>
          <p class="indent">
            Everything in Python is a dynamic process with very few
            restrictions. If you want to add a new attribute to an object after
            it’s been created, you’re free to do that. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0157-02" id="f0157-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; a = Account('Guido', 1000.0)
                                &gt;&gt;&gt; a.creation_date = '2019-02-14'
                                &gt;&gt;&gt; a.nickname = 'Former BDFL'
                                &gt;&gt;&gt; a.creation_date
                                '2019-02-14'
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            Instead of using dot (<code>.</code>) to perform these operations,
            you can supply an attribute name as a string to the
            <code>getattr()</code>, <code>setattr()</code>, and
            <code>delattr()</code> functions. The
            <code>hasattr()</code> function tests for the existence of an
            attribute. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0157-03" id="f0157-03"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; a = Account('Guido', 1000.0)
                                &gt;&gt;&gt; getattr(a, 'owner')
                                'Guido'
                                &gt;&gt;&gt; setattr(a, 'balance', 750.0)
                                &gt;&gt;&gt; delattr(a, 'balance')
                                &gt;&gt;&gt; hasattr(a, 'balance')
                                False
                                &gt;&gt;&gt; getattr(a, 'withdraw')(100)    # Method call
                                &gt;&gt;&gt; a
                                Account('Guido', 650.0)
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            <code>a.attr</code> and <code>getattr(a, 'attr')</code> are
            interchangeable, so <code>getattr(a, 'withdraw')(100)</code> is the
            same as <code>a.withdraw(100)</code>. It matters not that
            <code>withdraw()</code> is a method.
          </p>
          <p class="indent">
            The <code>getattr()</code> function is notable for taking an
            optional default value. If you wanted to look up an attribute that
            may or may not exist, you could do this:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0157-04" id="f0157-04"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; a = Account('Guido', 1000.0)
                                &gt;&gt;&gt; getattr(s, 'balance', 'unknown')
                                1000.0
                                &gt;&gt;&gt; getattr(s, 'creation_date', 'unknown')
                                'unknown'
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            <span epub:type="pagebreak" id="page_158"></span>When you access a
            method as an attribute, you get an object known as a
            <em>bound method</em>. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0158-01" id="f0158-01"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; a = Account('Guido', 1000.0)
                                &gt;&gt;&gt; w = a.withdraw
                                &gt;&gt;&gt; w
                                &lt;bound method Account.withdraw of Account('Guido', 1000.0)&gt;
                                &gt;&gt;&gt; w(100)
                                &gt;&gt;&gt; a
                                Account('Guido', 900.0)
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            A bound method is an object that contains both an instance (the
            <code>self</code>) and the function that implements the method. When
            you call a bound method by adding parentheses and arguments, it
            executes the method, passing the attached instance as the first
            argument. For example, calling <code>w(100)</code> above turns into
            a call to <code>Account.withdraw(a, 100)</code>.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec5">7.5 Scoping Rules</h3>
          <p class="noindent">
            Although classes define an isolated namespace for the methods, that
            namespace does not serve as a scope for resolving names used inside
            methods. Therefore, when you’re implementing a class, references to
            attributes and methods must be fully qualified. For example, in
            methods you always reference attributes of the instance through
            <code>self</code>. Thus, you use <code>self.balance</code>, not
            <code>balance</code>. This also applies if you want to call a method
            from another method. For example, suppose you want to implement
            <code>withdraw()</code> in terms of depositing a negative amount:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0158-02" id="f0158-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Account:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, owner, balance):
                                        <span class="dblue">self</span>.owner <span class="igrey">=</span> owner
                                        <span class="dblue">self</span>.balance <span class="igrey">=</span> balance
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__repr__</span>(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="trose">f'Account(</span><span class="mblue">{</span><span class="dblue">self</span><span class="mblue">.</span>owner<span class="mblue">!r}</span><span class="trose">,</span> <span class="mblue">{</span><span class="dblue">self</span><span class="mblue">.</span>balance<span class="mblue">!r}</span><span class="trose">)'</span>
                                
                                    <span class="lgreen"><strong>def</strong></span> deposit(<span class="dblue">self</span>, amount):
                                        <span class="dblue">self</span>.balance <span class="igrey">+=</span> amount
                                
                                    <span class="lgreen"><strong>def</strong></span> withdraw(<span class="dblue">self</span>, amount):
                                        <span class="dblue">self</span>.deposit(<span class="igrey">-</span>amount)    <span class="hblue"># Must use self.deposit()</span>
                                
                                    <span class="lgreen"><strong>def</strong></span> inquiry(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>.balance</pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_159"></span>The lack of a
            class-level scope is one area where Python differs from C++ or Java.
            If you have used those languages, the <code>self</code> parameter in
            Python is the same as the so-called “this” pointer, except that in
            Python you always have to use it explicitly.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec6">
            7.6 Operator Overloading and Protocols
          </h3>
          <p class="noindent">
            In <a href="ch04.xhtml#ch04">Chapter 4</a>, we discussed Python’s
            data model. Particular attention was given to the so-called special
            methods that implement Python operators and protocols. For example,
            the <code>len(obj)</code> function calls
            <code>obj.__len__()</code> and <code>obj[n]</code> calls
            <code>obj.__getitem__(n)</code>.
          </p>
          <p class="indent">
            When defining new classes, it is common to define some of these
            methods. The <code>__repr__()</code> method in the
            <code>Account</code> class was one such method for improving
            debugging output. You might define more of these methods if you’re
            creating something more complicated, such as a custom container. For
            example, suppose you wanted to make a portfolio of accounts:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0159-01" id="f0159-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> AccountPortfolio:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>):
                                        <span class="dblue">self</span>.accounts <span class="igrey">=</span> []
                                
                                    <span class="lgreen"><strong>def</strong></span> add_account(<span class="dblue">self</span>, account):
                                        <span class="dblue">self</span>.accounts.append(account)
                                
                                    <span class="lgreen"><strong>def</strong></span> total_funds(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> sum(account.inquiry() <span class="lgreen"><strong>for</strong></span> account <span class="lgreen"><strong>in</strong></span> <span class="dblue">self</span>.accounts)
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__len__</span>(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> len(<span class="dblue">self</span>.accounts)
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__getitem__</span>(<span class="dblue">self</span>, index):
                                        <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>.accounts[index]
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__iter__</span>(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> iter(<span class="dblue">self</span>.accounts)
                                
                                <span class="hblue"># Example</span>
                                port <span class="igrey">=</span> AccountPortfolio()
                                port.add_account(Account(<span class="mblue">'Guido'</span>, <span class="sgreen">1000.0</span>))
                                port.add_account(Account(<span class="mblue">'Eva'</span>, <span class="sgreen">50.0</span>))
                                
                                print(port.total_funds())    <span class="hblue"># -&gt; 1050.0</span>
                                len(port)                    <span class="hblue"># -&gt; 2</span>
                                
                                <span class="hblue"># Print the accounts</span>
                                <span epub:type="pagebreak" id="page_160"></span><span class="lgreen"><strong>for</strong></span> account <span class="lgreen"><strong>in</strong></span> port:
                                    print(account)
                                
                                <span class="hblue"># Access an individual account by index</span>
                                port[<span class="sgreen">1</span>].inquiry()            <span class="hblue"># -&gt; 50.0</span></pre>
          <p class="indent">
            The special methods that appear at the end, such as
            <code>__len__()</code>, <code>__getitem__()</code>, and
            <code>__iter__()</code>, make an <code>AccountPortfolio</code> work
            with Python operators such as indexing and iteration.
          </p>
          <p class="indent">
            Sometimes you’ll hear the word “Pythonic,” as in “this code is
            Pythonic.” The term is informal, but it usually refers to whether or
            not an object plays nicely with the rest of the Python environment.
            This implies supporting—to the extent that it makes sense—core
            Python features such as iteration, indexing, and other operations.
            You almost always do this by having your class implement predefined
            special methods as described in
            <a href="ch04.xhtml#ch04">Chapter 4</a>.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec7">7.7 Inheritance</h3>
          <p class="noindent">
            Inheritance is a mechanism for creating a new class that specializes
            or modifies the behavior of an existing class. The original class is
            called a base class, superclass, or parent class. The new class is
            called a derived class, child class, subclass, or subtype. When a
            class is created via inheritance, it inherits the attributes defined
            by its base classes. However, a derived class may redefine any of
            these attributes and add new attributes of its own.
          </p>
          <p class="indent">
            Inheritance is specified with a comma-separated list of base-class
            names in the <code>class</code> statement. If there is no specified
            base class, a class implicitly inherits from <code>object</code>.
            <code>object</code> is a class that is the root of all Python
            objects; it provides the default implementation of some common
            methods such as <code>__str__()</code> and <code>__repr__()</code>.
          </p>
          <p class="indent">
            One use of inheritance is to extend an existing class with new
            methods. For example, suppose you want to add a
            <code>panic()</code> method to <code>Account</code> that would
            withdraw all funds. Here’s how:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0160-02" id="f0160-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> MyAcount(Account):
                                    <span class="lgreen"><strong>def</strong></span> panic(<span class="dblue">self</span>):
                                        <span class="dblue">self</span>.withdraw(<span class="dblue">self</span>.balance)
                                
                                <span class="hblue"># Example</span>
                                a <span class="igrey">=</span> MyAcount(<span class="mblue">'Guido'</span>, <span class="sgreen">1000.0</span>)
                                a.withdraw(<span class="sgreen">23.0</span>)         <span class="hblue"># a.balance = 977.0</span>
                                a.panic()                <span class="hblue"># a.balance = 0</span></pre>
          <p class="indent">
            Inheritance can also be used to redefine the already existing
            methods. For example, here’s a specialized version of
            <code>Account</code> that redefines the
            <code>inquiry()</code> method to periodically overstate the balance
            with the hope that someone not paying close attention will overdraw
            their account and incur a big penalty when making a payment on their
            subprime mortgage:<span epub:type="pagebreak" id="page_161"></span>
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0161-01" id="f0161-01"
              >Click here to view code image</a
            >
          </p>
          <pre>import random
                                <span class="lgreen"><strong>class</strong></span> EvilAccount(Account):
                                    <span class="lgreen"><strong>def</strong></span> inquiry(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>if</strong></span> random.randint(<span class="sgreen">0</span>,<span class="sgreen">4</span>) <span class="igrey">==</span> <span class="sgreen">1</span>:
                                           <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>.balance <span class="igrey">*</span> <span class="sgreen">1.10</span>
                                        <span class="lgreen"><strong>else</strong></span>:
                                           <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>.balance
                                
                                a <span class="igrey">=</span> EvilAccount(<span class="mblue">'Guido'</span>, <span class="sgreen">1000.0</span>)
                                a.deposit(<span class="sgreen">10.0</span>)          <span class="hblue"># Calls Account.deposit(a, 10.0)</span>
                                available <span class="igrey">=</span> a.inquiry()  <span class="hblue"># Calls EvilAccount.inquiry(a)</span></pre>
          <p class="indent">
            In this example, instances of <code>EvilAccount</code> are identical
            to instances of <code>Account</code> except for the redefined
            <code>inquiry()</code> method.
          </p>
          <p class="indent">
            Occasionally, a derived class would reimplement a method but also
            need to call the original implementation. A method can explicitly
            call the original method using <code>super()</code>:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0161-02" id="f0161-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> EvilAccount(Account):
                                    <span class="lgreen"><strong>def</strong></span> inquiry(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>if</strong></span> random.randint(<span class="sgreen">0</span>,<span class="sgreen">4</span>) <span class="igrey">==</span> <span class="sgreen">1</span>:
                                           <span class="lgreen"><strong>return</strong></span> <span class="sgreen">1.10</span> <span class="igrey">*</span> super().inquiry()
                                        <span class="lgreen"><strong>else</strong></span>:
                                           <span class="lgreen"><strong>return</strong></span> super().inquiry()</pre>
          <p class="indent">
            In this example, <code>super()</code> allows you to access a method
            as it was previously defined. The
            <code>super().inquiry()</code> call is using the original definition
            of <code>inquiry()</code> before it got redefined by
            <code>EvilAccount</code>.
          </p>
          <p class="indent">
            It’s less common, but inheritance might also be used to add
            additional attributes to instances. Here’s how you could make the
            <code>1.10</code> factor in the above example an instance-level
            attribute that could be adjusted:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0161-03" id="f0161-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> EvilAccount(Account):
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, owner, balance, factor):
                                        super().<span class="cblue">__init__</span>(owner, balance)
                                        <span class="dblue">self</span>.factor <span class="igrey">=</span> factor
                                
                                    <span class="lgreen"><strong>def</strong></span> inquiry(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>if</strong></span> random.randint(<span class="sgreen">0</span>,<span class="sgreen">4</span>) <span class="igrey">==</span> <span class="sgreen">1</span>:
                                           <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>.factor <span class="igrey">*</span> super().inquiry()
                                        <span class="lgreen"><strong>else</strong></span>:
                                           <span class="lgreen"><strong>return</strong></span> super().inquiry()</pre>
          <p class="indent">
            A tricky issue with adding attributes is dealing with the existing
            <code>__init__()</code> method. In this example, we define a new
            version of <code>__init__()</code> that includes our additional
            instance variable <code>factor</code>. However, when
            <code>__init__()</code> is redefined, it is the responsibility of
            the child to initialize its parent using
            <code>super().__init__()</code> as shown. If you forget to do
            <span epub:type="pagebreak" id="page_162"></span>this, you’ll end up
            with a half-initialized object and everything will break. Since
            initialization of the parent requires additional arguments, those
            still must be passed to the child <code>__init__()</code> method.
          </p>
          <p class="indent">
            Inheritance can break code in subtle ways. Consider the
            <code>__repr__()</code> method of the <code>Account</code> class:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0162-01" id="f0162-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Account:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, owner, balance):
                                        <span class="dblue">self</span>.owner <span class="igrey">=</span> owner
                                        <span class="dblue">self</span>.balance <span class="igrey">=</span> balance
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__repr__</span>(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="trose">f'Account(</span><span class="mblue">{</span><span class="dblue">self</span><span class="mblue">.</span>owner<span class="mblue">!r}</span><span class="trose">,</span> <span class="mblue">{</span><span class="dblue">self</span><span class="mblue">.</span>balance<span class="mblue">!r}</span><span class="trose">)'</span></pre>
          <p class="indent">
            The purpose of this method is to assist in debugging by making nice
            output. However, the method is hardcoded to use the name
            <code>Account</code>. If you start using inheritance, you’ll find
            that the output is wrong:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0162-02" id="f0162-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; class EvilAccount(Account):
                                ...     pass
                                ...
                                &gt;&gt;&gt; a = EvilAccount('Eva', 10.0)
                                &gt;&gt;&gt; a
                                Account('Eva', 10.0)     # Notice misleading output
                                &gt;&gt;&gt; type(a)
                                &lt;class 'EvilAccount'&gt;
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            To fix this, you need to modify the <code>__repr__()</code> method
            to use the proper type name. for example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0162-03" id="f0162-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Account:
                                    ...
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__repr__</span>(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="trose">f'</span><span class="mblue">{</span>type(<span class="dblue">self</span>)<span class="mblue">.</span><span class="dblue">__name__</span><span class="mblue">}</span><span class="trose">(</span><span class="mblue">{</span><span class="dblue">self</span><span class="mblue">.</span>owner<span class="mblue">!r}</span><span class="trose">,</span> <span class="mblue">{</span><span class="dblue">self</span><span class="mblue">.</span>balance<span class="mblue">!r}</span><span class="trose">)'</span></pre>
          <p class="indent">
            Now you’ll see more accurate output. Inheritance is not used with
            every class, but if it’s an anticipated use case of the class you’re
            writing, you need to pay attention to details like this. As a
            general rule, avoid the hardcoding of class names.
          </p>
          <p class="indent">
            Inheritance establishes a relationship in the type system where any
            child class will type-check as the parent class. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0162-04" id="f0162-04"
              >Click here to view code image</a
            >
          </p>
          <pre>&gt;&gt;&gt; a = EvilAccount('Eva', 10)
                                &gt;&gt;&gt; type(a)
                                &lt;class 'EvilAccount'&gt;
                                &gt;&gt;&gt; isinstance(a, Account)
                                <span epub:type="pagebreak" id="page_163"></span>True
                                &gt;&gt;&gt;</pre>
          <p class="indent">
            This is the so-called “is a” relationship:
            <code>EvilAccount</code> is an <code>Account</code>. Sometimes, the
            “is a” inheritance relationship is used to define object type
            ontologies or taxonomies. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0163-02" id="f0163-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Food:
                                    <span class="lgreen"><strong>pass</strong></span>
                                
                                <span class="lgreen"><strong>class</strong></span> Sandwich(Food):
                                    <span class="lgreen"><strong>pass</strong></span>
                                
                                <span class="lgreen"><strong>class</strong></span> RoastBeef(Sandwich):
                                    <span class="lgreen"><strong>pass</strong></span>
                                
                                <span class="lgreen"><strong>class</strong></span> GrilledCheese(Sandwich):
                                    <span class="lgreen"><strong>pass</strong></span>
                                
                                <span class="lgreen"><strong>class</strong></span> Taco(Food):
                                    <span class="lgreen"><strong>pass</strong></span></pre>
          <p class="indent">
            In practice, organizing objects in this manner can be quite
            difficult and fraught with peril. Suppose you wanted to add a
            <code>HotDog</code> class to the above hierarchy. Where does it go?
            Given that a hot dog has a bun, you might be inclined to make it a
            subclass of <code>Sandwich</code>. However, based on the overall
            curved shape of the bun with a tasty filling inside, perhaps a hot
            dog is really more like a <code>Taco</code>. Maybe you decide to
            make it a subclass of both:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0163-03" id="f0163-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> HotDog(Sandwich, Taco):
                                    <span class="lgreen"><strong>pass</strong></span></pre>
          <p class="indent">
            At this point, everyone’s head is exploding and the office is
            embroiled in a heated argument. This might as well be a good time to
            mention that Python supports multiple inheritance. To do that, list
            more than one class as a parent. The resulting child class will
            inherit all of the combined features of the parents. See
            <a href="ch07.xhtml#ch07lev1sec19">Section 7.19</a> for more about
            multiple inheritance.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec8">
            7.8 Avoiding Inheritance via Composition
          </h3>
          <p class="noindent">
            One concern with inheritance is what’s known as implementation
            inheritance. To illustrate, suppose you wanted to make a stack data
            structure with push and pop operations. A quick way to do that would
            be to inherit from a list and add a new method to it:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0163-04" id="f0163-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Stack(list):
                                    <span class="lgreen"><strong>def</strong></span> push(<span class="dblue">self</span>, item):
                                        <span class="dblue">self</span>.append(item)
                                
                                <span epub:type="pagebreak" id="page_164"></span><span class="hblue"># Example</span>
                                s <span class="igrey">=</span> Stack()
                                s.push(<span class="sgreen">1</span>)
                                s.push(<span class="sgreen">2</span>)
                                s.push(<span class="sgreen">3</span>)
                                s.pop()     <span class="hblue"># -&gt; 3</span>
                                s.pop()     <span class="hblue"># -&gt; 2</span></pre>
          <p class="indent">
            Sure enough, this data structure works like a stack, but it also has
            every other feature of lists—insertion, sorting, slice reassignment,
            and so forth. This is implementation inheritance—you used
            inheritance to reuse some code upon which you built something else,
            but you also got a lot of features that aren’t pertinent to the
            problem actually being solved. Users will probably find the object
            strange. Why does a stack have methods for sorting?
          </p>
          <p class="indent">
            A better approach is composition. Instead of building a stack by
            inheriting from a list, you should build a stack as an independent
            class that happens to have a list contained in it. The fact that
            there’s a list inside is an implementation detail. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0164-02" id="f0164-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Stack:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>):
                                        <span class="dblue">self</span>._items <span class="igrey">=</span> list()
                                
                                    <span class="lgreen"><strong>def</strong></span> push(<span class="dblue">self</span>, item):
                                        <span class="dblue">self</span>._items.append(item)
                                
                                    <span class="lgreen"><strong>def</strong></span> pop(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>._items.pop()
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__len__</span>(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> len(<span class="dblue">self</span>._items)
                                
                                <span class="hblue"># Example use</span>
                                s <span class="igrey">=</span> Stack()
                                s.push(<span class="sgreen">1</span>)
                                s.push(<span class="sgreen">2</span>)
                                s.push(<span class="sgreen">3</span>)
                                s.pop()    <span class="hblue"># -&gt; 3</span>
                                s.pop()    <span class="hblue"># -&gt; 2</span></pre>
          <p class="indent">
            This object works exactly the same as before, but it’s focused
            exclusively on just being a stack. There are no extraneous list
            methods or nonstack features. There is much more clarity of purpose.
          </p>
          <p class="indent">
            A slight extension of this implementation might accept the internal
            <code>list</code> class as an optional argument:<span
              epub:type="pagebreak"
              id="page_165"
            ></span>
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0165-01" id="f0165-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Stack:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, <span class="igrey">*</span>, container<span class="igrey">=</span><span class="dblue">None</span>):
                                        <span class="lgreen"><strong>if</strong></span> container <span class="lgreen"><strong>is</strong></span> <span class="dblue">None</span>:
                                            container <span class="igrey">=</span> list()
                                        <span class="dblue">self</span>._items <span class="igrey">=</span> container
                                
                                    <span class="lgreen"><strong>def</strong></span> push(<span class="dblue">self</span>, item):
                                        <span class="dblue">self</span>._items.append(item)
                                
                                    <span class="lgreen"><strong>def</strong></span> pop(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>._items.pop()
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__len__</span>(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> len(<span class="dblue">self</span>._items)</pre>
          <p class="indent">
            One benefit of this approach is that it promotes loose coupling of
            components. For example, you might want to make a stack that stores
            its elements in a typed array instead of a list. Here’s how you
            could do it:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0165-02" id="f0165-02"
              >Click here to view code image</a
            >
          </p>
          <pre>import array
                                
                                s <span class="igrey">=</span> Stack(container<span class="igrey">=</span>array.array(<span class="mblue">'i'</span>))
                                s.push(<span class="sgreen">42</span>)
                                s.push(<span class="sgreen">23</span>)
                                s.push(<span class="mblue">'a lot'</span>)     <span class="hblue"># TypeError.</span></pre>
          <p class="indent">
            This is also an example of what’s known as
            <em>dependency injection</em>. Instead of hardwiring
            <code>Stack</code> to depend on <code>list</code>, you can make it
            depend on any container a user decides to pass in, provided it
            implements the required interface.
          </p>
          <p class="indent">
            More broadly, making the internal list a hidden implementation
            detail is related to the problem of data abstraction. Perhaps you
            later decide that you don’t even want to use a list. The above
            design makes that easy to change. For example, if you change the
            implementation to use linked tuples as follows, the users of
            <code>Stack</code> won’t even notice:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0165-03" id="f0165-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Stack:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>):
                                        <span class="dblue">self</span>._items <span class="igrey">=</span> <span class="dblue">None</span>
                                        <span class="dblue">self</span>._size <span class="igrey">=</span> <span class="sgreen">0</span>
                                
                                    <span class="lgreen"><strong>def</strong></span> push(<span class="dblue">self</span>, item):
                                        <span class="dblue">self</span>._items <span class="igrey">=</span> (item, <span class="dblue">self</span>._items)
                                        <span class="dblue">self</span>._size <span class="igrey">+=</span> <span class="sgreen">1</span>
                                
                                    <span class="lgreen"><strong>def</strong></span> pop(<span class="dblue">self</span>):
                                        (item, <span class="dblue">self</span>._items) <span class="igrey">=</span> <span class="dblue">self</span>._items
                                        <span class="dblue">self</span>._size <span class="igrey">-=</span> <span class="sgreen">1</span>
                                <span epub:type="pagebreak" id="page_166"></span>        <span class="lgreen"><strong>return</strong></span> item
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__len__</span>(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>._size</pre>
          <p class="indent">
            To decide whether to use inheritance or not, you should step back
            and ask yourself if the object you’re building is a specialized
            version of the parent class or if you are merely using it as a
            component in building something else. If it’s the latter, don’t use
            inheritance.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec9">
            7.9 Avoiding Inheritance via Functions
          </h3>
          <p class="noindent">
            Sometimes you might find yourself writing classes with just a single
            method that needs to be customized. For example, maybe you wrote a
            data parsing class like this:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0166-02" id="f0166-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> DataParser:
                                    <span class="lgreen"><strong>def</strong></span> parse(<span class="dblue">self</span>, lines):
                                        records <span class="igrey">=</span> []
                                        <span class="lgreen"><strong>for</strong></span> line <span class="lgreen"><strong>in</strong></span> lines:
                                            row <span class="igrey">=</span> line.split(<span class="mblue">','</span>)
                                            record <span class="igrey">=</span> <span class="dblue">self</span>.make_record(row)
                                            records.append(row)
                                        <span class="lgreen"><strong>return</strong></span> records
                                
                                    <span class="lgreen"><strong>def</strong></span> make_record(<span class="dblue">self</span>, row):
                                        <span class="lgreen"><strong>raise</strong></span> <span class="pgold">NotImplementedError</span>()
                                
                                <span class="lgreen"><strong>class</strong></span> PortfolioDataParser(DataParser):
                                    <span class="lgreen"><strong>def</strong></span> make_record(<span class="dblue">self</span>, row):
                                        <span class="lgreen"><strong>return</strong></span> {
                                           <span class="mblue">'name'</span>: row[<span class="sgreen">0</span>],
                                           <span class="mblue">'shares'</span>: int(row[<span class="sgreen">1</span>]),
                                           <span class="mblue">'price'</span>: float(row[<span class="sgreen">2</span>])
                                        }
                                
                                parser <span class="igrey">=</span> PortfolioDataParser()
                                data <span class="igrey">=</span> parser.parse(open(<span class="mblue">'portfolio.csv'</span>))</pre>
          <p class="indent">
            There is too much plumbing going on here. If you’re writing a lot of
            single-method classes, consider using functions instead. For
            example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0166-03" id="f0166-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> parse_data(lines, make_record):
                                    records <span class="igrey">=</span> []
                                    <span class="lgreen"><strong>for</strong></span> line <span class="lgreen"><strong>in</strong></span> lines:
                                        row <span class="igrey">=</span> line.split(<span class="mblue">','</span>)
                                        record <span class="igrey">=</span> make_record(row)
                                <span epub:type="pagebreak" id="page_167"></span>        records.append(row)
                                    <span class="lgreen"><strong>return</strong></span> records
                                
                                <span class="lgreen"><strong>def</strong></span> make_dict(row):
                                    <span class="lgreen"><strong>return</strong></span> {
                                        <span class="mblue">'name'</span>: row[<span class="sgreen">0</span>],
                                        <span class="mblue">'shares'</span>: int(row[<span class="sgreen">1</span>]),
                                        <span class="mblue">'price'</span>: float(row[<span class="sgreen">2</span>])
                                    }
                                
                                data <span class="igrey">=</span> parse_data(open(<span class="mblue">'portfolio.csv'</span>), make_dict)</pre>
          <p class="indent">
            This code is much simpler and just as flexible, plus simple
            functions are easier to test. If there’s a need to expand it into
            classes, you can always do it later. Premature abstraction is often
            not a good thing.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec10">
            7.10 Dynamic Binding and Duck Typing
          </h3>
          <p class="noindent">
            Dynamic binding is the runtime mechanism that Python uses to find
            the attributes of objects. This is what allows Python to work with
            instances without regard for their type. In Python, variable names
            do not have an associated type. Thus, the attribute binding process
            is independent of what kind of object <code>obj</code> is. If you
            make a lookup, such as <code>obj.name</code>, it will work on any
            <code>obj</code> whatsoever that happens to have a
            <code>name</code> attribute. This behavior is sometimes referred to
            as duck typing—in reference to the adage “if it looks like a duck,
            quacks like a duck, and walks like a duck, then it’s a duck.”
          </p>
          <p class="indent">
            Python programmers often write programs that rely on this behavior.
            For example, if you want to make a customized version of an existing
            object, you can either inherit from it, or you can create a
            completely new object that looks and acts like it but is otherwise
            unrelated. This latter approach is often used to maintain loose
            coupling of program components. For example, code may be written to
            work with any kind of object whatsoever as long as it has a certain
            set of methods. One of the most common examples is with various
            iterable objects defined in the standard library. There are all
            sorts of objects that work with the <code>for</code> loop to produce
            values—lists, files, generators, strings, and so on. However, none
            of these inherit from any kind of special <code>Iterable</code> base
            class. They merely implement the methods required to perform
            iteration—and it all works.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec11">
            7.11 The Danger of Inheriting from Built-in Types
          </h3>
          <p class="noindent">
            Python allows inheritance from built-in types. However, doing so
            invites danger. As an example, if you decide to subclass
            <code>dict</code> in order to force all keys to be uppercase, you
            might redefine the <code>__setitem__()</code> method like this:<span
              epub:type="pagebreak"
              id="page_168"
            ></span>
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0168-01" id="f0168-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> udict(dict):
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__setitem__</span>(<span class="dblue">self</span>, key, value):
                                        super().<span class="cblue">__setitem__</span>(key.upper(), value)</pre>
          <p class="indent">Indeed, it initially even seems to work:</p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0168-01a" id="f0168-01a"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; u = udict()
                                &gt;&gt;&gt; u['name'] = 'Guido'
                                &gt;&gt;&gt; u['number'] = 37
                                &gt;&gt;&gt; u
                                { 'NAME': 'Guido', 'NUMBER': 37 }
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            Further use, however, reveals that it only seems to work. In fact,
            it doesn’t really seem to work at all:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0168-02" id="f0168-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; u = udict(name='Guido', number=37)
                                &gt;&gt;&gt; u
                                { 'name': 'Guido', 'number': 37 }
                                &gt;&gt;&gt; u.update(color='blue')
                                &gt;&gt;&gt; u
                                { 'name': 'Guido', 'number': 37, 'color': 'blue' }
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            At issue here is the fact that Python’s built-in types aren’t
            implemented like normal Python classes—they’re implemented in C.
            Most of the methods operate in the world of C. For example, the
            <code>dict.update()</code> method directly manipulates the
            dictionary data without ever routing through the redefined
            <code>__setitem__()</code> method in your custom
            <code>udict</code> class above.
          </p>
          <p class="indent">
            The <code>collections</code> module has special classes
            <code>UserDict</code>, <code>UserList</code>, and
            <code>UserString</code> that can be used to make safe subclasses of
            <code>dict</code>, <code>list</code>, and <code>str</code> types.
            For example, you’ll find that this solution works a lot better:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0168-03" id="f0168-03"
              >Click here to view code image</a
            >
          </p>
          <pre>from collections import UserDict
                                
                                <span class="lgreen"><strong>class</strong></span> udict(UserDict):
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__setitem__</span>(<span class="dblue">self</span>, key, value):
                                        super().<span class="cblue">__setitem__</span>(key.upper(), value)</pre>
          <p class="indent">Here’s an example of this new version in action:</p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0168-04" id="f0168-04"
              >Click here to view code image</a
            >
          </p>
          <pre>&gt;&gt;&gt; u = udict(name='Guido', num=37)
                                &gt;&gt;&gt; u.update(color='Blue')
                                &gt;&gt;&gt; u
                                {'NAME': 'Guido', 'NUM': 37, 'COLOR': 'Blue'}
                                &gt;&gt;&gt; v = udict(u)
                                &gt;&gt;&gt; v['title'] = 'BDFL'
                                &gt;&gt;&gt; v
                                <span epub:type="pagebreak" id="page_169"></span>{'NAME': 'Guido', 'NUM': 37, 'COLOR': 'Blue', 'TITLE': 'BDFL'}
                                &gt;&gt;&gt;</pre>
          <p class="indent">
            Most of the time, subclassing a built-in type can be avoided. For
            example, when building new containers, it is probably better to make
            a new class, as was shown for the <code>Stack</code> class in
            <a href="ch07.xhtml#ch07lev1sec8">Section 7.8</a>. If you really do
            need to subclass a built-in, it might be a lot more work than you
            think.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec12">
            7.12 Class Variables and Methods
          </h3>
          <p class="noindent">
            In a class definition, all functions are assumed to operate on an
            instance, which is always passed as the first parameter
            <code>self</code>. However, the class itself is also an object that
            can carry state and be manipulated as well. As an example, you could
            track how many instances have been created using a class variable
            <code>num_accounts</code>:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0169-02" id="f0169-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Account:
                                    num_accounts <span class="igrey">=</span> <span class="sgreen">0</span>
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, owner, balance):
                                        <span class="dblue">self</span>.owner <span class="igrey">=</span> owner
                                        <span class="dblue">self</span>.balance <span class="igrey">=</span> balance
                                        Account.num_accounts <span class="igrey">+=</span> <span class="sgreen">1</span>
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__repr__</span>(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="trose">f'</span><span class="mblue">{</span>type(<span class="dblue">self</span>)<span class="mblue">.</span><span class="dblue">__name__</span><span class="mblue">}</span><span class="trose">(</span><span class="mblue">{</span><span class="dblue">self</span><span class="mblue">.</span>owner<span class="mblue">!r}</span><span class="trose">,</span> <span class="mblue">{</span><span class="dblue">self</span><span class="mblue">.</span>balance<span class="mblue">!r}</span><span class="trose">)'</span>
                                
                                    <span class="lgreen"><strong>def</strong></span> deposit(<span class="dblue">self</span>, amount):
                                        <span class="dblue">self</span>.balance <span class="igrey">+=</span> amount
                                
                                    <span class="lgreen"><strong>def</strong></span> withdraw(<span class="dblue">self</span>, amount):
                                        <span class="dblue">self</span>.deposit(<span class="igrey">-</span>amount)    <span class="hblue"># Must use self.deposit()</span>
                                
                                    <span class="lgreen"><strong>def</strong></span> inquiry(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>.balance</pre>
          <p class="indent">
            Class variables are defined outside the normal
            <code>__init__()</code> method. To modify them, use the class, not
            <code>self</code>. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0169-03" id="f0169-03"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; a = Account('Guido', 1000.0)
                                &gt;&gt;&gt; b = Account('Eva', 10.0)
                                &gt;&gt;&gt; Account.num_accounts
                                2
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            It’s a bit unusual, but class variables can also be accessed via
            instances. For example:<span
              epub:type="pagebreak"
              id="page_170"
            ></span>
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0170-01" id="f0170-01"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; a.num_accounts
                                2
                                &gt;&gt;&gt; c = Account('Ben', 50.0)
                                &gt;&gt;&gt; Account.num_accounts
                                3
                                &gt;&gt;&gt; a.num_accounts
                                3
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            This works because attribute lookup on instances checks the
            associated class if there’s no matching attribute on the instance
            itself. This is the same mechanism by which Python normally finds
            methods.
          </p>
          <p class="indent">
            It is also possible to define what’s known as a
            <em>class method</em>. A class method is a method applied to the
            class itself, not to instances. A common use of class methods is to
            define alternate instance constructors. For example, suppose there
            was a requirement to create <code>Account</code> instances from a
            legacy enterprise-grade input format:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0170-02" id="f0170-02"
              >Click here to view code image</a
            >
          </p>
          <pre>data <span class="igrey">=</span> <span class="mblue">'''</span>
                                <span class="mblue">&lt;account&gt;</span>
                                    <span class="mblue">&lt;owner&gt;Guido&lt;/owner&gt;</span>
                                    <span class="mblue">&lt;amount&gt;1000.0&lt;/amount&gt;</span>
                                <span class="mblue">&lt;/account&gt;</span>
                                <span class="mblue">'''</span></pre>
          <p class="indent">
            To do that, you can write a <code>@classmethod</code> like this:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0170-03" id="f0170-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Account:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, owner, balance):
                                        <span class="dblue">self</span>.owner <span class="igrey">=</span> owner
                                        <span class="dblue">self</span>.balance <span class="igrey">=</span> balance
                                
                                    <span class="wasabi">@classmethod</span>
                                    <span class="lgreen"><strong>def</strong></span> from_xml(cls, data):
                                        from xml.etree.ElementTree import XML
                                        doc <span class="igrey">=</span> XML(data)
                                        <span class="lgreen"><strong>return</strong></span> cls(doc.findtext(<span class="mblue">'owner'</span>),
                                                   float(doc.findtext(<span class="mblue">'amount'</span>)))
                                
                                <span class="hblue"># Example use</span>
                                
                                data <span class="igrey">=</span> <span class="mblue">'''</span>
                                <span class="mblue">&lt;account&gt;</span>
                                    <span class="mblue">&lt;owner&gt;Guido&lt;/owner&gt;</span>
                                    <span class="mblue">&lt;amount&gt;1000.0&lt;/amount&gt;</span>
                                <span class="mblue">&lt;/account&gt;</span>
                                <span class="mblue">'''</span>
                                a <span class="igrey">=</span> Account.from_xml(data)</pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_171"></span>The first argument
            of a class method is always the class itself. By convention, this
            argument is often named <code>cls</code>. In this example,
            <code>cls</code> is set to <code>Account</code>. If the purpose of a
            class method is to create a new instance, explicit steps must be
            taken to do so. In the final line of the example, the call
            <code>cls(..., ...)</code> is the same as calling
            <code>Account(..., ...)</code> on the two arguments.
          </p>
          <p class="indent">
            The fact that the class is passed as argument solves an important
            problem related to inheritance. Suppose you define a subclass of
            <code>Account</code> and now want to create an instance of that
            class. You’ll find that it still works:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0171-01" id="f0171-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> EvilAccount(Account):
                                    <span class="lgreen"><strong>pass</strong></span>
                                
                                e <span class="igrey">=</span> EvilAccount.from_xml(data)    <span class="hblue"># Creates an 'EvilAccount'</span></pre>
          <p class="indent">
            The reason this code works is that <code>EvilAccount</code> is now
            passed as <code>cls</code>. Thus, the last statement of the
            <code>from_xml()</code> classmethod now creates an
            <code>EvilAccount</code> instance.
          </p>
          <p class="indent">
            Class variables and class methods are sometimes used together to
            configure and control how instances operate. As another example,
            consider the following <code>Date</code> class:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0171-02" id="f0171-02"
              >Click here to view code image</a
            >
          </p>
          <pre>import time
                                
                                <span class="lgreen"><strong>class</strong></span> Date:
                                    datefmt <span class="igrey">=</span> <span class="mblue">'{year}-{month:02d}-{day:02d}'</span>
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, year, month, day):
                                        <span class="dblue">self</span>.year <span class="igrey">=</span> year
                                        <span class="dblue">self</span>.month <span class="igrey">=</span> month
                                        <span class="dblue">self</span>.day <span class="igrey">=</span> day
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__str__</span>(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>.datefmt.format(year<span class="igrey">=</span><span class="dblue">self</span>.year,
                                                                   month<span class="igrey">=</span><span class="dblue">self</span>.month,
                                                                   day<span class="igrey">=</span><span class="dblue">self</span>.day)
                                
                                    <span class="wasabi">@classmethod</span>
                                    <span class="lgreen"><strong>def</strong></span> from_timestamp(cls, ts):
                                        tm <span class="igrey">=</span> time.localtime(ts)
                                        <span class="lgreen"><strong>return</strong></span> cls(tm.tm_year, tm.tm_mon, tm.tm_mday)
                                
                                    <span class="wasabi">@classmethod</span>
                                    <span class="lgreen"><strong>def</strong></span> today(cls):
                                        <span class="lgreen"><strong>return</strong></span> cls.from_timestamp(time.time())</pre>
          <p class="indent">
            This class features a class variable <code>datefmt</code> that
            adjusts output from the <code>__str__()</code> method. This is
            something that can be customized via inheritance:<span
              epub:type="pagebreak"
              id="page_172"
            ></span>
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0172-01" id="f0172-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> MDYDate(Date):
                                    datefmt <span class="igrey">=</span> <span class="mblue">'{month}/{day}/{year}'</span>
                                
                                <span class="lgreen"><strong>class</strong></span> DMYDate(Date):
                                    datefmt <span class="igrey">=</span> <span class="mblue">'{day}/{month}/{year}'</span>
                                
                                <span class="hblue"># Example</span>
                                a <span class="igrey">=</span> Date(<span class="sgreen">1967</span>, <span class="sgreen">4</span>, <span class="sgreen">9</span>)
                                print(a)       <span class="hblue"># 1967-04-09</span>
                                
                                b <span class="igrey">=</span> MDYDate(<span class="sgreen">1967</span>, <span class="sgreen">4</span>, <span class="sgreen">9</span>)
                                print(b)       <span class="hblue"># 4/9/1967</span>
                                
                                c <span class="igrey">=</span> DMYDate(<span class="sgreen">1967</span>, <span class="sgreen">4</span>, <span class="sgreen">9</span>)
                                print(c)      <span class="hblue"># 9/4/1967</span></pre>
          <p class="indent">
            Configuration via class variables and inheritance like this is a
            common tool for adjusting the behavior of instances. The use of
            class methods is critical to making it work since they ensure that
            the proper kind of object gets created. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0172-02" id="f0172-02"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> MDYDate.today()
                                b <span class="igrey">=</span> DMYDate.today()
                                print(a)      <span class="hblue"># 2/13/2019</span>
                                print(b)      <span class="hblue"># 13/2/2019</span></pre>
          <p class="indent">
            Alternate construction of instances is, by far, the most common use
            of class methods. A common naming convention for such methods is to
            include the word <code>from_</code> as a prefix, such as
            <code>from_timestamp()</code>. You will see this naming convention
            used in class methods throughout the standard library and in
            third-party packages. For example, dictionaries have a class method
            for creating a preinitialized dictionary from a set of keys:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0172-03" id="f0172-03"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; dict.from_keys(['a','b','c'], 0)
                                {'a': 0, 'b': 0, 'c': 0}
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            One caution about class methods is that Python does not manage them
            in a namespace separate from the instance methods. As a result, they
            can still be invoked on an instance. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0172-04" id="f0172-04"
              >Click here to view code image</a
            >
          </p>
          <pre>d <span class="igrey">=</span> Date(<span class="sgreen">1967</span>,<span class="sgreen">4</span>,<span class="sgreen">9</span>)
                                b <span class="igrey">=</span> d.today()          <span class="hblue"># Calls Date.now(Date)</span></pre>
          <p class="indent">
            This is potentially quite confusing because a call to
            <code>d.today()</code> doesn’t really have anything to do with the
            instance <code>d</code>. Yet, you might see
            <code>today()</code> listed as a valid method on
            <code>Date</code> instances in your IDE and in documentation.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec13">
            <span epub:type="pagebreak" id="page_173"></span>7.13 Static Methods
          </h3>
          <p class="noindent">
            Sometimes a class is merely used as a namespace for functions
            declared as static methods using <code>@staticmethod</code>. Unlike
            a normal method or class method, a static method does not take an
            extra <code>self</code> or <code>cls</code> argument. A static
            method is just a ordinary function that happens to be defined inside
            a class. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0173-01" id="f0173-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Ops:
                                    <span class="wasabi">@staticmethod</span>
                                    <span class="lgreen"><strong>def</strong></span> add(x, y):
                                        <span class="lgreen"><strong>return</strong></span> x <span class="igrey">+</span> y
                                
                                    <span class="wasabi">@staticmethod</span>
                                    <span class="lgreen"><strong>def</strong></span> sub(x, y):
                                        <span class="lgreen"><strong>return</strong></span> x <span class="igrey">-</span> y</pre>
          <p class="indent">
            You don’t normally create instances of such a class. Instead, call
            the functions directly through the class:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0173-02" id="f0173-02"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> Ops.add(<span class="sgreen">2</span>, <span class="sgreen">3</span>)        <span class="hblue"># a = 5</span>
                                b <span class="igrey">=</span> Ops.sub(<span class="sgreen">4</span>, <span class="sgreen">5</span>)        <span class="hblue"># a = -1</span></pre>
          <p class="indent">
            Sometimes other classes will use a collection of static methods like
            this to implement “swappable” or “configurable” behavior, or as
            something that loosely mimics the behavior of an import module.
            Consider the use of inheritance in the earlier
            <code>Account</code> example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0173-03" id="f0173-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Account:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, owner, balance):
                                        <span class="dblue">self</span>.owner <span class="igrey">=</span> owner
                                        <span class="dblue">self</span>.balance <span class="igrey">=</span> balance
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__repr__</span>(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="trose">f'</span><span class="mblue">{</span>type(<span class="dblue">self</span>)<span class="mblue">.</span><span class="dblue">__name__</span><span class="mblue">}</span><span class="trose">(</span><span class="mblue">{</span><span class="dblue">self</span><span class="mblue">.</span>owner<span class="mblue">!r}</span><span class="trose">,</span> <span class="mblue">{</span><span class="dblue">self</span><span class="mblue">.</span>balance<span class="mblue">!r}</span><span class="trose">)'</span>
                                
                                    <span class="lgreen"><strong>def</strong></span> deposit(<span class="dblue">self</span>, amount):
                                        <span class="dblue">self</span>.balance <span class="igrey">+=</span> amount
                                
                                    <span class="lgreen"><strong>def</strong></span> withdraw(<span class="dblue">self</span>, amount):
                                        <span class="dblue">self</span>.balance <span class="igrey">-=</span> amount
                                
                                    <span class="lgreen"><strong>def</strong></span> inquiry(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>.balance
                                
                                <span class="hblue"># A special "Evil" account</span>
                                <span class="lgreen"><strong>class</strong></span> EvilAccount(Account):
                                    <span class="lgreen"><strong>def</strong></span> deposit(<span class="dblue">self</span>, amount):
                                        <span class="dblue">self</span>.balance <span class="igrey">+=</span> <span class="sgreen">0.95</span> <span class="igrey">*</span> amount
                                
                                <span epub:type="pagebreak" id="page_174"></span>    <span class="lgreen"><strong>def</strong></span> inquiry(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>if</strong></span> random.randint(<span class="sgreen">0</span>,<span class="sgreen">4</span>) <span class="igrey">==</span> <span class="sgreen">1</span>:
                                           <span class="lgreen"><strong>return</strong></span> <span class="sgreen">1.10</span> <span class="igrey">*</span> <span class="dblue">self</span>.balance
                                        <span class="lgreen"><strong>else</strong></span>:
                                           <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>.balance</pre>
          <p class="indent">
            The use of inheritance here is a little strange. It introduces two
            different kinds of objects, <code>Account</code> and
            <code>EvilAccount</code>. There is also no obvious way to change an
            existing <code>Account</code> instance into an
            <code>EvilAccount</code> or back, because this involves changing the
            instance type. Perhaps it’s better to have evil manifest as a kind
            of an account policy instead. Here is an alternate formulation of
            <code>Account</code> that does that with static methods:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0174-02" id="f0174-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> StandardPolicy:
                                    <span class="wasabi">@staticmethod</span>
                                    <span class="lgreen"><strong>def</strong></span> deposit(account, amount):
                                        account.balance <span class="igrey">+=</span> amount
                                
                                    <span class="wasabi">@staticmethod</span>
                                    <span class="lgreen"><strong>def</strong></span> withdraw(account, amount):
                                        account.balance <span class="igrey">-=</span> amount
                                
                                    <span class="wasabi">@staticmethod</span>
                                    <span class="lgreen"><strong>def</strong></span> inquiry(account):
                                        <span class="lgreen"><strong>return</strong></span> account.balance
                                
                                <span class="lgreen"><strong>class</strong></span> EvilPolicy(StandardPolicy):
                                    <span class="wasabi">@staticmethod</span>
                                    <span class="lgreen"><strong>def</strong></span> deposit(account, amount):
                                        account.balance <span class="igrey">+=</span> <span class="sgreen">0.95</span><span class="igrey">*</span>amount
                                
                                    <span class="wasabi">@staticmethod</span>
                                    <span class="lgreen"><strong>def</strong></span> inquiry(account):
                                        <span class="lgreen"><strong>if</strong></span> random.randint(<span class="sgreen">0</span>,<span class="sgreen">4</span>) <span class="igrey">==</span> <span class="sgreen">1</span>:
                                           <span class="lgreen"><strong>return</strong></span> <span class="sgreen">1.10</span> <span class="igrey">*</span> account.balance
                                        <span class="lgreen"><strong>else</strong></span>:
                                           <span class="lgreen"><strong>return</strong></span> account.balance
                                
                                <span class="lgreen"><strong>class</strong></span> Account:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, owner, balance, <span class="igrey">*</span>, policy<span class="igrey">=</span>StandardPolicy):
                                        <span class="dblue">self</span>.owner <span class="igrey">=</span> owner
                                        <span class="dblue">self</span>.balance <span class="igrey">=</span> balance
                                        <span class="dblue">self</span>.policy <span class="igrey">=</span> policy
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__repr__</span>(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="trose">f'Account(</span><span class="mblue">{</span><span class="dblue">self</span><span class="mblue">.</span>policy<span class="mblue">}</span><span class="trose">,</span> <span class="mblue">{</span><span class="dblue">self</span><span class="mblue">.</span>owner<span class="mblue">!r}</span><span class="trose">,</span> <span class="mblue">{</span><span class="dblue">self</span><span class="mblue">.</span>balance<span class="mblue">!r}</span><span class="trose">)'</span>
                                
                                <span epub:type="pagebreak" id="page_175"></span>    <span class="lgreen"><strong>def</strong></span> deposit(<span class="dblue">self</span>, amount):
                                        <span class="dblue">self</span>.policy.deposit(<span class="dblue">self</span>, amount)
                                
                                    <span class="lgreen"><strong>def</strong></span> withdraw(<span class="dblue">self</span>, amount):
                                        <span class="dblue">self</span>.policy.withdraw(<span class="dblue">self</span>, amount)
                                
                                    <span class="lgreen"><strong>def</strong></span> inquiry(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>.policy.inquiry(<span class="dblue">self</span>)</pre>
          <p class="indent">
            In this reformulation, there is only one type of instance that gets
            created, <code>Account</code>. However, it has a special
            <code>policy</code> attribute that provides the implementation of
            various methods. If needed, the policy can be dynamically changed on
            an existing <code>Account</code> instance:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0175-02" id="f0175-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; a = Account('Guido', 1000.0)
                                &gt;&gt;&gt; a.policy
                                &lt;class 'StandardPolicy'&gt;
                                &gt;&gt;&gt; a.deposit(500)
                                &gt;&gt;&gt; a.inquiry()
                                1500.0
                                &gt;&gt;&gt; a.policy = EvilPolicy
                                &gt;&gt;&gt; a.deposit(500)
                                &gt;&gt;&gt; a.inquiry()      # Could randomly be 1.10x more
                                1975.0
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            One reason why <code>@staticmethod</code> makes sense here is that
            there is no need to create instances of
            <code>StandardPolicy</code> or <code>EvilPolicy</code>. The main
            purpose of these classes is to organize a bundle of methods, not to
            store additional instance data that’s related to
            <code>Account</code>. Still, the loosely coupled nature of Python
            could certainly allow a policy to be upgraded to hold its own data.
            Change the static methods to normal instance methods like this:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0175-03" id="f0175-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> EvilPolicy(StandardPolicy):
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, deposit_factor, inquiry_factor):
                                        <span class="dblue">self</span>.deposit_factor <span class="igrey">=</span> deposit_factor
                                        <span class="dblue">self</span>.inquiry_factor <span class="igrey">=</span> inquiry_factor
                                
                                    <span class="lgreen"><strong>def</strong></span> deposit(<span class="dblue">self</span>, account, amount):
                                        account.balance <span class="igrey">+=</span> <span class="dblue">self</span>.deposit_factor <span class="igrey">*</span> amount
                                
                                    <span class="lgreen"><strong>def</strong></span> inquiry(<span class="dblue">self</span>, account):
                                        <span class="lgreen"><strong>if</strong></span> random.randint(<span class="sgreen">0</span>,<span class="sgreen">4</span>) <span class="igrey">==</span> <span class="sgreen">1</span>:
                                           <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>.inquiry_factor <span class="igrey">*</span> account.balance
                                        <span class="lgreen"><strong>else</strong></span>:
                                           <span class="lgreen"><strong>return</strong></span> account.balance
                                
                                <span epub:type="pagebreak" id="page_176"></span><span class="hblue"># Example use</span>
                                a <span class="igrey">=</span> Account(<span class="mblue">'Guido'</span>, <span class="sgreen">1000.0</span>, policy<span class="igrey">=</span>EvilPolicy(<span class="sgreen">0.95</span>, <span class="sgreen">1.10</span>))</pre>
          <p class="indent">
            This approach of delegating methods to supporting classes is a
            common implementation strategy for state machines and similar
            objects. Each operational state can be encapsulated into its own
            class of methods (often static). A mutable instance variable, such
            as the <code>policy</code> attribute in this example, can then be
            used to hold implementation-specific details related to the current
            operational state.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec14">
            7.14 A Word about Design Patterns
          </h3>
          <p class="noindent">
            In writing object-oriented programs, programmers sometimes get
            fixated on implementing named design patterns—such as the “strategy
            pattern,” the “flyweight pattern,” the “singleton pattern,” and so
            forth. Many of these originate from the famous
            <em>Design Patterns</em> book by Erich Gamma, Richard Helm, Ralph
            Johnson, and John Vlissides.
          </p>
          <p class="indent">
            If you are familiar with such patterns, the general design
            principles used in other languages can certainly be applied to
            Python. However, many of these documented patterns are aimed at
            working around specific issues that arise from the strict static
            type system of C++ or Java. The dynamic nature of Python renders a
            lot of these patterns obsolete, an overkill, or simply unnecessary.
          </p>
          <p class="indent">
            That said, there are a few overarching principles of writing good
            software—such as striving to write code that is debuggable,
            testable, and extensible. Basic strategies such as writing classes
            with useful <code>__repr__()</code> methods, preferring composition
            over inheritance, and allowing dependency injection can go a long
            way towards these goals. Python programmers also like to work with
            code that can be said to be “Pythonic.” Usually, that means that
            objects obey various built-in protocols, such as iteration,
            containers, or context management. For example, instead of trying to
            implement some exotic data traversal pattern from a Java programming
            book, a Python programmer would probably implement it with a
            generator function feeding a <code>for</code> loop, or just replace
            the entire pattern with a few dictionary lookups.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec15">
            7.15 Data Encapsulation and Private Attributes
          </h3>
          <p class="noindent">
            In Python, all attributes and methods of a class are
            <em>public</em>, that is, accessible without any restrictions. This
            is often undesirable in object-oriented applications that have
            reasons to hide or encapsulate internal implementation details.
          </p>
          <p class="indent">
            To address this problem, Python relies on naming conventions as a
            means of signaling intended usage. One such convention is that names
            starting with a single leading underscore (<code>_</code>) indicate
            internal implementation. For example, here’s a version of the
            <code>Account</code> class where the balance has been turned into a
            “private” attribute:<span
              epub:type="pagebreak"
              id="page_177"
            ></span>
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0177-01" id="f0177-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Account:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, owner, balance):
                                        <span class="dblue">self</span>.owner <span class="igrey">=</span> owner
                                        <span class="dblue">self</span>._balance <span class="igrey">=</span> balance
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__repr__</span>(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="trose">f'Account(</span><span class="mblue">{</span><span class="dblue">self</span><span class="mblue">.</span>owner<span class="mblue">!r}</span><span class="trose">,</span> <span class="mblue">{</span><span class="dblue">self</span><span class="mblue">.</span>_balance<span class="mblue">!r}</span><span class="trose">)'</span>
                                
                                    <span class="lgreen"><strong>def</strong></span> deposit(<span class="dblue">self</span>, amount):
                                        <span class="dblue">self</span>._balance <span class="igrey">+=</span> amount
                                
                                    <span class="lgreen"><strong>def</strong></span> withdraw(<span class="dblue">self</span>, amount):
                                        <span class="dblue">self</span>._balance <span class="igrey">-=</span> amount
                                
                                    <span class="lgreen"><strong>def</strong></span> inquiry(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>._balance</pre>
          <p class="indent">
            In this code, the <code>_balance</code> attribute is meant to be an
            internal detail. There’s nothing that prevents a user from accessing
            it directly, but the leading underscore is a strong indicator that a
            user should look for a more public-facing interface—such as the
            <code>Account.inquiry()</code> method.
          </p>
          <p class="indent">
            A grey area is whether or not internal attributes are available for
            use in a subclass. For example, is the previous inheritance example
            allowed to directly access the <code>_balance</code> attribute of
            its parent?
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0177-02" id="f0177-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> EvilAccount(Account):
                                    <span class="lgreen"><strong>def</strong></span> inquiry(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>if</strong></span> random.randint(<span class="sgreen">0</span>,<span class="sgreen">4</span>) <span class="igrey">==</span> <span class="sgreen">1</span>:
                                           <span class="lgreen"><strong>return</strong></span> <span class="sgreen">1.10</span> <span class="igrey">*</span> <span class="dblue">self</span>._balance
                                        <span class="lgreen"><strong>else</strong></span>:
                                           <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>._balance</pre>
          <p class="indent">
            As a general rule, this is considered acceptable in Python. IDEs and
            other tools are likely to expose such attributes. If you come from
            C++, Java, or another similar object-oriented language, consider
            <code>_balance</code> similar to a “protected” attribute.
          </p>
          <p class="indent">
            If you wish to have an even more private attribute, prefix the name
            with two leading underscores ( <code>__</code> ). All names such as
            <code>__name</code> are automatically renamed into a new name of the
            form <code>_Classname__name</code>. This ensures that private names
            used in a superclass won’t be overwritten by identical names in a
            child class. Here’s an example that illustrates this behavior:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0177-03" id="f0177-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> A:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>):
                                        <span class="dblue">self</span>.__x <span class="igrey">=</span> <span class="sgreen">3</span>        <span class="hblue"># Mangled to self._A__x</span>
                                
                                    <span class="lgreen"><strong>def</strong></span> __spam(<span class="dblue">self</span>):       <span class="hblue"># Mangled to _A__spam()</span>
                                <span epub:type="pagebreak" id="page_178"></span>        print(<span class="mblue">'A.__spam'</span>, <span class="dblue">self</span>.__x)
                                
                                    <span class="lgreen"><strong>def</strong></span> bar(<span class="dblue">self</span>):
                                        <span class="dblue">self</span>.__spam()       <span class="hblue"># Only calls A.__spam()</span>
                                
                                <span class="lgreen"><strong>class</strong></span> B(A):
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>):
                                        A.<span class="cblue">__init__</span>(<span class="dblue">self</span>)
                                        <span class="dblue">self</span>.__x <span class="igrey">=</span> <span class="sgreen">37</span>       <span class="hblue"># Mangled to self._B__x</span>
                                
                                    <span class="lgreen"><strong>def</strong></span> __spam(<span class="dblue">self</span>):       <span class="hblue"># Mangled to _B__spam()</span>
                                        print(<span class="mblue">'B.__spam'</span>, <span class="dblue">self</span>.__x)
                                
                                    <span class="lgreen"><strong>def</strong></span> grok(<span class="dblue">self</span>):
                                        <span class="dblue">self</span>.__spam()       <span class="hblue"># Calls B.__spam()</span></pre>
          <p class="indent">
            In this example, there are two different assignments to an
            <code>__x</code> attribute. In addition, it appears that class
            <code>B</code> is trying to override the
            <code>__spam()</code> method via inheritance. Yet this is not the
            case. Name mangling causes unique names to be used for each
            definition. Try the following example:
          </p>
          <pre>
&gt;&gt;&gt; b = B()
                                &gt;&gt;&gt; b.bar()
                                A.__spam 3
                                &gt;&gt;&gt; b.grok()
                                B.__spam 37
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            You can see the mangled names more directly if you look at the
            underlying instance variables:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0178-03" id="f0178-03"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; vars(b)
                                { '_A__x': 3, '_B__x': 37 }
                                &gt;&gt;&gt; b._A__spam()
                                A.__spam 3
                                &gt;&gt;&gt; b._B__spam
                                B.__spam 37
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            Although this scheme provides the illusion of data hiding, there’s
            no mechanism in place to actually prevent access to the “private”
            attributes of a class. In particular, if the names of the class and
            the corresponding private attribute are known, they can still be
            accessed using the mangled name. If such access to private
            attributes is still a concern, you might consider a more painful
            code review process.
          </p>
          <p class="indent">
            At first glance, name mangling might look like an extra processing
            step. However, the mangling process actually only occurs once when
            the class is defined. It does not occur during execution of the
            methods, nor does it add extra overhead to program execution.
            <span epub:type="pagebreak" id="page_179"></span>Be aware that name
            mangling does not occur in functions such as <code>getattr()</code>,
            <code>hasattr()</code>, <code>setattr()</code>, or
            <code>delattr()</code> where the attribute name is specified as a
            string. For these functions, you would need to explicitly use the
            mangled name such as <code>'_Classname__name'</code> to access the
            attribute.
          </p>
          <p class="indent">
            In practice, it’s probably best to not overthink the privacy of
            names. The single-underscore names are quite common;
            double-underscore names less so. Although you can take further steps
            to try and truly hide attributes, the extra effort and added
            complexity is hardly worth the benefits gained. Perhaps the most
            useful thing is to remember that if you see leading underscores on a
            name, it’s almost certainly some kind of internal detail best left
            alone.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec16">7.16 Type Hinting</h3>
          <p class="noindent">
            Attributes of user-defined classes have no constraints on their type
            or value. In fact, you can set an attribute to anything that you
            want. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0179-01" id="f0179-01"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; a = Account('Guido', 1000.0)
                                &gt;&gt;&gt; a.owner
                                'Guido'
                                &gt;&gt;&gt; a.owner = 37
                                &gt;&gt;&gt; a.owner
                                37
                                &gt;&gt;&gt; b = Account('Eva', 'a lot')
                                &gt;&gt;&gt; b.deposit(' more')
                                &gt;&gt;&gt; b.inquiry()
                                'a lot more'
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            If this is a practical concern, there are a few possible solutions.
            One is easy—don’t do that! Another is to rely upon external tooling
            such as linters and type checkers. For this, classes allow optional
            type hints to be specified for selected attributes. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0179-02" id="f0179-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Account:
                                    owner: str            <span class="hblue"># Type hint</span>
                                    _balance: float       <span class="hblue"># Type hint</span>
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, owner, balance):
                                        <span class="dblue">self</span>.owner <span class="igrey">=</span> owner
                                        <span class="dblue">self</span>._balance <span class="igrey">=</span> balance
                                    ...</pre>
          <p class="indent">
            The inclusion of type hints changes nothing about the actual runtime
            behavior of a class—that is, no extra checking takes place and
            nothing prevents a user from setting bad values in their code.
            However, the hints might give users more useful information in their
            editor, thus preventing careless usage errors before they happen.
          </p>
          <p class="indent">
            <span epub:type="pagebreak" id="page_180"></span>In practice,
            accurate type hinting can be difficult. For example, does the
            <code>Account</code> class allow someone to use an
            <code>int</code> instead of a <code>float</code>? Or what about a
            <code>Decimal</code>? You’ll find that all of these work even though
            the hint might seem to suggest otherwise.
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0180-01" id="f0180-01"
              >Click here to view code image</a
            >
          </p>
          <pre>from decimal import Decimal
                                
                                a <span class="igrey">=</span> Account(<span class="mblue">'Guido'</span>, Decimal(<span class="mblue">'1000.0'</span>))
                                a.withdraw(Decimal(<span class="mblue">'50.0'</span>))
                                print(a.inquiry())      <span class="hblue"># -&gt; 950.0</span></pre>
          <p class="indent">
            Knowing how to properly organize types in such situations is beyond
            the scope of this book. When in doubt, it’s probably better not to
            guess unless you are actively using tools that type-check your code.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec17">7.17 Properties</h3>
          <p class="noindent">
            As noted in the previous section, Python places no runtime
            restrictions on attribute values or types. However, such enforcement
            is possible if you put an attribute under the management of a
            so-called <em>property</em>. A property is a special kind of
            attribute that intercepts attribute access and handles it via
            user-defined methods. These methods have complete freedom to manage
            the attribute as they see fit. Here is an example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0180-02" id="f0180-02"
              >Click here to view code image</a
            >
          </p>
          <pre>import string
                                <span class="lgreen"><strong>class</strong></span> Account:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, owner, balance):
                                        <span class="dblue">self</span>.owner <span class="igrey">=</span> owner
                                        <span class="dblue">self</span>._balance <span class="igrey">=</span> balance
                                
                                    <span class="wasabi">@property</span>
                                    <span class="lgreen"><strong>def</strong></span> owner(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>._owner
                                
                                    <span class="wasabi">@owner.setter</span>
                                    <span class="lgreen"><strong>def</strong></span> owner(<span class="dblue">self</span>, value):
                                        <span class="lgreen"><strong>if not</strong></span> isinstance(value, str):
                                            <span class="lgreen"><strong>raise</strong></span> <span class="pgold">TypeError</span>(<span class="mblue">'Expected str'</span>)
                                        <span class="lgreen"><strong>if not</strong></span> all(c <span class="lgreen"><strong>in</strong></span> string.ascii_uppercase <span class="lgreen"><strong>for</strong></span> c <span class="lgreen"><strong>in</strong></span> value):
                                            <span class="lgreen"><strong>raise</strong></span> <span class="pgold">ValueError</span>(<span class="mblue">'Must be uppercase ASCII'</span>)
                                        <span class="lgreen"><strong>if</strong></span> len(value) <span class="igrey">&gt;</span> <span class="sgreen">10</span>:
                                            <span class="lgreen"><strong>raise</strong></span> <span class="pgold">ValueError</span>(<span class="mblue">'Must be 10 characters or less'</span>)
                                        <span class="dblue">self</span>._owner <span class="igrey">=</span> value</pre>
          <p class="indent">
            Here, the <code>owner</code> attribute is being constrained to a
            very enterprise-grade 10-character uppercase ASCII string. Here is
            how it works when you try to use the class:<span
              epub:type="pagebreak"
              id="page_181"
            ></span>
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0181-01" id="f0181-01"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; a = Account('GUIDO', 1000.0)
                                &gt;&gt;&gt; a.owner = 'EVA'
                                &gt;&gt;&gt; a.owner = 42
                                Traceback (most recent call last):
                                ...
                                TypeError: Expected str
                                &gt;&gt;&gt; a.owner = 'Carol'
                                Traceback (most recent call last):
                                ...
                                ValueError: Must be uppercase ASCII
                                &gt;&gt;&gt; a.owner = 'RENÉE'
                                Traceback (most recent call last):
                                ...
                                ValueError: Must be uppercase ASCII
                                &gt;&gt;&gt; a.owner = 'RAMAKRISHNAN'
                                Traceback (most recent call last):
                                ...
                                ValueError: Must be 10 characters or less
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            The <code>@property</code> decorator is used to establish an
            attribute as a property. In this example, it’s being applied to the
            <code>owner</code> attribute. This decorator is always first applied
            to a method that gets the attribute value. In this case, the method
            is returning the actual value which is being stored in the private
            attribute <code>_owner</code>. The
            <code>@owner.setter</code> decorator that follows is used to
            optionally implement a method for setting the attribute value. This
            method performs the various type and value checks before storing the
            value in the private <code>_owner</code> attribute.
          </p>
          <p class="indent">
            A critical feature of properties is that the associated name, such
            as <code>owner</code> in the example, becomes “magical.” That is,
            any use of that attribute automatically routes through the
            getter/setter methods that you implemented. You don’t have to change
            any preexisting code to make this work. For example, no changes need
            to be made to the <code>Account.__init__()</code> method. This may
            surprise you because <code>__init__()</code> makes the assignment
            <code>self.owner = owner</code> instead of using the private
            attribute <code>self._owner</code>. This is by design—the whole
            point of the <code>owner</code> property was to validate attribute
            values. You’d definitely want to do that when instances are created.
            You’ll find that it works exactly as intended:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0181-02" id="f0181-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; a = Account('Guido', 1000.0)
                                Traceback (most recent call last):
                                  File "account.py", line 5, in __init__
                                    self.owner = owner
                                  File "account.py", line 15, in owner
                                    raise ValueError('Must be uppercase ASCII')
                                ValueError: Must be uppercase ASCII
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            <span epub:type="pagebreak" id="page_182"></span>Since each access
            to a property attribute automatically invokes a method, the actual
            value needs to be stored under a different name. This is why
            <code>_owner</code> is used inside the getter and setter methods.
            You can’t use <code>owner</code> as the storage location because
            doing so would cause infinite recursion.
          </p>
          <p class="indent">
            In general, properties allow for the interception of any specific
            attribute name. You can implement methods for getting, setting, or
            deleting the attribute value. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0182-01" id="f0182-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> SomeClass:
                                    <span class="wasabi">@property</span>
                                    <span class="lgreen"><strong>def</strong></span> attr(<span class="dblue">self</span>):
                                        print(<span class="mblue">'Getting'</span>)
                                
                                    <span class="wasabi">@attr.setter</span>
                                    <span class="lgreen"><strong>def</strong></span> attr(<span class="dblue">self</span>, value):
                                        print(<span class="mblue">'Setting'</span>, value)
                                
                                    <span class="wasabi">@attr.deleter</span>
                                    <span class="lgreen"><strong>def</strong></span> attr(<span class="dblue">self</span>):
                                        print(<span class="mblue">'Deleting'</span>)
                                
                                <span class="hblue"># Example</span>
                                s <span class="igrey">=</span> SomeClass()
                                s.attr         <span class="hblue"># Getting</span>
                                s.attr <span class="igrey">=</span> <span class="sgreen">13</span>    <span class="hblue"># Setting</span>
                                <span class="lgreen"><strong>del</strong></span> s.attr     <span class="hblue"># Deleting</span></pre>
          <p class="indent">
            It is not necessary to implement all parts of a property. In fact,
            it’s common to use properties for implementing read-only computed
            data attributes. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0182-02" id="f0182-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Box(object):
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, width, height):
                                        <span class="dblue">self</span>.width <span class="igrey">=</span> width
                                        <span class="dblue">self</span>.height <span class="igrey">=</span> height
                                
                                    <span class="wasabi">@property</span>
                                    <span class="lgreen"><strong>def</strong></span> area(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>.width <span class="igrey">*</span> <span class="dblue">self</span>.height
                                
                                    <span class="wasabi">@property</span>
                                    <span class="lgreen"><strong>def</strong></span> perimeter(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="sgreen">2</span><span class="igrey">*</span><span class="dblue">self</span>.width <span class="igrey">+</span> <span class="sgreen">2</span><span class="igrey">*</span><span class="dblue">self</span>.height
                                
                                <span class="hblue"># Example use</span>
                                b <span class="igrey">=</span> Box(<span class="sgreen">4</span>, <span class="sgreen">5</span>)
                                <span epub:type="pagebreak" id="page_183"></span>print(b.area)       <span class="hblue"># -&gt; 20</span>
                                print(b.perimeter)  <span class="hblue"># -&gt; 18</span>
                                b.area <span class="igrey">=</span> <span class="sgreen">5</span>          <span class="hblue"># Error: can't set attribute</span></pre>
          <p class="indent">
            One thing to think about when defining a class is making the
            programming interface to it as uniform as possible. Without
            properties, some values would be accessed as simple attributes such
            as <code>b.width</code> or <code>b.height</code> whereas other
            values would be accessed as methods such as
            <code>b.area()</code> and <code>b.perimeter()</code>. Keeping track
            of when to add the extra <code>()</code> creates unnecessary
            confusion. A property can help fix this.
          </p>
          <p class="indent">
            Python programmers don’t often realize that methods themselves are
            implicitly handled as a kind of property. Consider this class:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0183-02" id="f0183-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> SomeClass:
                                    <span class="lgreen"><strong>def</strong></span> yow(<span class="dblue">self</span>):
                                        print(<span class="mblue">'Yow!'</span>)</pre>
          <p class="indent">
            When a user creates an instance such as
            <code>s = SomeClass()</code> and then accesses <code>s.yow</code>,
            the original function object <code>yow</code> is not returned.
            Instead, you get a bound method like this:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0183-03" id="f0183-03"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; s = SomeClass()
                                &gt;&gt;&gt; s.yow
                                &lt;bound method SomeClass.yow of &lt;__main__.SomeClass object at 0x10e2572b0&gt;&gt;
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            How did this happen? It turns out that functions behave a lot like
            properties when they’re placed in a class. Specifically, functions
            magically intercept attribute access and create the bound method
            behind the scenes. When you define static and class methods using
            <code>@staticmethod</code> and <code>@classmethod</code>, you are
            actually altering this process. <code>@staticmethod</code> returns
            the method function back “as is” without any special wrapping or
            processing. More information about this process is covered later in
            <a href="ch07.xhtml#ch07lev1sec28">Section 7.28</a>.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec18">
            7.18 Types, Interfaces, and Abstract Base Classes
          </h3>
          <p class="noindent">
            When you create an instance of a class, the type of that instance is
            the class itself. To test for membership in a class, use the
            built-in function <code>isinstance(obj, cls).</code> This function
            returns <code>True</code> if an object, <code>obj</code>, belongs to
            the class <code>cls</code> or any class derived from
            <code>cls</code>. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0183-04" id="f0183-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> A:
                                    <span class="lgreen"><strong>pass</strong></span>
                                
                                <span class="lgreen"><strong>class</strong></span> B(A):
                                    <span class="lgreen"><strong>pass</strong></span>
                                
                                <span epub:type="pagebreak" id="page_184"></span><span class="lgreen"><strong>class</strong></span> C:
                                    <span class="lgreen"><strong>pass</strong></span>
                                
                                a <span class="igrey">=</span> A()           <span class="hblue"># Instance of 'A'</span>
                                b <span class="igrey">=</span> B()           <span class="hblue"># Instance of 'B'</span>
                                c <span class="igrey">=</span> C()           <span class="hblue"># Instance of 'C'</span>
                                
                                type(a)           <span class="hblue"># Returns the class object A</span>
                                isinstance(a, A)  <span class="hblue"># Returns True</span>
                                isinstance(b, A)  <span class="hblue"># Returns True, B derives from A</span>
                                isinstance(b, C)  <span class="hblue"># Returns False, B not derived from C</span></pre>
          <p class="indent">
            Similarly, the built-in function
            <code>issubclass(A, B)</code> returns <code>True</code> if the class
            <code>A</code> is a subclass of class <code>B</code>. Here’s an
            example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0184-02" id="f0184-02"
              >Click here to view code image</a
            >
          </p>
          <pre>issubclass(B, A)   <span class="hblue"># Returns True</span>
                                issubclass(C, A)   <span class="hblue"># Returns False</span></pre>
          <p class="indent">
            A common use of class typing relations is the specification of
            programming interfaces. As an example, a top-level base class might
            be implemented to specify the requirements of a programming
            interface. That base class might then be used for type hinting or
            for defensive type enforcement via <code>isinstance()</code>:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0184-03" id="f0184-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Stream:
                                    <span class="lgreen"><strong>def</strong></span> receive(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>raise</strong></span> <span class="pgold">NotImplementedError</span>()
                                
                                    <span class="lgreen"><strong>def</strong></span> send(<span class="dblue">self</span>, msg):
                                        <span class="lgreen"><strong>raise</strong></span> <span class="pgold">NotImplementedError</span>()
                                
                                    <span class="lgreen"><strong>def</strong></span> close(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>raise</strong></span> <span class="pgold">NotImplementedError</span>()
                                
                                <span class="hblue"># Example.</span>
                                <span class="lgreen"><strong>def</strong></span> send_request(stream, request):
                                    <span class="lgreen"><strong>if not</strong></span> isinstance(stream, Stream):
                                        <span class="lgreen"><strong>raise</strong></span> <span class="pgold">TypeError</span>(<span class="mblue">'Expected a Stream'</span>)
                                    stream.send(request)
                                    <span class="lgreen"><strong>return</strong></span> stream.receive()</pre>
          <p class="indent">
            The anticipation with such code is not that <code>Stream</code> be
            used directly. Instead, different classes would inherit from
            <code>Stream</code> and implement the required functionality. A user
            would instantiate one of those classes instead. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0184-04" id="f0184-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> SocketStream(Stream):
                                    <span class="lgreen"><strong>def</strong></span> receive(<span class="dblue">self</span>):
                                        ...
                                
                                <span epub:type="pagebreak" id="page_185"></span>    <span class="lgreen"><strong>def</strong></span> send(<span class="dblue">self</span>, msg):
                                        ...
                                
                                    <span class="lgreen"><strong>def</strong></span> close(<span class="dblue">self</span>):
                                        ...
                                
                                <span class="lgreen"><strong>class</strong></span> PipeStream(Stream):
                                    <span class="lgreen"><strong>def</strong></span> receive(<span class="dblue">self</span>):
                                        ...
                                
                                    <span class="lgreen"><strong>def</strong></span> send(<span class="dblue">self</span>, msg):
                                        ...
                                
                                    <span class="lgreen"><strong>def</strong></span> close(<span class="dblue">self</span>):
                                        ...
                                
                                <span class="hblue"># Example</span>
                                s <span class="igrey">=</span> SocketStream()
                                send_request(s, request)</pre>
          <p class="indent">
            Worth discussing in this example is the runtime enforcement of the
            interface in <code>send_request()</code>. Should one use a type hint
            instead?
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0185-02" id="f0185-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># Specifying an interface as a type hint</span>
                                <span class="lgreen"><strong>def</strong></span> send_request(stream:Stream, request):
                                    stream.send(request)
                                    <span class="lgreen"><strong>return</strong></span> stream.receive()</pre>
          <p class="indent">
            Given that type hints aren’t enforced, the decision of how to
            validate an argument against an interface really depends on when you
            want it to happen—at runtime, as a code checking step, or not at
            all.
          </p>
          <p class="indent">
            This use of interface classes is more common in the organization of
            large frameworks and applications. However, with this approach you
            need to make sure that subclasses actually implement the required
            interface. For example, if a subclass chose not to implement one of
            the required methods or had a simple misspelling, the effects might
            go unnoticed at first as the code might still work in the common
            case. However, later on, the program will crash if the unimplemented
            method is invoked. Naturally, this would only take place at 3:30 AM
            in production.
          </p>
          <p class="indent">
            To prevent this problem, it is common for interfaces to be defined
            as <em>abstract base classes</em> using the <code>abc</code> module.
            This module defines a base class (<code>ABC</code>) and a decorator
            (<code>@abstractmethod</code>) that are used together to describe an
            interface. Here is an example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0185-03" id="f0185-03"
              >Click here to view code image</a
            >
          </p>
          <pre>from abc import ABC, abstractmethod
                                
                                <span class="lgreen"><strong>class</strong></span> Stream(ABC):
                                    <span class="wasabi">@abstractmethod</span>
                                <span epub:type="pagebreak" id="page_186"></span>    <span class="lgreen"><strong>def</strong></span> receive(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>pass</strong></span>
                                
                                    <span class="wasabi">@abstractmethod</span>
                                    <span class="lgreen"><strong>def</strong></span> send(<span class="dblue">self</span>, msg):
                                        <span class="lgreen"><strong>pass</strong></span>
                                
                                    <span class="wasabi">@abstractmethod</span>
                                    <span class="lgreen"><strong>def</strong></span> close(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>pass</strong></span></pre>
          <p class="indent">
            An abstract class is not meant to be instantiated directly. In fact,
            if you try to create a <code>Stream</code> instance, you’ll get an
            error:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0186-02" id="f0186-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; s = Stream()
                                Traceback (most recent call last):
                                  File "&lt;stdin&gt;", line 1, <strong>in</strong> &lt;module&gt;
                                TypeError: Can't instantiate abstract class Stream with abstract methods close, receive, send
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            The error message tells you exactly what methods need to be
            implemented by a <code>Stream</code>. This serves as a guide for
            writing subclasses. Suppose you write a subclass but make a mistake:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0186-03" id="f0186-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> SocketStream(Stream):
                                    <span class="lgreen"><strong>def</strong></span> read(<span class="dblue">self</span>):         <span class="hblue"># Misnamed</span>
                                        ...
                                
                                    <span class="lgreen"><strong>def</strong></span> send(<span class="dblue">self</span>, msg):
                                        ...
                                
                                    <span class="lgreen"><strong>def</strong></span> close(<span class="dblue">self</span>):
                                        ...</pre>
          <p class="indent">
            An abstract base class will catch the mistake upon instantiation.
            This is useful because errors are caught early.
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0186-04" id="f0186-04"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; s = SocketStream()
                                Traceback (most recent call last):
                                  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
                                TypeError: Can't instantiate abstract class SocketStream with abstract methods receive
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            <span epub:type="pagebreak" id="page_187"></span>Although an
            abstract class cannot be instantiated, it can define methods and
            properties for use in subclasses. Moreover, an abstract method in
            the base can still be called from a subclass. For example, calling
            <code>super().receive()</code> from a subclass is allowed.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec19">
            7.19 Multiple Inheritance, Interfaces, and Mixins
          </h3>
          <p class="noindent">
            Python supports multiple inheritance. If a child class lists more
            than one parent, the child inherits all of the features of the
            parents. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0187-01" id="f0187-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Duck:
                                    <span class="lgreen"><strong>def</strong></span> walk(<span class="dblue">self</span>):
                                        print(<span class="mblue">'Waddle'</span>)
                                
                                <span class="lgreen"><strong>class</strong></span> Trombonist:
                                    <span class="lgreen"><strong>def</strong></span> noise(<span class="dblue">self</span>):
                                        print(<span class="mblue">'Blat!'</span>)
                                
                                <span class="lgreen"><strong>class</strong></span> DuckBonist(Duck, Trombonist):
                                    <span class="lgreen"><strong>pass</strong></span>
                                
                                d <span class="igrey">=</span> DuckBonist()
                                d.walk()        <span class="hblue"># -&gt; Waddle</span>
                                d.noise()       <span class="hblue"># -&gt; Blat!</span></pre>
          <p class="indent">
            Conceptually, it’s a neat idea, but then practical realities start
            to set in. For example, what happens if <code>Duck</code> and
            <code>Trombonist</code> each define an
            <code>__init__()</code> method? Or if they both define a
            <code>noise()</code> method? Suddenly, you start to realize that
            multiple inheritance is fraught with peril.
          </p>
          <p class="indent">
            To better understand the actual usage of multiple inheritance, step
            back and view it as a highly specialized tool for organization and
            code reuse—as opposed to a general-purpose programming technique.
            Specifically, taking a collection of arbitrary unrelated classes and
            combining them together with multiple inheritance to create weird
            mutant duck-musicians isn’t standard practice. Don’t ever do that.
          </p>
          <p class="indent">
            A more common use of multiple inheritance is organizing type and
            interface relations. For example, the last section introduced the
            concept of an abstract base class. The purpose of an abstract base
            is to specify a programming interface. For example, you might have
            various abstract classes like this:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0187-02" id="f0187-02"
              >Click here to view code image</a
            >
          </p>
          <pre>from abc import ABC, abstractmethod
                                
                                <span class="lgreen"><strong>class</strong></span> Stream(ABC):
                                    <span class="wasabi">@abstractmethod</span>
                                <span epub:type="pagebreak" id="page_188"></span>    <span class="lgreen"><strong>def</strong></span> receive(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>pass</strong></span>
                                
                                    <span class="wasabi">@abstractmethod</span>
                                    <span class="lgreen"><strong>def</strong></span> send(<span class="dblue">self</span>, msg):
                                        <span class="lgreen"><strong>pass</strong></span>
                                
                                    <span class="wasabi">@abstractmethod</span>
                                    <span class="lgreen"><strong>def</strong></span> close(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>pass</strong></span>
                                
                                <span class="lgreen"><strong>class</strong></span> Iterable(ABC):
                                    <span class="wasabi">@abstractmethod</span>
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__iter__</span>(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>pass</strong></span></pre>
          <p class="indent">
            With these classes, multiple inheritance might be used to specify
            which interfaces have been implemented by a child class:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0188-02" id="f0188-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> MessageStream(Stream, Iterable):
                                    <span class="lgreen"><strong>def</strong></span> receive(<span class="dblue">self</span>):
                                        ...
                                    <span class="lgreen"><strong>def</strong></span> send(<span class="dblue">self</span>):
                                        ...
                                    <span class="lgreen"><strong>def</strong></span> close(<span class="dblue">self</span>):
                                        ...
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__iter__</span>(<span class="dblue">self</span>):
                                        ...</pre>
          <p class="indent">
            Again, this use of multiple inheritance is not about implementation,
            but type relations. For example, none of the inherited methods even
            do anything in this example. There is no code reuse. Mainly, the
            inheritance relationship allows you to perform type checks like
            this:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0188-03" id="f0188-03"
              >Click here to view code image</a
            >
          </p>
          <pre>m <span class="igrey">=</span> MessageStream()
                                
                                isinstance(m, Stream)     <span class="hblue"># -&gt; True</span>
                                isinstance(m, Iterable)   <span class="hblue"># -&gt; True</span></pre>
          <p class="indent">
            The other use of multiple inheritance is to define
            <em>mixin classes</em>. A mixin class is a class that modifies or
            extends the functionality of other classes. Consider the following
            class definitions:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0188-04" id="f0188-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Duck:
                                    <span class="lgreen"><strong>def</strong></span> noise(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="mblue">'Quack'</span>
                                
                                    <span class="lgreen"><strong>def</strong></span> waddle(<span class="dblue">self</span>):
                                <span epub:type="pagebreak" id="page_189"></span>        <span class="lgreen"><strong>return</strong></span> <span class="mblue">'Waddle'</span>
                                
                                <span class="lgreen"><strong>class</strong></span> Trombonist:
                                    <span class="lgreen"><strong>def</strong></span> noise(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="mblue">'Blat!'</span>
                                
                                    <span class="lgreen"><strong>def</strong></span> march(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="mblue">'Clomp'</span>
                                
                                <span class="lgreen"><strong>class</strong></span> Cyclist:
                                    <span class="lgreen"><strong>def</strong></span> noise(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="mblue">'On your left!'</span>
                                
                                    <span class="lgreen"><strong>def</strong></span> pedal(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="mblue">'Pedaling'</span></pre>
          <p class="indent">
            These classes are completely unrelated to each other. There is no
            inheritance relationship and they implement different methods.
            However, there is a shared commonality in that they each define a
            <code>noise()</code> method. Using that as a guide, you could define
            the following classes:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0189-02" id="f0189-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> LoudMixin:
                                    <span class="lgreen"><strong>def</strong></span> noise(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> super().noise().upper()
                                
                                <span class="lgreen"><strong>class</strong></span> AnnoyingMixin:
                                    <span class="lgreen"><strong>def</strong></span> noise(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="sgreen">3</span><span class="igrey">*</span>super().noise()</pre>
          <p class="indent">
            At first glance, these classes look wrong. There’s just a single
            isolated method and it uses <code>super()</code> to delegate to a
            nonexistent parent class. The classes don’t even work:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0189-03" id="f0189-03"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; a = AnnoyingMixin()
                                &gt;&gt;&gt; a.noise()
                                Traceback (most recent call last):
                                ...
                                AttributeError: 'super' object has no attribute 'noise'
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            These are mixin classes. The only way that they work is in
            combination with other classes that implement the missing
            functionality. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0189-04" id="f0189-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> LoudDuck(LoudMixin, Duck):
                                    <span class="lgreen"><strong>pass</strong></span>
                                
                                <span class="lgreen"><strong>class</strong></span> AnnoyingTrombonist(AnnoyingMixin, Trombonist):
                                    <span class="lgreen"><strong>pass</strong></span>
                                
                                <span epub:type="pagebreak" id="page_190"></span><span class="lgreen"><strong>class</strong></span> AnnoyingLoudCyclist(AnnoyingMixin, LoudMixin, Cyclist):
                                    <span class="lgreen"><strong>pass</strong></span>
                                
                                d <span class="igrey">=</span> LoudDuck()
                                d.noise() <span class="hblue"># -&gt; 'QUACK'</span>
                                
                                t <span class="igrey">=</span> AnnoyingTrombonist()
                                t.noise() <span class="hblue"># -&gt; 'Blat!Blat!Blat!'</span>
                                
                                c <span class="igrey">=</span> AnnoyingLoudCyclist()
                                c.noise() <span class="hblue"># -&gt; 'ON YOUR LEFT!ON YOUR LEFT!ON YOUR LEFT!'</span></pre>
          <p class="indent">
            Since mixin classes are defined in the same way as normal classes,
            it is best to include the word “Mixin” as part of the class name.
            This naming convention provides a greater clarity of purpose.
          </p>
          <p class="indent">
            To fully understand mixins, you need to know a bit more about how
            inheritance and the <code>super()</code> function work.
          </p>
          <p class="indent">
            First, whenever you use inheritance, Python builds a linear chain of
            classes known as the <em>Method Resolution Order</em>, or MRO for
            short. This is available as the <code>__mro__</code> attribute on a
            class. Here are some examples for single inheritance:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0190-02" id="f0190-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Base:
                                    <span class="lgreen"><strong>pass</strong></span>
                                
                                <span class="lgreen"><strong>class</strong></span> A(Base):
                                    <span class="lgreen"><strong>pass</strong></span>
                                
                                <span class="lgreen"><strong>class</strong></span> B(A):
                                    <span class="lgreen"><strong>pass</strong></span>
                                
                                Base.__mro__ <span class="hblue"># -&gt; (&lt;class 'Base'&gt;, &lt;class 'object'&gt;)</span>
                                A.__mro__    <span class="hblue"># -&gt; (&lt;class 'A'&gt;, &lt;class 'Base'&gt;, &lt;class 'object'&gt;)</span>
                                B.__mro__    <span class="hblue"># -&gt; (&lt;class 'B'&gt;, &lt;class 'A'&gt;, &lt;class 'Base'&gt;, &lt;class 'object'&gt;)</span></pre>
          <p class="indent">
            The MRO specifies the search order for attribute lookup.
            Specifically, whenever you search for an attribute on an instance or
            class, each class on the MRO is checked in the order listed. The
            search stops when the first match is made. The
            <code>object</code> class is listed in the MRO because all classes
            inherit from <code>object</code>, whether or not it’s listed as a
            parent.
          </p>
          <p class="indent">
            To support multiple inheritance, Python implements what’s known as
            “cooperative multiple inheritance.” With cooperative inheritance,
            all of the classes are placed on the MRO list according to two
            primary ordering rules. The first rule states that a child class
            must always be checked before any of its parents. The second rule
            states that if a class has multiple parents, those parents must be
            checked in the same order as they’re written in the inheritance list
            of the child. For the most part, these rules produce an MRO that
            makes sense. However, the precise algorithm that orders the classes
            is actually quite complex and not based on any simple approach such
            as depth-first or breadth-first search. Instead, the
            <span epub:type="pagebreak" id="page_191"></span>ordering is
            determined according to the C3 linearization algorithm, which is
            described in the paper “A Monotonic Superclass Linearization for
            Dylan” (K. Barrett, et al., presented at OOPSLA’96). A subtle aspect
            of this algorithm is that certain class hierarchies will be rejected
            by Python with a <code>TypeError</code>. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0191-01" id="f0191-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> X: <span class="lgreen"><strong>pass</strong></span>
                                <span class="lgreen"><strong>class</strong></span> Y(X): <span class="lgreen"><strong>pass</strong></span>
                                <span class="lgreen"><strong>class</strong></span> Z(X,Y): <span class="lgreen"><strong>pass</strong></span>  <span class="hblue"># TypeError.</span>
                                                    <span class="hblue"># Can't create consistent MRO</span></pre>
          <p class="indent">
            In this case, the method resolution algorithm rejects class
            <code>Z</code> because it can’t determine an ordering of the base
            classes that makes sense. Here, the class <code>X</code> appears
            before class <code>Y</code> in the inheritance list, so it must be
            checked first. However, class <code>Y</code> inherits from
            <code>X</code>, so if <code>X</code> is checked first, it violates
            the rule about children being checked first. In practice, these
            issues rarely arise—and if they do, it usually indicates a more
            serious design problem.
          </p>
          <p class="indent">
            As an example of an MRO in practice, here’s the MRO for the
            <code>AnnoyingLoudCyclist</code> class shown earlier:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0191-02" id="f0191-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> AnnoyingLoudCyclist(AnnoyingMixin, LoudMixin, Cyclist):
                                    <span class="lgreen"><strong>pass</strong></span>
                                
                                AnnoyingLoudCyclist.__mro__
                                <span class="hblue"># (&lt;class 'AnnoyingLoudCyclist'&gt;, &lt;class 'AnnoyingMixin'&gt;,</span>
                                <span class="hblue"># &lt;class 'LoudMixin'&gt;, &lt;class 'Cyclist'&gt;, &lt;class 'object'&gt;)</span></pre>
          <p class="indent">
            In this MRO, you see how both rules are satisfied. Specifically, any
            child class is always listed before its parents. The
            <code>object</code> class is listed last because it is the parent of
            all other classes. The multiple parents are listed in the order they
            appeared in the code.
          </p>
          <p class="indent">
            The behavior of the <code>super()</code> function is tied to the
            underlying MRO. Specifically, its role is to delegate attributes to
            the next class on the MRO. This is based upon the class where
            <code>super()</code> is used. For example, when the
            <code>AnnoyingMixin</code> class uses <code>super()</code>, it looks
            at the MRO of the instance to find its own position. From there, it
            delegates attribute lookup to the next class. In this example, using
            <code>super().noise()</code> in the <code>AnnoyingMixin</code> class
            invokes <code>LoudMixin.noise()</code>. This is because
            <code>LoudMixin</code> is the next class listed on the MRO for
            <code>AnnoyingLoudCyclist</code>. The
            <code>super().noise()</code> operation in the
            <code>LoudMixin</code> class then delegates to the
            <code>Cyclist</code> class. For any use of <code>super()</code>, the
            choice of the next class varies according to the type of the
            instance. For example, if you make an instance of
            <code>AnnoyingTrombonist</code>, then
            <code>super().noise()</code> will invoke
            <code>Trombonist.noise()</code> instead.
          </p>
          <p class="indent">
            Designing for cooperative multiple inheritance and mixins is a
            challenge. Here are some design guidelines. First, child classes are
            always checked before any base class in the MRO. Thus, it is common
            for mixins to share a common parent, and for that parent to provide
            an empty implementation of methods. If multiple mixin classes are
            used at the same time, they’ll line up after each other. The common
            parent will appear last where it can provide a default
            implementation or an error check. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0191-03" id="f0191-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> NoiseMixin:
                                    <span class="lgreen"><strong>def</strong></span> noise(<span class="dblue">self</span>):
                                <span epub:type="pagebreak" id="page_192"></span>        <span class="lgreen"><strong>raise</strong></span> <span class="pgold">NotImplementedError</span>(<span class="mblue">'noise() not implemented'</span>)
                                
                                <span class="lgreen"><strong>class</strong></span> LoudMixin(NoiseMixin):
                                    <span class="lgreen"><strong>def</strong></span> noise(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> super().noise().upper()
                                
                                <span class="lgreen"><strong>class</strong></span> AnnoyingMixin(NoiseMixin):
                                    <span class="lgreen"><strong>def</strong></span> noise(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="sgreen">3</span> <span class="igrey">*</span> super().noise()</pre>
          <p class="indent">
            The second guideline is that all implementations of a mixin method
            should have an identical function signature. One issue with mixins
            is that they are optional and often mixed together in unpredictable
            order. For this to work, you must guarantee that operations
            involving <code>super()</code> succeed regardless of what class
            comes next. To do that, all methods in the call chain need to have a
            compatible calling signature.
          </p>
          <p class="indent">
            Finally, you need to make sure that you use
            <code>super()</code> everywhere. Sometimes you’ll encounter a class
            that makes a direct call to its parent:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0192-02" id="f0192-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Base:
                                    <span class="lgreen"><strong>def</strong></span> yow(<span class="dblue">self</span>):
                                        print(<span class="mblue">'Base.yow'</span>)
                                
                                <span class="lgreen"><strong>class</strong></span> A(Base):
                                    <span class="lgreen"><strong>def</strong></span> yow(<span class="dblue">self</span>):
                                        print(<span class="mblue">'A.yow'</span>)
                                        Base.yow(<span class="dblue">self</span>)       <span class="hblue"># Direct call to parent</span>
                                
                                <span class="lgreen"><strong>class</strong></span> B(Base):
                                    <span class="lgreen"><strong>def</strong></span> yow(<span class="dblue">self</span>):
                                        print(<span class="mblue">'B.yow'</span>)
                                        super().yow(<span class="dblue">self</span>)
                                
                                <span class="lgreen"><strong>class</strong></span> C(A, B):
                                    <span class="lgreen"><strong>pass</strong></span>
                                
                                c <span class="igrey">=</span> C()
                                c.yow()
                                <span class="hblue"># Outputs:</span>
                                <span class="hblue">#    A.yow</span>
                                <span class="hblue">#    Base.yow</span></pre>
          <p class="indent">
            Such classes are not safe to use with multiple inheritance. Doing so
            breaks the proper chain of method calls and causes confusion. For
            instance, in the above example, no output ever appears from
            <code>B.yow()</code> even though it’s part of the inheritance
            hierarchy. If you’re doing anything with multiple inheritance, you
            should be using <code>super()</code> instead of making direct calls
            to methods in superclasses.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec20">
            <span epub:type="pagebreak" id="page_193"></span>7.20 Type-Based
            Dispatch
          </h3>
          <p class="noindent">
            Sometimes you need to write code that dispatches based on a specific
            type. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0193-01" id="f0193-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>if</strong></span> isinstance(obj, Duck):
                                   handle_duck(obj)
                                <span class="lgreen"><strong>elif</strong></span> isinstance(obj, Trombonist):
                                   handle_trombonist(obj)
                                <span class="lgreen"><strong>elif</strong></span> isinstance(obj, Cyclist):
                                   handle_cyclist(obj)
                                <span class="lgreen"><strong>else</strong></span>:
                                   <span class="lgreen"><strong>raise</strong></span> <span class="pgold">RuntimeError</span>(<span class="mblue">'Unknown object'</span>)</pre>
          <p class="indent">
            Such a large <code>if-elif-else</code> block is inelegant and
            fragile. An often used solution is to dispatch through a dictionary:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0193-02" id="f0193-02"
              >Click here to view code image</a
            >
          </p>
          <pre>handlers <span class="igrey">=</span> {
                                    Duck: handle_duck,
                                    Trombonist: handle_trombonist,
                                    Cyclist: handle_cyclist
                                }
                                
                                <span class="hblue"># Dispatch</span>
                                <span class="lgreen"><strong>def</strong></span> dispatch(obj):
                                    func <span class="igrey">=</span> handlers.get(type(obj))
                                    <span class="lgreen"><strong>if</strong></span> func:
                                         <span class="lgreen"><strong>return</strong></span> func(obj)
                                    <span class="lgreen"><strong>else</strong></span>:
                                         <span class="lgreen"><strong>raise</strong></span> <span class="pgold">RuntimeError</span>(<span class="trose">f'No handler for</span> <span class="mblue">{</span>obj<span class="mblue">}</span><span class="trose">'</span>)</pre>
          <p class="indent">
            This solution assumes an exact type match. If inheritance is also to
            be supported in such dispatch, you would need to walk the MRO:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0193-03" id="f0193-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> dispatch(obj):
                                    <span class="lgreen"><strong>for</strong></span> ty <span class="lgreen"><strong>in</strong></span> type(obj).__mro__:
                                        func <span class="igrey">=</span> handlers.get(ty)
                                        <span class="lgreen"><strong>if</strong></span> func:
                                            <span class="lgreen"><strong>return</strong></span> func(obj)
                                    <span class="lgreen"><strong>raise</strong></span> <span class="pgold">RuntimeError</span>(<span class="trose">f'No handler for</span> <span class="mblue">{</span>obj<span class="mblue">}</span><span class="trose">'</span>)</pre>
          <p class="indent">
            Sometimes dispatching is implemented through a class-based interface
            using <code>getattr()</code> like this:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0193-04" id="f0193-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Dispatcher:
                                    <span class="lgreen"><strong>def</strong></span> handle(<span class="dblue">self</span>, obj):
                                        <span class="lgreen"><strong>for</strong></span> ty <span class="lgreen"><strong>in</strong></span> type(obj).__mro__:
                                            meth <span class="igrey">=</span> getattr(<span class="dblue">self</span>, <span class="trose">f'handle_</span><span class="mblue">{ty.</span><span class="dblue">__name__</span><span class="mblue">}</span><span class="trose">'</span>, <span class="dblue">None</span>)
                                <span epub:type="pagebreak" id="page_194"></span>            <span class="lgreen"><strong>if</strong></span> meth:
                                                <span class="lgreen"><strong>return</strong></span> meth(obj)
                                        <span class="lgreen"><strong>raise</strong></span> <span class="pgold">RuntimeError</span>(<span class="trose">f'No handler for</span> <span class="mblue">{</span>obj<span class="mblue">}</span><span class="trose">'</span>)
                                
                                    <span class="lgreen"><strong>def</strong></span> handle_Duck(<span class="dblue">self</span>, obj):
                                        ...
                                
                                    <span class="lgreen"><strong>def</strong></span> handle_Trombonist(<span class="dblue">self</span>, obj):
                                        ...
                                
                                    <span class="lgreen"><strong>def</strong></span> handle_Cyclist(<span class="dblue">self</span>, obj):
                                        ...
                                
                                <span class="hblue"># Example</span>
                                dispatcher <span class="igrey">=</span> Dispatcher()
                                dispatcher.handle(Duck())     <span class="hblue"># -&gt; handle_Duck()</span>
                                dispatcher.handle(Cyclist())  <span class="hblue"># -&gt; handle_Cyclist()</span></pre>
          <p class="indent">
            This last example of using <code>getattr()</code> to dispatch onto
            methods of a class is a fairly common programming pattern.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec21">7.21 Class Decorators</h3>
          <p class="noindent">
            Sometimes you want to perform extra processing steps after a class
            has been defined—such as adding the class to a registry or
            generating extra support code. One approach is to use a class
            decorator. A class decorator is a function that takes a class as
            input and returns a class as output. For example, here’s how you can
            maintain a registry:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0194-02" id="f0194-02"
              >Click here to view code image</a
            >
          </p>
          <pre>_registry <span class="igrey">=</span> { }
                                <span class="lgreen"><strong>def</strong></span> register_decoder(cls):
                                    <span class="lgreen"><strong>for</strong></span> mt <span class="lgreen"><strong>in</strong></span> cls.mimetypes:
                                        _registry[mt.mimetype] <span class="igrey">=</span> cls
                                    <span class="lgreen"><strong>return</strong></span> cls
                                
                                <span class="hblue"># Factory function that uses the registry</span>
                                <span class="lgreen"><strong>def</strong></span> create_decoder(mimetype):
                                    <span class="lgreen"><strong>return</strong></span> _registry[mimetype]()</pre>
          <p class="indent">
            In this example, the <code>register_decoder()</code> function looks
            inside a class for a <code>mimetypes</code> attribute. If found,
            it’s used to add the class to a dictionary mapping MIME types to
            class objects. To use this function, you apply it as a decorator
            right before the class definition:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0194-03" id="f0194-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="wasabi">@register_decoder</span>
                                <span class="lgreen"><strong>class</strong></span> TextDecoder:
                                    mimetypes <span class="igrey">=</span> [ <span class="mblue">'text/plain'</span> ]
                                <span epub:type="pagebreak" id="page_195"></span>    <span class="lgreen"><strong>def</strong></span> decode(<span class="dblue">self</span>, data):
                                        ...
                                
                                <span class="wasabi">@register_decoder</span>
                                <span class="lgreen"><strong>class</strong></span> HTMLDecoder:
                                    mimetypes <span class="igrey">=</span> [ <span class="mblue">'text/html'</span> ]
                                    <span class="lgreen"><strong>def</strong></span> decode(<span class="dblue">self</span>, data):
                                        ...
                                
                                <span class="wasabi">@register_decoder</span>
                                <span class="lgreen"><strong>class</strong></span> ImageDecoder:
                                    mimetypes <span class="igrey">=</span> [ <span class="mblue">'image/png'</span>, <span class="mblue">'image/jpg'</span>, <span class="mblue">'image/gif'</span> ]
                                    <span class="lgreen"><strong>def</strong></span> decode(<span class="dblue">self</span>, data):
                                        ...
                                
                                <span class="hblue"># Example usage</span>
                                decoder <span class="igrey">=</span> create_decoder(<span class="mblue">'image/jpg'</span>)</pre>
          <p class="indent">
            A class decorator is free to modify the contents of the class it’s
            given. For example, it might even rewrite existing methods. This is
            a common alternative to mixin classes or multiple inheritance. For
            example, consider these decorators:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0195-02" id="f0195-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> loud(cls):
                                    orig_noise <span class="igrey">=</span> cls.noise
                                    <span class="lgreen"><strong>def</strong></span> noise(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> orig_noise(<span class="dblue">self</span>).upper()
                                    cls.noise <span class="igrey">=</span> noise
                                    <span class="lgreen"><strong>return</strong></span> cls
                                
                                <span class="lgreen"><strong>def</strong></span> annoying(cls):
                                    orig_noise <span class="igrey">=</span> cls.noise
                                    <span class="lgreen"><strong>def</strong></span> noise(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="sgreen">3</span> <span class="igrey">*</span> orig_noise(<span class="dblue">self</span>)
                                    cls.noise <span class="igrey">=</span> noise
                                    <span class="lgreen"><strong>return</strong></span> cls
                                
                                <span class="wasabi">@annoying</span>
                                <span class="wasabi">@loud</span>
                                <span class="lgreen"><strong>class</strong></span> Cyclist(object):
                                    <span class="lgreen"><strong>def</strong></span> noise(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="mblue">'On your left!'</span>
                                
                                    <span class="lgreen"><strong>def</strong></span> pedal(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="mblue">'Pedaling'</span></pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_196"></span>This example
            produces the same result as the mixin example from the previous
            section. However, there is no multiple inheritance and no use of
            <code>super()</code>. Within each decorator, the lookup of
            <code>cls.noise</code> performs the same action as
            <code>super()</code>. But, since this only happens once when the
            decorator is applied (at definition time), the resulting calls to
            <code>noise()</code> will run a bit faster.
          </p>
          <p class="indent">
            Class decorators can also be used to create entirely new code. For
            example, a common task when writing a class is to write a useful
            <code>__repr__()</code> method for improved debugging:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0196-01" id="f0196-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Point:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, x, y):
                                        <span class="dblue">self</span>.x <span class="igrey">=</span> x
                                        <span class="dblue">self</span>.y <span class="igrey">=</span> y
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__repr__</span>(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="trose">f'</span><span class="mblue">{</span>type(<span class="dblue">self</span>)<span class="mblue">.</span><span class="dblue">__name__</span><span class="mblue">}</span><span class="trose">(</span><span class="mblue">{</span><span class="dblue">self</span><span class="mblue">.x!r}</span><span class="trose">,</span> <span class="mblue">{</span><span class="dblue">self</span><span class="mblue">.y!r}</span><span class="trose">)'</span></pre>
          <p class="indent">
            Writing such methods is often annoying. Perhaps a class decorator
            could create the method for you?
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0196-02" id="f0196-02"
              >Click here to view code image</a
            >
          </p>
          <pre>import inspect
                                <span class="lgreen"><strong>def</strong></span> with_repr(cls):
                                    args <span class="igrey">=</span> list(inspect.signature(cls).parameters)
                                    argvals <span class="igrey">=</span> <span class="mblue">', '</span>.join(<span class="mblue">'{self.%s!r}'</span> <span class="igrey">%</span> arg <span class="lgreen"><strong>for</strong></span> arg <span class="lgreen"><strong>in</strong></span> args)
                                    code <span class="igrey">=</span> <span class="mblue">'def __repr__(self):\n'</span>
                                    code <span class="igrey">+=</span> <span class="trose">f' return f"</span><span class="mblue">{</span>cls<span class="mblue">.</span><span class="dblue">__name__</span><span class="mblue">}</span><span class="trose">(</span><span class="mblue">{</span>argvals<span class="mblue">}</span><span class="trose">)"</span><span class="mblue">\n</span><span class="trose">'</span>
                                    locs <span class="igrey">=</span> { }
                                    exec(code, locs)
                                    cls.<span class="cblue">__repr__</span> <span class="igrey">=</span> locs[<span class="mblue">'__repr__'</span>]
                                    <span class="lgreen"><strong>return</strong></span> cls
                                
                                <span class="hblue"># Example</span>
                                <span class="wasabi">@with_repr</span>
                                <span class="lgreen"><strong>class</strong></span> Point:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, x, y):
                                        <span class="dblue">self</span>.x <span class="igrey">=</span> x
                                        <span class="dblue">self</span>.y <span class="igrey">=</span> y</pre>
          <p class="indent">
            In this example, a <code>__repr__()</code> method is generated from
            the calling signature of the <code>__init__()</code> method. The
            method is created as a text string and passed to
            <code>exec()</code> to create a function. That function is attached
            to the class.
          </p>
          <p class="indent">
            Similar code generation techniques are used in parts of the standard
            library. For example, a convenient way to define data structures is
            to use a dataclass:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0196-03" id="f0196-03"
              >Click here to view code image</a
            >
          </p>
          <pre>from dataclasses import dataclass
                                
                                <span class="wasabi">@dataclass</span>
                                <span class="lgreen"><strong>class</strong></span> Point:
                                <span epub:type="pagebreak" id="page_197"></span>    x: int
                                    y: int</pre>
          <p class="indent">
            A dataclass automatically creates methods such as
            <code>__init__()</code> and <code>__repr__()</code> from class type
            hints. The methods are created using <code>exec()</code>, similarly
            to the prior example. Here’s how the resulting
            <code>Point</code> class works:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0197-02" id="f0197-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; p = Point(2, 3)
                                &gt;&gt;&gt; p
                                Point(x=2, y=3)
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            One downside of such an approach is poor startup performance.
            Dynamically creating code with <code>exec()</code> bypasses the
            compilation optimizations that Python normally applies to modules.
            Defining a large number of classes in this way may therefore
            significantly slow down the importing of your code.
          </p>
          <p class="indent">
            The examples shown in this section illustrate common uses of class
            decorators— registration, code rewriting, code generation,
            validation, and so on. One issue with class decorators is that they
            must be explicitly applied to each class where they are used. This
            is not always desired. The next section describes a feature that
            allows for implicit manipulation of classes.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec22">7.22 Supervised Inheritance</h3>
          <p class="noindent">
            As you saw in the previous section, sometimes you want to define a
            class and perform additional actions. A class decorator is one
            mechanism for doing this. However, a parent class can also perform
            extra actions on behalf of its subclasses. This is accomplished by
            implementing an <code>__init_subclass__(cls)</code> class method.
            For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0197-03" id="f0197-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Base:
                                    <span class="wasabi">@classmethod</span>
                                    <span class="lgreen"><strong>def</strong></span> __init_subclass__(cls):
                                        print(<span class="mblue">'Initializing'</span>, cls)
                                
                                <span class="hblue"># Example (should see 'Initializing' message for each class)</span>
                                <span class="lgreen"><strong>class</strong></span> A(Base):
                                    <span class="lgreen"><strong>pass</strong></span>
                                
                                <span class="lgreen"><strong>class</strong></span> B(A):
                                    <span class="lgreen"><strong>pass</strong></span></pre>
          <p class="indent">
            If an <code>__init_subclass__()</code> method is present, it is
            triggered automatically upon the definition of any child class. This
            happens even if the child is buried deeply in an inheritance
            hierarchy.
          </p>
          <p class="indent">
            Many of the tasks commonly performed with class decorators can be
            performed with <code>__init_subclass__()</code> instead. For
            example, class registration:<span
              epub:type="pagebreak"
              id="page_198"
            ></span>
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0198-01" id="f0198-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> DecoderBase:
                                    _registry <span class="igrey">=</span> { }
                                    <span class="wasabi">@classmethod</span>
                                    <span class="lgreen"><strong>def</strong></span> __init_subclass__(cls):
                                        <span class="lgreen"><strong>for</strong></span> mt <span class="lgreen"><strong>in</strong></span> cls.mimetypes:
                                            DecoderBase._registry[mt.mimetype] <span class="igrey">=</span> cls
                                
                                <span class="hblue"># Factory function that uses the registry</span>
                                <span class="lgreen"><strong>def</strong></span> create_decoder(mimetype):
                                    <span class="lgreen"><strong>return</strong></span> DecoderBase._registry[mimetype]()
                                
                                <span class="lgreen"><strong>class</strong></span> TextDecoder(DecoderBase):
                                    mimetypes <span class="igrey">=</span> [ <span class="mblue">'text/plain'</span> ]
                                    <span class="lgreen"><strong>def</strong></span> decode(<span class="dblue">self</span>, data):
                                        ...
                                
                                <span class="lgreen"><strong>class</strong></span> HTMLDecoder(DecoderBase):
                                    mimetypes <span class="igrey">=</span> [ <span class="mblue">'text/html'</span> ]
                                    <span class="lgreen"><strong>def</strong></span> decode(<span class="dblue">self</span>, data):
                                        ...
                                
                                <span class="lgreen"><strong>class</strong></span> ImageDecoder(DecoderBase):
                                    mimetypes <span class="igrey">=</span> [ <span class="mblue">'image/png'</span>, <span class="mblue">'image/jpg'</span>, <span class="mblue">'image/gif'</span> ]
                                    <span class="lgreen"><strong>def</strong></span> decode(<span class="dblue">self</span>, data):
                                        ...
                                
                                <span class="hblue"># Example usage</span>
                                decoder <span class="igrey">=</span> create_decoder(<span class="mblue">'image/jpg'</span>)</pre>
          <p class="indent">
            Here is an example of a class that automatically creates a
            <code>__repr__()</code> method from the signature of the class
            <code>__init__()</code> method:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0198-02" id="f0198-02"
              >Click here to view code image</a
            >
          </p>
          <pre>import inspect
                                <span class="lgreen"><strong>class</strong></span> Base:
                                    <span class="wasabi">@classmethod</span>
                                    <span class="lgreen"><strong>def</strong></span> __init_subclass__(cls):
                                        <span class="hblue"># Create a __repr__ method</span>
                                        args <span class="igrey">=</span> list(inspect.signature(cls).parameters)
                                        argvals <span class="igrey">=</span> <span class="mblue">', '</span>.join(<span class="mblue">'{self.%s!r}'</span> <span class="igrey">%</span> arg <span class="lgreen"><strong>for</strong></span> arg <span class="lgreen"><strong>in</strong></span> args)
                                        code <span class="igrey">=</span> <span class="mblue">'def __repr__(self):\n'</span>
                                        code <span class="igrey">+=</span> <span class="trose">f' return f"</span><span class="mblue">{</span>cls<span class="mblue">.</span><span class="dblue">__name__</span><span class="mblue">}</span><span class="trose">(</span><span class="mblue">{</span>argvals<span class="mblue">}</span><span class="trose">)"</span><span class="mblue">\n</span><span class="trose">'</span>
                                        locs <span class="igrey">=</span> { }
                                        exec(code, locs)
                                        cls.<span class="cblue">__repr__</span> <span class="igrey">=</span> locs[<span class="mblue">'__repr__'</span>]
                                
                                <span epub:type="pagebreak" id="page_199"></span><span class="lgreen"><strong>class</strong></span> Point(Base):
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, x, y):
                                        <span class="dblue">self</span>.x <span class="igrey">=</span> x
                                        <span class="dblue">self</span>.y <span class="igrey">=</span> y</pre>
          <p class="indent">
            If multiple inheritance is being used, you should use
            <code>super()</code> to make sure all classes that implement
            <code>__init_subclass__()</code> get called. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0199-02" id="f0199-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> A:
                                    <span class="wasabi">@classmethod</span>
                                    <span class="lgreen"><strong>def</strong></span> __init_subclass__(cls):
                                        print(<span class="mblue">'A.init_subclass'</span>)
                                        super().__init_subclass__()
                                
                                <span class="lgreen"><strong>class</strong></span> B:
                                    <span class="wasabi">@classmethod</span>
                                    <span class="lgreen"><strong>def</strong></span> __init_subclass__(cls):
                                        print(<span class="mblue">'B.init_subclass'</span>)
                                        super().__init_subclass__()
                                
                                <span class="hblue"># Should see output from both classes here</span>
                                <span class="lgreen"><strong>class</strong></span> C(A, B):
                                    <span class="lgreen"><strong>pass</strong></span></pre>
          <p class="indent">
            Supervising inheritance with <code>__init_subclass__()</code> is one
            of Python’s most powerful customization features. Much of its power
            comes from its implicit nature. A top-level base class can use this
            to quietly supervise an entire hierarchy of child classes. Such
            supervision can register classes, rewrite methods, perform
            validation, and more.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec23">
            7.23 The Object Life Cycle and Memory Management
          </h3>
          <p class="noindent">
            When a class is defined, the resulting class is a factory for
            creating new instances. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0199-03" id="f0199-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Account:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, owner, balance):
                                        <span class="dblue">self</span>.owner <span class="igrey">=</span> owner
                                        <span class="dblue">self</span>.balance <span class="igrey">=</span> balance
                                
                                <span class="hblue"># Create some Account instances</span>
                                a <span class="igrey">=</span> Account(<span class="mblue">'Guido'</span>, <span class="sgreen">1000.0</span>)
                                b <span class="igrey">=</span> Account(<span class="mblue">'Eva'</span>, <span class="sgreen">25.0</span>)</pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_200"></span>The creation of an
            instance is carried out in two steps using the special method
            <code>__new__()</code> that creates a new instance and
            <code>__init__()</code> that initializes it. For example, the
            operation <code>a = Account('Guido', 1000.0)</code> performs these
            steps:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0200-01" id="f0200-01"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> Account.<span class="cblue">__new__</span>(Account, <span class="mblue">'Guido'</span>, <span class="sgreen">1000.0</span>)
                                <span class="lgreen"><strong>if</strong></span> isinstance(a, Account):
                                    Account.<span class="cblue">__init__</span>(<span class="mblue">'Guido'</span>, <span class="sgreen">1000.0</span>)</pre>
          <p class="indent">
            Except for the first argument which is the class instead of an
            instance, <code>__new__()</code> normally receives the same
            arguments as <code>__init__()</code>. However, the default
            implementation of <code>__new__()</code> just ignores them. You’ll
            sometimes see <code>__new__()</code> invoked with just a single
            argument. For example, this code also works:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0200-02" id="f0200-02"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> Account.<span class="cblue">__new__</span>(Account)
                                Account.<span class="cblue">__init__</span>(<span class="mblue">'Guido'</span>, <span class="sgreen">1000.0</span>)</pre>
          <p class="indent">
            Direct use of the <code>__new__()</code> method is uncommon, but
            sometimes it’s used to create instances while bypassing the
            invocation of the <code>__init__()</code> method. One such use is in
            class methods. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0200-03" id="f0200-03"
              >Click here to view code image</a
            >
          </p>
          <pre>import time
                                
                                <span class="lgreen"><strong>class</strong></span> Date:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, year, month, day):
                                        <span class="dblue">self</span>.year <span class="igrey">=</span> year
                                        <span class="dblue">self</span>.month <span class="igrey">=</span> month
                                        <span class="dblue">self</span>.day <span class="igrey">=</span> day
                                
                                    <span class="wasabi">@classmethod</span>
                                    <span class="lgreen"><strong>def</strong></span> today(cls):
                                        t <span class="igrey">=</span> time.localtime()
                                        <span class="dblue">self</span> <span class="igrey">=</span> cls.<span class="cblue">__new__</span>(cls)   <span class="hblue"># Make instance</span>
                                        <span class="dblue">self</span>.year <span class="igrey">=</span> t.tm_year
                                        <span class="dblue">self</span>.month <span class="igrey">=</span> t.tm_month
                                        <span class="dblue">self</span>.day <span class="igrey">=</span> t.tm_day
                                        <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span></pre>
          <p class="indent">
            Modules that perform object serialization such as
            <code>pickle</code> also utilize <code>__new__()</code> to recreate
            instances when objects are deserialized. This is done without ever
            invoking <code>__init__()</code>.
          </p>
          <p class="indent">
            Sometimes a class will define <code>__new__()</code> if it wants to
            alter some aspect of instance creation. Typical applications include
            instance caching, singletons, and immutability. As an example, you
            might want <code>Date</code> class to perform date interning—that
            is, caching and reusing <code>Date</code> instances that have an
            identical year, month, and day. Here is one way that might be
            implemented:<span epub:type="pagebreak" id="page_201"></span>
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0201-01" id="f0201-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Date:
                                    _cache <span class="igrey">=</span> { }
                                
                                    <span class="wasabi">@staticmethod</span>
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__new__</span>(cls, year, month, day):
                                        <span class="dblue">self</span> <span class="igrey">=</span> Date._cache.get((year,month,day))
                                        <span class="lgreen"><strong>if not</strong></span> <span class="dblue">self</span>:
                                            <span class="dblue">self</span> <span class="igrey">=</span> super().<span class="cblue">__new__</span>(cls)
                                            <span class="dblue">self</span>.year <span class="igrey">=</span> year
                                            <span class="dblue">self</span>.month <span class="igrey">=</span> month
                                            <span class="dblue">self</span>.day <span class="igrey">=</span> day
                                            Date._cache[year,month,day] <span class="igrey">=</span> <span class="dblue">self</span>
                                        <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, year, month, day):
                                        <span class="lgreen"><strong>pass</strong></span>
                                
                                <span class="hblue"># Example</span>
                                d <span class="igrey">=</span> Date(<span class="sgreen">2012</span>, <span class="sgreen">12</span>, <span class="sgreen">21</span>)
                                e <span class="igrey">=</span> Date(<span class="sgreen">2012</span>, <span class="sgreen">12</span>, <span class="sgreen">21</span>)
                                <span class="lgreen"><strong>assert</strong></span> d <span class="lgreen"><strong>is</strong></span> e              <span class="hblue"># Same object</span></pre>
          <p class="indent">
            In this example, the class keeps an internal dictionary of
            previously created <code>Date</code> instances. When creating a new
            <code>Date</code>, the cache is consulted first. If a match is
            found, that instance is returned. Otherwise, a new instance is
            created and initialized.
          </p>
          <p class="indent">
            A subtle detail of this solution is the empty
            <code>__init__()</code> method. Even though instances are cached,
            every call to <code>Date()</code> still invokes
            <code>__init__()</code>. To avoid duplicated effort, the method
            simply does nothing—instance creation actually takes place in
            <code>__new__()</code> when an instance is created the first time.
          </p>
          <p class="indent">
            There are ways to avoid the extra call to
            <code>__init__()</code> but it requires sneaky tricks. One way to
            avoid it is to have <code>__new__()</code> return an entirely
            different type instance—for example, one belonging to a different
            class. Another solution, described later, is to use a metaclass.
          </p>
          <p class="indent">
            Once created, instances are managed by reference counting. If the
            reference count reaches zero, the instance is immediately destroyed.
            When the instance is about to be destroyed, the interpreter first
            looks for a <code>__del__()</code> method associated with the object
            and calls it. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0201-02" id="f0201-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Account(object):
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, owner, balance):
                                        <span class="dblue">self</span>.owner <span class="igrey">=</span> owner
                                        <span class="dblue">self</span>.balance <span class="igrey">=</span> balance
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__del__</span>(<span class="dblue">self</span>):
                                        print(<span class="mblue">'Deleting Account'</span>)
                                
                                <span epub:type="pagebreak" id="page_202"></span>&gt;&gt;&gt; a = Account('Guido', 1000.0)
                                &gt;&gt;&gt; <strong>del</strong> a
                                Deleting Account
                                &gt;&gt;&gt;</pre>
          <p class="indent">
            Occasionally, a program will use the <code>del</code> statement to
            delete a reference to an object as shown. If this causes the
            reference count of the object to reach zero, the
            <code>__del__()</code> method is called. However, in general, the
            <code>del</code> statement doesn’t directly call
            <code>__del__()</code> because there may be other object references
            living elsewhere. There are many other ways that an object might be
            deleted—for example, reassignment of a variable name or a variable
            going out of scope in a function:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0202-02" id="f0202-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; a = Account('Guido', 1000.0)
                                &gt;&gt;&gt; a = 42
                                Deleting Account
                                &gt;&gt;&gt; <strong>def</strong> func():
                                ...     a = Account('Guido', 1000.0)
                                ...
                                &gt;&gt;&gt; func()
                                Deleting Account
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            In practice, it’s rarely necessary for a class to define a
            <code>__del__()</code> method. The only exception is when the
            destruction of an object requires an extra cleanup action—such as
            closing a file, shutting down a network connection, or releasing
            other system resources. Even in these cases, it’s dangerous to rely
            on <code>__del__()</code> for a proper shutdown because there’s no
            guarantee that this method will be called when you think it would.
            For clean shutdown of resources, you should give the object an
            explicit <code>close()</code> method. You should also make your
            class support the context manager protocol so it can be used with
            the <code>with</code> statement. Here is an example that covers all
            of the cases:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0202-03" id="f0202-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> SomeClass:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>):
                                        <span class="dblue">self</span>.resource <span class="igrey">=</span> open_resource()
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__del__</span>(<span class="dblue">self</span>):
                                        <span class="dblue">self</span>.close()
                                
                                    <span class="lgreen"><strong>def</strong></span> close(<span class="dblue">self</span>):
                                        <span class="dblue">self</span>.resource.close()
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__enter__</span>(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__exit__</span>(<span class="dblue">self</span>, ty, val, tb):
                                        <span class="dblue">self</span>.close()
                                
                                <span epub:type="pagebreak" id="page_203"></span><span class="hblue"># Closed via __del__()</span>
                                s <span class="igrey">=</span> SomeClass()
                                <span class="lgreen"><strong>del</strong></span> s
                                
                                <span class="hblue"># Explicit close</span>
                                s <span class="igrey">=</span> SomeClass()
                                s.close()
                                
                                <span class="hblue"># Closed at the end of a context block</span>
                                <span class="lgreen"><strong>with</strong></span> SomeClass() as s:
                                    ...</pre>
          <p class="indent">
            Again, it should be emphasized that writing a
            <code>__del__()</code> in a class is almost never necessary. Python
            already has garbage collection and there is simply no need to do it
            unless there is some extra action that needs to take place upon
            object destruction. Even then, you still might not need
            <code>__del__()</code> as it’s possible that the object is already
            programmed to clean itself up properly even if you do nothing.
          </p>
          <p class="indent">
            As if there weren’t enough dangers with reference counting and
            object destruction, there are certain kinds of programming
            patterns—especially those involving parent-child relationships,
            graphs, or caching—where objects can create a so-called
            <em>reference cycle</em>. Here is an example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0203-02" id="f0203-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> SomeClass:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__del__</span>(<span class="dblue">self</span>):
                                        print(<span class="mblue">'Deleting'</span>)
                                
                                parent <span class="igrey">=</span> SomeClass()
                                child <span class="igrey">=</span> SomeClass()
                                
                                <span class="hblue"># Create a child-parent reference cycle</span>
                                parent.child <span class="igrey">=</span> child
                                child.parent <span class="igrey">=</span> parent
                                
                                <span class="hblue"># Try deletion (no output from __del__ appears)</span>
                                <span class="lgreen"><strong>del</strong></span> parent
                                <span class="lgreen"><strong>del</strong></span> child</pre>
          <p class="indent">
            In this example, the variable names are destroyed but you never see
            execution of the <code>__del__()</code> method. The two objects each
            hold internal references to each other, so there’s no way for the
            reference count to ever drop to 0. To handle this, a special
            cycle-detecting garbage collector runs every so often. Eventually
            the objects will be reclaimed, but it’s hard to predict when this
            might happen. If you want to force garbage collection, you can call
            <code>gc.collect()</code>. The <code>gc</code> module has a variety
            of other functions related to the cyclic garbage collector and
            monitoring memory.
          </p>
          <p class="indent">
            Because of the unpredictable timing of garbage collection, the
            <code>__del__()</code> method has a few restrictions placed on it.
            First, any exception that propagates out of
            <code>__del__()</code> is
            <span epub:type="pagebreak" id="page_204"></span>printed to
            <code>sys.stderr</code>, but otherwise ignored. Second, the
            <code>__del__()</code> method should avoid operations such as
            acquiring locks or other resources. Doing so could result in a
            deadlock when <code>__del__()</code> is unexpectedly fired in the
            middle of executing an unrelated function within the seventh inner
            callback circle of signal handling and threads. If you must define
            <code>__del__()</code>, keep it simple.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec24">7.24 Weak References</h3>
          <p class="noindent">
            Sometimes objects are kept alive when you’d much rather see them
            die. In an earlier example, a <code>Date</code> class was shown with
            internal caching of instances. One problem with this implementation
            is that there is no way for an instance to ever be removed from the
            cache. As such, the cache will grow larger and larger over time.
          </p>
          <p class="indent">
            One way to fix this problem is to create a weak reference using the
            <code>weakref</code> module. A weak reference is a way of creating a
            reference to an object without increasing its reference count. To
            work with a weak reference, you have to add an extra bit of code to
            check if the object being referred to still exists. Here’s an
            example of how you create a weakref:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0204-01" id="f0204-01"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; a = Account('Guido', 1000.0)
                                &gt;&gt;&gt; import weakref
                                &gt;&gt;&gt; a_ref = weakref.ref(a)
                                &gt;&gt;&gt; a_ref
                                &lt;weakref at 0x104617188; to 'Account' at 0x1046105c0&gt;
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            Unlike a normal reference, a weak reference allows the original
            object to die. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0204-02" id="f0204-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; del a
                                &gt;&gt;&gt; a_ref
                                &lt;weakref at 0x104617188; dead&gt;
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            A weak reference contains an optional reference to an object. To get
            the actual object, you need to call the weak reference as a function
            with no arguments. This will either return the object being pointed
            at or <code>None</code>. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0204-03" id="f0204-03"
              >Click here to view code image</a
            >
          </p>
          <pre>acct <span class="igrey">=</span> a_ref()
                                <span class="lgreen"><strong>if</strong></span> acct <span class="lgreen"><strong>is not</strong></span> <span class="dblue">None</span>:
                                    acct.withdraw(<span class="sgreen">10</span>)
                                
                                <span class="hblue"># Alternative</span>
                                <span class="lgreen"><strong>if</strong></span> acct :<span class="igrey">=</span> a_ref():
                                   acct.withdraw(<span class="sgreen">10</span>)</pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_205"></span>Weak references are
            commonly used in conjunction with caching and other advanced memory
            management. Here is a modified version of the
            <code>Date</code> class that automatically removes objects from the
            cache when no more references exist:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0205-01" id="f0205-01"
              >Click here to view code image</a
            >
          </p>
          <pre>import weakref
                                
                                <span class="lgreen"><strong>class</strong></span> Date:
                                    _cache <span class="igrey">=</span> { }
                                
                                <span class="wasabi">@staticmethod</span>
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__new__</span>(cls, year, month, day):
                                        selfref <span class="igrey">=</span> Date._cache.get((year,month,day))
                                        <span class="lgreen"><strong>if not</strong></span> selfref:
                                            <span class="dblue">self</span> <span class="igrey">=</span> super().<span class="cblue">__new__</span>(cls)
                                            <span class="dblue">self</span>.year <span class="igrey">=</span> year
                                            <span class="dblue">self</span>.month <span class="igrey">=</span> month
                                            <span class="dblue">self</span>.day <span class="igrey">=</span> day
                                            Date._cache[year,month,day] <span class="igrey">=</span> weakref.ref(<span class="dblue">self</span>)
                                        <span class="lgreen"><strong>else</strong></span>:
                                            <span class="dblue">self</span> <span class="igrey">=</span> selfref()
                                        <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, year, month, day):
                                        <span class="lgreen"><strong>pass</strong></span>
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__del__</span>(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>del</strong></span> Date._cache[<span class="dblue">self</span>.year,<span class="dblue">self</span>.month,<span class="dblue">self</span>.day]</pre>
          <p class="indent">
            This might require a bit of study, but here is an interactive
            session that shows how it works. Notice how an entry is removed from
            the cache once no more references to it exist:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0205-02" id="f0205-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; Date._cache
                                {}
                                &gt;&gt;&gt; a = Date(2012, 12, 21)
                                &gt;&gt;&gt; Date._cache
                                {(2012, 12, 21): &lt;weakref at 0x10c7ee2c8; to 'Date' at 0x10c805518&gt;}
                                &gt;&gt;&gt; b = Date(2012, 12, 21)
                                &gt;&gt;&gt; a is b
                                True
                                &gt;&gt;&gt; del a
                                &gt;&gt;&gt; Date._cache
                                {(2012, 12, 21): &lt;weakref at 0x10c7ee2c8; to 'Date' at 0x10c805518&gt;}
                                &gt;&gt;&gt; del b
                                &gt;&gt;&gt; Date._cache
                                {}
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            <span epub:type="pagebreak" id="page_206"></span>As previously
            noted, the <code>__del__()</code> method of a class is only invoked
            when the reference count of an object reaches zero. In this example,
            the first <code>del a</code> statement decreases the reference
            count. However, since there’s still another reference to the same
            object, the object remains in <code>Date._cache</code>. When the
            second object is deleted, <code>__del__()</code> is invoked and the
            cache is cleared.
          </p>
          <p class="indent">
            Support for weak references requires instances to have a mutable
            <code>__weakref__</code> attribute. Instances of user-defined
            classes normally have such an attribute by default. However,
            built-in types and certain kinds of special data structures—named
            tuples, classes with slots—do not. If you want to construct weak
            references to these types, you can do it by defining variants with a
            <code>__weakref__</code> attribute added:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0206-01" id="f0206-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> wdict(dict):
                                    __slots__ <span class="igrey">=</span> (<span class="mblue">'__weakref__'</span>,)
                                
                                w <span class="igrey">=</span> wdict()
                                w_ref <span class="igrey">=</span> weakref.ref(w)      <span class="hblue"># Now works</span></pre>
          <p class="indent">
            The use of slots here is to avoid unnecessary memory overhead, as
            explained shortly.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec25">
            7.25 Internal Object Representation and Attribute Binding
          </h3>
          <p class="noindent">
            The state associated with an instance is stored in a dictionary
            that’s accessible as the instance’s <code>__dict__</code> attribute.
            This dictionary contains the data that’s unique to each instance.
            Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0206-02" id="f0206-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; a = Account('Guido', 1100.0)
                                &gt;&gt;&gt; a.__dict__
                                {'owner': 'Guido', 'balance': 1100.0}</pre
          >
          <p class="indent">
            New attributes can be added to an instance at any time:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0206-02a" id="f0206-02a"
              >Click here to view code image</a
            >
          </p>
          <pre>a.number <span class="igrey">=</span> <span class="sgreen">123456</span> <span class="hblue"># Add attribute 'number' to a.__dict__</span>
                                a.__dict__[<span class="mblue">'number'</span>] <span class="igrey">=</span> <span class="sgreen">654321</span></pre>
          <p class="indent">
            Modifications to an instance are always reflected in the local
            <code>__dict__</code> attribute unless the attribute is being
            managed by a property. Likewise, if you make modifications to
            <code>__dict__</code> directly, those modifications are reflected in
            the attributes.
          </p>
          <p class="indent">
            Instances are linked back to their class by a special attribute
            <code>__class__</code>. The class itself is also just a thin layer
            over a dictionary that can be found in its own
            <code>__dict__</code> attribute. The class dictionary is where you
            find the methods. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0206-03" id="f0206-03"
              >Click here to view code image</a
            >
          </p>
          <pre>&gt;&gt;&gt; a.__class__
                                &lt;class '__main__.Account'&gt;
                                &gt;&gt;&gt; Account.__dict__.keys()
                                <span epub:type="pagebreak" id="page_207"></span>dict_keys(['__module__', '__init__', '__repr__', 'deposit', 'withdraw',
                                'inquiry', '__dict__', '__weakref__', '__doc__'])
                                &gt;&gt;&gt; Account.__dict__['withdraw']
                                &lt;function Account.withdraw at 0x108204158&gt;
                                &gt;&gt;&gt;</pre>
          <p class="indent">
            Classes are linked to their base classes by a special attribute
            <code>__bases__</code>, which is a tuple of the base classes. The
            <code>__bases__</code> attribute is only informational. The actual
            runtime implementation of inheritance uses the
            <code>__mro__</code> attribute which is a tuple of all parent
            classes listed in search order. This underlying structure is the
            basis for all operations that get, set, or delete the attributes of
            instances.
          </p>
          <p class="indent">
            Whenever an attribute is set using <code>obj.name = value</code>,
            the special method <code>obj.__setattr__('name', value)</code> is
            invoked. If an attribute is deleted using <code>del obj.name</code>,
            the special method <code>obj.__delattr__('name')</code> is invoked.
            The default behavior of these methods is to modify or remove values
            from the local <code>__dict__</code> of <code>obj</code> unless the
            requested attribute happens to correspond to a property or
            descriptor. In that case, the set and delete operations will be
            carried out by the set and delete functions associated with the
            property.
          </p>
          <p class="indent">
            For attribute lookup such as <code>obj.name</code>, the special
            method <code>obj.__getattribute__('name')</code> is invoked. This
            method carries out the search for the attribute, which normally
            includes checking the properties, looking in the local
            <code>__dict__</code>, checking the class dictionary, and searching
            the MRO. If this search fails, a final attempt to find the attribute
            is made by invoking the <code>obj.__getattr__('name')</code> method
            of the class (if defined). If this fails, an
            <code>AttributeError</code> exception is raised.
          </p>
          <p class="indent">
            User-defined classes can implement their own versions of the
            attribute access functions, if desired. For example, here’s a class
            that restricts the attribute names that can be set:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0207-02" id="f0207-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Account:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, owner, balance):
                                        <span class="dblue">self</span>.owner <span class="igrey">=</span> owner
                                        <span class="dblue">self</span>.balance <span class="igrey">=</span> balance
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__setattr__</span>(<span class="dblue">self</span>, name, value):
                                        <span class="lgreen"><strong>if</strong></span> name <span class="lgreen"><strong>not in</strong></span> {<span class="mblue">'owner'</span>, <span class="mblue">'balance'</span>}:
                                            <span class="lgreen"><strong>raise</strong></span> <span class="pgold">AttributeError</span>(<span class="trose">f'No attribute</span> <span class="mblue">{</span>name<span class="mblue">}</span><span class="trose">'</span>)
                                        super().<span class="cblue">__setattr__</span>(name, value)
                                
                                <span class="hblue"># Example</span>
                                a <span class="igrey">=</span> Account(<span class="mblue">'Guido'</span>, <span class="sgreen">1000.0</span>)
                                a.balance <span class="igrey">=</span> <span class="sgreen">940.25</span>          <span class="hblue"># Ok</span>
                                a.amount <span class="igrey">=</span> <span class="sgreen">540.2</span>            <span class="hblue"># AttributeError. No attribute amount</span></pre>
          <p class="indent">
            A class that reimplements these methods should rely upon the default
            implementation provided by <code>super()</code> to carry out the
            actual work of manipulating an attribute. This is because the
            default implementation takes care of the more advanced features of
            classes such <span epub:type="pagebreak" id="page_208"></span>as
            descriptors and properties. If you don’t use <code>super()</code>,
            you will have to take care of these details yourself.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec26">
            7.26 Proxies, Wrappers, and Delegation
          </h3>
          <p class="noindent">
            Sometimes classes implement a wrapper layer around another object to
            create a kind of proxy object. A proxy is an object exposes the same
            interface as another object but, for some reason, isn’t related to
            the original object via inheritance. This is different from
            composition where an entirely new object is created from other
            objects but with its own unique set of methods and attributes.
          </p>
          <p class="indent">
            There are many real-world scenarios where this might arise. For
            example, in distributed computing, the actual implementation of an
            object might live on a remote server in the cloud. Clients that
            interact with that server might use a proxy that looks like the
            object on the server but, behind the scenes, delegates all of its
            method calls via network messages.
          </p>
          <p class="indent">
            A common implementation technique for proxies involves the
            <code>__getattr__()</code> method. Here is a simple example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0208-01" id="f0208-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> A:
                                    <span class="lgreen"><strong>def</strong></span> spam(<span class="dblue">self</span>):
                                        print(<span class="mblue">'A.spam'</span>)
                                
                                    <span class="lgreen"><strong>def</strong></span> grok(<span class="dblue">self</span>):
                                        print(<span class="mblue">'A.grok'</span>)
                                
                                    <span class="lgreen"><strong>def</strong></span> yow(<span class="dblue">self</span>):
                                        print(<span class="mblue">'A.yow'</span>)
                                
                                <span class="lgreen"><strong>class</strong></span> LoggedA:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>):
                                        <span class="dblue">self</span>._a <span class="igrey">=</span> A()
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__getattr__</span>(<span class="dblue">self</span>, name):
                                        print(<span class="mblue">"Accessing"</span>, name)
                                        <span class="hblue"># Delegate to internal A instance</span>
                                        <span class="lgreen"><strong>return</strong></span> getattr(<span class="dblue">self</span>._a, name)
                                
                                <span class="hblue"># Example use</span>
                                a <span class="igrey">=</span> LoggedA()
                                a.spam()       <span class="hblue"># prints "Accessing spam" and "A.spam"</span>
                                a.yow()        <span class="hblue"># prints "Accessing yow" and "A.yow"</span></pre>
          <p class="indent">
            Delegation is sometimes used as an alternative to inheritance. Here
            is an example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0208-02" id="f0208-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> A:
                                    <span class="lgreen"><strong>def</strong></span> spam(<span class="dblue">self</span>):
                                <span epub:type="pagebreak" id="page_209"></span>        print(<span class="mblue">'A.spam'</span>)
                                
                                    <span class="lgreen"><strong>def</strong></span> grok(<span class="dblue">self</span>):
                                        print(<span class="mblue">'A.grok'</span>)
                                
                                    <span class="lgreen"><strong>def</strong></span> yow(<span class="dblue">self</span>):
                                        print(<span class="mblue">'A.yow'</span>)
                                
                                <span class="lgreen"><strong>class</strong></span> B:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>):
                                        <span class="dblue">self</span>._a <span class="igrey">=</span> A()
                                
                                    <span class="lgreen"><strong>def</strong></span> grok(<span class="dblue">self</span>):
                                        print(<span class="mblue">'B.grok'</span>)
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__getattr__</span>(<span class="dblue">self</span>, name):
                                        <span class="lgreen"><strong>return</strong></span> getattr(<span class="dblue">self</span>._a, name)
                                
                                <span class="hblue"># Example use</span>
                                b <span class="igrey">=</span> B()
                                b.spam()      <span class="hblue"># -&gt; A.spam</span>
                                b.grok()      <span class="hblue"># -&gt; B.grok   (redefined method)</span>
                                b.yow()       <span class="hblue"># -&gt; A.yow</span></pre>
          <p class="indent">
            In this example, it appears as if class <code>B</code> might be
            inheriting from class <code>A</code> and redefining a single method.
            This is the observed behavior—but inheritance is not being used.
            Instead, <code>B</code> holds an internal reference to an
            <code>A</code> inside. Certain methods of <code>A</code> can be
            redefined. However, all of the other methods are delegated via the
            <code>__getattr__()</code> method.
          </p>
          <p class="indent">
            The technique of forwarding attribute lookup via
            <code>__getattr__()</code> is a common technique. However, be aware
            that it does not apply to operations mapped to special methods. For
            example, consider this class:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0209-02" id="f0209-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> ListLike:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>):
                                        <span class="dblue">self</span>._items <span class="igrey">=</span> list()
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__getattr__</span>(<span class="dblue">self</span>, name):
                                        <span class="lgreen"><strong>return</strong></span> getattr(<span class="dblue">self</span>._items, name)
                                
                                <span class="hblue"># Example</span>
                                a <span class="igrey">=</span> ListLike()
                                a.append(<span class="sgreen">1</span>)         <span class="hblue"># Works</span>
                                a.insert(<span class="sgreen">0</span>, <span class="sgreen">2</span>)      <span class="hblue"># Works</span>
                                a.sort()            <span class="hblue"># Works</span>
                                
                                <span epub:type="pagebreak" id="page_210"></span>len(a)              <span class="hblue"># Fails. No __len__() method</span>
                                a[<span class="sgreen">0</span>]                <span class="hblue"># Fails. No __getitem__() method</span></pre>
          <p class="indent">
            Here, the class successfully forwards all of the standard list
            methods (<code>list.sort()</code>, <code>list.append()</code>, and
            so on) to an inner list. However, none of Python’s standard
            operators work. To make those work, you would have to explicitly
            implement the required special methods. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0210-02" id="f0210-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> ListLike:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>):
                                        <span class="dblue">self</span>._items <span class="igrey">=</span> list()
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__getattr__</span>(<span class="dblue">self</span>, name):
                                        <span class="lgreen"><strong>return</strong></span> getattr(<span class="dblue">self</span>._items, name)
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__len__</span>(<span class="dblue">self</span>):
                                        <span class="lgreen"><strong>return</strong></span> len(<span class="dblue">self</span>._items)
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__getitem__</span>(<span class="dblue">self</span>, index):
                                        <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>._items[index]
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__setitem__</span>(<span class="dblue">self</span>, index, value):
                                        <span class="dblue">self</span>._items[index] <span class="igrey">=</span> value</pre>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec27">
            7.27 Reducing Memory Use with <code>__slots__</code>
          </h3>
          <p class="noindent">
            As we’ve seen, an instance stores its data in a dictionary. If you
            are creating a large number of instances, this can introduce a lot
            of memory overhead. If you know that the attribute names are fixed,
            you can specify the names in a special class variable called
            <code>__slots__</code>. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0210-03" id="f0210-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Account(object):
                                    __slots__ <span class="igrey">=</span> (<span class="mblue">'owner'</span>, <span class="mblue">'balance'</span>)
                                      ...</pre>
          <p class="indent">
            Slots is a definition hint that allows Python to make performance
            optimizations for both memory use and execution speed. Instances of
            a class with <code>__slots__</code> no longer use a dictionary for
            storing instance data. Instead, a much more compact data structure
            based on an array is used. In programs that create a large number of
            objects, using <code>__slots__</code> can result in a substantial
            reduction in memory use and a modest improvement in execution time.
          </p>
          <p class="indent">
            The only entries in <code>__slots__</code> are instance attributes.
            You do not list methods, properties, class variables, or any other
            class-level attributes. Basically, it’s the same names that would
            ordinarily appear as dictionary keys in the instance’s
            <code>__dict__</code>.
          </p>
          <p class="indent">
            <span epub:type="pagebreak" id="page_211"></span>Be aware that
            <code>__slots__</code> has a tricky interaction with inheritance. If
            a class inherits from a base class that uses <code>__slots__</code>,
            it also needs to define <code>__slots__</code> for storing its own
            attributes (even if it doesn’t add any) to take advantage of the
            benefits <code>__slots__</code> provides. If you forget this, the
            derived class will run slower—and use even more memory than if
            <code>__slots__</code> had not been used on any of the classes!
          </p>
          <p class="indent">
            <code>__slots__</code> is incompatible with multiple inheritance. If
            multiple base classes are specified, each with nonempty slots, you
            will get a <code>TypeError</code>.
          </p>
          <p class="indent">
            The use of <code>__slots__</code> can also break code that expects
            instances to have an underlying <code>__dict__</code> attribute.
            Although this often does not apply to user code, utility libraries
            and other tools for supporting objects may be programmed to look at
            <code>__dict__</code> for debugging, serializing objects, and other
            operations.
          </p>
          <p class="indent">
            The presence of <code>__slots__</code> has no effect on the
            invocation of methods such as <code>__getattribute__()</code>,
            <code>__getattr__()</code>, and <code>__setattr__()</code> should
            they be redefined in a class. However, if you’re implementing such
            methods, be aware that there is no longer any instance
            <code>__dict__</code> attribute. Your implementation will need to
            take that into account.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec28">7.28 Descriptors</h3>
          <p class="noindent">
            Normally, attribute access corresponds to dictionary operations. If
            more control is needed, attribute access can be routed through
            user-defined <code>get</code>, <code>set</code>, and
            <code>delete</code> functions. The use of properties was already
            described. However, a property is actually implemented using a
            lower-level construct known as a descriptor. A descriptor is a
            class-level object that manages access to an attribute. By
            implementing one or more of the special methods
            <code>__get__()</code>, <code>__set__()</code>, and
            <code>__delete__()</code>, you can hook directly into the attribute
            access mechanism and customize those operations. Here is an example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0211-01" id="f0211-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Typed:
                                    expected_type <span class="igrey">=</span> object
                                
                                    <span class="lgreen"><strong>def</strong></span> __set_name__(<span class="dblue">self</span>, cls, name):
                                        <span class="dblue">self</span>.key <span class="igrey">=</span> name
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__get__</span>(<span class="dblue">self</span>, instance, cls):
                                        <span class="lgreen"><strong>if</strong></span> instance:
                                            <span class="lgreen"><strong>return</strong></span> instance.__dict__[<span class="dblue">self</span>.key]
                                        <span class="lgreen"><strong>else</strong></span>:
                                            <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__set__</span>(<span class="dblue">self</span>, instance, value):
                                        <span class="lgreen"><strong>if not</strong></span> isinstance(value, <span class="dblue">self</span>.expected_type):
                                            <span class="lgreen"><strong>raise</strong></span> <span class="pgold">TypeError</span>(<span class="trose">f'Expected</span> <span class="mblue">{</span><span class="dblue">self</span><span class="mblue">.</span>expected_type<span class="mblue">}</span><span class="trose">'</span>)
                                        instance.__dict__[<span class="dblue">self</span>.key] <span class="igrey">=</span> value
                                
                                <span epub:type="pagebreak" id="page_212"></span>    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__delete__</span>(<span class="dblue">self</span>,instance):
                                        <span class="lgreen"><strong>raise</strong></span> <span class="pgold">AttributeError</span>(<span class="mblue">"Can't delete attribute"</span>)
                                
                                <span class="lgreen"><strong>class</strong></span> Integer(Typed):
                                    expected_type <span class="igrey">=</span> int
                                
                                <span class="lgreen"><strong>class</strong></span> Float(Typed):
                                    expected_type <span class="igrey">=</span> float
                                
                                <span class="lgreen"><strong>class</strong></span> String(Typed):
                                    expected_type <span class="igrey">=</span> str
                                
                                <span class="hblue"># Example use:</span>
                                <span class="lgreen"><strong>class</strong></span> Account:
                                    owner <span class="igrey">=</span> String()
                                    balance <span class="igrey">=</span> Float()
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, owner, balance):
                                        <span class="dblue">self</span>.owner <span class="igrey">=</span> owner
                                        <span class="dblue">self</span>.balance <span class="igrey">=</span> balance</pre>
          <p class="indent">
            In this example, the class <code>Typed</code> defines a descriptor
            where type checking is performed when an attribute is assigned and
            an error is produced if an attempt is made to delete the attribute.
            The <code>Integer</code>, <code>Float</code>, and
            <code>String</code> subclasses specialize <code>Type</code> to match
            a specific type. The use of these classes in another class (such as
            <code>Account</code>) makes those attributes automatically call the
            appropriate <code>__get__()</code>, <code>__set__()</code>, or
            <code>__delete__()</code> methods on access. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0212-02" id="f0212-02"
              >Click here to view code image</a
            >
          </p>
          <pre>a <span class="igrey">=</span> Account(<span class="mblue">'Guido'</span>, <span class="sgreen">1000.0</span>)
                                b <span class="igrey">=</span> a.owner           <span class="hblue"># Calls Account.owner.__get__(a, Account)</span>
                                a.owner <span class="igrey">=</span> <span class="mblue">'Eva'</span>       <span class="hblue"># Calls Account.owner.__set__(a, 'Eva')</span>
                                <span class="lgreen"><strong>del</strong></span> f.owner           <span class="hblue"># Calls Account.owner.__delete__(a)</span></pre>
          <p class="indent">
            Descriptors can only be instantiated at the class level. It is not
            legal to create descriptors on a per-instance basis by creating
            descriptor objects inside <code>__init__()</code> and other methods.
            The <code>__set_name__()</code> method of a descriptor is invoked
            after a class has been defined, but before any instances have been
            created, to inform a descriptor about the name that has been used
            within the class. For instance, the
            <code>balance = Float()</code> definition calls
            <code>Float.__set_name__(Account, 'balance')</code> to inform the
            descriptor of the class and name being used.
          </p>
          <p class="indent">
            Descriptors with a <code>__set__()</code> method always take
            precedence over items in the instance dictionary. For example, if a
            descriptor happens to have the same name as a key in the instance
            dictionary, the descriptor takes priority. In the above
            <code>Account</code> example, you’ll see the descriptor applying
            type checking even though the instance dictionary has a matching
            entry:<span epub:type="pagebreak" id="page_213"></span>
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0213-01" id="f0213-01"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; a = Account('Guido', 1000.0)
                                &gt;&gt;&gt; a.__dict__
                                {'owner': 'Guido', 'balance': 1000.0 }
                                &gt;&gt;&gt; a.balance = 'a lot'
                                Traceback (most recent call last):
                                  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
                                  File "descrip.py", line 63, in __set__
                                    raise TypeError(f'Expected {self.expected_type}')
                                TypeError: Expected &lt;class 'float'&gt;
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            The <code>__get__(instance, cls)</code> method of a descriptor takes
            arguments for both the instance and the class. It’s possible that
            <code>__get__()</code> is invoked at the class level, in which case
            the <code>instance</code> argument is <code>None</code>. In most
            cases, the <code>__get__()</code> returns the descriptor back if no
            instance is provided. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0213-02" id="f0213-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; Account.balance
                                &lt;__main__.Float object at 0x110606710&gt;
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            A descriptor that only implements <code>__get__()</code> is known as
            a method descriptor. It has a weaker binding than a descriptor with
            both get/set capabilities. Specifically, the
            <code>__get__()</code> method of a method descriptor only gets
            invoked if there is no matching entry in the instance dictionary.
            The reason it’s called a method descriptor is that this kind of
            descriptor is mainly used to implement Python’s various types of
            methods—including instance methods, class methods, and static
            methods.
          </p>
          <p class="indent">
            For example, here’s a skeleton implementation that shows how
            <code>@classmethod</code> and <code>@staticmethod</code> could be
            implemented from scratch (the real implementation is more
            efficient):
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0213-03" id="f0213-03"
              >Click here to view code image</a
            >
          </p>
          <pre>import types
                                <span class="lgreen"><strong>class</strong></span> classmethod:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, func):
                                        <span class="dblue">self</span>.__func__ <span class="igrey">=</span> func
                                
                                    <span class="hblue"># Return a bound method with cls as first argument</span>
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__get__</span>(<span class="dblue">self</span>, instance, cls):
                                        <span class="lgreen"><strong>return</strong></span> types.MethodType(<span class="dblue">self</span>.__func__, cls)
                                
                                <span class="lgreen"><strong>class</strong></span> staticmethod:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, func):
                                        <span class="dblue">self</span>.__func__ <span class="igrey">=</span> func
                                
                                    <span class="hblue"># Return the bare function</span>
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__get__</span>(<span class="dblue">self</span>, instance, cls):
                                        <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>.__func__</pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_214"></span>Since method
            descriptors only act if there is no matching entry in the instance
            dictionary, they can also be used to implement various forms of lazy
            evaluation of attributes. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0214-01" id="f0214-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Lazy:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, func):
                                        <span class="dblue">self</span>.func <span class="igrey">=</span> func
                                
                                    <span class="lgreen"><strong>def</strong></span> __set_name__(<span class="dblue">self</span>, cls, name):
                                        <span class="dblue">self</span>.key <span class="igrey">=</span> name
                                
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__get__</span>(<span class="dblue">self</span>, instance, cls):
                                        <span class="lgreen"><strong>if</strong></span> instance:
                                            value <span class="igrey">=</span> <span class="dblue">self</span>.func(instance)
                                            instance.__dict__[<span class="dblue">self</span>.key] <span class="igrey">=</span> value
                                            <span class="lgreen"><strong>return</strong></span> value
                                        <span class="lgreen"><strong>else</strong></span>:
                                            <span class="lgreen"><strong>return</strong></span> <span class="dblue">self</span>
                                
                                <span class="lgreen"><strong>class</strong></span> Rectangle:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, width, height):
                                        <span class="dblue">self</span>.width <span class="igrey">=</span> width
                                        <span class="dblue">self</span>.height <span class="igrey">=</span> height
                                
                                    area <span class="igrey">=</span> Lazy(<span class="lgreen"><strong>lambda</strong></span> <span class="dblue">self</span>: <span class="dblue">self</span>.width <span class="igrey">*</span> <span class="dblue">self</span>.height)
                                    perimeter <span class="igrey">=</span> Lazy(<span class="lgreen"><strong>lambda</strong></span> <span class="dblue">self</span>: <span class="sgreen">2</span><span class="igrey">*</span><span class="dblue">self</span>.width <span class="igrey">+</span> <span class="sgreen">2</span><span class="igrey">*</span><span class="dblue">self</span>.height)</pre>
          <p class="indent">
            In this example, <code>area</code> and <code>perimeter</code> are
            attributes that are computed on demand and stored in the instance
            dictionary. Once computed, values are just returned directly from
            the instance dictionary.
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0214-02" id="f0214-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; r = Rectangle(3, 4)
                                &gt;&gt;&gt; r.__dict__
                                {'width': 3, 'height': 4 }
                                &gt;&gt;&gt; r.area
                                12
                                &gt;&gt;&gt; r.perimeter
                                14
                                &gt;&gt;&gt; r.__dict__
                                {'width': 3, 'height': 4, 'area': 12, 'perimeter': 14 }
                                &gt;&gt;&gt;</pre
          >
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec29">
            <span epub:type="pagebreak" id="page_215"></span>7.29 Class
            Definition Process
          </h3>
          <p class="noindent">
            The definition of a class is a dynamic process. When you define a
            class using the <code>class</code> statement, a new dictionary is
            created that serves as the local class namespace. The body of the
            class then executes as a script within this namespace. Eventually,
            the namespace becomes the <code>__dict__</code> attribute of the
            resulting class object.
          </p>
          <p class="indent">
            Any legal Python statement is allowed in the body of a class.
            Normally, you just define functions and variables, but control flow,
            imports, nested classes, and everything else is allowed. For
            example, here is a class that conditionally defines methods:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0215-01" id="f0215-01"
              >Click here to view code image</a
            >
          </p>
          <pre>debug <span class="igrey">=</span> <span class="dblue">True</span>
                                
                                <span class="lgreen"><strong>class</strong></span> Account:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, owner, balance):
                                        <span class="dblue">self</span>.owner <span class="igrey">=</span> owner
                                        <span class="dblue">self</span>.balance <span class="igrey">=</span> balance
                                
                                    <span class="lgreen"><strong>if</strong></span> debug:
                                        import logging
                                        log <span class="igrey">=</span> logging.getLogger(<span class="trose">f'</span><span class="mblue">{</span>__module__<span class="mblue">}</span><span class="trose">.</span><span class="mblue">{</span>__qualname__<span class="mblue">}</span><span class="trose">'</span>)
                                        <span class="lgreen"><strong>def</strong></span> deposit(<span class="dblue">self</span>, amount):
                                            Account.log.debug(<span class="mblue">'Depositing %f'</span>, amount)
                                            <span class="dblue">self</span>.balance <span class="igrey">+=</span> amount
                                
                                        <span class="lgreen"><strong>def</strong></span> withdraw(<span class="dblue">self</span>, amount):
                                            Account.log.debug(<span class="mblue">'Withdrawing %f'</span>, amount)
                                            <span class="dblue">self</span>.balance <span class="igrey">-=</span> amount
                                    <span class="lgreen"><strong>else</strong></span>:
                                        <span class="lgreen"><strong>def</strong></span> deposit(<span class="dblue">self</span>, amount):
                                            <span class="dblue">self</span>.balance <span class="igrey">+=</span> amount
                                
                                        <span class="lgreen"><strong>def</strong></span> withdraw(<span class="dblue">self</span>, amount):
                                            <span class="dblue">self</span>.balance <span class="igrey">-=</span> amount</pre>
          <p class="indent">
            In this example, a global variable <code>debug</code> is being used
            to conditionally define methods. The <code>__qualname__</code> and
            <code>__module__</code> variables are predefined strings that hold
            information about the class name and enclosing module. These can be
            used by statements in the class body. In this example, they’re being
            used to configure the logging system. There are probably cleaner
            ways of organizing the above code, but the key point is that you can
            put anything you want in a class.
          </p>
          <p class="indent">
            One critical point about class definition is that the namespace used
            to hold the contents of the class body is not a scope of variables.
            Any name that gets used within a method (such as
            <code>Account.log</code> in the above example) needs to be fully
            qualified.
          </p>
          <p class="indent">
            If a function like <code>locals()</code> is used in a class body
            (but not inside a method), it returns the dictionary being used for
            the class namespace.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec30">
            <span epub:type="pagebreak" id="page_216"></span>7.30 Dynamic Class
            Creation
          </h3>
          <p class="noindent">
            Normally, classes are created using the
            <code>class</code> statement, but this is not a requirement. As
            noted in the previous section, classes are defined by executing the
            body of a class to populate a namespace. If you’re able to populate
            a dictionary with your own definitions, you can make a class without
            ever using the <code>class</code> statement. To do that, use
            <code>types.new_class()</code>:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0216-01" id="f0216-01"
              >Click here to view code image</a
            >
          </p>
          <pre>import types
                                
                                <span class="hblue"># Some methods (not in a class)</span>
                                <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, owner, balance):
                                    <span class="dblue">self</span>.owner <span class="igrey">=</span> owner
                                    <span class="dblue">self</span>.balance <span class="igrey">=</span> balance
                                
                                <span class="lgreen"><strong>def</strong></span> deposit(<span class="dblue">self</span>, amount):
                                    <span class="dblue">self</span>.balance <span class="igrey">-=</span> amount
                                
                                <span class="lgreen"><strong>def</strong></span> withdraw(<span class="dblue">self</span>, amount):
                                    <span class="dblue">self</span>.balance <span class="igrey">+=</span> amount
                                
                                methods <span class="igrey">=</span> {
                                   <span class="mblue">'__init__'</span>: <span class="cblue">__init__</span>,
                                   <span class="mblue">'deposit'</span>: deposit,
                                   <span class="mblue">'withdraw'</span>: withdraw,
                                }
                                
                                Account <span class="igrey">=</span> types.new_class(<span class="mblue">'Account'</span>, (),
                                               exec_body<span class="igrey">=</span><span class="lgreen"><strong>lambda</strong></span> ns: ns.update(methods))
                                
                                <span class="hblue"># You now have a class</span>
                                a <span class="igrey">=</span> Account(<span class="mblue">'Guido'</span>, <span class="sgreen">1000.0</span>)
                                a.deposit(<span class="sgreen">50</span>)
                                a.withdraw(<span class="sgreen">25</span>)</pre>
          <p class="indent">
            The <code>new_class()</code> function requires a class name, a tuple
            of base classes, and a callback function responsible for populating
            the class namespace. This callback receives the class namespace
            dictionary as an argument. It should update this dictionary in
            place. The return value of the callback is ignored.
          </p>
          <p class="indent">
            Dynamic class creation may be useful if you want to create classes
            from data structures. For example, in the section on descriptors,
            the following classes were defined:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0216-02" id="f0216-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Integer(Typed):
                                    expected_type <span class="igrey">=</span> int
                                
                                <span epub:type="pagebreak" id="page_217"></span><span class="lgreen"><strong>class</strong></span> Float(Typed):
                                    expected_type <span class="igrey">=</span> float
                                
                                <span class="lgreen"><strong>class</strong></span> String(Typed):
                                    expected_type <span class="igrey">=</span> str</pre>
          <p class="indent">
            This code is highly repetitive. Perhaps a data-driven approach would
            be better:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0217-02" id="f0217-02"
              >Click here to view code image</a
            >
          </p>
          <pre>typed_classes <span class="igrey">=</span> [
                                   (<span class="mblue">'Integer'</span>, int),
                                   (<span class="mblue">'Float'</span>, float),
                                   (<span class="mblue">'String'</span>, str),
                                   (<span class="mblue">'Bool'</span>, bool),
                                   (<span class="mblue">'Tuple'</span>, tuple),
                                ]
                                
                                globals().update(
                                   (name, types.new_class(name, (Typed,),
                                          exec_body<span class="igrey">=</span><span class="lgreen"><strong>lambda</strong></span> ns: ns.update(expected_type<span class="igrey">=</span>ty)))
                                   <span class="lgreen"><strong>for</strong></span> name, ty <span class="lgreen"><strong>in</strong></span> typed_classes)</pre>
          <p class="indent">
            In this example, the global module namespace is being updated with
            dynamically created classes using <code>types.new_class()</code>. If
            you want to make more classes, put an appropriate entry in the
            <code>typed_classes</code> list.
          </p>
          <p class="indent">
            Sometimes you will see <code>type()</code> being used to dynamically
            create a class instead. For example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0217-03" id="f0217-03"
              >Click here to view code image</a
            >
          </p>
          <pre>Account <span class="igrey">=</span> type(<span class="mblue">'Account'</span>, (), methods)</pre>
          <p class="indent">
            This works, but it doesn’t take into account some of the more
            advanced class machinery such as metaclasses (to be discussed
            shortly). In modern code, try to use
            <code>types.new_class()</code> instead.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec31">7.31 Metaclasses</h3>
          <p class="noindent">
            When you define a class in Python, the class definition itself
            becomes an object. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0217-04" id="f0217-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Account:
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, owner, balance):
                                        <span class="dblue">self</span>.owner <span class="igrey">=</span> owner
                                        <span class="dblue">self</span>.balance <span class="igrey">=</span> balance
                                
                                    <span class="lgreen"><strong>def</strong></span> deposit(<span class="dblue">self</span>, amount):
                                        <span class="dblue">self</span>.balance <span class="igrey">+=</span> amount
                                
                                <span epub:type="pagebreak" id="page_218"></span>    <span class="lgreen"><strong>def</strong></span> withdraw(<span class="dblue">self</span>, amount):
                                        <span class="dblue">self</span>.balance <span class="igrey">-=</span> amount
                                
                                isinstance(Account, object)       <span class="hblue"># -&gt; True</span></pre>
          <p class="indent">
            If you think about this long enough, you will realize that if
            <code>Account</code> is an object, then something had to create it.
            This creation of the class object is controlled by a special kind of
            class called a <em>metaclass</em>. Simply put, a metaclass is a
            class that creates instances of classes.
          </p>
          <p class="indent">
            In the preceding example, the metaclass that created
            <code>Account</code> is a built-in class called <code>type</code>.
            In fact, if you check the type of <code>Account</code>, you will see
            that it is an instance of <code>type</code>:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0218-02" id="f0218-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; Account.__class__
                                &lt;type 'type'&gt;
                                &gt;&gt;&gt;</pre
          >
          <p class="indent">
            It’s a bit brain-bending, but it’s similar to integers. For example,
            if you write <code>x = 42</code> and then look at
            <code>x.__class__</code>, you’ll get <code>int</code>, which is the
            class that creates integers. Similarly, <code>type</code> makes
            instances of types or classes.
          </p>
          <p class="indent">
            When a new class is defined with the <code>class</code> statement, a
            number of things happen. First, a new namespace for the class is
            created. Next, the body of the class is executed in this namespace.
            Finally, the class name, base classes, and populated namespace are
            used to create the class instance. The following code illustrates
            the low-level steps that take place:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0218-03" id="f0218-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># Step 1: Create the class namespace</span>
                                namespace <span class="igrey">=</span> type.__prepare__(<span class="mblue">'Account'</span>, ())
                                
                                <span class="hblue"># Step 2: Execute the class body</span>
                                exec(<span class="mblue">'''</span>
                                <span class="mblue">def __init__(self, owner, balance):</span>
                                    <span class="mblue">self.owner = owner</span>
                                    <span class="mblue">self.balance = balance</span>
                                
                                <span class="mblue">def deposit(self, amount):</span>
                                    <span class="mblue">self.balance += amount</span>
                                
                                <span class="mblue">def withdraw(self, amount):</span>
                                    <span class="mblue">self.balance -= amount</span>
                                <span class="mblue">'''</span>, globals(), namespace)
                                
                                <span class="hblue"># Step 3: Create the final class object</span>
                                Account <span class="igrey">=</span> type(<span class="mblue">'Account'</span>, (), namespace)</pre>
          <p class="indent">
            In the definition process, there is interaction with the
            <code>type</code> class to create the class namespace and to create
            the final class object. The choice of using <code>type</code> can be
            customized—a class can choose to be processed by a different type
            class by specifying a different metaclass. This is done by using the
            <code>metaclass</code> keyword argument in inheritance:<span
              epub:type="pagebreak"
              id="page_219"
            ></span>
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0219-02" id="f0219-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Account(metaclass<span class="igrey">=</span>type):
                                    ...</pre>
          <p class="indent">
            If no <code>metaclass</code> is given, the
            <code>class</code> statement examines the type of the first entry in
            the tuple of base classes (if any) and uses that as the metaclass.
            Therefore, if you write <code>class Account(object)</code>, the
            resulting <code>Account</code> class will have the same type as
            <code>object</code> (which is <code>type</code>). Note that classes
            that don’t specify any parent at all always inherit from
            <code>object</code>, so this still applies.
          </p>
          <p class="indent">
            To create a new metaclass, define a class that inherits from
            <code>type</code>. Within this class, you can redefine one or more
            methods that are used during the class creation process. Typically,
            this includes the <code>__prepare__()</code> method used to create
            the class namespace, the <code>__new__()</code> method used to
            create the class instance, the <code>__init__()</code> method called
            after a class has already been created, and the
            <code>__call__()</code> method used to create new instances. The
            following example implements a metaclass that merely prints the
            input arguments to each method so you can experiment:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0219-01" id="f0219-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> mytype(type):
                                
                                    <span class="hblue"># Creates the class namespace</span>
                                    <span class="wasabi">@classmethod</span>
                                    <span class="lgreen"><strong>def</strong></span> __prepare__(meta, clsname, bases):
                                        print(<span class="mblue">"Preparing:"</span>, clsname, bases)
                                        <span class="lgreen"><strong>return</strong></span> super().__prepare__(clsname, bases)
                                
                                    <span class="hblue"># Creates the class instance after body has executed</span>
                                    <span class="wasabi">@staticmethod</span>
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__new__</span>(meta, clsname, bases, namespace):
                                        print(<span class="mblue">"Creating:"</span>, clsname, bases, namespace)
                                        <span class="lgreen"><strong>return</strong></span> super().<span class="cblue">__new__</span>(meta, clsname, bases, namespace)
                                
                                    <span class="hblue"># Initializes the class instance</span>
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(cls, clsname, bases, namespace):
                                        print(<span class="mblue">"Initializing:"</span>, clsname, bases, namespace)
                                        super().<span class="cblue">__init__</span>(clsname, bases, namespace)
                                
                                    <span class="hblue"># Creates new instances of the class</span>
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__call__</span>(cls, <span class="igrey">*</span>args, <span class="igrey">**</span>kwargs):
                                        print(<span class="mblue">"Creating instance:"</span>, args, kwargs)
                                        <span class="lgreen"><strong>return</strong></span> super().<span class="cblue">__call__</span>(<span class="igrey">*</span>args, <span class="igrey">**</span>kwargs)
                                
                                <span class="hblue"># Example</span>
                                <span class="lgreen"><strong>class</strong></span> Base(metaclass<span class="igrey">=</span>mytype):
                                    <span class="lgreen"><strong>pass</strong></span>
                                
                                <span class="hblue"># Definition of the Base produces the following output</span>
                                <span epub:type="pagebreak" id="page_220"></span><span class="hblue"># Preparing: Base ()</span>
                                <span class="hblue"># Creating: Base () {'__module__': '__main__', '__qualname__': 'Base'}</span>
                                <span class="hblue"># Initializing: Base () {'__module__': '__main__', '__qualname__': 'Base'}</span>
                                
                                b <span class="igrey">=</span> Base()
                                <span class="hblue"># Creating instance: () {}</span></pre>
          <p class="indent">
            One tricky facet of working with metaclasses is the naming of
            variables and keeping track of the various entities involved. In the
            above code, the <code>meta</code> name refers to the metaclass
            itself. The <code>cls</code> name refers to a class instance created
            by the metaclass. Although not used here, the <code>self</code> name
            refers to a normal instance created by a class.
          </p>
          <p class="indent">
            Metaclasses propagate via inheritance. So, if you’ve defined a base
            class to use a different metaclass, all child classes will also use
            that metaclass. Try this example to see your custom metaclass at
            work:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0220-02" id="f0220-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> Account(Base):
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, owner, balance):
                                        <span class="dblue">self</span>.owner <span class="igrey">=</span> owner
                                        <span class="dblue">self</span>.balance <span class="igrey">=</span> balance
                                
                                    <span class="lgreen"><strong>def</strong></span> deposit(<span class="dblue">self</span>, amount):
                                        <span class="dblue">self</span>.balance <span class="igrey">+=</span> amount
                                
                                    <span class="lgreen"><strong>def</strong></span> withdraw(<span class="dblue">self</span>, amount):
                                        <span class="dblue">self</span>.balance <span class="igrey">-=</span> amount
                                
                                print(type(Account))   <span class="hblue"># -&gt; &lt;class 'mytype'&gt;</span></pre>
          <p class="indent">
            The primary use of metaclasses is in situations where you want to
            exert extreme low-level control over the class definition
            environment and creation process. Before proceeding, however,
            remember that Python already provides a lot of functionality for
            monitoring and altering class definitions (such as the
            <code>__init_subclass__()</code> method, class decorators,
            descriptors, mixins, and so on). Most of the time, you probably
            don’t need a metaclass. That said, the next few examples show
            situations where a metaclass provides the only sensible solution.
          </p>
          <p class="indent">
            One use of a metaclass is in rewriting the contents of the class
            namespace prior to the creation of the class object. Certain
            features of classes are established at definition time and can’t be
            modified later. One such feature is <code>__slots__</code>. As noted
            earlier, <code>__slots__</code> is a performance optimization
            related to the memory layout of instances. Here’s a metaclass that
            automatically sets the <code>__slots__</code> attribute based on the
            calling signature of the <code>__init__()</code> method.
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0220-03" id="f0220-03"
              >Click here to view code image</a
            >
          </p>
          <pre>import inspect
                                
                                <span class="lgreen"><strong>class</strong></span> SlotMeta(type):
                                    <span class="wasabi">@staticmethod</span>
                                <span epub:type="pagebreak" id="page_221"></span>    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__new__</span>(meta, clsname, bases, methods):
                                        <span class="lgreen"><strong>if</strong></span> <span class="mblue">'__init__'</span> <span class="lgreen"><strong>in</strong></span> methods:
                                            sig <span class="igrey">=</span> inspect.signature(methods[<span class="mblue">'__init__'</span>])
                                            __slots__ <span class="igrey">=</span> tuple(sig.parameters)[<span class="sgreen">1</span>:]
                                        <span class="lgreen"><strong>else</strong></span>:
                                            __slots__ <span class="igrey">=</span> ()
                                        methods[<span class="mblue">'__slots__'</span>] <span class="igrey">=</span> __slots__
                                        <span class="lgreen"><strong>return</strong></span> super().<span class="cblue">__new__</span>(meta, clsname, bases, methods)
                                
                                <span class="lgreen"><strong>class</strong></span> Base(metaclass<span class="igrey">=</span>SlotMeta):
                                    <span class="lgreen"><strong>pass</strong></span>
                                
                                <span class="hblue"># Example</span>
                                <span class="lgreen"><strong>class</strong></span> Point(Base):
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>, x, y):
                                        <span class="dblue">self</span>.x <span class="igrey">=</span> x
                                        <span class="dblue">self</span>.y <span class="igrey">=</span> y</pre>
          <p class="indent">
            In this example, the <code>Point</code> class that’s created is
            automatically created with <code>__slots__</code> of
            <code>('x', 'y')</code>. The resulting instances of
            <code>Point</code> now get memory savings without knowing that slots
            are being used. It doesn’t have to be specified directly. This kind
            of trick is not possible with class decorators or with
            <code>__init_subclass__()</code> because those features only operate
            on a class after it’s been created. By then, it’s too late to apply
            the <code>__slots__</code> optimization.
          </p>
          <p class="indent">
            Another use of metaclasses is for altering the class definition
            environment. For example, duplicate definitions of a name during
            class definition normally result in a silent error—the second
            definition overwrites the first. Suppose you wanted to catch that.
            Here’s a metaclass that does that by defining a different kind of
            dictionary for the class namespace:
          </p>
          <p class="codelink">
            <a href="ch07_images.xhtml#rf0221-02" id="f0221-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>class</strong></span> NoDupeDict(dict):
                                    <span class="lgreen"><strong>def</strong></span> <span class="cblue">__setitem__</span>(<span class="dblue">self</span>, key, value):
                                        <span class="lgreen"><strong>if</strong></span> key <span class="lgreen"><strong>in</strong></span> <span class="dblue">self</span>:
                                            <span class="lgreen"><strong>raise</strong></span> <span class="pgold">AttributeError</span>(<span class="trose">f'</span><span class="mblue">{</span>key<span class="mblue">}</span> <span class="trose">already defined'</span>)
                                        super().<span class="cblue">__setitem__</span>(key, value)
                                
                                <span class="lgreen"><strong>class</strong></span> NoDupeMeta(type):
                                    <span class="wasabi">@classmethod</span>
                                    <span class="lgreen"><strong>def</strong></span> __prepare__(meta, clsname, bases):
                                        <span class="lgreen"><strong>return</strong></span> NoDupeDict()
                                
                                <span class="lgreen"><strong>class</strong></span> Base(metaclass<span class="igrey">=</span>NoDupeMeta):
                                    <span class="lgreen"><strong>pass</strong></span>
                                
                                <span class="hblue"># Example</span>
                                <span class="lgreen"><strong>class</strong></span> SomeClass(Base):
                                <span epub:type="pagebreak" id="page_222"></span>    <span class="lgreen"><strong>def</strong></span> yow(<span class="dblue">self</span>):
                                        print(<span class="mblue">'Yow!'</span>)
                                
                                    <span class="lgreen"><strong>def</strong></span> yow(<span class="dblue">self</span>, x):             <span class="hblue"># Fails. Already defined</span>
                                        print(<span class="mblue">'Different Yow!'</span>)</pre>
          <p class="indent">
            This is only a small sample of what’s possible. For framework
            builders, metaclasses offer an opportunity to tightly control what
            happens during class definition—allowing classes to serve as a kind
            of domain-specific language.
          </p>
          <p class="indent">
            Historically, metaclasses have been used to accomplish a variety of
            tasks that are now possible through other means. The
            <code>__init_subclass__()</code> method, in particular, can be used
            to address a wide variety of use cases where metaclasses were once
            applied. This includes registration of classes with a central
            registry, automatic decoration of methods, and code generation.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec32">
            7.32 Built-in Objects for Instances and Classes
          </h3>
          <p class="noindent">
            This section gives some details about the low-level objects used to
            represent types and instances. This information may be useful in
            low-level metaprogramming and code that needs to directly manipulate
            types.
          </p>
          <p class="indent">
            <a href="ch07.xhtml#ch07tab01">Table 7.1</a> shows commonly used
            attributes of a type object <code>cls</code>.
          </p>
          <figure class="table" id="ch07tab01">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 7.1</span> Attributes of Types
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Attribute</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext"><code>cls.__name__</code></p>
                  </td>
                  <td><p class="tabtext">Class name</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>cls.__module__</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Module name in which the class is defined
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>cls.__qualname__</code></p>
                  </td>
                  <td><p class="tabtext">Fully qualified class name</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>cls.__bases__</code></p>
                  </td>
                  <td><p class="tabtext">Tuple of base classes</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>cls.__mro__</code></p>
                  </td>
                  <td><p class="tabtext">Method Resolution Order tuple</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>cls.__dict__</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Dictionary holding class methods and variables
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>cls.__doc__</code></p>
                  </td>
                  <td><p class="tabtext">Documentation string</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>cls.__annotations__</code></p>
                  </td>
                  <td><p class="tabtext">Dictionary of class type hints</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>cls.__abstractmethods__</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Set of abstract method names (may be undefined if there
                      aren’t any).
                    </p>
                  </td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            The <code>cls.__name__</code> attribute contains a short class name.
            The <code>cls.__qualname__</code> attribute contains a fully
            qualified name with additional information about the surrounding
            context (this may be useful if a class is defined inside a function
            or if you create a nested class definition). The
            <code>cls.__annotations__</code> dictionary contains class-level
            type hints (if any).
          </p>
          <p class="indent">
            <span epub:type="pagebreak" id="page_223"></span
            ><a href="ch07.xhtml#ch07tab02">Table 7.2</a> shows special
            attributes of an instance <code>i</code>.
          </p>
          <figure class="table" id="ch07tab02">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 7.2</span> Instance Attributes
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Attribute</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext"><code>i.__class__</code></p>
                  </td>
                  <td>
                    <p class="tabtext">Class to which the instance belongs</p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>i.__dict__</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      Dictionary holding instance data (if defined)
                    </p>
                  </td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            The <code>__dict__</code> attribute is normally where all of the
            data associated with an instance is stored. However, if a
            user-defined class uses <code>__slots__</code>, a more efficient
            internal representation is used and instances will not have a
            <code>__dict__</code> attribute.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch07lev1sec33">
            7.33 Final Words: Keep It Simple
          </h3>
          <p class="noindent">
            This chapter has presented a lot of information about classes and
            the ways to customize and control them. However, when writing
            classes, keeping it simple is often the best strategy. Yes, you
            could use abstract based classes, metaclasses, descriptors, class
            decorators, properties, multiple inheritance, mixins, patterns, and
            type hints. However, you could also just write a plain class.
            There’s a pretty good chance that this class is good enough and that
            everyone will understand what it’s doing.
          </p>
          <p class="indent">
            In the big picture, it’s useful to step back and consider a few
            generally desirable code qualities. First and foremost, readability
            counts for a lot—and it often suffers if you pile on too many layers
            of abstraction. Second, you should try to make code that is easy to
            observe and debug, and don’t forget about using the REPL. Finally,
            making code testable is often a good driver for good design. If your
            code can’t be tested or testing is too awkward, there may be a
            better way to organize your solution.<span
              epub:type="pagebreak"
              id="page_224"
            ></span>
          </p>
        </section>
      </section>
    </div>
    <div id="sbo-rt-content">
      <section epub:type="chapter">
        <h2 class="h2" id="ch08">
          <span epub:type="pagebreak" id="page_225"></span
          ><span class="ash">8.</span> Modules and Packages
        </h2>
        <p class="noindent">
          Python programs are organized into modules and packages that are
          loaded with the <code>import</code> statement. This chapter describes
          the module and package system in more detail. The primary focus is on
          programming with modules and packages, not the process of bundling
          code for deployment to others. For the latter, consult the latest
          documentation at
          <code
            ><a
              href="https://packaging.python.org/tutorials/packaging-projects/"
              >https://packaging.python.org/tutorials/packaging-projects/</a
            ></code
          >.
        </p>
        <section>
          <h3 class="h3" id="ch08lev1sec1">
            8.1 Modules and the <code>import</code> Statement
          </h3>
          <p class="noindent">
            Any Python source file can be imported as a module. For example:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0225-01" id="f0225-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># module.py</span>
                                    
                                    a <span class="igrey">=</span> <span class="sgreen">37</span>
                                    
                                    <span class="lgreen"><strong>def</strong></span> func():
                                        print(<span class="trose">f'func says that a is</span> <span class="mblue">{a}</span><span class="trose">'</span>)
                                    
                                    <span class="lgreen"><strong>class</strong></span> SomeClass:
                                        <span class="lgreen"><strong>def</strong></span> method(<span class="dblue">self</span>):
                                            print(<span class="mblue">'method says hi'</span>)
                                    
                                    print(<span class="mblue">'loaded module'</span>)</pre>
          <p class="indent">
            This file contains common programming elements—including a global
            variable, a function, a class definition, and an isolated statement.
            This example illustrates some important (and sometimes subtle)
            features of module loading.
          </p>
          <p class="indent">
            To load a module, use the statement <code>import module</code>. For
            example:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0226-01" id="f0226-01"
              >Click here to view code image</a
            >
          </p>
          <pre>&gt;&gt;&gt; import module
                                    loaded module
                                    &gt;&gt;&gt; module.a
                                    37
                                    <span epub:type="pagebreak" id="page_226"></span>&gt;&gt;&gt; module.func()
                                    func says that a is 37
                                    &gt;&gt;&gt; s = module.SomeClass()
                                    &gt;&gt;&gt; s.method()
                                    method says hi
                                    &gt;&gt;&gt;</pre>
          <p class="indent">In executing an import, several things happen:</p>
          <ol>
            <li>
              <p>
                The module source code is located. If it can’t be found, an
                <code>ImportError</code> exception is raised.
              </p>
            </li>
            <li>
              <p>
                A new module object is created. This object serves as a
                container for all of the global definitions contained within the
                module. It’s sometimes referred to as a <em>namespace</em>.
              </p>
            </li>
            <li>
              <p>
                The module source code is executed within the newly created
                module namespace.
              </p>
            </li>
            <li>
              <p>
                If no errors occur, a name is created within the caller that
                refers to the new module object. This name matches the name of
                the module, but without any kind of filename suffix. For
                example, if the code is found in a file <code>module.py</code>,
                the name of the module is <code>module</code>.
              </p>
            </li>
          </ol>
          <p class="indent">
            Of these steps, the first one (locating modules) is the most
            complicated. A common source of failure for newcomers is using a bad
            filename or putting code in an unknown location. A module filename
            must use the same rules as variable names (letters, digits, and
            underscore) and have a <code>.py</code> suffix—for example,
            <code>module.py</code>. When using <code>import</code>, you specify
            the name without the suffix: <code>import module</code>, not
            <code>import module.py</code> (the latter produces a rather
            confusing error message). The file needs to be placed in one of the
            directories found in <code>sys.path</code>.
          </p>
          <p class="indent">
            The remaining steps are all related to a module defining an isolated
            environment for the code. All definitions that appear in a module
            remain isolated to that module. Thus, there is no risk of the names
            of variables, functions, and classes clashing with identical names
            in other modules. When accessing definitions in a module, use a
            fully qualified name such as <code>module.func()</code>.
          </p>
          <p class="indent">
            <code>import</code> executes all of the statements in the loaded
            source file. If a module carries out a computation or produces
            output in addition to defining objects, you will see the result—such
            as the “loaded module” message printed in the example above. A
            common confusion with modules concerns accessing classes. A module
            always defines a namespace, so if a file
            <code>module.py</code> defines a class <code>SomeClass</code>, use
            the name <code>module.SomeClass</code> to refer to the class.
          </p>
          <p class="indent">
            To import multiple modules using a single <code>import</code>, use a
            comma-separated list of names:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0226-02" id="f0226-02"
              >Click here to view code image</a
            >
          </p>
          <pre>import socket, os, re</pre>
          <p class="indent">
            Sometimes the local name used to refer to a module is changed using
            the <code>as</code> qualifier to <code>import</code>. For example:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0226-03" id="f0226-03"
              >Click here to view code image</a
            >
          </p>
          <pre>
import module as mo
                                    mo.func()</pre
          >
          <p class="indent">
            <span epub:type="pagebreak" id="page_227"></span>This latter style
            of <code>import</code> is standard practice in the data analysis
            world. For example, you often see this:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0227-01" id="f0227-01"
              >Click here to view code image</a
            >
          </p>
          <pre>
import numpy as np
                                    import pandas as pd
                                    import matplotlib as plt
                                    ...</pre
          >
          <p class="indent">
            When a module is renamed, the new name only applies to the context
            where the <code>import</code> statement appeared. Other unrelated
            program modules can still load the module using its original name.
          </p>
          <p class="indent">
            Assigning a different name to an imported module can be a useful
            tool for managing different implementations of common functionality
            or for writing extensible programs. For example, if you have two
            modules <code>unixmodule.py</code> and
            <code>winmodule.py</code> that both define a function
            <code>func()</code> but involve platform-dependent implementation
            details, you could write code to selectively import the module:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0227-02" id="f0227-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>if</strong></span> platform <span class="igrey">==</span> <span class="mblue">'unix'</span>:
                                        import unixmodule as module
                                    <span class="lgreen"><strong>elif</strong></span> platform <span class="igrey">==</span> <span class="mblue">'windows'</span>:
                                        import winmodule as module
                                    
                                    ...
                                    r <span class="igrey">=</span> module.func()</pre>
          <p class="indent">
            Modules are first-class objects in Python. This means they can be
            assigned to variables, placed in data structures, and passed around
            in a program as data. For instance, the <code>module</code> name in
            the above example is a variable that refers to the corresponding
            module object.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch08lev1sec2">8.2 Module Caching</h3>
          <p class="noindent">
            The source code for a module is loaded and executed only once,
            regardless of how often you use the <code>import</code> statement.
            Subsequent <code>import</code> statements bind the module name to
            the module object already created by the previous import.
          </p>
          <p class="indent">
            A common confusion for newcomers arises when a module is imported
            into an interactive session, then its source code is modified (for
            example, to fix a bug) but a new <code>import</code> fails to load
            the modified code. The module cache is to blame for this. Python
            will never reload a previously imported module even if the
            underlying source code has been updated.
          </p>
          <p class="indent">
            You can find the cache of all currently loaded modules in
            <code>sys.modules</code>, which is a dictionary that maps module
            names to module objects. The contents of this dictionary are used to
            determine whether <code>import</code> loads a fresh copy of a module
            or not. Deleting a module from the cache will force it to load again
            on the next <code>import</code> statement. However, this is rarely
            safe for reasons explained in
            <a href="ch08.xhtml#ch08lev1sec5">Section 8.5</a> on module
            reloading.
          </p>
          <p class="indent">
            <span epub:type="pagebreak" id="page_228"></span>Sometimes you will
            see <code>import</code> used inside a function like this:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0228-01" id="f0228-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="lgreen"><strong>def</strong></span> f(x):
                                        import math
                                        <span class="lgreen"><strong>return</strong></span> math.sin(x) <span class="igrey">+</span> math.cos(x)</pre>
          <p class="indent">
            At first glance, it seems like such an implementation would be
            horribly slow—loading a module on each invocation. In reality, the
            cost of the <code>import</code> is minimal—it’s just a single
            dictionary lookup, as Python immediately finds the module in the
            cache. The main objection to having the <code>import</code> inside a
            function is one of style—it’s more common to have all module imports
            listed at the top of a file where they’re easy to see. On the other
            hand, if you have a specialized function that’s rarely invoked,
            putting the function’s import dependencies inside the function body
            can speed up program loading. In this case, you’d only load the
            required modules if they are actually needed.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch08lev1sec3">
            8.3 Importing Selected Names from a Module
          </h3>
          <p class="noindent">
            You can load specific definitions from a module into the current
            namespace using the <code>from module import name</code> statement.
            It’s identical to <code>import</code> except that, instead of
            creating a name referring to the newly created module namespace, it
            places references to one or more of the objects defined in the
            module into the current namespace:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0228-02" id="f0228-02"
              >Click here to view code image</a
            >
          </p>
          <pre>from module import func  <span class="hblue"># Imports module and puts func in current namespace</span>
                                    func()                   <span class="hblue"># Calls module.func()</span>
                                    module.func()            <span class="hblue"># Fails. NameError: module</span></pre>
          <p class="indent">
            The <code>from</code> statement accepts comma-separated names if you
            want multiple definitions. For example:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0228-03" id="f0228-03"
              >Click here to view code image</a
            >
          </p>
          <pre>from module import func, SomeClass</pre>
          <p class="indent">
            Semantically, the statement
            <code>from module import name</code> performs a name copy from the
            module cache to the local namespace. That is, Python first executes
            <code>import module</code> behind the scenes. Afterwards, it makes
            an assignment from the cache to a local name, such as
            <code>name = sys.modules['module'].name</code>.
          </p>
          <p class="indent">
            A common misconception is that the
            <code>from module import name</code> statement is more
            efficient—possibly only loading part of a module. This is not the
            case. Either way, the entire module is loaded and stored in the
            cache.
          </p>
          <p class="indent">
            Importing functions using the <code>from</code> syntax does not
            change their scoping rules. When functions look for variables, they
            only look within the file where the function was defined, not the
            namespace into which a function is imported and called. For example:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0228-05" id="f0228-05"
              >Click here to view code image</a
            >
          </p>
          <pre>&gt;&gt;&gt; from module import func
                                    &gt;&gt;&gt; a = 42
                                    <span epub:type="pagebreak" id="page_229"></span>&gt;&gt;&gt; func()
                                    func says that a is 37
                                    &gt;&gt;&gt; func.__module__
                                    'module'
                                    &gt;&gt;&gt; func.__globals__['a']
                                    37
                                    &gt;&gt;&gt;</pre>
          <p class="indent">
            A related confusion concerns the behavior of global variables. For
            example, consider this code that imports both <code>func</code> and
            a global variable <code>a</code> that it uses:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0229-02" id="f0229-02"
              >Click here to view code image</a
            >
          </p>
          <pre>from module import a, func
                                    a <span class="igrey">=</span> <span class="sgreen">42</span>                      <span class="hblue"># Modify the variable</span>
                                    func()                      <span class="hblue"># Prints "func says a is 37"</span>
                                    print(a)                    <span class="hblue"># Prints "42"</span></pre>
          <p class="indent">
            Variable assignment in Python is not a storage operation. That is,
            the name <code>a</code> in this example does not represent some kind
            of box where a value gets stored. The initial import associates the
            local name <code>a</code> with the original object
            <code>module.a</code>. However, the later reassignment
            <code>a = 42</code> moves the local name <code>a</code> to a
            completely different object. At this point, <code>a</code> is no
            longer bound to the value in the imported module. Because of this,
            it is not possible to use the <code>from</code> statement in a way
            that makes variables behave like global variables in a language such
            as C. If you want to have mutable global parameters in your program,
            put them in a module and use the module name explicitly using the
            <code>import</code> statement— for example, <code>module.a</code>.
          </p>
          <p class="indent">
            The asterisk (<code>*</code>) wildcard character is sometimes used
            to load all the definitions in a module, except those that start
            with an underscore. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0229-03" id="f0229-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># Load all definitions into the current namespace</span>
                                    from module import <span class="igrey">*</span></pre>
          <p class="indent">
            The <code>from module import *</code> statement may only be used at
            the top-level scope of a module. In particular, it is illegal to use
            this form of import inside a function body.
          </p>
          <p class="indent">
            Modules can precisely control the set of names imported by
            <code>from module import *</code> by defining the list
            <code>__all__</code>. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0229-04" id="f0229-04"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># module: module.py</span>
                                    __all__ <span class="igrey">=</span> [ <span class="mblue">'func'</span>, <span class="mblue">'SomeClass'</span> ]
                                    
                                    a <span class="igrey">=</span> <span class="sgreen">37</span>              <span class="hblue"># Not exported</span>
                                    
                                    <span class="lgreen"><strong>def</strong></span> func():         <span class="hblue"># Exported</span>
                                        ...
                                    
                                    <span class="lgreen"><strong>class</strong></span> SomeClass:    <span class="hblue"># Exported</span>
                                        ...</pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_230"></span>When at the
            interactive Python prompt, using
            <code>from module import *</code> can be a convenient way to work
            with a module. However, using this style of import in a program is
            frowned upon. Overuse can pollute the local namespace and lead to
            confusion. For example:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0230-01" id="f0230-01"
              >Click here to view code image</a
            >
          </p>
          <pre>from math import <span class="igrey">*</span>
                                    from random import <span class="igrey">*</span>
                                    from statistics import <span class="igrey">*</span>
                                    
                                    a <span class="igrey">=</span> gauss(<span class="sgreen">1.0</span>, <span class="sgreen">0.25</span>)        <span class="hblue"># From which module?</span></pre>
          <p class="indent">It’s usually better to be explicit about names:</p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0230-01a" id="f0230-01a"
              >Click here to view code image</a
            >
          </p>
          <pre>from math import sin, cos, sqrt
                                    from random import gauss
                                    from statistics import mean
                                    
                                    a <span class="igrey">=</span> gauss(<span class="sgreen">1.0</span>, <span class="sgreen">0.25</span>)</pre>
        </section>
        <section>
          <h3 class="h3" id="ch08lev1sec4">8.4 Circular Imports</h3>
          <p class="noindent">
            A peculiar problem arises if two modules mutually import each other.
            For example, suppose you had two files:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0230-02" id="f0230-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># ----------------------------</span>
                                    <span class="hblue"># moda.py</span>
                                    
                                    import modb
                                    
                                    <span class="lgreen"><strong>def</strong></span> func_a():
                                        modb.func_b()
                                    
                                    <span class="lgreen"><strong>class</strong></span> Base:
                                        <span class="lgreen"><strong>pass</strong></span>
                                    
                                    <span class="hblue"># ----------------------------</span>
                                    <span class="hblue"># modb.py</span>
                                    
                                    import moda
                                    
                                    <span class="lgreen"><strong>def</strong></span> func_b():
                                        print(<span class="mblue">'B'</span>)
                                    
                                    <span class="lgreen"><strong>class</strong></span> Child(moda.Base):
                                        <span class="lgreen"><strong>pass</strong></span></pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_231"></span>There is a strange
            import order dependency in this code. Using
            <code>import modb</code> first works fine, but if you put
            <code>import moda</code> first, it blows up with an error about
            <code>moda.Base</code> being undefined.
          </p>
          <p class="indent">
            To understand what is happening, you have to follow the control
            flow. <code>import moda</code> starts executing the file
            <code>moda.py</code>. The first statement it encounters is
            <code>import modb</code>. Thus, control switches over to
            <code>modb.py</code>. The first statement in that file is
            <code>import moda</code>. Instead of entering a recursive cycle,
            that import is satisfied by the module cache and control continues
            on to the next statement in <code>modb.py</code>. This is
            good—circular imports don’t cause Python to deadlock or enter a new
            spacetime dimension. However, at this point in execution, module
            <code>moda</code> has only been partially evaluated. When control
            reaches the <code>class Child(moda.Base)</code> statement, it blows
            up. The required <code>Base</code> class hasn’t been defined yet.
          </p>
          <p class="indent">
            One way to fix this problem is to move the
            <code>import modb</code> statement someplace else. For example, you
            could move the import into <code>func_a()</code> where the
            definition is actually needed:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0231-01" id="f0231-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># moda.py</span>
                                    <span class="lgreen"><strong>def</strong></span> func_a():
                                        import modb
                                        modb.func_b()
                                    
                                    <span class="lgreen"><strong>class</strong></span> Base:
                                        <span class="lgreen"><strong>pass</strong></span></pre>
          <p class="indent">
            You could also move the import to a later position in the file:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0231-02" id="f0231-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># moda.py</span>
                                    
                                    <span class="lgreen"><strong>def</strong></span> func_a():
                                        modb.func_b()
                                    
                                    <span class="lgreen"><strong>class</strong></span> Base:
                                        <span class="lgreen"><strong>pass</strong></span>
                                    
                                    import modb     <span class="hblue"># Must be after Base is defined</span></pre>
          <p class="indent">
            Both of these solutions are likely to raise eyebrows in a code
            review. Most of the time, you don’t see module imports appearing at
            the end of a file. The presence of circular imports almost always
            suggests a problem in code organization. A better way to handle this
            might be to move the definition of <code>Base</code> to a separate
            file <code>base.py</code> and rewrite <code>modb.py</code> as
            follows:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0231-03" id="f0231-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># modb.py</span>
                                    import base
                                    
                                    <span epub:type="pagebreak" id="page_232"></span><span class="lgreen"><strong>def</strong></span> func_b():
                                        print(<span class="mblue">'B'</span>)
                                    
                                    <span class="lgreen"><strong>class</strong></span> Child(base.Base):
                                        <span class="lgreen"><strong>pass</strong></span></pre>
        </section>
        <section>
          <h3 class="h3" id="ch08lev1sec5">
            8.5 Module Reloading and Unloading
          </h3>
          <p class="noindent">
            There is no reliable support for reloading or unloading of
            previously imported modules. Although you can remove a module from
            <code>sys.modules</code>, this does not unload a module from memory.
            This is because references to the cached module object still exist
            in other modules that imported that module. Moreover, if there are
            instances of classes defined in the module, those instances contain
            references back to their class objects, which in turn hold
            references to the module in which they were defined.
          </p>
          <p class="indent">
            The fact that module references exist in many places makes it
            generally impractical to reload a module after making changes to its
            implementation. For example, if you remove a module from
            <code>sys.modules</code> and use <code>import</code> to reload it,
            this will not retroactively change all of the previous references to
            the module used in a program. Instead, you’ll have one reference to
            the new module created by the most recent
            <code>import</code> statement, and a set of references to the old
            module created by imports in other parts of the code. This is rarely
            what you want. Module reloading is never safe to use in any kind of
            sane production code unless you are able to carefully control the
            entire execution environment.
          </p>
          <p class="indent">
            There is a <code>reload()</code> function for reloading a module
            that can be found in the <code>importlib</code> library. As an
            argument, you pass it the already loaded module. For example:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0232-02" id="f0232-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
&gt;&gt;&gt; import module
                                    &gt;&gt;&gt; import importlib
                                    &gt;&gt;&gt; importlib.reload(module)
                                    loaded module
                                    &lt;module 'module' from 'module.py'&gt;
                                    &gt;&gt;&gt;</pre
          >
          <p class="indent">
            <code>reload()</code> works by loading a new version of the module
            source code and then executing it on top of the already existing
            module namespace. This is done without clearing the previous
            namespace. It’s literally the same as you typing new source code on
            top of the old code without restarting the interpreter.
          </p>
          <p class="indent">
            If other modules had previously imported the reloaded module using a
            standard <code>import</code> statement, such as
            <code>import module</code>, reloading will make them see the updated
            code as if by magic. However, there’s still a lot of peril. First,
            reloading doesn’t reload any of the modules that might be imported
            by the reloaded file. It’s not recursive—it only applies to the
            single module given to <code>reload()</code>. Second, if any module
            has used the <code>from module import name</code> form of import,
            those imports fail to see the effect of the reload. Finally, if
            <span epub:type="pagebreak" id="page_233"></span>instances of
            classes have been created, reloading does not update their
            underlying class definition. In fact, you’ll now have two different
            definitions of the same class in the same program—the old one that
            remains in use for all existing instances at the time of reloading,
            and the new one that gets used for new instances. This is almost
            always confusing.
          </p>
          <p class="indent">
            Finally, it should be noted that C/C++ extensions to Python cannot
            be safely unloaded or reloaded in any way. No support is provided
            for this, and the underlying operating system may prohibit it
            anyways. Your best recourse for that scenario is to restart the
            Python interpreter process.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch08lev1sec6">8.6 Module Compilation</h3>
          <p class="noindent">
            When modules are first imported, they are compiled into an
            interpreter bytecode. This code is written to a
            <code>.pyc</code> file within a special
            <code>__pycache__</code> directory. This directory is usually found
            in the same directory as the original <code>.py</code> file. When
            the same import occurs again on a different run of the program, the
            compiled bytecode is loaded instead. This significantly speeds up
            the import process.
          </p>
          <p class="indent">
            The caching of bytecode is an automatic process that you almost
            never need to worry about. Files are automatically regenerated if
            the original source code changes. It just works.
          </p>
          <p class="indent">
            That said, there are still reasons to know about this caching and
            compilation process. First, sometimes Python files get installed
            (often accidentally) in an environment where users don’t have
            operating system permissions to create the required
            <code>__pycache__</code> directory. Python will still work, but
            every import now loads the original source code and compiles it to
            bytecode. Program loading will be a lot slower than it needs to be.
            Similarly, in deploying or packaging a Python application, it may be
            advantageous to include the compiled bytecode, as that may
            significantly speed up program startup.
          </p>
          <p class="indent">
            The other good reason to know about module caching is that some
            programming techniques interfere with it. Advanced metaprogramming
            techniques involving dynamic code generation and the
            <code>exec()</code> function defeat the benefits of bytecode
            caching. A notable example is the use of dataclasses:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0233-01" id="f0233-01"
              >Click here to view code image</a
            >
          </p>
          <pre>from dataclasses import dataclass
                                    
                                    <span class="wasabi">@dataclass</span>
                                    <span class="lgreen"><strong>class</strong></span> Point:
                                        x: float
                                        y: float</pre>
          <p class="indent">
            Dataclasses work by generating method functions as text fragments
            and executing them using <code>exec()</code>. None of this generated
            code is cached by the import system. For a single class definition,
            you won’t notice. However, if you have a module consisting of 100
            dataclasses, you might find that it imports nearly 20 times slower
            than a comparable module where you just wrote out the classes in the
            normal, if less compact, way.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch08lev1sec7">
            <span epub:type="pagebreak" id="page_234"></span>8.7 The Module
            Search Path
          </h3>
          <p class="noindent">
            When importing modules, the interpreter searches the list of
            directories in <code>sys.path</code>. The first entry in
            <code>sys.path</code> is often an empty string <code>''</code>,
            which refers to the current working directory. Alternatively, if you
            run a script, the first entry in <code>sys.path</code> is the
            directory in which the script is located. The other entries in
            <code>sys.path</code> usually consist of a mix of directory names
            and <code>.zip</code> archive files. The order in which entries are
            listed in <code>sys.path</code> determines the search order used
            when importing modules. To add new entries to the search path, add
            them to this list. This can be done directly or by setting the
            <code>PYTHONPATH</code> environment variable. For example, on UNIX:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0234-01" id="f0234-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="cblue">bash</span> $ env PYTHONPATH=/some/path python3 script.py</pre>
          <p class="indent">
            ZIP archive files are a convenient way to bundle a collection of
            modules into a single file. For example, suppose you created two
            modules, <code>foo.py</code> and <code>bar.py</code>, and placed
            them in a file <code>mymodules.zip</code>. The file could be added
            to the Python search path as follows:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0234-02" id="f0234-02"
              >Click here to view code image</a
            >
          </p>
          <pre>import sys
                                    sys.path.append(<span class="mblue">'mymodules.zip'</span>)
                                    import foo, bar</pre>
          <p class="indent">
            Specific locations within the directory structure of a
            <code>.zip</code> file can also be used for the path. In addition,
            <code>.zip</code> files can be mixed with regular pathname
            components. Here’s an example:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0234-03" id="f0234-03"
              >Click here to view code image</a
            >
          </p>
          <pre>sys.path.append(<span class="mblue">'/tmp/modules.zip/lib/python'</span>)</pre>
          <p class="indent">
            It is not necessary for a ZIP file to have a <code>.zip</code> file
            suffix to be used. Historically, it has been common to encounter
            <code>.egg</code> files on the path as well. <code>.egg</code> files
            originate from an early Python package management tool called
            <code>setuptools</code>. However, an <code>.egg</code> file is
            nothing more than a normal <code>.zip</code> file or directory with
            some extra metadata added to it (version number, dependencies, and
            so on).
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch08lev1sec8">
            8.8 Execution as the Main Program
          </h3>
          <p class="noindent">
            Although this section is about the <code>import</code> statement,
            Python files are often executed as a main script. For example:
          </p>
          <pre><span class="igrey">%</span> python3 module.py</pre>
          <p class="indent">
            Each module contains a variable, <code>__name__</code>, that holds
            the module name. Code can examine this variable to determine the
            module in which they’re executing. The top-level module of the
            interpreter is named <code>__main__</code>. Programs specified on
            the command line or entered interactively run inside the
            <code>__main__</code> module. Sometimes a program may alter its
            behavior, depending on whether it has been imported as a module or
            is running in <code>__main__</code>. For example, a module may
            include code that is executed if the module is used
            <span epub:type="pagebreak" id="page_235"></span>as the main program
            but not executed if the module is simply imported by another module.
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0235-01" id="f0235-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># Check if running as a program</span>
                                    <span class="lgreen"><strong>if</strong></span> <span class="dblue">__name__</span> <span class="igrey">==</span> <span class="mblue">'__main__'</span>:
                                         <span class="hblue"># Yes. Running as the main script</span>
                                         statements
                                    <span class="lgreen"><strong>else</strong></span>:
                                         <span class="hblue"># No, I must have been imported as a module</span>
                                         statements</pre>
          <p class="indent">
            Source files intended for use as libraries can use this technique to
            include optional testing or example code. When developing a module,
            you can put debugging code for testing the features of your library
            inside an <code>if</code> statement as shown, and run Python on your
            module as the main program. That code won’t run for users who import
            your library.
          </p>
          <p class="indent">
            If you’ve made a directory of Python code, you can execute the
            directory if it contains a special <code>__main__.py</code> file.
            For example, if you make a directory like this:
          </p>
          <pre>
myapp/
                                        foo.py
                                        bar.py
                                        __main__.py</pre
          >
          <p class="indent">
            You can run Python on it by typing <code>python3 myapp</code>.
            Execution will start in the <code>__main__.py</code> file. This also
            works if you turn the <code>myapp</code> directory into a ZIP
            archive. Typing <code>python3 myapp.zip</code> will look for a
            top-level <code>__main__.py</code> file and execute it if found.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch08lev1sec9">8.9 Packages</h3>
          <p class="noindent">
            For anything but the simplest programs, Python code is organized
            into <em>packages</em>. A package is a collection of modules that
            are grouped under a common top-level name. This grouping helps
            resolve conflicts between the module names used in different
            applications and keeps your code separate from everyone else’s code.
            A package is defined by creating a directory with a distinctive name
            and placing an initially empty <code>__init__.py</code> file in that
            directory. You then place additional Python files and subpackages in
            this directory as needed. For example, a package might be organized
            as follows:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0235-03" id="f0235-03"
              >Click here to view code image</a
            >
          </p>
          <pre>graphics<span class="igrey">/</span>
                                          <span class="cblue">__init__</span>.py
                                          primitive<span class="igrey">/</span>
                                             <span class="cblue">__init__</span>.py
                                             lines.py
                                             fill.py
                                             text.py
                                             ...
                                    <span epub:type="pagebreak" id="page_236"></span>      graph2d<span class="igrey">/</span>
                                             <span class="cblue">__init__</span>.py
                                             plot2d.py
                                             ...
                                          graph3d<span class="igrey">/</span>
                                             <span class="cblue">__init__</span>.py
                                             plot3d.py
                                             ...
                                          formats<span class="igrey">/</span>
                                             <span class="cblue">__init__</span>.py
                                             gif.py
                                             png.py
                                             tiff.py
                                             jpeg.py</pre>
          <p class="indent">
            The <code>import</code> statement is used to load modules from a
            package the same way as it’s used for simple modules, except that
            you now have longer names. For example:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0236-02" id="f0236-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># Full path</span>
                                    import graphics.primitive.fill
                                    ...
                                    graphics.primitive.fill.floodfill(img, x, y, color)
                                    
                                    <span class="hblue"># Load a specific submodule</span>
                                    from graphics.primitive import fill
                                    ...
                                    fill.floodfill(img, x, y, color)
                                    
                                    <span class="hblue"># Load a specific function from a submodule</span>
                                    from graphics.primitive.fill import floodfill
                                    ...
                                    floodfill(img, x, y, color)</pre>
          <p class="indent">
            Whenever any part of a package is first imported, code in the
            <code>__init__.py</code> file executes first (if it exists). As
            noted, this file may be empty, but it can also contain code to
            perform package-specific initializations. If importing a deeply
            nested submodule, all <code>__init__.py</code> files encountered in
            traversal of the directory structure are executed. Thus, the
            statement <code>import graphics.primitive.fill</code> would first
            execute the <code>__init__.py</code> file in the
            <code>graphics/</code> directory followed by the
            <code>__init__.py</code> file in the
            <code>primitive/</code> directory.
          </p>
          <p class="indent">
            Astute Python users might observe that a package still seems to work
            if <code>__init__.py</code> files are omitted. This is true—you can
            use a directory of Python code as a package even if it contains no
            <code>__init__.py</code>. However, what’s not obvious is that a
            directory with a missing <code>__init__.py</code> file actually
            defines a different kind of package known as
            <em>namespace package</em>. This is an advanced feature sometimes
            used by very large libraries and frameworks to
            <span epub:type="pagebreak" id="page_237"></span>implement broken
            plugin systems. In the opinion of the author, this is rarely what
            you want—you should always create proper
            <code>__init__.py</code> files when creating a package.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch08lev1sec10">8.10 Imports Within a Package</h3>
          <p class="noindent">
            A critical feature of the <code>import</code> statement is that all
            module imports require an absolute or fully qualified package path.
            This includes <code>import</code> statements used within a package
            itself. For example, suppose the
            <code>graphics.primitive.fill</code> module wants to import the
            <code>graphics.primitive.lines</code> module. A simple statement
            such as <code>import lines</code> won’t work—you’ll get an
            <code>ImportError</code> exception. Instead, you need to fully
            qualify the import like this:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0237-01" id="f0237-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># graphics/primitives/fill.py</span>
                                    
                                    <span class="hblue"># Fully qualified submodule import</span>
                                    from graphics.primitives import lines</pre>
          <p class="indent">
            Sadly, writing out a full package name like that is both annoying
            and fragile. For example, sometimes it makes sense to rename a
            package—maybe you want to rename it so that you can use different
            versions. If the package name is hardwired into the code, you can’t
            do that. A better choice is to use a package-relative import like
            this:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0237-02" id="f0237-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># graphics/primitives/fill.py</span>
                                    
                                    <span class="hblue"># Package-relative import</span>
                                    from . import lines</pre>
          <p class="indent">
            Here, the <code>.</code> used in the statement
            <code>from . import lines</code> refers to the same directory as the
            importing module. Thus, this statement looks for a module
            <code>lines</code> in the same directory as the file
            <code>fill.py</code>.
          </p>
          <p class="indent">
            Relative imports can also specify submodules contained in different
            directories of the same package. For example, if the module
            <code>graphics.graph2d.plot2d</code> wants to import
            <code>graphics.primitive.lines</code>, it may use a statement like
            this:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0237-03" id="f0237-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># graphics/graph2d/plot2d.py</span>
                                    
                                    from ..primitive import lines</pre>
          <p class="indent">
            Here, the <code>..</code> moves up one directory level and
            <code>primitive</code> drops down into a different subpackage
            directory.
          </p>
          <p class="indent">
            Relative imports can only be specified using the
            <code>from module import symbol</code> form of the
            <code>import</code> statement. Thus, statements such as
            <code>import ..primitive.lines</code> or
            <code>import .lines</code> are a syntax error. Also,
            <code>symbol</code> has to be a simple identifier, so a statement
            such as <code>from .. import primitive.lines</code> is also illegal.
            Finally, relative imports can only be used from within a package; it
            is illegal to use a relative import to refer to modules that are
            simply located in a different directory on the filesystem.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch08lev1sec11">
            <span epub:type="pagebreak" id="page_238"></span>8.11 Running a
            Package Submodule as a Script
          </h3>
          <p class="noindent">
            Code that’s organized into a package has a different runtime
            environment than a simple script. There is an enclosing package
            name, submodules, and the use of relative imports (which only work
            inside a package). One feature that no longer works is the ability
            to run Python directly on a package source file. For example,
            suppose you are working on the
            <code>graphics/graph2d/plot2d.py</code> file and add some testing
            code at the bottom:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0238-01" id="f0238-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># graphics/graph2d/plot2d.py</span>
                                    from ..primitive import lines, text
                                    
                                    <span class="lgreen"><strong>class</strong></span> Plot2D:
                                        ...
                                    
                                    <span class="lgreen"><strong>if</strong></span> <span class="dblue">__name__</span> <span class="igrey">==</span> <span class="mblue">'__main__'</span>:
                                        print(<span class="mblue">'Testing Plot2D'</span>)
                                        p <span class="igrey">=</span> Plot2D()
                                        ...</pre>
          <p class="indent">
            If you try to run it directly, you get a crash complaining about
            relative import statements:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0238-02" id="f0238-02"
              >Click here to view code image</a
            >
          </p>
          <pre>
bash $ python3 graphics/graph2d/plot2d.py
                                    Traceback (most recent call last):
                                      File "graphics/graph2d/plot2d.py", line 1, in &lt;module&gt;
                                        from ..primitive import line, text
                                    ValueError: attempted relative import beyond top-level package
                                    bash $</pre
          >
          <p class="indent">
            You can’t move into the package directory and run it there either:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0238-03" id="f0238-03"
              >Click here to view code image</a
            >
          </p>
          <pre>
bash $ cd graphics/graph2d/
                                    bash $ python3 plot2d.py
                                    Traceback (most recent call last):
                                      File "plot2d.py", line 1, in &lt;module&gt;
                                        from ..primitive import line, text
                                    ValueError: attempted relative import beyond top-level package
                                    bash $</pre
          >
          <p class="indent">
            To run a submodule as a main script, you need to use the
            <code>-m</code> option to the interpreter. For example:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0238-04" id="f0238-04"
              >Click here to view code image</a
            >
          </p>
          <pre>
bash $ python3 -m graphics.graph2d.plot2d
                                    Testing Plot2D
                                    bash $</pre
          >
          <p class="indent">
            <span epub:type="pagebreak" id="page_239"></span
            ><code>-m</code> specifies a module or package as the main program.
            Python will run the module with the proper environment to make sure
            that imports work. Many of Python’s built-in packages have “secret”
            features that can be used via <code>-m</code>. One of the most
            well-known is using <code>python3 -m http.server</code> to run a web
            server from the current directory.
          </p>
          <p class="indent">
            You can provide similar functionality with your own packages. If the
            name supplied to <code>python -m name</code> corresponds to a
            package directory, Python looks for the presence of a
            <code>__main__.py</code> in that directory and runs that as the
            script.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch08lev1sec12">
            8.12 Controlling the Package Namespace
          </h3>
          <p class="noindent">
            The primary purpose of a package is to serve as a top-level
            container for code. Sometimes users will import the top-level name
            and nothing else. For example:
          </p>
          <pre>import graphics</pre>
          <p class="indent">
            This import doesn’t specify any particular submodule. Nor does it
            make any other part of the package accessible. For example, you’ll
            find that code like this fails:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0239-02" id="f0239-02"
              >Click here to view code image</a
            >
          </p>
          <pre>import graphics
                                    graphics.primitive.fill.floodfill(img,x,y,color)  <span class="hblue"># Fails!</span></pre>
          <p class="indent">
            When only a top-level package import is given, the only file that
            imports is the associated <code>__init__.py</code> file. In this
            example, it’s the file <code>graphics/__init__.py</code> file.
          </p>
          <p class="indent">
            The primary purpose of an <code>__init__.py</code> file is to build
            and/or manage the contents of the top-level package namespace.
            Often, this involves importing selected functions, classes, and
            other objects from lower-level submodules. For example, if the
            <code>graphics</code> package in this example consists of hundreds
            of low-level functions but most of those details are encapsulated
            into a handful of high-level classes, then the
            <code>__init__.py</code> file might choose to expose just those
            classes:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0239-03" id="f0239-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># graphics/__init__.py</span>
                                    
                                    from .graph2d.plot2d import Plot2D
                                    from .graph3d.plot3d import Plot3D</pre>
          <p class="indent">
            With this <code>__init__.py</code> file, the names
            <code>Plot2D</code> and <code>Plot3D</code> would appear at the top
            level of the package. A user could then use those names as if
            <code>graphics</code> were a simple module:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0239-04" id="f0239-04"
              >Click here to view code image</a
            >
          </p>
          <pre>from graphics import Plot2D
                                    plt <span class="igrey">=</span> Plot2D(<span class="sgreen">100</span>, <span class="sgreen">100</span>)
                                    plt.clear()
                                    ...</pre>
          <p class="indent">
            This is often much more convenient for the user because they don’t
            have to know how you’ve actually organized your code. In some sense,
            you’re putting a higher layer of
            <span epub:type="pagebreak" id="page_240"></span>abstraction on top
            of your code structure. Many of the modules in the Python standard
            library are constructed in this manner. For example, the popular
            <code>collections</code> module is actually a package. The
            <code>collections/__init__.py</code> file consolidates definitions
            from a few different places and presents them to the user as a
            single consolidated namespace.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch08lev1sec13">
            8.13 Controlling Package Exports
          </h3>
          <p class="noindent">
            One issue concerns the interaction between an
            <code>__init__.py</code> file and low-level submodules. For example,
            the user of a package might only want to concern themselves with
            objects and functions that live in the top-level package namespace.
            However, the implementor of a package might be concerned with the
            problem of organizing code into maintainable submodules.
          </p>
          <p class="indent">
            To better manage this organizational complexity, package submodules
            often declare an explicit list of exports by defining an
            <code>__all__</code> variable. This is a list of names that should
            be pushed up one level in the package namespace. For example:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0240-01" id="f0240-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># graphics/graph2d/plot2d.py</span>
                                    
                                    __all__ <span class="igrey">=</span> [<span class="mblue">'Plot2D'</span>]
                                    
                                    <span class="lgreen"><strong>class</strong></span> Plot2D:
                                        ...</pre>
          <p class="indent">
            The associated <code>__init__.py</code> file then imports its
            submodules using an <code>*</code> import like this:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0240-02" id="f0240-02"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># graphics/graph2d/__init__.py</span>
                                    
                                    <span class="hblue"># Only loads names explicitly listed in __all__ variables</span>
                                    from .plot2d import <span class="igrey">*</span>
                                    
                                    <span class="hblue"># Propagate the __all__ up to next level (if desired)</span>
                                    __all__ <span class="igrey">=</span> plot2d.__all__</pre>
          <p class="indent">
            This lifting process then continues all the way to the top-level
            package <code>__init__.py</code>. for example:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0240-03" id="f0240-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># graphics/__init__.py</span>
                                    from .graph2d import <span class="igrey">*</span>
                                    from .graph3d import <span class="igrey">*</span>
                                    
                                    <span class="hblue"># Consolidate exports</span>
                                    __all__ <span class="igrey">=</span> [
                                        <span class="igrey">*</span>graph2d.__all__,
                                    <span epub:type="pagebreak" id="page_241"></span>    <span class="igrey">*</span>graph3d.__all__
                                    ]</pre>
          <p class="indent">
            The gist is that every component of a package explicitly states its
            exports using the <code>__all__</code> variable. The
            <code>__init__.py</code> files then propagate the exports upwards.
            In practice, it can get complicated, but this approach avoids the
            problem of hard-wiring specific export names into the
            <code>__init__.py</code> file. Instead, if a submodule wants to
            export something, its name gets listed in just one place—the
            <code>__all__</code> variable. Then, by magic, it propagates up to
            its proper place in the package namespace.
          </p>
          <p class="indent">
            It is worth noting that although using <code>*</code> imports in
            user code is frowned upon, it is widespread practice in package
            <code>__init__.py</code> files. The reason it works in packages is
            that it is usually much more controlled and contained—being driven
            by the contents of the <code>__all__</code> variables and not a
            free-wheeling attitude of “let’s just import everything.”
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch08lev1sec14">8.14 Package Data</h3>
          <p class="noindent">
            Sometimes a package includes data files that need to be loaded (as
            opposed to source code). Within a package, the
            <code>__file__</code> variable will give you location information
            about a specific source file. However, packages are complicated.
            They might be bundled within ZIP archive files or loaded from
            unusual environments. The <code>__file__</code> variable itself
            might be unreliable or even undefined. As a result, loading a data
            file is often not a simple matter of passing a filename to the
            built-in <code>open()</code> function and reading some data.
          </p>
          <p class="indent">
            To read package data, use
            <code>pkgutil.get_data(package, resource)</code>. For example, is
            your package looks like this:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0241-02" id="f0241-02"
              >Click here to view code image</a
            >
          </p>
          <pre>mycode<span class="igrey">/</span>
                                        resources<span class="igrey">/</span>
                                            data.json
                                        <span class="cblue">__init__</span>.py
                                        spam.py
                                        yow.py</pre>
          <p class="indent">
            To load the file <code>data.json</code> from the file
            <code>spam.py</code>, do this:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0241-03" id="f0241-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># mycode/spam.py</span>
                                    import pkgutil
                                    import json
                                    
                                    <span class="lgreen"><strong>def</strong></span> func():
                                        rawdata <span class="igrey">=</span> pkgutil.get_data(__package__,
                                                                   <span class="mblue">'resources/data.json'</span>)
                                        textdata <span class="igrey">=</span> rawdata.decode(<span class="mblue">'utf-8'</span>)
                                        data <span class="igrey">=</span> json.loads(textdata)
                                        print(data)</pre>
          <p class="indent">
            <span epub:type="pagebreak" id="page_242"></span>The
            <code>get_data()</code> function attempts to find the specified
            resource and returns its contents as a raw byte string. The
            <code>__package__</code> variable shown in the example is a string
            holding the name of the enclosing package. Any further decoding
            (such as converting bytes to text) and interpretation is up to you.
            In the example, the data is decoded and parsed from JSON into a
            Python dictionary.
          </p>
          <p class="indent">
            A package is not a good place to store giant data files. Reserve
            package resources for configuration data and other assorted bits of
            stuff needed to make your package work.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch08lev1sec15">8.15 Module Objects</h3>
          <p class="noindent">
            Modules are first-class objects.
            <a href="ch08.xhtml#ch08tab01">Table 8.1</a> lists attributes
            commonly found on modules.
          </p>
          <figure class="table" id="ch08tab01">
            <figcaption>
              <p class="tab-caption">
                <span class="ash">Table 8.1</span> Module Attributes
              </p>
            </figcaption>
            <table>
              <thead>
                <tr>
                  <th><p class="tabtext">Attribute</p></th>
                  <th><p class="tabtext">Description</p></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="tabtext"><code>__name__</code></p>
                  </td>
                  <td><p class="tabtext">Full module name</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__doc__</code></p>
                  </td>
                  <td><p class="tabtext">Documentation string</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__dict__</code></p>
                  </td>
                  <td><p class="tabtext">Module dictionary</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__file__</code></p>
                  </td>
                  <td><p class="tabtext">Filename where defined</p></td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__package__</code></p>
                  </td>
                  <td>
                    <p class="tabtext">Name of enclosing package (if any)</p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__path__</code></p>
                  </td>
                  <td>
                    <p class="tabtext">
                      List of subdirectories to search for submodules of a
                      package.
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="tabtext"><code>__annotations__</code></p>
                  </td>
                  <td><p class="tabtext">Module-level type hints</p></td>
                </tr>
              </tbody>
            </table>
          </figure>
          <p class="indent">
            The <code>__dict__</code> attribute is a dictionary that represents
            the module namespace. Everything that’s defined in the module is
            placed here.
          </p>
          <p class="indent">
            The <code>__name__</code> attribute is often used in scripts. A
            check such as <code>if __name__ == '__main__'</code> is often done
            to see if a file is running as a standalone program.
          </p>
          <p class="indent">
            The <code>__package__</code> attribute contains the name of the
            enclosing package if any. If set, the
            <code>__path__</code> attribute is a list of directories that will
            be searched to locate package submodules. Normally, it contains a
            single entry with the directory in which a package is located.
            Sometimes large frameworks will manipulate <code>__path__</code> to
            incorporate additional directories for the purpose of supporting
            plugins and other advanced features.
          </p>
          <p class="indent">
            Not all attributes are available on all modules. For example,
            built-in modules may not have a <code>__file__</code> attribute set.
            Similarly, package-related attributes are not set for top-level
            modules (not contained in a package).
          </p>
          <p class="indent">
            The <code>__doc__</code> attribute is the module doc string (if
            any). This is a string that appears as the first statement in a
            file. The <code>__annotations__</code> attribute is a dictionary of
            module-level type hints. These look something like this:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0242-01" id="f0242-01"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># mymodule.py</span>
                                    
                                    <span class="hblue">'''</span>
                                    <span epub:type="pagebreak" id="page_243"></span><span class="hblue">The doc string</span>
                                    <span class="hblue">'''</span>
                                    
                                    
                                    <span class="hblue"># Type hints (placed into __annotations__)</span>
                                    x: int
                                    y: float
                                    ...</pre>
          <p class="indent">
            As with other type hints, module-level hints change no part of
            Python’s behavior, nor do they actually define variables. They are
            purely metadata that other tools can choose to look at if they want.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch08lev1sec16">8.16 Deploying Python Packages</h3>
          <p class="noindent">
            The final frontier of modules and packages is the problem of giving
            your code to others. This is a large topic that has been the focus
            of active ongoing development over many years. I won’t try to
            document a process that’s bound to be out-of-date by the time you
            read this. Instead, direct your attention to the documentation at
            <code
              ><a
                href="https://packaging.python.org/tutorials/packaging-projects"
                >https://packaging.python.org/tutorials/packaging-projects</a
              ></code
            >.
          </p>
          <p class="indent">
            For the purposes of day-to-day development, the most important thing
            is to keep your code isolated as a self-contained project. All of
            your code should live in a proper package. Try to give your package
            a unique name so that it doesn’t conflict with other possible
            dependencies. Consult the Python package index at
            <code><a href="https://pypi.org">https://pypi.org</a></code> to pick
            a name. In structuring your code, try to keep things simple. As
            you’ve seen, there are many highly sophisticated things that can be
            done with the module and package system. There is a time and place
            for that, but it should not be your starting point.
          </p>
          <p class="indent">
            With absolute simplicity in mind, the most minimalistic way to
            distribute pure Python code is to use the
            <code>setuptools</code> module or the built-in
            <code>distutils</code> module. Suppose you have written some code
            and it’s in a project that looks like this:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0243-02" id="f0243-02"
              >Click here to view code image</a
            >
          </p>
          <pre>spam<span class="igrey">-</span>project<span class="igrey">/</span>
                                         README.txt
                                         Documentation.txt
                                         spam<span class="igrey">/</span>              <span class="hblue"># A package of code</span>
                                             <span class="cblue">__init__</span>.py
                                             foo.py
                                             bar.py
                                         runspam.py         <span class="hblue"># A script to run as: python runspam.py</span></pre>
          <p class="indent">
            To create a distribution, create a file <code>setup.py</code> in the
            topmost directory (<code>spam-project/</code> in this example). In
            this file, put the following code:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0243-03" id="f0243-03"
              >Click here to view code image</a
            >
          </p>
          <pre><span class="hblue"># setup.py</span>
                                    from setuptools import setup
                                    
                                    setup(name <span class="igrey">=</span> <span class="mblue">"spam"</span>,
                                    <span epub:type="pagebreak" id="page_244"></span>            version <span class="igrey">=</span> <span class="mblue">"0.0"</span>
                                                packages <span class="igrey">=</span> [<span class="mblue">'spam'</span>],
                                                scripts <span class="igrey">=</span> [<span class="mblue">'runspam.py'</span>],
                                                )</pre>
          <p class="indent">
            In the <code>setup()</code> call, <code>packages</code> is a list of
            all package directories, and <code>scripts</code> is a list of
            script files. Any of these arguments may be omitted if your software
            does not have them (for example, if there are no scripts).
            <code>name</code> is the name of your package, and
            <code>version</code> is the version number as a string. The call to
            <code>setup()</code> supports a variety of other parameters that
            supply various metadata about your package. See the full list at
            <code
              ><a href="https://docs.python.org/3/distutils/apiref.html"
                >https://docs.python.org/3/distutils/apiref.html</a
              ></code
            >.
          </p>
          <p class="indent">
            Creating a <code>setup.py</code> file is enough to create a source
            distribution of your software. Type the following shell command to
            make a source distribution:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0244-03" id="f0244-03"
              >Click here to view code image</a
            >
          </p>
          <pre>
bash $ python setup.py sdist
                                    ...
                                    bash $</pre
          >
          <p class="indent">
            This creates an archive file, such as
            <code>spam-1.0.tar.gz</code> or <code>spam-1.0.zip</code>, in the
            directory <code>spam/dist</code>. This is the file you would give to
            others to install your software. To install, a user can use a
            command such as <code>pip</code>. For example:
          </p>
          <p class="codelink">
            <a href="ch08_images.xhtml#rf0244-04" id="f0244-04"
              >Click here to view code image</a
            >
          </p>
          <pre>shell $ python3 -m pip install spam-1.0.tar.gz</pre>
          <p class="indent">
            This installs the software into the local Python distribution and
            makes it available for general use. The code will normally be
            installed into a directory called <code>site-packages</code> in the
            Python library. To find the exact location of this directory,
            inspect the value of <code>sys.path</code>. Scripts are normally
            installed into the same directory as the Python interpreter itself.
          </p>
          <p class="indent">
            If the first line of a script starts with <code>#!</code> and
            contains the text <code>python</code>, the installer will rewrite
            the line to point to the local installation of Python. Thus, if your
            scripts have been hardcoded to a specific Python location, such as
            <code>/usr/local/bin/python</code>, they should still work when
            installed on other systems where Python is in a different location.
          </p>
          <p class="indent">
            It must be stressed that the use of <code>setuptools</code> as
            described here is absolutely minimal. Larger projects may involve
            C/C++ extensions, complicated package structures, examples, and
            more. Covering all of the tools and possible ways to deploy such
            code is beyond the scope of this book. You should consult various
            resources on
            <code><a href="https://python.org">https://python.org</a></code> and
            <code><a href="https://pypi.org">https://pypi.org</a></code> for the
            most up-to-date advice.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch08lev1sec17">
            8.17 The Penultimate Word: Start with a Package
          </h3>
          <p class="noindent">
            When first starting a new program, it is easy to start with a simple
            single Python file. For example, you might write a script called
            <code>program.py</code> and start with that. Although this will work
            fine for throwaway programs and short tasks, your “script” may start
            growing <span epub:type="pagebreak" id="page_245"></span>and adding
            features. Eventually, you might want to split it into multiple
            files. It’s at that point that problems often arise.
          </p>
          <p class="indent">
            In light of this, it makes sense to get in the habit of starting all
            programs as a package from the onset. For example, instead of making
            a file called <code>program.py</code>, you should make a program
            package directory called <code>program</code>:
          </p>
          <pre>
program/
                                        __init__.py
                                        __main__.py</pre
          >
          <p class="indent">
            Put your starting code in <code>__main__.py</code> and run your
            program using a command such as <code>python -m program</code>. As
            you need more code, add new files to your package and use
            package-relative imports. An advantage of using a package is that
            all of your code remains isolated. You can name the files whatever
            you want and not worry about collisions with other packages,
            standard library modules, or code written by your coworkers.
            Although setting up a package requires a bit more work at the start,
            it will likely save you a lot of headaches later.
          </p>
        </section>
        <section>
          <h3 class="h3" id="ch08lev1sec18">
            8.18 The Final Word: Keep It Simple
          </h3>
          <p class="noindent">
            There is a lot of more advanced wizardry associated with the module
            and package system than what has been shown here. Consult the
            tutorial “Modules and Packages: Live and Let Die!” at
            <code
              ><a href="https://dabeaz.com/modulepackage/index.html"
                >https://dabeaz.com/modulepackage/index.html</a
              ></code
            >
            to get an idea of what’s possible.
          </p>
          <p class="indent">
            All things considered, however, you’re probably better off
            <em>not</em> doing any advanced module hacking. Managing modules,
            packages, and software distribution has always been a source of pain
            in the Python community. Much of the pain is a direct consequence of
            people applying hacks to the module system. Don’t do that. Keep it
            simple and find the power to just say “no” when your coworkers
            propose to modify <code>import</code> to work with the
            blockchain.<span epub:type="pagebreak" id="page_246"></span>
          </p>
        </section>
      </section>
    </div>
    <div id="sbo-rt-content"><section epub:type="chapter">
        <h2 class="h2" id="ch09"><span epub:type="pagebreak" id="page_247"></span><span class="ash">9.</span> Input and Output</h2>
        <p class="noindent">Input and output (I/O) is part of all programs. This chapter describes the essentials of Python I/O including data encoding, command-line options, environment variables, file I/O, and data serialization. Particular attention is given to programming techniques and abstractions that encourage proper I/O handling. The end of this chapter gives an overview of common standard library modules related to I/O.</p>
        <section>
        <h3 class="h3" id="ch09lev1sec1">9.1 Data Representation</h3>
        <p class="noindent">The main problem of I/O is the outside world. To communicate with it, data must be properly represented, so that it can be manipulated. At the lowest level, Python works with two fundamental datatypes: <em>bytes</em> that represent raw uninterpreted data of any kind and <em>text</em> that represents Unicode characters.</p>
        <p class="indent">To represent bytes, two built-in types are used, <code>bytes</code> and <code>bytearray</code>. <code>bytes</code> is an immutable string of integer byte values. <code>bytearray</code> is a mutable byte array that behaves as a combination of a byte string and a list. Its mutability makes it suitable for building up groups of bytes in a more incremental manner, as when assembling data from fragments. The following example illustrates a few features of <code>bytes</code> and <code>bytearray</code>:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0247-01" id="f0247-01">Click here to view code image</a></p>
        <pre><span class="hblue"># Specify a bytes literal (note: b' prefix)</span>
        a <span class="igrey">=</span> b<span class="mblue">'hello'</span>
        
        <span class="hblue"># Specify bytes from a list of integers</span>
        b <span class="igrey">=</span> bytes([<span class="sgreen">0x68</span>, <span class="sgreen">0x65</span>, <span class="sgreen">0x6c</span>, <span class="sgreen">0x6c</span>, <span class="sgreen">0x6f</span>])
        
        <span class="hblue"># Create and populate a bytearray from parts</span>
        c <span class="igrey">=</span> bytearray()
        c.extend(b<span class="mblue">'world'</span>)   <span class="hblue"># d = 'world'</span>
        c.append(<span class="sgreen">0x21</span>)       <span class="hblue"># d = 'world!'</span>
        
        <span class="hblue"># Access byte values</span>
        print(a[<span class="sgreen">0</span>])     <span class="hblue"># --&gt; prints 104</span>
        
        <span epub:type="pagebreak" id="page_248"></span><span class="lgreen"><strong>for</strong></span> x <span class="lgreen"><strong>in</strong></span> b:     <span class="hblue"># Outputs 104 101 108 108 111</span>
           print(x)</pre>
        <p class="indent">Accessing individual elements of <code>byte</code> and <code>bytearray</code> objects produces integer byte values, not single-character byte strings. This is different from text strings, so it is a common usage error.</p>
        <p class="indent">Text is represented by the <code>str</code> datatype and stored as an array of Unicode code points. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0248-02" id="f0248-02">Click here to view code image</a></p>
        <pre>d <span class="igrey">=</span> <span class="mblue">'hello'</span>     <span class="hblue"># Text (Unicode)</span>
        len(d)          <span class="hblue"># --&gt; 5</span>
        print(d[<span class="sgreen">0</span>])     <span class="hblue"># prints 'h'</span></pre>
        <p class="indent">Python maintains a strict separation between bytes and text. There is never automatic conversion between the two types, comparisons between these types evaluate as <code>False</code>, and any operation that mixes bytes and text together results in an error. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0248-03" id="f0248-03">Click here to view code image</a></p>
        <pre>a <span class="igrey">=</span> b<span class="mblue">'hello'</span>     <span class="hblue"># bytes</span>
        b <span class="igrey">=</span> <span class="mblue">'hello'</span>      <span class="hblue"># text</span>
        c <span class="igrey">=</span> <span class="mblue">'world'</span>      <span class="hblue"># text</span>
        
        print(a <span class="igrey">==</span> b)    <span class="hblue"># -&gt; False</span>
        d <span class="igrey">=</span> a <span class="igrey">+</span> c        <span class="hblue"># TypeError: can't concat str to bytes</span>
        e <span class="igrey">=</span> b <span class="igrey">+</span> c        <span class="hblue"># -&gt; 'helloworld' (both are strings)</span></pre>
        <p class="indent">When performing I/O, make sure you’re working with the right kind of data representation. If you are manipulating text, use text strings. If you are manipulating binary data, use bytes.</p>
        </section>
        <section>
        <h3 class="h3" id="ch09lev1sec2">9.2 Text Encoding and Decoding</h3>
        <p class="noindent">If you work with text, all data read from input must be decoded and all data written to output must be encoded. For explicit conversion between text and bytes, there are <code>encode(text [,errors])</code> and <code>decode(bytes [,errors])</code> methods on text and bytes objects, respectively. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0248-04" id="f0248-04">Click here to view code image</a></p>
        <pre>a <span class="igrey">=</span> <span class="mblue">'hello'</span>             <span class="hblue"># Text</span>
        b <span class="igrey">=</span> a.encode(<span class="mblue">'utf-8'</span>)   <span class="hblue"># Encode to bytes</span>
        
        c <span class="igrey">=</span> b<span class="mblue">'world'</span>            <span class="hblue"># Bytes</span>
        d <span class="igrey">=</span> c.decode(<span class="mblue">'utf-8'</span>)   <span class="hblue"># Decode to text</span></pre>
        <p class="indent">Both <code>encode()</code> and <code>decode()</code> require the name of an encoding such as <code>'utf-8'</code> or <code>'latin-1'</code>. The encodings in <a href="ch09.xhtml#ch09tab01">Table 9.1</a> are common.<span epub:type="pagebreak" id="page_249"></span></p>
        <figure class="table" id="ch09tab01">
        <figcaption><p class="tab-caption"><span class="ash">Table 9.1</span> Common Encodings</p></figcaption>
        <table>
        <thead>
        <tr>
        <th><p class="tabtext">Encoding Name</p></th>
        <th><p class="tabtext">Description</p></th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p class="tabtext"><code>'ascii'</code></p></td>
        <td><p class="tabtext">Character values in the range [0x00, 0x7f].</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>'latin1'</code></p></td>
        <td><p class="tabtext">Character values in the range [0x00, 0xff]. Also known as <code>'iso-8859-1'</code>.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>'utf-8'</code></p></td>
        <td><p class="tabtext">Variable-length encoding that allows all Unicode characters to be represented.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>'cp1252'</code></p></td>
        <td><p class="tabtext">A common text encoding on Windows.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>'macroman'</code></p></td>
        <td><p class="tabtext">A common text encoding on Macintosh.</p></td>
        </tr>
        </tbody>
        </table>
        </figure>
        <p class="indent">Additionally, the encoding methods accept an optional <code>errors</code> argument that specifies behavior in the presence of encoding errors. It is one of the values in <a href="ch09.xhtml#ch09tab02">Table 9.2</a>.</p>
        <figure class="table" id="ch09tab02">
        <figcaption><p class="tab-caption"><span class="ash">Table 9.2</span> Error Handling Options</p></figcaption>
        <table>
        <thead>
        <tr>
        <th><p class="tabtext">Value</p></th>
        <th><p class="tabtext">Description</p></th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p class="tabtext"><code>'strict'</code></p></td>
        <td><p class="tabtext">Raises a <code>UnicodeError</code> exception for encoding and decoding errors (the default).</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>'ignore'</code></p></td>
        <td><p class="tabtext">Ignores invalid characters.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>'replace'</code></p></td>
        <td><p class="tabtext">Replaces invalid characters with a replacement character (U+FFFD in Unicode, <code>b'?'</code> in bytes).</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>'backslashreplace'</code></p></td>
        <td><p class="tabtext">Replaces each invalid character with a Python character escape sequence. For example, the character U+1234 is replaced by <code>'\u1234'</code> (encoding only).</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>'xmlcharrefreplace'</code></p></td>
        <td><p class="tabtext">Replaces each invalid character with an XML character reference. For example, the character U+1234 is replaced by <code>'&amp;#4660;'</code> (encoding only).</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>'surrogateescape'</code></p></td>
        <td><p class="tabtext">Replaces any invalid byte <code>'\xhh'</code> with U+DChh on decoding, replaces U+DChh with byte <code>'\xhh'</code> on encoding.</p></td>
        </tr>
        </tbody>
        </table>
        </figure>
        <p class="indent">The <code>'backslashreplace'</code> and <code>'xmlcharrefreplace'</code> error policies represent unrepresentable characters in a form that allows them to be viewed as simple ASCII text or as XML character references. This can be useful for debugging.</p>
        <p class="indent">The <code>'surrogateescape'</code> error handling policy allows degenerate byte data—data that does not follow the expected encoding rules—to survive a roundtrip decoding/encoding cycle intact regardless of the text encoding being used. Specifically, <code>s.decode(enc, 'surrogateescape').encode(enc, 'surrogateescape') == s</code>. This round-trip preservation of data is useful for certain kinds of system interfaces where a text encoding is expected but can’t be guaranteed due to issues outside of Python’s control. Instead of destroying data with a bad encoding, Python embeds it “as is” using surrogate encoding. Here’s an example of this behavior with a improperly encoded UTF-8 string:<span epub:type="pagebreak" id="page_250"></span></p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0250-01" id="f0250-01">Click here to view code image</a></p>
        <pre>&gt;&gt;&gt; a = b'Spicy Jalape\xf1o'   # Invalid UTF-8
        &gt;&gt;&gt; a.decode('utf-8')
        Traceback (most recent call last):
          File "&lt;stdin&gt;", line 1, in &lt;module&gt;
        UnicodeDecodeError: 'utf-8' codec can't decode byte 0xf1
        in position 12: invalid continuation byte
        &gt;&gt;&gt; a.decode('utf-8', 'surrogateescape')
        'Spicy Jalape\udcf1o'
        &gt;&gt;&gt; # Encode the resulting string back into bytes
        &gt;&gt;&gt; _.encode('utf-8', 'surrogateescape')
        b'Spicy Jalape\xf1o'
        &gt;&gt;&gt;</pre>
        </section>
        <section>
        <h3 class="h3" id="ch09lev1sec3">9.3 Text and Byte Formatting</h3>
        <p class="noindent">A common problem when working with text and byte strings is string conversions and formatting—for example, converting a floating-point number to a string with a given width and precision. To format a single value, use the <code>format()</code> function:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0250-02" id="f0250-02">Click here to view code image</a></p>
        <pre>x <span class="igrey">=</span> <span class="sgreen">123.456</span>
        format(x, <span class="mblue">'0.2f'</span>)       <span class="hblue"># '123.46'</span>
        format(x, <span class="mblue">'10.4f'</span>)      <span class="hblue"># '  123.4560'</span>
        format(x, <span class="mblue">'&lt;*10.2f'</span>)    <span class="hblue"># '123.46****'</span></pre>
        <p class="indent">The second argument to <code>format()</code> is a format specifier. The general format of the specifier is <code>[[fill[align]][sign][0][width][,][.precision][type]</code> where each part enclosed in <code>[]</code> is optional. The <code>width</code> specifies the minimum field width to use, and the align specifier is one of <code>&lt;</code>, <code>&gt;</code>, or <code>^</code> for left, right, and centered alignment within the field. An optional fill character <code>fill</code> is used to pad the space. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0250-03" id="f0250-03">Click here to view code image</a></p>
        <pre>name <span class="igrey">=</span> <span class="mblue">'Elwood'</span>
        r <span class="igrey">=</span> format(name, <span class="mblue">'&lt;10'</span>)     <span class="hblue"># r = 'Elwood    '</span>
        r <span class="igrey">=</span> format(name, <span class="mblue">'&gt;10'</span>)     <span class="hblue"># r = '    Elwood'</span>
        r <span class="igrey">=</span> format(name, <span class="mblue">'^10'</span>)     <span class="hblue"># r = '  Elwood  '</span>
        r <span class="igrey">=</span> format(name, <span class="mblue">'*^10'</span>)    <span class="hblue"># r = '**Elwood**'</span></pre>
        <p class="indent">The <code>type</code> specifier indicates the type of data. <a href="ch09.xhtml#ch09tab03">Table 9.3</a> lists the supported format codes. If not supplied, the default format code is <code>s</code> for strings, <code>d</code> for integers, and <code>f</code> for floats.<span epub:type="pagebreak" id="page_251"></span></p>
        <figure class="table" id="ch09tab03">
        <figcaption><p class="tab-caption"><span class="ash">Table 9.3</span> Format Codes</p></figcaption>
        <table>
        <thead>
        <tr>
        <th><p class="tabtext">Character</p></th>
        <th><p class="tabtext">Output Format</p></th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p class="tabtext"><code>d</code></p></td>
        <td><p class="tabtext">Decimal integer or long integer.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>b</code></p></td>
        <td><p class="tabtext">Binary integer or long integer.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>o</code></p></td>
        <td><p class="tabtext">Octal integer or long integer.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>x</code></p></td>
        <td><p class="tabtext">Hexadecimal integer or long integer.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>X</code></p></td>
        <td><p class="tabtext">Hexadecimal integer (uppercase letters).</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>f</code>, <code>F</code></p></td>
        <td><p>Floating point as [-]m.dddddd.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>e</code></p></td>
        <td><p class="tabtext">Floating point as [-]m.dddddde±xx.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>E</code></p></td>
        <td><p class="tabtext">Floating point as [-]m.ddddddE±xx.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>g</code>, <code>G</code></p></td>
        <td><p class="tabtext">Use <code>e</code> or <code>E</code> for exponents less than [nd]4 or greater than the precision; otherwise use <code>f</code>.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>n</code></p></td>
        <td><p class="tabtext">Same as <code>g</code> except that the current locale setting determines the decimal point character.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>%</code></p></td>
        <td><p class="tabtext">Multiplies a number by 100 and displays it using <code>f</code> format followed by a % sign.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>s</code></p></td>
        <td><p class="tabtext">String or any object. The formatting code uses <code>str()</code> to generate strings.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>c</code></p></td>
        <td><p class="tabtext">Single character.</p></td>
        </tr>
        </tbody>
        </table>
        </figure>
        <p class="indent">The sign part of a format specifier is one of <code>+</code>, <code>-</code>, or a space. A <code>+</code> indicates that a leading sign should be used on all numbers. A <code>-</code> is the default and only adds a sign character for negative numbers. A space adds a leading space to positive numbers.</p>
        <p class="indent">An optional comma (<code>,</code>) may appear between the width and the precision. This adds a thousands separator character. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0251-01" id="f0251-01">Click here to view code image</a></p>
        <pre>x <span class="igrey">=</span> <span class="sgreen">123456.78</span>
        format(x, <span class="mblue">'16,.2f'</span>)   <span class="hblue"># '      123,456.78'</span></pre>
        <p class="indent">The <code>precision</code> part of the specifier supplies the number of digits of accuracy to use for decimals. If a leading <code>0</code> is added to the field <code>width</code> for numbers, numeric values are padded with leading 0s to fill the space. Here are some examples of formatting different kinds of numbers:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0251-02" id="f0251-02">Click here to view code image</a></p>
        <pre>x <span class="igrey">=</span> <span class="sgreen">42</span>
        r <span class="igrey">=</span> format(x, <span class="mblue">'10d'</span>)        <span class="hblue"># r = '        42'</span>
        r <span class="igrey">=</span> format(x, <span class="mblue">'10x'</span>)        <span class="hblue"># r = '        2a'</span>
        r <span class="igrey">=</span> format(x, <span class="mblue">'10b'</span>)        <span class="hblue"># r = '    101010'</span>
        r <span class="igrey">=</span> format(x, <span class="mblue">'010b'</span>)       <span class="hblue"># r = '0000101010'</span>
        
        y <span class="igrey">=</span> <span class="sgreen">3.1415926</span>
        r <span class="igrey">=</span> format(y, <span class="mblue">'10.2f'</span>)      <span class="hblue"># r = '      3.14'</span>
        r <span class="igrey">=</span> format(y, <span class="mblue">'10.2e'</span>)      <span class="hblue"># r = '  3.14e+00'</span>
        r <span class="igrey">=</span> format(y, <span class="mblue">'+10.2f'</span>)     <span class="hblue"># r = '     +3.14'</span>
        r <span class="igrey">=</span> format(y, <span class="mblue">'+010.2f'</span>)    <span class="hblue"># r = '+000003.14'</span>
        r <span class="igrey">=</span> format(y, <span class="mblue">'+10.2%'</span>)     <span class="hblue"># r = '  +314.16%'</span></pre>
        <p class="indent">For more complex string formatting, you can use f-strings:</p>
        <pre>x <span class="igrey">=</span> <span class="sgreen">123.456</span></pre>
        <p class="codelink"><a href="ch09_images.xhtml#rf0252-01" id="f0252-01">Click here to view code image</a></p>
        <pre><span epub:type="pagebreak" id="page_252"></span><span class="trose">f'Value is</span> <span class="mblue">{x:0.2f}</span><span class="trose">'</span>        <span class="hblue"># 'Value is 123.46'</span>
        <span class="trose">f'Value is</span> <span class="mblue">{x:10.4f}</span><span class="trose">'</span>       <span class="hblue"># 'Value is   123.4560'</span>
        <span class="trose">f'Value is</span> <span class="mblue">{</span><span class="sgreen">2</span><span class="igrey">*</span><span class="mblue">x:*&lt;10.2f}</span><span class="trose">'</span>   <span class="hblue"># 'Value is 246.91****'</span></pre>
        <p class="indent">Within an f-string, text of the form <code>{expr:spec}</code> is replaced by the value of <code>format(expr, spec)</code>. <code>expr</code> can be an arbitrary expression as long as it doesn’t include <code>{</code>, <code>}</code>, or <code>\</code> characters. Parts of the format specifier itself can optionally be supplied by other expressions. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0252-02" id="f0252-02">Click here to view code image</a></p>
        <pre>y <span class="igrey">=</span> <span class="sgreen">3.1415926</span>
        width <span class="igrey">=</span> <span class="sgreen">8</span>
        precision<span class="igrey">=</span><span class="sgreen">3</span>
        
        r <span class="igrey">=</span> <span class="trose">f'</span><span class="mblue">{y:</span>{width}<span class="mblue">.</span>{precision}<span class="mblue">f}</span><span class="trose">'</span>   <span class="hblue"># r = '   3.142'</span></pre>
        <p class="indent">If you end <code>expr</code> by <code>=</code>, then the literal text of <code>expr</code> is also included in the result. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0252-03" id="f0252-03">Click here to view code image</a></p>
        <pre>x <span class="igrey">=</span> <span class="sgreen">123.456</span>
        
        <span class="trose">f'</span><span class="mblue">{x</span><span class="igrey">=</span><span class="mblue">:0.2f}</span><span class="trose">'</span>        <span class="hblue"># 'x=123.46'</span>
        <span class="trose">f'</span><span class="mblue">{</span><span class="sgreen">2</span><span class="igrey">*</span><span class="mblue">x</span><span class="igrey">=</span><span class="mblue">:0.2f}</span><span class="trose">'</span>      <span class="hblue"># '2*x=246.91'</span></pre>
        <p class="indent">If you append <code>!r</code> to a value, formatting is applied to the output of <code>repr()</code>. If you use <code>!s</code>, formatting is applied to the output of <code>str()</code>. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0252-04" id="f0252-04">Click here to view code image</a></p>
        <pre><span class="trose">f'</span><span class="mblue">{x</span><span class="igrey">!</span><span class="mblue">r:</span>spec<span class="mblue">}</span><span class="trose">'</span>      <span class="hblue"># Calls (repr(x).__format__('spec'))</span>
        <span class="trose">f'</span><span class="mblue">{x</span><span class="igrey">!</span><span class="mblue">s:</span>spec<span class="mblue">}</span><span class="trose">'</span>      <span class="hblue"># Calls (str(x).__format__('spec'))</span></pre>
        <p class="indent">As an alternative to f-strings, you can use the <code>.format()</code> method of strings:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0252-05" id="f0252-05">Click here to view code image</a></p>
        <pre>x <span class="igrey">=</span> <span class="sgreen">123.456</span>
        
        <span class="hblue">'Value is {:0.2f}'</span> .format(x)            <span class="hblue"># 'Value is 123.46'</span>
        <span class="hblue">'Value is {0:10.2f}'</span> .format(x)          <span class="hblue"># 'Value is   123.4560'</span>
        <span class="hblue">'Value is {val:&lt;*10.2f}'</span> .format(val<span class="igrey">=</span>x)  <span class="hblue"># 'Value is 123.46****'</span></pre>
        <p class="indent">With a string formatted by <code>.format()</code>, text of the form <code>{arg:spec}</code> is replaced by the value of <code>format(arg, spec)</code>. In this case, <code>arg</code> refers to one of the arguments given to the <code>format()</code> method. If omitted entirely, the arguments are taken in order. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0252-06" id="f0252-06">Click here to view code image</a></p>
        <pre>name <span class="igrey">=</span> <span class="mblue">'IBM'</span>
        shares <span class="igrey">=</span> <span class="sgreen">50</span>
        price <span class="igrey">=</span> <span class="sgreen">490.1</span>
        
        r <span class="igrey">=</span> <span class="mblue">'{:&gt;10s} {:10d} {:10.2f}'</span>.format(name, shares, price)
        <span class="hblue"># r = '       IBM         50     490.10'</span></pre>
        <p class="indent"><code>arg</code> can also refer to a specific argument number or name. For example:<span epub:type="pagebreak" id="page_253"></span></p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0253-01" id="f0253-01">Click here to view code image</a></p>
        <pre>tag <span class="igrey">=</span> <span class="mblue">'p'</span>
        text <span class="igrey">=</span> <span class="mblue">'hello world'</span>
        
        r <span class="igrey">=</span> <span class="mblue">'&lt;{0}&gt;{1}&lt;/{0}&gt;'</span>.format(tag, text)  <span class="hblue"># r = '&lt;p&gt;hello world&lt;/p&gt;'</span>
        r <span class="igrey">=</span> <span class="mblue">'&lt;{tag}&gt;{text}&lt;/{tag}&gt;'</span>.format(tag<span class="igrey">=</span><span class="mblue">'p'</span>, text<span class="igrey">=</span><span class="mblue">'hello world'</span>)</pre>
        <p class="indent">Unlike f-strings, the <code>arg</code> value of a specifier cannot be an arbitrary expression, so it’s not quite as expressive. However, the <code>format()</code> method can perform limited attribute lookup, indexing, and nested substitutions. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0253-02" id="f0253-02">Click here to view code image</a></p>
        <pre>y <span class="igrey">=</span> <span class="sgreen">3.1415926</span>
        width <span class="igrey">=</span> <span class="sgreen">8</span>
        precision<span class="igrey">=</span><span class="sgreen">3</span>
        
        r <span class="igrey">=</span> <span class="mblue">'Value is {0:{1}.{2}f}'</span>.format(y, width, precision)
        
        d <span class="igrey">=</span> {
           <span class="mblue">'name'</span>: <span class="mblue">'IBM'</span>,
           <span class="mblue">'shares'</span>: <span class="sgreen">50</span>,
           <span class="mblue">'price'</span>: <span class="sgreen">490.1</span>
        }
        r <span class="igrey">=</span> <span class="mblue">'{0[shares]:d} shares of {0[name]} at {0[price]:0.2f}'</span>.format(d)
        <span class="hblue"># r = '50 shares of IBM at 490.10'</span></pre>
        <p class="indent"><code>bytes</code> and <code>bytearray</code> instances can be formatted using the <code>%</code> operator. The semantics of this operator are modeled after the <code>sprintf()</code> function from C. Here are some examples:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0253-03" id="f0253-03">Click here to view code image</a></p>
        <pre>name <span class="igrey">=</span> b<span class="mblue">'ACME'</span>
        x <span class="igrey">=</span> <span class="sgreen">123.456</span>
        
        b<span class="mblue">'Value is %0.2f'</span> <span class="igrey">%</span> x             <span class="hblue"># b'The value is 123.46'</span>
        bytearray(b<span class="mblue">'Value is %0.2f'</span>) <span class="igrey">%</span> x  <span class="hblue"># b'Value is 123.46'</span>
        b<span class="mblue">'%s = %0.2f'</span> <span class="igrey">%</span> (name, x)         <span class="hblue"># b'ACME = 123.46'</span></pre>
        <p class="indent">With this formatting, sequences of the form <code>%spec</code> are replaced in order with values from a tuple provided as the second operand to the <code>%</code> operator. The basic format codes (<code>d</code>, <code>f</code>, <code>s</code>, etc.) are the same as those used for the <code>format()</code> function. However, more advanced features are either missing or changed slightly. For example, to adjust alignment, you use a <code>-</code> character like this:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0253-04" id="f0253-04">Click here to view code image</a></p>
        <pre>x <span class="igrey">=</span> <span class="sgreen">123.456</span>
        b<span class="mblue">'%10.2f'</span> <span class="igrey">%</span> x     <span class="hblue"># b'    123.46'</span>
        b<span class="mblue">'%-10.2f'</span> <span class="igrey">%</span> x    <span class="hblue"># b'123.46    '</span></pre>
        <p class="indent">Using a format code of <code>%r</code> produces the output of <code>ascii()</code> which can be useful in debugging and logging.</p>
        <p class="indent"><span epub:type="pagebreak" id="page_254"></span>When working with bytes, be aware that text strings are not supported. They need to be explicitly encoded.</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0254-01" id="f0254-01">Click here to view code image</a></p>
        <pre>name <span class="igrey">=</span> <span class="mblue">'Dave'</span>
        
        b<span class="mblue">'Hello %s'</span> <span class="igrey">%</span> name                    <span class="hblue"># TypeError!</span>
        b<span class="mblue">'Hello %s'</span> <span class="igrey">%</span> name.encode(<span class="mblue">'utf-8'</span>)    <span class="hblue"># Ok</span></pre>
        <p class="indent">This form of formatting can also be used with text strings, but it’s considered to be an older programming style. However, it still arises in certain libraries. For example, messages produced by the <code>logging</code> module are formatted in this way:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0254-02" id="f0254-02">Click here to view code image</a></p>
        <pre>import logging
        log <span class="igrey">=</span> logging.getLogger(<span class="dblue">__name__</span>)
        
        log.debug(<span class="mblue">'%s got %d'</span>, name, value)  <span class="hblue"># '%s got %d' % (name, value)</span></pre>
        <p class="indent">The <code>logging</code> module is briefly described later in this chapter in <a href="ch09.xhtml#ch09lev2sec22">Section 9.15.12</a>.</p>
        </section>
        <section>
        <h3 class="h3" id="ch09lev1sec4">9.4 Reading Command-Line Options</h3>
        <p class="noindent">When Python starts, command-line options are placed in the list <code>sys.argv</code> as text strings. The first item is the name of the program. Subsequent items are the options added on the command line after the program name. The following program is a minimal prototype of manually processing command-line arguments:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0254-03" id="f0254-03">Click here to view code image</a></p>
        <pre><span class="lgreen"><strong>def</strong></span> main(argv):
            <span class="lgreen"><strong>if</strong></span> len(argv) <span class="igrey">!=</span> <span class="sgreen">3</span>:
                <span class="lgreen"><strong>raise</strong></span> <span class="pgold">SystemExit</span>(
                      <span class="trose">f'Usage : python</span> <span class="mblue">{</span>argv[<span class="sgreen">0</span>]<span class="mblue">}</span> <span class="trose">inputfile outputfile</span><span class="mblue">\n</span><span class="trose">'</span>)
            inputfile  <span class="igrey">=</span> argv[<span class="sgreen">1</span>]
            outputfile <span class="igrey">=</span> argv[<span class="sgreen">2</span>]
            ...
        
        <span class="lgreen"><strong>if</strong></span> <span class="dblue">__name__</span> <span class="igrey">==</span> <span class="mblue">'__main__'</span>:
            import sys
            main(sys.argv)</pre>
        <p class="indent">For better code organization, testing, and similar reasons, it’s a good idea to write a dedicated <code>main()</code> function that accepts the command-line options (if any) as a list, as opposed to directly reading <code>sys.argv</code>. Include a small fragment of code at the end of your program to pass the command-line options to your <code>main()</code> function.</p>
        <p class="indent"><span epub:type="pagebreak" id="page_255"></span><code>sys.argv[0]</code> contains the name of the script being executed. Writing a descriptive help message and raising <code>SystemExit</code> is standard practice for command-line scripts that want to report an error.</p>
        <p class="indent">Although in simple scripts, you can manually process command options, consider using the <code>argparse</code> module for more complicated command-line handling. Here is an example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0255-01" id="f0255-01">Click here to view code image</a></p>
        <pre>import argparse
        
        <span class="lgreen"><strong>def</strong></span> main(argv):
            p <span class="igrey">=</span> argparse.ArgumentParser(description<span class="igrey">=</span><span class="mblue">"This is some program"</span>)
        
            <span class="hblue"># A positional argument</span>
            p.add_argument(<span class="mblue">"infile"</span>)
        
            <span class="hblue"># An option taking an argument</span>
            p.add_argument(<span class="mblue">"-o"</span>,<span class="mblue">"--output"</span>, action<span class="igrey">=</span><span class="mblue">"store"</span>)
        
            <span class="hblue"># An option that sets a boolean flag</span>
            p.add_argument(<span class="mblue">"-d"</span>,<span class="mblue">"--debug"</span>, action<span class="igrey">=</span><span class="mblue">"store_true"</span>, default<span class="igrey">=</span><span class="dblue">False</span>)
        
            <span class="hblue"># Parse the command line</span>
            args <span class="igrey">=</span> p.parse_args(args<span class="igrey">=</span>argv)
        
            <span class="hblue"># Retrieve the option settings</span>
            infile    <span class="igrey">=</span> args.infile
            output    <span class="igrey">=</span> args.output
            debugmode <span class="igrey">=</span> args.debug
        
            print(infile, output, debugmode)
        
        <span class="lgreen"><strong>if</strong></span> <span class="dblue">__name__</span> <span class="igrey">==</span> <span class="mblue">'__main__'</span>:
            import sys
            main(sys.argv[<span class="sgreen">1</span>:])</pre>
        <p class="indent">This example only shows the most simple use of the <code>argparse</code> module. The standard library documentation provides more advanced usage. There are also third-party modules such as <code>click</code> and <code>docopt</code> that can simplify writing of more complex command-line parsers.</p>
        <p class="indent">Finally, command-line options might be provided to Python in an invalid text encoding. Such arguments are still accepted but they will be encoded using <code>'surrogateescape'</code> error handling as described in <a href="ch09.xhtml#ch09lev1sec2">Section 9.2</a>. You need to be aware of this if such arguments are later included in any kind of text output and it’s critical to avoid crashing. It might not be critical, though—don’t overcomplicate your code for edge cases that don’t matter.</p>
        </section>
        <section>
        <h3 class="h3" id="ch09lev1sec5"><span epub:type="pagebreak" id="page_256"></span>9.5 Environment Variables</h3>
        <p class="noindent">Sometimes data is passed to a program via environment variables set in the command shell. For example, a Python program might be launched using a shell command such as <code>env</code>:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0256-01" id="f0256-01">Click here to view code image</a></p>
        <pre>bash $ env SOMEVAR=somevalue python3 somescript.py</pre>
        <p class="indent">Environment variables are accessed as text strings in the mapping <code>os.environ</code>. Here’s an example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0256-02" id="f0256-02">Click here to view code image</a></p>
        <pre>import os
        path <span class="igrey">=</span> os.environ[<span class="mblue">'PATH'</span>]
        user <span class="igrey">=</span> os.environ[<span class="mblue">'USER'</span>]
        editor <span class="igrey">=</span> os.environ[<span class="mblue">'EDITOR'</span>]
        val <span class="igrey">=</span> os.environ[<span class="mblue">'SOMEVAR'</span>]
        ... etc ...</pre>
        <p class="indent">To modify environment variables, set the <code>os.environ</code> variable. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0256-03" id="f0256-03">Click here to view code image</a></p>
        <pre>os.environ[<span class="mblue">'NAME'</span>] <span class="igrey">=</span> <span class="mblue">'VALUE'</span></pre>
        <p class="indent">Modifications to <code>os.environ</code> affect both the running program and any subprocesses created later—for example, those created by the <code>subprocess</code> module.</p>
        <p class="indent">As with command-line options, badly encoded environment variables may produce strings that use the <code>'surrogateescape'</code> error handling policy.</p>
        </section>
        <section>
        <h3 class="h3" id="ch09lev1sec6">9.6 Files and File Objects</h3>
        <p class="noindent">To open a file, use the built-in <code>open()</code> function. Usually, <code>open()</code> is given a filename and a file mode. It is also often used in combination with the <code>with</code> statement as a context manager. Here are some common usage patterns of working with files:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0256-04" id="f0256-04">Click here to view code image</a></p>
        <pre><span class="hblue"># Read a text file all at once as a string</span>
        <span class="lgreen"><strong>with</strong></span> open(<span class="mblue">'filename.txt'</span>, <span class="mblue">'rt'</span>) as file:
            data <span class="igrey">=</span> file.read()
        
        <span class="hblue"># Read a file line-by-line</span>
        <span class="lgreen"><strong>with</strong></span> open(<span class="mblue">'filename.txt'</span>, <span class="mblue">'rt'</span>) as file:
            <span class="lgreen"><strong>for</strong></span> line <span class="lgreen"><strong>in</strong></span> file:
                ...
        
        <span class="hblue"># Write to a text file</span>
        <span class="lgreen"><strong>with</strong></span> open(<span class="mblue">'out.txt'</span>, <span class="mblue">'wt'</span>) as file:
            file.write(<span class="mblue">'Some output\n'</span>)
            print(<span class="mblue">'More output'</span>, file<span class="igrey">=</span>file)</pre>
        <p class="indent"><span epub:type="pagebreak" id="page_257"></span>In most cases, using <code>open()</code> is a straightforward affair. You give it the name of the file you want to open along with a file mode. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0257-01" id="f0257-01">Click here to view code image</a></p>
        <pre>open(<span class="mblue">'name.txt'</span>)        <span class="hblue"># Opens "name.txt" for reading</span>
        open(<span class="mblue">'name.txt'</span>, <span class="mblue">'rt'</span>)  <span class="hblue"># Opens "name.txt" for reading (same)</span>
        open(<span class="mblue">'name.txt'</span>, <span class="mblue">'wt'</span>)  <span class="hblue"># Opens "name.txt" for writing</span>
        open(<span class="mblue">'data.bin'</span>, <span class="mblue">'rb'</span>)  <span class="hblue"># Binary mode read</span>
        open(<span class="mblue">'data.bin'</span>, <span class="mblue">'wb'</span>)  <span class="hblue"># Binary mode write</span></pre>
        <p class="indent">For most programs, you will never need to know more than these simple examples to work with files. However, there are a number of special cases and more esoteric features of <code>open()</code> worth knowing. The next few sections discuss <code>open()</code> and file I/O in more detail.</p>
        <section>
        <h4 class="h4" id="ch09lev2sec1">9.6.1 Filenames</h4>
        <p class="noindent">To open a file, you need to give <code>open()</code> the name of the file. The name can either be a fully specified absolute pathname such as <code>'/Users/guido/Desktop/files/old/data.csv'</code> or a relative pathname such as <code>'data.csv'</code> or <code>'..\old\data.csv'</code>. For relative filenames, the file location is determined relative to the current working directory as returned by <code>os.getcwd()</code>. The current working directory can be changed with <code>os.chdir(newdir)</code>.</p>
        <p class="indent">The name itself can be encoded in a number of forms. If it’s a text string, the name is interpreted according to the text encoding returned by <code>sys.getfilesystemencoding()</code> before being passed to the host operating system. If the filename is a byte string, it is left unencoded and is passed as is. This latter option may be useful if you’re writing programs that must handle the possibility of degenerate or miscoded filenames—instead of passing the filename as text, you can pass the raw binary representation of the name. This might seem like an obscure edge case, but Python is commonly used to write system-level scripts that manipulate the filesystem. Abuse of the filesystem is a common technique used by hackers to either hide their tracks or to break system tools.</p>
        <p class="indent">In addition to text and bytes, any object that implements the special method <code>__fspath__()</code> can be used as a name. The <code>__fspath__()</code> method must return a text or bytes object corresponding to the actual name. This is the mechanism that makes standard library modules such as <code>pathlib</code> work. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0257-02" id="f0257-02">Click here to view code image</a></p>
        <pre>&gt;&gt;&gt; from pathlib import Path
        &gt;&gt;&gt; p = Path('Data/portfolio.csv')
        &gt;&gt;&gt; p.__fspath__()
        'Data/portfolio.csv'
        &gt;&gt;&gt;</pre>
        <p class="indent">Potentially, you could make your own custom <code>Path</code> object that worked with <code>open()</code> as long as it implements <code>__fspath__()</code> in a way that resolves to a proper filename on the system.</p>
        <p class="indent">Finally, filenames can be given as low-level integer file descriptors. This requires that the “file” is already open on the system in some way. Perhaps it corresponds to a network socket, a pipe, or some other system resource that exposes a file descriptor. Here is an <span epub:type="pagebreak" id="page_258"></span>example of opening a file directly with the <code>os</code> module and then turning it into a proper file object:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0258-01" id="f0258-01">Click here to view code image</a></p>
        <pre>&gt;&gt;&gt; import os
        &gt;&gt;&gt; fd = os.open('/etc/passwd', os.O_RDONLY)
        &gt;&gt;&gt; fd
        3
        &gt;&gt;&gt; file = open(fd, 'rt')
        &gt;&gt;&gt; file
        &lt;_io.TextIOWrapper name=3 mode='rt' encoding='UTF-8'&gt;
        &gt;&gt;&gt; data = file.read()
        &gt;&gt;&gt;</pre>
        <p class="indent">When opening an existing file descriptor like this, the <code>close()</code> method of the returned file will also close the underlying descriptor. This can be disabled by passing <code>closefd=False</code> to <code>open()</code>. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0258-02" id="f0258-02">Click here to view code image</a></p>
        <pre>file <span class="igrey">=</span> open(fd, <span class="mblue">'rt'</span>, closefd<span class="igrey">=</span><span class="dblue">False</span>)</pre>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec2">9.6.2 File Modes</h4>
        <p class="noindent">When opening a file, you need to specify a file mode. The core file modes are <code>'r'</code> for reading, <code>'w'</code> for writing, and <code>'a'</code> for appending. <code>'w'</code> mode replaces any existing file with new content. <code>'a'</code> opens a file for writing and positions the file pointer to the end of the file so that new data can be appended.</p>
        <p class="indent">A special file mode of <code>'x'</code> can be used to write to a file, but only if it doesn’t exist already. This is a useful way to prevent accidental overwriting of existing data. For this mode, a <code>FileExistsError</code> exception is raised if the file already exists.</p>
        <p class="indent">Python makes a strict distinction between text and binary data. To specify the kind of data, you append a <code>'t'</code> or a <code>'b'</code> to the file mode. For example, a file mode of <code>'rt'</code> opens a file for reading in text mode and <code>'rb'</code> opens a file for reading in binary mode. The mode determines the kind of data returned by file-related methods such as <code>f.read()</code>. In text mode, strings are returned. In binary mode, bytes are returned.</p>
        <p class="indent">Binary files can be opened for in-place updates by supplying a plus (<code>+</code>) character, such as <code>'rb+'</code> or <code>'wb+'</code>. When a file is opened for update, you can perform both input and output, as long as all output operations flush their data before any subsequent input operations. If a file is opened using <code>'wb+'</code> mode, its length is first truncated to zero. A common use of the update mode is to provide random read/write access to file contents in combination with seek operations.</p>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec3">9.6.3 I/O Buffering</h4>
        <p class="noindent">By default, files are opened with I/O buffering enabled. With I/O buffering, I/O operations are performed in larger chunks to avoid excessive system calls. For example, <span epub:type="pagebreak" id="page_259"></span>write operations would start filling an internal memory buffer and output would only actually occur when the buffer is filled up. This behavior can be changed by giving a <code>buffering</code> argument to <code>open()</code>. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0259-01" id="f0259-01">Click here to view code image</a></p>
        <pre><span class="hblue"># Open a binary-mode file with no I/O buffering</span>
        
        <span class="lgreen"><strong>with</strong></span> open(<span class="mblue">'data.bin'</span>, <span class="mblue">'wb'</span>, buffering<span class="igrey">=</span><span class="sgreen">0</span>) as file:
            file.write(data)
            ...</pre>
        <p class="indent">A value of <code>0</code> specifies unbuffered I/O and is only valid for binary mode files. A value of <code>1</code> specifies line-buffering and is usually only meaningful for text-mode files. Any other positive value indicates the buffer size to use (in bytes). If no buffering value is specified, the default behavior depends on the kind of file. If it’s a normal file on disk, buffering is managed in blocks and the buffer size is set to <code>io.DEFAULT_BUFFER_SIZE</code>. Typically this is some small multiple of 4096 bytes. It might vary by system. If the file represents an interactive terminal, line buffering is used.</p>
        <p class="indent">For normal programs, I/O buffering is not typically a major concern. However, buffering can have an impact on applications involving active communication between processes. For example, a problem that sometimes arises is two communicating subprocesses that deadlock due to an internal buffering issue—for instance, one process writes into a buffer, but a receiver never sees that data because the buffer didn’t get flushed. Such problems can be fixed by either specifying unbuffered I/O or by an explicit <code>flush()</code> call on the associated file. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0259-02" id="f0259-02">Click here to view code image</a></p>
        <pre>file.write(data)
        file.write(data)
        ...
        file.flush()       <span class="hblue"># Make sure all data is written from buffers</span></pre>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec4">9.6.4 Text Mode Encoding</h4>
        <p class="noindent">For files opened in text mode, an optional encoding and an error-handling policy can be specified using the <code>encoding</code> and <code>errors</code> arguments. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0259-03" id="f0259-03">Click here to view code image</a></p>
        <pre><span class="lgreen"><strong>with</strong></span> open(<span class="mblue">'file.txt'</span>, <span class="mblue">'rt'</span>,
                  encoding<span class="igrey">=</span><span class="mblue">'utf-8'</span>, errors<span class="igrey">=</span><span class="mblue">'replace'</span>) as file:
            data <span class="igrey">=</span> file.read()</pre>
        <p class="indent">The values given to the <code>encoding</code> and <code>errors</code> argument have the same meaning as for the <code>encode()</code> and <code>decode()</code> methods of strings and bytes respectively.</p>
        <p class="indent">The default text encoding is determined by the value of <code>sys.getdefaultencoding()</code> and may vary by system. If you know the encoding in advance, it’s often better to explicitly provide it even if it happens to match the default encoding on your system.</p>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec5"><span epub:type="pagebreak" id="page_260"></span>9.6.5 Text-Mode Line Handling</h4>
        <p class="noindent">With text files, one complication is the encoding of newline characters. Newlines are encoded as <code>'\n'</code>, <code>'\r\n'</code>, or <code>'\r'</code> depending on the host operating system—for example, <code>'\n'</code> on UNIX and <code>'\r\n'</code> on Windows. By default, Python translates all of these line endings to a standard <code>'\n'</code> character when reading. On writing, newline characters are translated back to the default line ending used on the system. The behavior is sometimes referred to as “universal newline mode” in Python documentation.</p>
        <p class="indent">You can change the newline behavior by giving a <code>newline</code> argument to <code>open()</code>. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0260-01" id="f0260-01">Click here to view code image</a></p>
        <pre><span class="hblue"># Exactly require '\r\n' and leave intact</span>
        file <span class="igrey">=</span> open(<span class="mblue">'somefile.txt'</span>, <span class="mblue">'rt'</span>, newline<span class="igrey">=</span><span class="mblue">'\r\n'</span>)</pre>
        <p class="indent">Specifying <code>newline=None</code> enables the default line handling behavior where all line endings are translated to a standard <code>'\n'</code> character. Giving <code>newline=''</code> makes Python recognize all line endings, but disables the translation step—if lines were terminated by <code>'\r\n'</code>, the <code>'\r\n'</code> combination would be left in the input intact. Specifying a value of <code>'\n'</code>, <code>'\r'</code>, or <code>'\r\n'</code> makes that the expected line ending.</p>
        </section>
        </section>
        <section>
        <h3 class="h3" id="ch09lev1sec7">9.7 I/O Abstraction Layers</h3>
        <p class="noindent">The <code>open()</code> function serves as a kind of high-level factory function for creating instances of different I/O classes. These classes embody the different file modes, encodings, and buffering behaviors. They are also composed together in layers. The following classes are defined in the <code>io</code> module:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0260-02" id="f0260-02">Click here to view code image</a></p>
        <pre>FileIO(filename, mode='r', closefd=True, opener=None)</pre>
        <p class="indent1">Opens a file for raw unbuffered binary I/O. <code>filename</code> is any valid filename accepted by the <code>open()</code> function. Other arguments have the same meaning as for <code>open()</code>.</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0260-03" id="f0260-03">Click here to view code image</a></p>
        <pre>BufferedReader(file [, buffer_size])
        BufferedWriter(file [, buffer_size])
        BufferedRandom(file,[, buffer_size])</pre>
        <p class="indent1">Implements a buffered binary I/O layer for a file. <code>file</code> is an instance of <code>FileIO</code>. <code>buffer_size</code> specifies the internal buffer size to use. The choice of class depends on whether or not the file is reading, writing, or updating data. The optional <code>buffer_size</code> argument specifies the internal buffer size used.</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0260-04" id="f0260-04">Click here to view code image</a></p>
        <pre>TextIOWrapper(buffered, [encoding, [errors [, newline [, line_buffering [, write_through]]]]])</pre>
        <p class="indent1">Implements text mode I/O. <code>buffered</code> is a buffered binary mode file, such as <code>BufferedReader</code> or <code>BufferedWriter</code>. The <code>encoding</code>, <code>errors</code>, and <code>newline</code> arguments have the same meaning as for <code>open()</code>. <code>line_buffering</code> is a Boolean flag that forces I/O to be flushed on newline characters (<code>False</code> by default). <code>write_through</code> is a Boolean flag that forces all writes to be flushed (<code>False</code> by default).</p>
        <p class="indent"><span epub:type="pagebreak" id="page_261"></span>Here is an example that shows how a text-mode file is constructed, layer-by-layer:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0261-01" id="f0261-01">Click here to view code image</a></p>
        <pre>&gt;&gt;&gt; raw = io.FileIO('filename.txt', 'r')        # Raw-binary mode
        &gt;&gt;&gt; buffer = io.BufferedReader(raw)      # Binary buffered reader
        &gt;&gt;&gt; file = io.TextIOWrapper(buffer, encoding='utf-8') # Text mode
        &gt;&gt;&gt;</pre>
        <p class="indent">Normally you don’t need to manually construct layers like this—the built-in <code>open()</code> function takes care of all of the work. However, if you already have an existing file object and want to change its handling in some way, you might manipulate the layers as shown.</p>
        <p class="indent">To strip layers away, use the <code>detach()</code> method of a file. For example, here is how you can convert an already text-mode file into a binary-mode file:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0261-02" id="f0261-02">Click here to view code image</a></p>
        <pre>f <span class="igrey">=</span> open(<span class="mblue">'something.txt'</span>, <span class="mblue">'rt'</span>)  <span class="hblue"># Text-mode file</span>
        fb <span class="igrey">=</span> f.detach()                  <span class="hblue"># Detach underlying binary mode file</span>
        data <span class="igrey">=</span> fb.read()                 <span class="hblue"># Returns bytes</span></pre>
        <section>
        <h4 class="h4" id="ch09lev2sec6">9.7.1 File Methods</h4>
        <p class="noindent">The exact type of object returned by <code>open()</code> depends on the combination of file mode and buffering options provided. However, the resulting file object supports the methods in <a href="ch09.xhtml#ch09tab04">Table 9.4</a>.</p>
        <figure class="table" id="ch09tab04">
        <figcaption><p class="tab-caption"><span class="ash">Table 9.4</span> File Methods</p></figcaption>
        <table>
        <thead>
        <tr>
        <th><p class="tabtext">Method</p></th>
        <th><p class="tabtext">Description</p></th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p class="tabtext"><code>f.readable()</code></p></td>
        <td><p class="tabtext">Returns <code>True</code> if file can be read.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>f.read([n])</code></p></td>
        <td><p class="tabtext">Reads at most <code>n</code> bytes.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>f.readline([n])</code></p></td>
        <td><p class="tabtext">Reads a single line of input up to <code>n</code> characters. If <code>n</code> is omitted, this method reads the entire line.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>f.readlines([size])</code></p></td>
        <td><p class="tabtext">Reads all the lines and returns a list. <code>size</code> optionally specifies the approximate number of characters to read on the file before stopping.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>f.readinto(buffer)</code></p></td>
        <td><p class="tabtext">Reads data into a memory buffer.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>f.writable()</code></p></td>
        <td><p class="tabtext">Returns <code>True</code> if file can be written.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>f.write(s)</code></p></td>
        <td><p class="tabtext">Writes string <code>s</code>.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>f.writelines(lines)</code></p></td>
        <td><p class="tabtext">Writes all strings in iterable <code>lines</code>.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>f.close()</code></p></td>
        <td><p class="tabtext">Closes the file.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>f.seekable()</code></p></td>
        <td><p class="tabtext">Returns <code>True</code> if file supports random-access seeking.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>f.tell()</code></p></td>
        <td><p class="tabtext">Returns the current file pointer.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>f.seek(offset [, where])</code></p></td>
        <td><p class="tabtext">Seeks to a new file position.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>f.isatty()</code></p></td>
        <td><p class="tabtext">Returns <code>True</code> if <code>f</code> is an interactive terminal.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>f.flush()</code></p></td>
        <td><p class="tabtext">Flushes the output buffers.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>f.truncate([size])</code></p></td>
        <td><p class="tabtext">Truncates the file to at most <code>size</code> bytes.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>f.fileno()</code></p></td>
        <td><p class="tabtext">Returns an integer file descriptor.</p></td>
        </tr>
        </tbody>
        </table>
        </figure>
        <p class="indent"><span epub:type="pagebreak" id="page_262"></span>The <code>readable()</code>, <code>writable()</code>, and <code>seekable()</code> methods test for supported file capabilities and modes. The <code>read()</code> method returns the entire file as a string unless an optional length parameter specifies the maximum number of characters. The <code>readline()</code> method returns the next line of input, including the terminating newline; the <code>readlines()</code> method returns all the input file as a list of strings. The <code>readline()</code> method optionally accepts a maximum line length, <code>n</code>. If a line longer than <code>n</code> characters is read, the first <code>n</code> characters are returned. The remaining line data is not discarded and will be returned on subsequent read operations. The <code>readlines()</code> method accepts a <code>size</code> parameter that specifies the approximate number of characters to read before stopping. The actual number of characters read may be larger than this depending on how much data has been buffered already. The <code>readinto()</code> method is used to avoid memory copies and is discussed later.</p>
        <p class="indent"><code>read()</code> and <code>readline()</code> indicate end-of-file (EOF) by returning an empty string. Thus, the following code shows how you can detect an EOF condition:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0262-01" id="f0262-01">Click here to view code image</a></p>
        <pre><span class="lgreen"><strong>while</strong></span> <span class="dblue">True</span>:
            line <span class="igrey">=</span> file.readline()
            <span class="lgreen"><strong>if not</strong></span> line:        <span class="hblue"># EOF</span>
                <span class="lgreen"><strong>break</strong></span>
            statements
            ...</pre>
        <p class="indent">You could also write this code as follows:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0262-01a" id="f0262-01a">Click here to view code image</a></p>
        <pre><span class="lgreen"><strong>while</strong></span> (line:<span class="igrey">=</span>file.readline()):
            statements
            ...</pre>
        <p class="indent">A convenient way to read all lines in a file is to use iteration with a <code>for</code> loop:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0262-02" id="f0262-02">Click here to view code image</a></p>
        <pre><span class="lgreen"><strong>for</strong></span> line <span class="lgreen"><strong>in</strong></span> file:    <span class="hblue"># Iterate over all lines in the file</span>
            <span class="hblue"># Do something with line</span>
            ...</pre>
        <p class="indent">The <code>write()</code> method writes data to the file, and the <code>writelines()</code> method writes an iterable of strings to the file. <code>write()</code> and <code>writelines()</code> do not add newline characters to the output, so all output that you produce should already include all necessary formatting.</p>
        <p class="indent">Internally, each open file object keeps a file pointer that stores the byte offset at which the next read or write operation will occur. The <code>tell()</code> method returns the current value of the file pointer. The <code>seek(offset [,whence])</code> method is used to randomly access parts of a file given an integer offset and a placement rule in <code>whence</code>. If <code>whence</code> is <code>os.SEEK_SET</code> (the default), <code>seek()</code> assumes that offset is relative to the start of the file; if <code>whence</code> is <code>os.SEEK_CUR</code>, the position is moved relative to the current position; and if <code>whence</code> is <code>os.SEEK_END</code>, the offset is taken from the end of the file.</p>
        <p class="indent">The <code>fileno()</code> method returns the integer file descriptor for a file and is sometimes used in low-level I/O operations in certain library modules. For example, the <code>fcntl</code> module uses the file descriptor to provide low-level file control operations on UNIX systems.</p>
        <p class="indent"><span epub:type="pagebreak" id="page_263"></span>The <code>readinto()</code> method is used to perform zero-copy I/O into contiguous memory buffers. It is most commonly used in combination with specialized libraries such as <code>numpy</code> —for example, to read data directly into the memory allocated for a numeric array .</p>
        <p class="indent">File objects also have the read-only data attributes shown in <a href="ch09.xhtml#ch09tab05">Table 9.5</a>.</p>
        <figure class="table" id="ch09tab05">
        <figcaption><p class="tab-caption"><span class="ash">Table 9.5</span> File Attributes</p></figcaption>
        <table>
        <thead>
        <tr>
        <th><p class="tabtext">Attribute</p></th>
        <th><p class="tabtext">Description</p></th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p class="tabtext"><code>f.closed</code></p></td>
        <td><p class="tabtext">Boolean value indicates the file state: <code>False</code> if the file is open, <code>True</code> if closed.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>f.mode</code></p></td>
        <td><p class="tabtext">The I/O mode for the file.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>f.name</code></p></td>
        <td><p class="tabtext">Name of the file if created using <code>open()</code>. Otherwise, it will be a string indicating the source of the file.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>f.newlines</code></p></td>
        <td><p class="tabtext">The newline representation actually found in the file. The value is either <code>None</code> if no newlines have been encountered, a string containing <code>'\n'</code>, <code>'\r'</code>, or <code>'\r\n'</code>, or a tuple containing all the different newline encodings seen.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>f.encoding</code></p></td>
        <td><p class="tabtext">A string that indicates file encoding, if any (for example, <code>'latin-1'</code> or <code>'utf-8'</code>). The value is <code>None</code> if no encoding is being used.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>f.errors</code></p></td>
        <td><p class="tabtext">The error handling policy.</p></td>
        </tr>
        <tr>
        <td><p class="tabtext"><code>f.write_through</code></p></td>
        <td><p class="tabtext">Boolean value indicating if writes on a text file pass data directly to the underlying binary level file without buffering.</p></td>
        </tr>
        </tbody>
        </table>
        </figure>
        </section>
        </section>
        <section>
        <h3 class="h3" id="ch09lev1sec8">9.8 Standard Input, Output, and Error</h3>
        <p class="noindent">The interpreter provides three standard file-like objects, known as standard input, standard output, and standard error, available as <code>sys.stdin</code>, <code>sys.stdout</code>, and <code>sys.stderr</code>, respectively. <code>stdin</code> is a file object corresponding to the stream of input characters supplied to the interpreter, <code>stdout</code> is the file object that receives output produced by <code>print()</code>, and <code>stderr</code> is a file that receives error messages. More often than not, <code>stdin</code> is mapped to the user’s keyboard, whereas <code>stdout</code> and <code>stderr</code> produce text on screen.</p>
        <p class="indent">The methods described in the preceding section can be used to perform I/O with the user. For example, the following code writes to standard output and reads a line of input from standard input:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0263-01" id="f0263-01">Click here to view code image</a></p>
        <pre>import sys
        sys.stdout.write(<span class="mblue">"Enter your name : "</span>)
        name <span class="igrey">=</span> sys.stdin.readline()</pre>
        <p class="indent">Alternatively, the built-in function <code>input(prompt)</code> can read a line of text from <code>stdin</code> and optionally print a prompt:<span epub:type="pagebreak" id="page_264"></span></p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0264-01" id="f0264-01">Click here to view code image</a></p>
        <pre>name <span class="igrey">=</span> input(<span class="mblue">"Enter your name : "</span>)</pre>
        <p class="indent">Lines read by <code>input()</code> do not include the trailing newline. This is different than reading directly from <code>sys.stdin</code> where newlines are included in the input text.</p>
        <p class="indent">If necessary, the values of <code>sys.stdout</code>, <code>sys.stdin</code>, and <code>sys.stderr</code> can be replaced with other file objects, in which case the <code>print()</code> and <code>input()</code> functions will use the new values. Should it ever be necessary to restore the original value of <code>sys.stdout</code>, it should be saved first. The original values of <code>sys.stdout</code>, <code>sys.stdin</code>, and <code>sys.stderr</code> at interpreter startup are also available in <code>sys.__stdout__</code>, <code>sys.__stdin__</code>, and <code>sys.__stderr__</code>, respectively.</p>
        </section>
        <section>
        <h3 class="h3" id="ch09lev1sec9">9.9 Directories</h3>
        <p class="noindent">To get a directory listing, use the <code>os.listdir(pathname)</code> function. For example, here is how to print out a list of filenames in a directory:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0264-02" id="f0264-02">Click here to view code image</a></p>
        <pre>import os
        
        names <span class="igrey">=</span> os.listdir(<span class="mblue">'dirname'</span>)
        <span class="lgreen"><strong>for</strong></span> name <span class="lgreen"><strong>in</strong></span> names:
            print(name)</pre>
        <p class="indent">Names returned by <code>listdir()</code> are normally decoded according to the encoding returned by <code>sys.getfilesystemencoding()</code>. If you specify the initial path as bytes, the filenames are returned as undecoded byte strings. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0264-03" id="f0264-03">Click here to view code image</a></p>
        <pre>import os
        
        <span class="hblue"># Return raw undecoded names</span>
        names <span class="igrey">=</span> os.listdir(b<span class="mblue">'dirname'</span>)</pre>
        <p class="indent">A useful operation related to directory listing is matching filenames according to a pattern, known as <em>globbing</em>. The <code>pathlib</code> modules can be used for this purpose. For example, here is an example of matching all <code>*.txt</code> files in a specific directory:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0264-04" id="f0264-04">Click here to view code image</a></p>
        <pre>import pathlib
        
        <span class="lgreen"><strong>for</strong></span> filename <span class="lgreen"><strong>in</strong></span> path.Path(dirname).glob(<span class="mblue">'*.txt'</span>):
            print(filename)</pre>
        <p class="indent">If you use <code>rglob()</code> instead of <code>glob()</code>, it will recursively search all subdirectories for filenames that match the pattern. Both the <code>glob()</code> and <code>rglob()</code> functions return a generator that produces the filenames via iteration.</p>
        </section>
        <section>
        <h3 class="h3" id="ch09lev1sec10"><span epub:type="pagebreak" id="page_265"></span>9.10 The <code>print()</code> function</h3>
        <p class="noindent">To print a series of values separated by spaces, supply them all to <code>print()</code> like this:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0265-01" id="f0265-01">Click here to view code image</a></p>
        <pre>print(<span class="mblue">'The values are'</span>, x, y, z)</pre>
        <p class="indent">To suppress or change the line ending, use the <code>end</code> keyword argument:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0265-02" id="f0265-02">Click here to view code image</a></p>
        <pre><span class="hblue"># Suppress the newline</span>
        print(<span class="mblue">'The values are'</span>, x, y, z, end<span class="igrey">=</span><span class="mblue">''</span>)</pre>
        <p class="indent">To redirect the output to a file, use the <code>file</code> keyword argument:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0265-03" id="f0265-03">Click here to view code image</a></p>
        <pre><span class="hblue"># Redirect to file object f</span>
        print(<span class="mblue">'The values are'</span>, x, y, z, file<span class="igrey">=</span>f)</pre>
        <p class="indent">To change the separator character between items, use the <code>sep</code> keyword argument:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0265-04" id="f0265-04">Click here to view code image</a></p>
        <pre><span class="hblue"># Put commas between the values</span>
        print(<span class="mblue">'The values are'</span>, x, y, z, sep<span class="igrey">=</span><span class="mblue">','</span>)</pre>
        </section>
        <section>
        <h3 class="h3" id="ch09lev1sec11">9.11 Generating Output</h3>
        <p class="noindent">Working directly with files is most familiar to programmers. However, generator functions can also be used to emit an I/O stream as a sequence of data fragments. To do this, use the <code>yield</code> statement as you would use a <code>write()</code> or <code>print()</code> function. Here is an example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0265-05" id="f0265-05">Click here to view code image</a></p>
        <pre><span class="lgreen"><strong>def</strong></span> countdown(n):
            <span class="lgreen"><strong>while</strong></span> n <span class="igrey">&gt;</span> <span class="sgreen">0</span>:
                 <span class="lgreen"><strong>yield</strong></span> <span class="trose">f'T-minus</span> <span class="mblue">{n}\n</span><span class="trose">'</span>
                 n <span class="igrey">-=</span> <span class="sgreen">1</span>
            <span class="lgreen"><strong>yield</strong></span> <span class="mblue">'Kaboom!\n'</span></pre>
        <p class="indent">Producing an output stream in this manner provides flexibility because it is decoupled from the code that actually directs the stream to its intended destination. For example, if you want to route the above output to a file <code>f</code>, you can do this:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0265-06" id="f0265-06">Click here to view code image</a></p>
        <pre>lines <span class="igrey">=</span> countdown(<span class="sgreen">5</span>)
        f.writelines(lines)</pre>
        <p class="indent">If, instead, you want to redirect the output across a socket <code>s</code>, you can do this:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0265-07" id="f0265-07">Click here to view code image</a></p>
        <pre><span class="lgreen"><strong>for</strong></span> chunk <span class="lgreen"><strong>in</strong></span> lines:
            s.sendall(chunk)</pre>
        <p class="indent">Or, if you simply want to capture all of the output in a single string, you can do this:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0265-08" id="f0265-08">Click here to view code image</a></p>
        <pre>out <span class="igrey">=</span> <span class="mblue">''</span>.join(lines)</pre>
        <p class="indent"><span epub:type="pagebreak" id="page_266"></span>More advanced applications can use this approach to implement their own I/O buffering. For example, a generator could be emitting small text fragments, but another function would then collect the fragments into larger buffers to create a more efficient single I/O operation.</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0266-01" id="f0266-01">Click here to view code image</a></p>
        <pre>chunks <span class="igrey">=</span> []
        buffered_size <span class="igrey">=</span> <span class="sgreen">0</span>
        <span class="lgreen"><strong>for</strong></span> chunk <span class="lgreen"><strong>in</strong></span> count:
            chunks.append(chunk)
            buffered_size <span class="igrey">+=</span> len(chunk)
            <span class="lgreen"><strong>if</strong></span> buffered_size <span class="igrey">&gt;=</span> MAXBUFFERSIZE:
                 outf.write(<span class="mblue">''</span>.join(chunks))
                 chunks.clear()
                 buffered_size <span class="igrey">=</span> <span class="sgreen">0</span>
        outf.write(<span class="mblue">''</span>.join(chunks)</pre>
        <p class="indent">For programs that are routing output to files or network connections, a generator approach can also result in a significant reduction in memory use because the entire output stream can often be generated and processed in small fragments, as opposed to being first collected into one large output string or list of strings.</p>
        </section>
        <section>
        <h3 class="h3" id="ch09lev1sec12">9.12 Consuming Input</h3>
        <p class="noindent">For programs that consume fragmentary input, enhanced generators can be useful for decoding protocols and other facets of I/O. Here is an example of an enhanced generator that receives byte fragments and assembles them into lines:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0266-02" id="f0266-02">Click here to view code image</a></p>
        <pre><span class="lgreen"><strong>def</strong></span> line_receiver():
            data <span class="igrey">=</span> bytearray()
            line <span class="igrey">=</span> <span class="dblue">None</span>
            linecount <span class="igrey">=</span> <span class="sgreen">0</span>
            <span class="lgreen"><strong>while</strong></span> <span class="dblue">True</span>:
                part <span class="igrey">=</span> <span class="lgreen"><strong>yield</strong></span> line
                linecount <span class="igrey">+=</span> part.count(b<span class="mblue">'\n'</span>)
                data.extend(part)
                <span class="lgreen"><strong>if</strong></span> linecount <span class="igrey">&gt;</span> <span class="sgreen">0</span>:
                    index <span class="igrey">=</span> data.index(b<span class="mblue">'\n'</span>)
                    line <span class="igrey">=</span> bytes(data[:index<span class="igrey">+</span><span class="sgreen">1</span>])
                    data <span class="igrey">=</span> data[index<span class="igrey">+</span><span class="sgreen">1</span>:]
                    linecount <span class="igrey">-=</span> <span class="sgreen">1</span>
                <span class="lgreen"><strong>else</strong></span>:
                    line <span class="igrey">=</span> <span class="dblue">None</span></pre>
        <p class="indent">In this example, a generator has been programmed to receive byte fragments that are collected into a byte array. If the array contains a newline, a line is extracted and returned. Otherwise, <code>None</code> is returned. Here’s an example illustrating how it works:<span epub:type="pagebreak" id="page_267"></span></p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0267-01" id="f0267-01">Click here to view code image</a></p>
        <pre>&gt;&gt;&gt; r = line_receiver()
        &gt;&gt;&gt; r.send(None)    # Necessary first step
        &gt;&gt;&gt; r.send(b'hello')
        &gt;&gt;&gt; r.send(b'world\nit ')
        b'hello world\n'
        &gt;&gt;&gt; r.send(b'works!')
        &gt;&gt;&gt; r.send(b'\n')
        b'it works!\n''
        &gt;&gt;&gt;</pre>
        <p class="indent">An interesting side effect of this approach is that it externalizes the actual I/O operations that must be performed to get the input data. Specifically, the implementation of <code>line_receiver()</code> contains no I/O operations at all! This means that it could be used in different contexts. For example, with sockets:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0267-02" id="f0267-02">Click here to view code image</a></p>
        <pre>r <span class="igrey">=</span> line_receiver()
        data <span class="igrey">=</span> <span class="dblue">None</span>
        <span class="lgreen"><strong>while</strong></span> <span class="dblue">True</span>:
            <span class="lgreen"><strong>while not</strong></span> (line:<span class="igrey">=</span>r.send(data)):
                data <span class="igrey">=</span> sock.recv(<span class="sgreen">8192</span>)
        
            <span class="hblue"># Process the line</span>
            ...</pre>
        <p class="indent">or with files:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0267-03" id="f0267-03">Click here to view code image</a></p>
        <pre>r <span class="igrey">=</span> line_receiver()
        data <span class="igrey">=</span> <span class="dblue">None</span>
        <span class="lgreen"><strong>while</strong></span> <span class="dblue">True</span>:
            <span class="lgreen"><strong>while not</strong></span> (line:<span class="igrey">=</span>r.send(data)):
                data <span class="igrey">=</span> file.read(<span class="sgreen">10000</span>)
        
            <span class="hblue"># Process the line</span>
            ...</pre>
        <p class="indent">or even in asynchronous code:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0267-04" id="f0267-04">Click here to view code image</a></p>
        <pre><span class="lgreen"><strong>async def</strong></span> reader(ch):
            r <span class="igrey">=</span> line_receiver()
            data <span class="igrey">=</span> <span class="dblue">None</span>
            <span class="lgreen"><strong>while</strong></span> <span class="dblue">True</span>:
                <span class="lgreen"><strong>while not</strong></span> (line:<span class="igrey">=</span>r.send(data)):
                    data <span class="igrey">=</span> <span class="lgreen"><strong>await</strong></span> ch.receive(<span class="sgreen">8192</span>)
        
                <span class="hblue"># Process the line</span>
                ...</pre>
        </section>
        <section>
        <h3 class="h3" id="ch09lev1sec13"><span epub:type="pagebreak" id="page_268"></span>9.13 Object Serialization</h3>
        <p class="noindent">Sometimes it’s necessary to serialize the representation of an object so it can be transmitted over the network, saved to a file, or stored in a database. One way to do this is to convert data into a standard encoding such as JSON or XML. There is also a common Python-specific data serialization format called <em>Pickle</em>.</p>
        <p class="indent">The <code>pickle</code> module serializes an object into a stream of bytes that can be used to reconstruct the object at a later point in time. The interface to <code>pickle</code> is simple, consisting of two operations, <code>dump()</code> and <code>load()</code>. For example, the following code writes an object to a file:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0268-01" id="f0268-01">Click here to view code image</a></p>
        <pre>import pickle
        obj <span class="igrey">=</span> SomeObject()
        <span class="lgreen"><strong>with</strong></span> open(filename, <span class="mblue">'wb'</span>) as file:
           pickle.dump(obj, file)      <span class="hblue"># Save object on f</span></pre>
        <p class="indent">To restore the object, use:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0268-01a" id="f0268-01a">Click here to view code image</a></p>
        <pre><span class="lgreen"><strong>with</strong></span> open(filename, <span class="mblue">'rb'</span>) as file:
            obj <span class="igrey">=</span> pickle.load(file)   <span class="hblue"># Restore the object</span></pre>
        <p class="indent">The data format used by <code>pickle</code> has its own framing of records. Thus, a sequence of objects can be saved by issuing a series of <code>dump()</code> operations one after the other. To restore these objects, simply use a similar sequence of <code>load()</code> operations.</p>
        <p class="indent">For network programming, it is common to use pickle to create byte-encoded messages. To do that, use <code>dumps()</code> and <code>loads()</code>. Instead of reading/writing data to a file, these functions work with byte strings.</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0268-02" id="f0268-02">Click here to view code image</a></p>
        <pre>obj <span class="igrey">=</span> SomeObject()
        
        <span class="hblue"># Turn an object into bytes</span>
        data <span class="igrey">=</span> pickle.dumps(obj)
        ...
        
        <span class="hblue"># Turn bytes back into an object</span>
        obj <span class="igrey">=</span> pickle.loads(data)</pre>
        <p class="indent">It is not normally necessary for user-defined objects to do anything extra to work with <code>pickle</code>. However, certain kinds of objects can’t be pickled. These tend to be objects that incorporate runtime state—open files, threads, closures, generators, and so on. To handle these tricky cases, a class can define the special methods <code>__getstate__()</code> and <code>__setstate__()</code>.</p>
        <p class="indent">The <code>__getstate__()</code> method, if defined, will be called to create a value representing the state of an object. The value returned by <code>__getstate__()</code> is typically a string, tuple, list, or dictionary. The <code>__setstate__()</code> method receives this value during unpickling and should restore the state of an object from it.</p>
        <p class="indent"><span epub:type="pagebreak" id="page_269"></span>When encoding an object, <code>pickle</code> does not include the underlying source code itself. Instead, it encodes a name reference to the defining class. When unpickling, this name is used to perform a source-code lookup on the system. For unpickling to work, the recipient of a pickle must have the proper source code already installed. It is also important to emphasize that <code>pickle</code> is inherently insecure—unpickling untrusted data is a known vector for remote code execution. Thus, <code>pickle</code> should only be used if you can completely secure the runtime environment.</p>
        </section>
        <section>
        <h3 class="h3" id="ch09lev1sec14">9.14 Blocking Operations and Concurrency</h3>
        <p class="noindent">A fundamental aspect of I/O is the concept of <em>blocking</em>. By its very nature, I/O is connected to the real world. It often involves waiting for input or devices to be ready. For example, code that reads data on the network might perform a receive operation on a socket like this:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0269-01" id="f0269-01">Click here to view code image</a></p>
        <pre>data <span class="igrey">=</span> sock.recv(<span class="sgreen">8192</span>)</pre>
        <p class="indent">When this statement executes, it might return immediately if data is available. However, if that’s not the case, it will stop—waiting for data to arrive. This is blocking. While the program is blocked, nothing else happens.</p>
        <p class="indent">For a data analysis script or a simple program, blocking is not something that you worry about. However, if you want your program to do something else while an operation is blocked, you will need to take a different approach. This is the fundamental problem of concurrency—having a program work on more than one thing at a time. One common problem is having a program read on two or more different network sockets at the same time:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0269-02" id="f0269-02">Click here to view code image</a></p>
        <pre><span class="lgreen"><strong>def</strong></span> reader1(sock):
            <span class="lgreen"><strong>while</strong></span> (data :<span class="igrey">=</span> sock.recv(<span class="sgreen">8192</span>)):
                print(<span class="mblue">'reader1 got:'</span>, data)
        
        <span class="lgreen"><strong>def</strong></span> reader2(sock):
            <span class="lgreen"><strong>while</strong></span> (data :<span class="igrey">=</span> sock.recv(<span class="sgreen">8192</span>)):
                print(<span class="mblue">'reader2 got:'</span>, data)
        
        <span class="hblue"># Problem: How to make reader1() and reader2()</span>
        <span class="hblue"># run at the same time?</span></pre>
        <p class="indent">The rest of this section outlines a few different approaches to solving this problem. However, it is not meant to be a full tutorial on concurrency. For that, you will need to consult other resources.</p>
        <section>
        <h4 class="h4" id="ch09lev2sec7"><span epub:type="pagebreak" id="page_270"></span>9.14.1 Nonblocking I/O</h4>
        <p class="noindent">One approach to avoiding blocking is to use so-called <em>nonblocking I/O</em>. This is a special mode that has to be enabled—for example, on a socket:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0270-01" id="f0270-01">Click here to view code image</a></p>
        <pre>sock.setblocking(<span class="dblue">False</span>)</pre>
        <p class="indent">Once enabled, an exception will now be raised if an operation would have blocked. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0270-02" id="f0270-02">Click here to view code image</a></p>
        <pre><span class="lgreen"><strong>try</strong></span>:
            data <span class="igrey">=</span> sock.recv(<span class="sgreen">8192</span>)
        <span class="lgreen"><strong>except</strong></span> <span class="pgold">BlockingIOError</span> as e:
            <span class="hblue"># No data is avaiable</span>
            ...</pre>
        <p class="indent">In response to a <code>BlockingIOError</code>, the program could elect to work on something else. It could retry the I/O operation later to see if any data has arrived. For example, here’s how you might read on two sockets at once:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0270-03" id="f0270-03">Click here to view code image</a></p>
        <pre><span class="lgreen"><strong>def</strong></span> reader1(sock):
            <span class="lgreen"><strong>try</strong></span>:
                data <span class="igrey">=</span> sock.recv(<span class="sgreen">8192</span>)
                print(<span class="mblue">'reader1 got:'</span>, data)
            <span class="lgreen"><strong>except</strong></span> <span class="pgold">BlockingIOError</span>:
                <span class="lgreen"><strong>pass</strong></span>
        
        <span class="lgreen"><strong>def</strong></span> reader2(sock):
            <span class="lgreen"><strong>try</strong></span>:
                data <span class="igrey">=</span> sock.recv(<span class="sgreen">8192</span>)
                print(<span class="mblue">'reader2 got:'</span>, data)
            <span class="lgreen"><strong>except</strong></span> <span class="pgold">BlockingIOError</span>:
                <span class="lgreen"><strong>pass</strong></span>
        
        <span class="lgreen"><strong>def</strong></span> run(sock1, sock2):
            sock1.setblocking(<span class="dblue">False</span>)
            sock2.setblocking(<span class="dblue">False</span>)
            <span class="lgreen"><strong>while</strong></span> <span class="dblue">True</span>:
                reader1(sock1)
                reader2(sock2)</pre>
        <p class="indent">In practice, relying only on nonblocking I/O is clumsy and inefficient. For example, the core of this program is the <code>run()</code> function at the end. It will run in a inefficient busy loop as it constantly tries to read on the sockets. This works, but it is not a good design.</p>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec8"><span epub:type="pagebreak" id="page_271"></span>9.14.2 I/O Polling</h4>
        <p class="noindent">Instead of relying upon exceptions and spinning, it is possible to poll I/O channels to see if data is available. The <code>select</code> or <code>selectors</code> module can be used for this purpose. For example, here’s a slightly modified version of the <code>run()</code> function:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0271-01" id="f0271-01">Click here to view code image</a></p>
        <pre>from selectors import DefaultSelector, EVENT_READ, EVENT_WRITE
        
        <span class="lgreen"><strong>def</strong></span> run(sock1, sock2):
            selector <span class="igrey">=</span> DefaultSelector()
            selector.register(sock1, EVENT_READ, data<span class="igrey">=</span>reader1)
            selector.register(sock2, EVENT_READ, data<span class="igrey">=</span>reader2)
            <span class="hblue"># Wait for something to happen</span>
            <span class="lgreen"><strong>while</strong></span> <span class="dblue">True</span>:
                <span class="lgreen"><strong>for</strong></span> key, evt <span class="lgreen"><strong>in</strong></span> selector.select():
                    func <span class="igrey">=</span> key.data
                    func(key.fileobj)</pre>
        <p class="indent">In this code, the loop dispatches either <code>reader1()</code> or <code>reader2()</code> function as a callback whenever I/O is detected on the appropriate socket. The <code>selector.select()</code> operation itself blocks, waiting for I/O to occur. Thus, unlike the previous example, it won’t make the CPU furiously spin.</p>
        <p class="indent">This approach to I/O is the foundation of many so-called “async” frameworks such as <code>asyncio</code>, although you usually don’t see the inner workings of the event loop.</p>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec9">9.14.3 Threads</h4>
        <p class="noindent">In the last two examples, concurrency required the use of a special <code>run()</code> function to drive the calculation. As an alternative, you can use thread programming and the <code>threading</code> module. Think of a thread as an independent task that runs inside your program. Here is an example of code that reads data on two sockets at once:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0271-02" id="f0271-02">Click here to view code image</a></p>
        <pre>import threading
        
        <span class="lgreen"><strong>def</strong></span> reader1(sock):
            <span class="lgreen"><strong>while</strong></span> (data :<span class="igrey">=</span> sock.recv(<span class="sgreen">8192</span>)):
                print(<span class="mblue">'reader1 got:'</span>, data)
        
        <span class="lgreen"><strong>def</strong></span> reader2(sock):
            <span class="lgreen"><strong>while</strong></span> (data :<span class="igrey">=</span> sock.recv(<span class="sgreen">8192</span>)):
                print(<span class="mblue">'reader2 got:'</span>, data)
        
        t1 <span class="igrey">=</span> threading.Thread(target<span class="igrey">=</span>reader1, args<span class="igrey">=</span>[sock1]).start()
        t2 <span class="igrey">=</span> threading.Thread(target<span class="igrey">=</span>reader2, args<span class="igrey">=</span>[sock2]).start()
        
        <span class="hblue"># Start the threads</span>
        <span epub:type="pagebreak" id="page_272"></span>t1.start()
        t2.start()
        
        <span class="hblue"># Wait for the threads to finish</span>
        t1.join()
        t2.join()</pre>
        <p class="indent">In this program, the <code>reader1()</code> and <code>reader2()</code> functions execute concurrently. This is managed by the host operating system, so you don’t need to know much about how it works. If a blocking operation occurs in one thread, it does not affect the other thread.</p>
        <p class="indent">The subject of thread programming is, in its entirety, beyond the scope of this book. However, a few additional examples are provided in the <code>threading</code> module section later in this chapter.</p>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec10">9.14.4 Concurrent Execution with <code>asyncio</code></h4>
        <p class="noindent">The <code>asyncio</code> module provides a concurrency implementation alternative to threads. Internally, it’s based on an event loop that uses I/O polling. However, the high-level programming model looks very similar to threads through the use of special <code>async</code> functions. Here is an example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0272-02" id="f0272-02">Click here to view code image</a></p>
        <pre>import asyncio
        
        <span class="lgreen"><strong>async def</strong></span> reader1(sock):
            loop <span class="igrey">=</span> asyncio.get_event_loop()
            <span class="lgreen"><strong>while</strong></span> (data :<span class="igrey">=</span> <span class="lgreen"><strong>await</strong></span> loop.sock_recv(sock, <span class="sgreen">8192</span>)):
                print(<span class="mblue">'reader1 got:'</span>, data)
        
        <span class="lgreen"><strong>async def</strong></span> reader2(sock):
            loop <span class="igrey">=</span> asyncio.get_event_loop()
            <span class="lgreen"><strong>while</strong></span> (data :<span class="igrey">=</span> <span class="lgreen"><strong>await</strong></span> loop.sock_recv(sock, <span class="sgreen">8192</span>)):
                print(<span class="mblue">'reader2 got:'</span>, data)
        
        <span class="lgreen"><strong>async def</strong></span> main(sock1, sock2):
            loop <span class="igrey">=</span> asyncio.get_event_loop()
            t1 <span class="igrey">=</span> loop.create_task(reader1(sock1))
            t2 <span class="igrey">=</span> loop.create_task(reader2(sock2))
        
            <span class="hblue"># Wait for the tasks to finish</span>
            <span class="lgreen"><strong>await</strong></span> t1
            <span class="lgreen"><strong>await</strong></span> t2
        
        ...
        <span class="hblue"># Run it</span>
        asyncio.run(main(sock1, sock2))</pre>
        <p class="indent"><span epub:type="pagebreak" id="page_273"></span>Full details of using <code>asyncio</code> would require its own dedicated book. What you should know is that many libraries and frameworks advertise support for asynchronous operation. Usually that means that concurrent execution is supported through <code>asyncio</code> or a similar module. Much of the code is likely to involve async functions and related features.</p>
        </section>
        </section>
        <section>
        <h3 class="h3" id="ch09lev1sec15">9.15 Standard Library Modules</h3>
        <p class="noindent">A large number of standard library modules are used for various I/O related tasks. This section provides a brief overview of the commonly used modules, along with a few examples. Complete reference material can be found online or in an IDE and is not repeated here. The main purpose of this section is to point you in the right direction by giving you the names of the modules that you should be using along with a few examples of very common programming tasks involving each module.</p>
        <p class="indent">Many of the examples are shown as interactive Python sessions. These are experiments that you are encouraged to try yourself.</p>
        <section>
        <h4 class="h4" id="ch09lev2sec11">9.15.1 <code>asyncio</code> Module</h4>
        <p class="noindent">The <code>asyncio</code> module provides support for concurrent I/O operations using I/O polling and an underlying event loop. Its primary use is in code involving networks and distributed systems. Here is an example of a TCP echo server using low-level sockets:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0273-01" id="f0273-01">Click here to view code image</a></p>
        <pre>import asyncio
        from socket import <span class="igrey">*</span>
        
        <span class="lgreen"><strong>async def</strong></span> echo_server(address):
            loop <span class="igrey">=</span> asyncio.get_event_loop()
            sock <span class="igrey">=</span> socket(AF_INET, SOCK_STREAM)
            sock.setsockopt(SOL_SOCKET, SO_REUSEADDR, <span class="sgreen">1</span>)
            sock.bind(address)
            sock.listen(<span class="sgreen">5</span>)
            sock.setblocking(<span class="dblue">False</span>)
            print(<span class="mblue">'Server listening at'</span>, address)
            <span class="lgreen"><strong>with</strong></span> sock:
                <span class="lgreen"><strong>while</strong></span> <span class="dblue">True</span>:
                    client, addr <span class="igrey">=</span> <span class="lgreen"><strong>await</strong></span> loop.sock_accept(sock)
                    print(<span class="mblue">'Connection from'</span>, addr)
                    loop.create_task(echo_client(loop, client))
        
        <span class="lgreen"><strong>async def</strong></span> echo_client(loop, client):
            <span class="lgreen"><strong>with</strong></span> client:
                <span class="lgreen"><strong>while</strong></span> <span class="dblue">True</span>:
                    data <span class="igrey">=</span> <span class="lgreen"><strong>await</strong></span> loop.sock_recv(client, <span class="sgreen">10000</span>)
        <span epub:type="pagebreak" id="page_274"></span>            <span class="lgreen"><strong>if not</strong></span> data:
                        <span class="lgreen"><strong>break</strong></span>
                    <span class="lgreen"><strong>await</strong></span> loop.sock_sendall(client, b<span class="mblue">'Got:'</span> <span class="igrey">+</span> data)
            print(<span class="mblue">'Connection closed'</span>)
        
        <span class="lgreen"><strong>if</strong></span> <span class="dblue">__name__</span> <span class="igrey">==</span> <span class="mblue">'__main__'</span>:
            loop <span class="igrey">=</span> asyncio.get_event_loop()
            loop.create_task(echo_server(loop, (<span class="mblue">''</span>, <span class="sgreen">25000</span>)))
            loop.run_forever()</pre>
        <p class="indent">To test this code, use a program such as <code>nc</code> or <code>telnet</code> to connect to port 25000 on your machine. The code should echo back the text that you type. If you connect more than once using multiple terminal windows, you’ll find that the code can handle all of the connections concurrently.</p>
        <p class="indent">Most applications using <code>asyncio</code> will probably operate at a higher level than sockets. However, in such applications, you will still have to make use of special <code>async</code> functions and interact with the underlying event loop in some manner.</p>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec12">9.15.2 <code>binascii</code> Module</h4>
        <p class="noindent">The <code>binascii</code> module has functions for converting binary data into various text-based representations such as hexadecimal and base64. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0274-02" id="f0274-02">Click here to view code image</a></p>
        <pre>&gt;&gt;&gt; binascii.b2a_hex(b'hello')
        b'68656c6c6f'
        &gt;&gt;&gt; binascii.a2b_hex(_)
        b'hello'
        &gt;&gt;&gt; binascii.b2a_base64(b'hello')
        b'aGVsbG8=\n'
        &gt;&gt;&gt; binascii.a2b_base64(_)
        b'hello'
        &gt;&gt;&gt;</pre>
        <p class="indent">Similar functionality can be found in the <code>base64</code> module as well as with the <code>hex()</code> and <code>fromhex()</code> methods of <code>bytes</code>. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0274-03" id="f0274-03">Click here to view code image</a></p>
        <pre>&gt;&gt;&gt; a = b'hello'
        &gt;&gt;&gt; a.hex()
        '68656c6c6f'
        &gt;&gt;&gt; bytes.fromhex(_)
        b'hello'
        &gt;&gt;&gt; import base64
        &gt;&gt;&gt; base64.b64encode(a)
        b'aGVsbG8='
        &gt;&gt;&gt;</pre>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec13"><span epub:type="pagebreak" id="page_275"></span>9.15.3 <code>cgi</code> Module</h4>
        <p class="noindent">So, let’s say you just want to put a basic form on your website. Perhaps it’s a sign-up form for your weekly “Cats and Categories” newsletter. Sure, you could install the latest web framework and spend all of your time fiddling with it. Or, you could also just write a basic CGI script—old-school style. The <code>cgi</code> module is for doing just that.</p>
        <p class="indent">Suppose you have the following form fragment on a webpage:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0275-01" id="f0275-01">Click here to view code image</a></p>
        <pre><span class="lgreen"><strong>&lt;form</strong></span> <strong>method</strong><span class="lgreen">=</span><span class="mblue">"POST"</span> <strong>action</strong><span class="lgreen">=</span><span class="mblue">"cgi-bin/register.py"</span><span class="lgreen"><strong>&gt;</strong></span>
           <span class="lgreen"><strong>&lt;p&gt;</strong></span>
           To register, please provide a contact name and email address.
           <span class="lgreen"><strong>&lt;/p&gt;</strong></span>
           <span class="lgreen"><strong>&lt;div&gt;</strong></span>
              <span class="lgreen"><strong>&lt;input</strong></span> <strong>name</strong><span class="lgreen">=</span><span class="mblue">"name"</span> <strong>type</strong><span class="lgreen">=</span><span class="mblue">"text"</span><span class="lgreen"><strong>&gt;</strong></span>Your name:<span class="lgreen"><strong>&lt;/input&gt;</strong></span>
           <span class="lgreen"><strong>&lt;/div&gt;</strong></span>
           <span class="lgreen"><strong>&lt;div&gt;</strong></span>
              <span class="lgreen"><strong>&lt;input</strong></span> <strong>name</strong><span class="lgreen">=</span><span class="mblue">"email"</span> <strong>type</strong><span class="lgreen">=</span><span class="mblue">"email"</span><span class="lgreen"><strong>&gt;</strong></span>Your email:<span class="lgreen"><strong>&lt;/input&gt;</strong></span>
           <span class="lgreen"><strong>&lt;/div&gt;</strong></span>
           <span class="lgreen"><strong>&lt;div</strong></span> <strong>class</strong><span class="lgreen">=</span><span class="mblue">"modal-footer justify-content-center"</span><span class="lgreen"><strong>&gt;</strong></span>
              <span class="lgreen"><strong>&lt;input</strong></span> <strong>type</strong><span class="lgreen">=</span><span class="mblue">"submit"</span> <strong>name</strong><span class="lgreen">=</span><span class="mblue">"submit"</span> <strong>value</strong><span class="lgreen">=</span><span class="mblue">"Register"</span><span class="lgreen"><strong>&gt;&lt;/input&gt;</strong></span>
           <span class="lgreen"><strong>&lt;/div&gt;</strong></span>
        <span class="lgreen"><strong>&lt;/form&gt;</strong></span></pre>
        <p class="indent">Here’s a CGI script that receives the form data on the other end:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0275-02" id="f0275-02">Click here to view code image</a></p>
        <pre><span class="hblue">#!/usr/bin/env python</span>
        import cgi
        <span class="lgreen"><strong>try</strong></span>:
            form <span class="igrey">=</span> cgi.FieldStorage()
            name <span class="igrey">=</span> form.getvalue(<span class="mblue">'name'</span>)
            email <span class="igrey">=</span> form.getvalue(<span class="mblue">'email'</span>)
            <span class="hblue"># Validate the responses and do whatever</span>
            ...
            <span class="hblue"># Produce an HTML result (or redirect)</span>
            print(<span class="mblue">"Status: 302 Moved\r"</span>)
            print(<span class="mblue">"Location: https://www.mywebsite.com/thanks.html\r"</span>)
            print(<span class="mblue">"\r"</span>)
        <span class="lgreen"><strong>except</strong></span> <span class="pgold">Exception</span> as e:
            print(<span class="mblue">"Status: 501 Error\r"</span>)
            print(<span class="mblue">"Content-type: text/plain\r"</span>)
            print(<span class="mblue">"\r"</span>)
            print(<span class="mblue">"Some kind of error occurred.\r"</span>)</pre>
        <p class="indent">Will writing such a CGI script get you a job at an Internet startup? Probably not. Will it solve your actual problem? Likely.</p>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec14"><span epub:type="pagebreak" id="page_276"></span>9.15.4 <code>configparser</code> Module</h4>
        <p class="noindent">INI files are a common format for encoding program configuration information in a human-readable form. Here is an example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0276-01" id="f0276-01">Click here to view code image</a></p>
        <pre># config.ini
        
        ; A comment
        [section1]
        name1 = value1
        name2 = value2
        
        [section2]
        ; Alternative syntax
        name1: value1
        name2: value2</pre>
        <p class="indent">The <code>configparser</code> module is used to read <code>.ini</code> files and extract values. Here’s a basic example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0276-02" id="f0276-02">Click here to view code image</a></p>
        <pre>import configparser
        
        <span class="hblue"># Create a config parser and read a file</span>
        cfg <span class="igrey">=</span> configparser.ConfigParser()
        cfg.read(<span class="mblue">'conig.ini'</span>)
        
        <span class="hblue"># Extract values</span>
        a <span class="igrey">=</span> cfg.get(<span class="mblue">'section1'</span>, <span class="mblue">'name1'</span>)
        b <span class="igrey">=</span> cfg.get(<span class="mblue">'section2'</span>, <span class="mblue">'name2'</span>)
        ...</pre>
        <p class="indent">More advanced functionality is also available, including string interpolation features, the ability to merge multiple <code>.ini</code> files, provide default values, and more. Consult the official documentation for more examples.</p>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec15">9.15.5 <code>csv</code> Module</h4>
        <p class="noindent">The <code>csv</code> module is used to read/write files of comma-separated values (CSV) produced by programs such as Microsoft Excel or exported from a database. To use it, open a file and then wrap an extra layer of CSV encoding/decoding around it. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0276-03" id="f0276-03">Click here to view code image</a></p>
        <pre>import csv
        
        <span class="hblue"># Read a CSV file into a list of tuples</span>
        <span class="lgreen"><strong>def</strong></span> read_csv_data(filename):
            <span class="lgreen"><strong>with</strong></span> open(filename) as file:
                rows <span class="igrey">=</span> csv.reader(file)
        <span epub:type="pagebreak" id="page_277"></span>        <span class="hblue"># First line is often a header. This reads it</span>
                headers <span class="igrey">=</span> next(rows)
                <span class="hblue"># Now read the rest of the data</span>
                <span class="lgreen"><strong>for</strong></span> row <span class="lgreen"><strong>in</strong></span> rows:
                    <span class="hblue"># Do something with row</span>
                    ...
        
        <span class="hblue"># Write Python data to a CSV file</span>
        <span class="lgreen"><strong>def</strong></span> write_csv_data(filename, headers, rows):
            <span class="lgreen"><strong>with</strong></span> open(filename, <span class="mblue">"w"</span>) as file:
                out <span class="igrey">=</span> csv.writer(file)
                out.writerow(headers)
                out.writerows(rows)</pre>
        <p class="indent">An often used convenience is to use a <code>DictReader()</code> instead. This interprets the first line of a CSV file as headers and returns each row as dictionary instead of a tuple.</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0277-02" id="f0277-02">Click here to view code image</a></p>
        <pre>import csv
        
        <span class="lgreen"><strong>def</strong></span> find_nearby(filename):
            <span class="lgreen"><strong>with</strong></span> open(filename) as file:
                rows <span class="igrey">=</span> csv.DictReader(file)
                <span class="lgreen"><strong>for</strong></span> row <span class="lgreen"><strong>in</strong></span> rows:
                    lat <span class="igrey">=</span> float(rows[<span class="mblue">'latitude'</span>])
                    lon <span class="igrey">=</span> float(rows[<span class="mblue">'longitude'</span>])
                    <span class="lgreen"><strong>if</strong></span> close_enough(lat, lon):
                        print(row)</pre>
        <p class="indent">The <code>csv</code> module doesn’t do much with CSV data other than reading or writing it. The main benefit provided is that the module knows how to properly encode/decode the data and handles a lot of edge cases involving quotation, special characters, and other details. This is a module you might use to write simple scripts for cleaning or preparing data to be used with other programs. If you want to perform data analysis tasks with CSV data, consider using a third-party package such as the popular <code>pandas</code> library.</p>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec16">9.15.6 <code>errno</code> Module</h4>
        <p class="noindent">Whenever a system-level error occurs, Python reports it with an exception that’s a subclass of <code>OSError</code>. Some of the more common kinds of system errors are represented by separate subclasses of <code>OSError</code> such as <code>PermissionError</code> or <code>FileNotFoundError</code>. However, there are hundreds of other errors that could occur in practice. For these, any <code>OSError</code> exception carries a numeric <code>errno</code> attribute that can be inspected. The <code>errno</code> module provides symbolic constants corresponding to these error codes. They are often used when writing specialized exception handlers. For example, here is an exception handler that checks for no space remaining on a device:<span epub:type="pagebreak" id="page_278"></span></p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0278-01" id="f0278-01">Click here to view code image</a></p>
        <pre>import errno
        
        <span class="lgreen"><strong>def</strong></span> write_data(file, data):
            <span class="lgreen"><strong>try</strong></span>:
                file.write(data)
            <span class="lgreen"><strong>except</strong></span> <span class="pgold">OSError</span> as e:
                <span class="lgreen"><strong>if</strong></span> e.errno <span class="igrey">==</span> errno.ENOSPC:
                    print(<span class="mblue">"You're out of disk space!"</span>
                <span class="lgreen"><strong>else</strong></span>:
                    <span class="lgreen"><strong>raise</strong></span>       <span class="hblue"># Some other error. Propagate</span></pre>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec17">9.15.7 <code>fcntl</code> Module</h4>
        <p class="noindent">The <code>fcntl</code> module is used to perform low-level I/O control operations on UNIX using the <code>fcntl()</code> and <code>ioctl()</code> system calls. This is also the module to use if you want to perform any kind of file locking—a problem that sometimes arises in the context of concurrency and distributed systems. Here is an example of opening a file in combination with mutual exclusion locking across all processes using <code>fcntl.flock()</code>:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0278-02" id="f0278-02">Click here to view code image</a></p>
        <pre>import fcntl
        
        <span class="lgreen"><strong>with</strong></span> open(<span class="mblue">"somefile"</span>, <span class="mblue">"r"</span>) as file:
             <span class="lgreen"><strong>try</strong></span>:
                 fcntl.flock(file.fileno(), fcntl.LOCK_EX)
                 <span class="hblue"># Use the file</span>
                 ...
             <span class="lgreen"><strong>finally</strong></span>:
                 fcntl.flock(file.fileno(), fcntl.LOCK_UN)</pre>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec18">9.15.8 <code>hashlib</code> Module</h4>
        <p class="noindent">The <code>hashlib</code> module provides functions for computing cryptographic hash values such as MD5 and SHA-1. The following example illustrates how to use the module:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0278-03" id="f0278-03">Click here to view code image</a></p>
        <pre>&gt;&gt;&gt; h = hashlib.new('sha256')
        &gt;&gt;&gt; h.update(b'Hello')    # Feed data
        &gt;&gt;&gt; h.update(b'World')
        &gt;&gt;&gt; h.digest()
        b'\xa5\x91\xa6\xd4\x0b\xf4 @J\x01\x173\xcf\xb7\xb1\x90\xd6,e\xbf\x0b\xcd\xa3+W\xb2w\xd9\xad\x9f\x14n
        &gt;&gt;&gt; h.hexdigest()
        'a591a6d40bf420404a011733cfb7b190d62c65bf0bcda32b57b277d9ad9f146e'
        &gt;&gt;&gt; h.digest_size
        32
        &gt;&gt;&gt;</pre>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec19"><span epub:type="pagebreak" id="page_279"></span>9.15.9 <code>http</code> Package</h4>
        <p class="noindent">The <code>http</code> package contains a large amount of code related to the low-level implementation of the HTTP internet protocol. It can be used to implement both servers and clients. However, most of this package is considered legacy and too low-level for day-to-day work. Serious programmers working with HTTP are more likely to use third-party libraries such as <code>requests</code>, <code>httpx</code>, <code>Django</code>, <code>flask</code>, and others.</p>
        <p class="indent">Nevertheless, one useful easter egg of the <code>http</code> package is the ability for Python to run a standalone web server. Go a directory with a collection of files and type the following:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0279-01" id="f0279-01">Click here to view code image</a></p>
        <pre>bash $ python -m http.server
        Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...</pre>
        <p class="indent">Now, Python will serve the files to your browser if you point it at the right port. You wouldn’t use this to run a website, but it can be useful for testing and debugging programs related to the web. For example, the author has used this to locally test programs involving a mix of HTML, Javascript, and WebAssembly.</p>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec20">9.15.10 <code>io</code> Module</h4>
        <p class="noindent">The <code>io</code> module primarily contains the definitions of classes used to implement the file objects as returned by the <code>open()</code> function. It is not so common to access those classes directly. However, the module also contains a pair of classes that are useful for “faking” a file in the form of strings and bytes. This can be useful for testing and other applications where you need to provide a “file” but have obtained data in a different way.</p>
        <p class="indent">The <code>StringIO()</code> class provides a file-like interface on top of strings. For example, here is how you can write output to a string:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0279-02" id="f0279-02">Click here to view code image</a></p>
        <pre><span class="hblue"># Function that expects a file</span>
        <span class="lgreen"><strong>def</strong></span> greeting(file):
            file.write(<span class="mblue">'Hello\n'</span>)
            file.write(<span class="mblue">'World\n'</span>)
        
        <span class="hblue"># Call the function using a real file</span>
        <span class="lgreen"><strong>with</strong></span> open(<span class="mblue">'out.txt'</span>, <span class="mblue">'w'</span>) as file:
            greeting(file)
        
        <span class="hblue"># Call the function with a "fake" file</span>
        import io
        file <span class="igrey">=</span> io.StringIO()
        greeting(file)
        
        <span class="hblue"># Get the resulting output</span>
        output <span class="igrey">=</span> file.getvalue()</pre>
        <p class="indent">Similarly, you can create a <code>StringIO</code> object and use it for reading:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0280-01" id="f0280-01">Click here to view code image</a></p>
        <pre><span epub:type="pagebreak" id="page_280"></span>file <span class="igrey">=</span> io.StringIO(<span class="mblue">'hello\nworld\n'</span>)
        <span class="lgreen"><strong>while</strong></span> (line :<span class="igrey">=</span> file.readline()):
            print(line, end<span class="igrey">=</span><span class="mblue">''</span>)</pre>
        <p class="indent">The <code>BytesIO()</code> class serves a similar purpose but is used for emulating binary I/O with bytes.</p>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec21">9.15.11 <code>json</code> Module</h4>
        <p class="noindent">The <code>json</code> module can be used to encode and decode data in the JSON format, commonly used in the APIs of microservices and web applications. There are two basic functions for converting data, <code>dumps()</code> and <code>loads()</code>. <code>dumps()</code> takes a Python dictionary and encodes it as a JSON Unicode string:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0280-02" id="f0280-02">Click here to view code image</a></p>
        <pre>&gt;&gt;&gt; import json
        &gt;&gt;&gt; data = { 'name': 'Mary A. Python', 'email': 'mary123@python.org' }
        &gt;&gt;&gt; s = json.dumps(data)
        &gt;&gt;&gt; s
        '{"name": "Mary A. Python", "email": "mary123@python.org"}'
        &gt;&gt;&gt;</pre>
        <p class="indent">The <code>loads()</code> function goes in the other direction:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0280-02a" id="f0280-02a">Click here to view code image</a></p>
        <pre>&gt;&gt;&gt; d = json.loads(s)
        &gt;&gt;&gt; d == data
        True
        &gt;&gt;&gt;</pre>
        <p class="indent">Both the <code>dumps()</code> and <code>loads()</code> functions have many options for controlling aspects of the conversion as well as interfacing with Python class instances. That’s beyond the scope of this section but copious amounts of information is available in the official documentation.</p>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec22">9.15.12 <code>logging</code> Module</h4>
        <p class="noindent">The <code>logging</code> module is the de facto standard module used for reporting program diagnostics and for print-style debugging. It can be used to route output to a log file and provides a large number of configuration options. A common practice is to write code that creates a <code>Logger</code> instance and issues messages on it like this:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0280-03" id="f0280-03">Click here to view code image</a></p>
        <pre>import logging
        log <span class="igrey">=</span> logging.getLogger(<span class="dblue">__name__</span>)
        
        <span class="hblue"># Function that uses logging</span>
        <span class="lgreen"><strong>def</strong></span> func(args):
            log.debug(<span class="mblue">"A debugging message"</span>)
            log.info(<span class="mblue">"An informational message"</span>)
        <span epub:type="pagebreak" id="page_281"></span>    log.warning(<span class="mblue">"A warning message"</span>)
            log.error(<span class="mblue">"An error message"</span>)
            log.critical(<span class="mblue">"A critical message"</span>)
        
        <span class="hblue"># Configuration of logging (occurs one at program startup)</span>
        <span class="lgreen"><strong>if</strong></span> <span class="dblue">__name__</span> <span class="igrey">==</span> <span class="mblue">'__main__'</span>:
            logging.basicConfig(
                 level<span class="igrey">=</span>logging.WARNING,
                 filename<span class="igrey">=</span><span class="mblue">"output.log"</span>
            )</pre>
        <p class="indent">There are five built-in levels of logging ordered by increasing severity. When configuring the logging system, you specify a level that acts as a filter. Only messages at that level or greater severity are reported. Logging provides a large number of configuration options, mostly related to the back-end handling of the log messages. Usually you don’t need to know about that when writing application code—you use <code>debug()</code>, <code>info()</code>, <code>warning()</code>, and similar methods on some given <code>Logger</code> instance. Any special configuration takes place during program startup in a special location (such as a <code>main()</code> function or the main code block).</p>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec23">9.15.13 <code>os</code> Module</h4>
        <p class="noindent">The <code>os</code> module provides a portable interface to common operating-system functions, typically associated with the process environment, files, directories, permissions, and so forth. The programming interface closely follows C programming and standards such as POSIX.</p>
        <p class="indent">Practically speaking, most of this module is probably too low-level to be directly used in a typical application. However, if you’re ever faced with the problem of executing some obscure low-level system operation (such as opening a TTY), there’s a good chance you’ll find the functionality for it here.</p>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec24">9.15.14 <code>os.path</code> Module</h4>
        <p class="noindent">The <code>os.path</code> module is a legacy module for manipulating pathnames and performing common operations on the filesystem. Its functionality has been largely replaced by the newer <code>pathlib</code> module, but since its use is still so widespread, you’ll continue to see it in a lot of code.</p>
        <p class="indent">One fundamental problem solved by this module is portable handling of path separators on UNIX (forward-slash <code>/</code>) and Windows (backslash <code>\</code>). Functions such as <code>os.path.join()</code> and <code>os.path.split()</code> are often used to pull apart filepaths and put them back together:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0281-02" id="f0281-02">Click here to view code image</a></p>
        <pre>&gt;&gt;&gt; filename = '/Users/beazley/Desktop/old/data.csv'
        &gt;&gt;&gt; os.path.split()
        ('/Users/beazley/Desktop/old', 'data.csv')
        &gt;&gt;&gt; os.path.join('/Users/beazley/Desktop', 'out.txt')
        <span epub:type="pagebreak" id="page_282"></span>'/Users/beazley/Desktop/out.txt'
        &gt;&gt;&gt;</pre>
        <p class="indent">Here is an example of code that uses these functions:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0282-02" id="f0282-02">Click here to view code image</a></p>
        <pre>import os.path
        
        <span class="lgreen"><strong>def</strong></span> clean_line(line):
            <span class="hblue"># Line up a line (whatever)</span>
            <span class="lgreen"><strong>return</strong></span> line.strip().upper() <span class="igrey">+</span> <span class="mblue">'\n'</span>
        
        <span class="lgreen"><strong>def</strong></span> clean_data(filename):
            dirname, basename <span class="igrey">=</span> os.path.split()
            newname <span class="igrey">=</span> os.path.join(dirname, basename<span class="igrey">+</span><span class="mblue">'.clean'</span>)
            <span class="lgreen"><strong>with</strong></span> open(newname, <span class="mblue">'w'</span>) as out_f:
                <span class="lgreen"><strong>with</strong></span> open(filename, <span class="mblue">'r'</span>) as in_f:
                    <span class="lgreen"><strong>for</strong></span> line <span class="lgreen"><strong>in</strong></span> in_f:
                        out_f.write(clean_line(line))</pre>
        <p class="indent">The <code>os.path</code> module also has a number of functions, such as <code>isfile()</code>, <code>isdir()</code>, and <code>getsize()</code>, for performing tests on the filesystem and getting file metadata. For example, this function returns the total size in bytes of a simple file or of all of files in a directory:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0282-03" id="f0282-03">Click here to view code image</a></p>
        <pre>import os.path
        
        <span class="lgreen"><strong>def</strong></span> compute_usage(filename):
            <span class="lgreen"><strong>if</strong></span> os.path.isfile(filename):
                <span class="lgreen"><strong>return</strong></span> os.path.getsize(filename)
            <span class="lgreen"><strong>elif</strong></span> os.path.isdir(filename):
                <span class="lgreen"><strong>return</strong></span> sum(compute_usage(os.path.join(filename, name))
                           <span class="lgreen"><strong>for</strong></span> name <span class="lgreen"><strong>in</strong></span> os.listdir(filename))
            <span class="lgreen"><strong>else</strong></span>:
                <span class="lgreen"><strong>raise</strong></span> <span class="pgold">RuntimeError</span>(<span class="mblue">'Unsupported file kind'</span>)</pre>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec25">9.15.15 <code>pathlib</code> Module</h4>
        <p class="noindent">The <code>pathlib</code> module is the modern way of manipulating pathnames in a portable and high-level manner. It combines a lot of the file-oriented functionality in one place and uses an object-oriented interface. The core object is the <code>Path</code> class. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0282-04" id="f0282-04">Click here to view code image</a></p>
        <pre>from pathlib import Path
        
        filename <span class="igrey">=</span> Path(<span class="mblue">'/Users/beazley/old/data.csv'</span>)</pre>
        <p class="indent">Once you have an instance <code>filename</code> of <code>Path</code>, you can perform various operations on it to manipulate the filename. For example:<span epub:type="pagebreak" id="page_283"></span></p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0283-01" id="f0283-01">Click here to view code image</a></p>
        <pre>&gt;&gt;&gt; filename.name
        'data.csv'
        &gt;&gt;&gt; filename.parent
        Path('/Users/beazley/old')
        &gt;&gt;&gt; filename.parent / 'newfile.csv'
        Path('/Users/beazley/old/newfile.csv')
        &gt;&gt;&gt; filename.parts
        ('/', 'Users', 'beazley', 'old', 'data.csv')
        &gt;&gt;&gt; filename.with_suffix('.csv.clean')
        Path('/Users/beazley/old/data.csv.clean')
        &gt;&gt;&gt;</pre>
        <p class="indent"><code>Path</code> instances also have functions for obtaining file metadata, getting directory listings, and other similar functions. Here is a reimplementation of the <code>compute_usage()</code> function from the previous section:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0283-02" id="f0283-02">Click here to view code image</a></p>
        <pre>import pathlib
        
        <span class="lgreen"><strong>def</strong></span> compute_usage(filename):
            pathname <span class="igrey">=</span> pathlib.Path(filename)
            <span class="lgreen"><strong>if</strong></span> pathname.is_file():
                <span class="lgreen"><strong>return</strong></span> pathname.stat().st_size
            <span class="lgreen"><strong>elif</strong></span> pathname.is_dir():
                <span class="lgreen"><strong>return</strong></span> sum(path.stat().st_size
                           <span class="lgreen"><strong>for</strong></span> path <span class="lgreen"><strong>in</strong></span> pathname.rglob(<span class="mblue">'*'</span>)
                           <span class="lgreen"><strong>if</strong></span> path.is_file())
                <span class="lgreen"><strong>return</strong></span> pathname.stat().st_size
            <span class="lgreen"><strong>else</strong></span>:
                <span class="lgreen"><strong>raise</strong></span> <span class="pgold">RuntimeError</span>(<span class="mblue">'Unsupported file kind'</span>)</pre>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec26">9.15.16 <code>re</code> Module</h4>
        <p class="noindent">The <code>re</code> module is used to perform text matching, searching, and replacement operations using regular expressions. Here is a simple example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0283-03" id="f0283-03">Click here to view code image</a></p>
        <pre>&gt;&gt;&gt; text = 'Today is 3/27/2018. Tomorrow is 3/28/2018.'
        &gt;&gt;&gt; # Find all occurrences of a date
        &gt;&gt;&gt; import re
        &gt;&gt;&gt; re.findall(r'\d+/\d+/\d+', text)
        ['3/27/2018', '3/28/2018']
        &gt;&gt;&gt; # Replace all occurrences of a date with replacement text
        &gt;&gt;&gt; re.sub(r'(\d+)/(\d+)/(\d+)', r'\3-\1-\2', text)
        'Today is 2018-3-27. Tomorrow is 2018-3-28.'
        &gt;&gt;&gt;</pre>
        <p class="indent"><span epub:type="pagebreak" id="page_284"></span>Regular expressions are often notorious for their inscrutable syntax. In this example, the <code>\d+</code> is interpreted to mean “one or more digits.” More information about the pattern syntax can be found in the official documentation for the <code>re</code> module.</p>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec27">9.15.17 <code>shutil</code> Module</h4>
        <p class="noindent">The <code>shutil</code> module is used to carry out some common tasks that you might otherwise perform in the shell. These include copying and removing files, working with archives, and so forth. For example, to copy a file:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0284-01" id="f0284-01">Click here to view code image</a></p>
        <pre>import shutil
        
        shutil.copy(srcfile, dstfile)</pre>
        <p class="indent">To move a file:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0284-01a" id="f0284-01a">Click here to view code image</a></p>
        <pre>shutil.move(srcfile, dstfile)</pre>
        <p class="indent">To copy a directory tree:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0284-01b" id="f0284-01b">Click here to view code image</a></p>
        <pre>shutil.copytree(srcdir, dstdir)</pre>
        <p class="indent">To remove a directory tree:</p>
        <pre>shutil.rmtree(pathname)</pre>
        <p class="indent">The <code>shutil</code> module is often used as a safer and more portable alternative to directly executing shell commands with the <code>os.system()</code> function.</p>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec28">9.15.18 <code>select</code> Module</h4>
        <p class="noindent">The <code>select</code> module is used for simple polling of multiple I/O streams. That is, it can be used to watch a collection of file descriptors for incoming data or for the ability to receive outgoing data. The following example shows typical usage:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0284-02" id="f0284-02">Click here to view code image</a></p>
        <pre>import select
        
        <span class="hblue"># Collections of objects representing file descriptors.  Must be</span>
        <span class="hblue"># integers or objects with a fileno() method.</span>
        want_to_read <span class="igrey">=</span> [ ... ]
        want_to_write <span class="igrey">=</span> [ ... ]
        check_exceptions <span class="igrey">=</span> [ ... ]
        
        <span class="hblue"># Timeout (or None)</span>
        timeout <span class="igrey">=</span> <span class="dblue">None</span>
        
        <span class="hblue"># Poll for I/O</span>
        <span epub:type="pagebreak" id="page_285"></span>can_read, can_write, have_exceptions <span class="igrey">= \</span>
            select.select(want_to_read, want_to_write, check_exceptions, timeout)
        
        <span class="hblue"># Perform I/O operations</span>
        <span class="lgreen"><strong>for</strong></span> file <span class="lgreen"><strong>in</strong></span> can_read:
            do_read(file)
        <span class="lgreen"><strong>for</strong></span> file <span class="lgreen"><strong>in</strong></span> can_write:
            do_write(file)
        
        <span class="hblue"># Handle exceptions</span>
        <span class="lgreen"><strong>for</strong></span> file <span class="lgreen"><strong>in</strong></span> have_exceptions:
            handle_exception(file)</pre>
        <p class="indent">In this code, three sets of file descriptors are constructed. These sets correspond to reading, writing, and exceptions. These are passed to <code>select()</code> along with an optional timeout. <code>select()</code> returns three subsets of the passed arguments. These subsets represent the files on which the requested operation can be performed. For example, a file returned in <code>can_read()</code> has incoming data pending.</p>
        <p class="indent">The <code>select()</code> function is a standard low-level system call that’s commonly used to watch for system events and to implement asynchronous I/O frameworks such as the built-in <code>asyncio</code> module.</p>
        <p class="indent">In addition to <code>select()</code>, the <code>select</code> module also exposes <code>poll()</code>, <code>epoll()</code>, <code>kqueue()</code>, and similar variant functions that provide similar functionality. The availability of these functions varies by operating system.</p>
        <p class="indent">The <code>selectors</code> module provides a higher-level interface to <code>select</code> that might be useful in certain contexts. An example was given earlier in <a href="ch09.xhtml#ch09lev2sec8">Section 9.14.2</a>.</p>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec29">9.15.19 <code>smtplib</code> Module</h4>
        <p class="noindent">The <code>smtplib</code> module implements the client side of SMTP, commonly used to send email messages. A common use of the module is in a script that does just that—sends an email to someone. Here is an example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0285-02" id="f0285-02">Click here to view code image</a></p>
        <pre>import smtplib
        
        fromaddr <span class="igrey">=</span> <span class="mblue">"someone@some.com"</span>
        toaddrs <span class="igrey">=</span> [<span class="mblue">"recipient@other.com"</span> ]
        amount <span class="igrey">=</span> <span class="sgreen">123.45</span>
        msg <span class="igrey">=</span> <span class="trose">f"""From:</span> <span class="mblue">{</span>fromaddr<span class="mblue">}\r</span>
        <span class="mblue">\r</span>
        <span class="trose">Pay</span> <span class="mblue">{</span>amount<span class="mblue">}</span> <span class="trose">bitcoin or else.  We're watching.</span><span class="mblue">\r</span>
        <span class="trose">"""</span>
        
        server <span class="igrey">=</span> smtplib.SMTP(<span class="mblue">'localhost'</span>)
        serv.sendmail(fromaddr, toaddrs, msg)
        serv.quit()</pre>
        <p class="indent"><span epub:type="pagebreak" id="page_286"></span>There are additional features to handle passwords, authentication, and other matters. However, if you’re running a script on a machine and that machine is configured to support email, the above example will usually do the job.</p>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec30">9.15.20 <code>socket</code> Module</h4>
        <p class="noindent">The <code>socket</code> module provides low-level access to network programming functions. The interface is modeled after the standard BSD socket interface commonly associated with system programming in C.</p>
        <p class="indent">The following example shows how to make an outgoing connection and receive a response:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0286-01" id="f0286-01">Click here to view code image</a></p>
        <pre>from socket import socket, AF_INET, SOCK_STREAM
        
        sock <span class="igrey">=</span> socket(AF_INET, SOCK_STREAM)
        sock.connect((<span class="mblue">'python.org'</span>, <span class="sgreen">80</span>))
        sock.send(b<span class="mblue">'GET /index.html HTTP/1.0\r\n\r\n'</span>)
        parts <span class="igrey">=</span> []
        <span class="lgreen"><strong>while</strong></span> <span class="dblue">True</span>:
            part <span class="igrey">=</span> sock.recv(<span class="sgreen">10000</span>)
            <span class="lgreen"><strong>if not</strong></span> part:
                <span class="lgreen"><strong>break</strong></span>
            parts.append(part)
        response <span class="igrey">=</span> b<span class="mblue">''</span>.join(part)
        print(part)</pre>
        <p class="indent">The following example shows a basic echo server that accepts client connections and echoes back any received data. To test this server, run it and then connect to it using a command such as <code>telnet localhost 25000</code> or <code>nc localhost 25000</code> in a separate terminal session.</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0286-02" id="f0286-02">Click here to view code image</a></p>
        <pre>from socket import socket, AF_INET, SOCK_STREAM
        
        <span class="lgreen"><strong>def</strong></span> echo_server(address):
            sock <span class="igrey">=</span> socket(AF_INET, SOCK_STREAM)
            sock.bind(address)
            sock.listen(<span class="sgreen">1</span>)
            <span class="lgreen"><strong>while</strong></span> <span class="dblue">True</span>:
                client, addr <span class="igrey">=</span> sock.accept()
                echo_handler(client, addr)
        
        <span class="lgreen"><strong>def</strong></span> echo_handler(client, addr):
            print(<span class="mblue">'Connection from:'</span>, addr)
            <span class="lgreen"><strong>with</strong></span> client:
                <span class="lgreen"><strong>while</strong></span> <span class="dblue">True</span>:
                    data <span class="igrey">=</span> client.recv(<span class="sgreen">10000</span>)
        <span epub:type="pagebreak" id="page_287"></span>            <span class="lgreen"><strong>if not</strong></span> data:
                        <span class="lgreen"><strong>break</strong></span>
                    client.sendall(data)
            print(<span class="mblue">'Connection closed'</span>)
        
        <span class="lgreen"><strong>if</strong></span> <span class="dblue">__name__</span> <span class="igrey">==</span> <span class="mblue">'__main__'</span>:
            echo_server((<span class="mblue">''</span>, <span class="sgreen">25000</span>))</pre>
        <p class="indent">For UDP servers, there is no connection process. However, a server must still bind the socket to a known address. Here is a typical example of what a UDP server and client look like:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0287-02" id="f0287-02">Click here to view code image</a></p>
        <pre><span class="hblue"># udp.py</span>
        
        from socket import socket, AF_INET, SOCK_DGRAM
        
        <span class="lgreen"><strong>def</strong></span> run_server(address):
            sock <span class="igrey">=</span> socket(AF_INET, SOCK_DGRAM)     <span class="hblue"># 1. Create a UDP socket</span>
            sock.bind(address)                     <span class="hblue"># 2. Bind to address/port</span>
            <span class="lgreen"><strong>while</strong></span> <span class="dblue">True</span>:
                msg, addr <span class="igrey">=</span> sock.recvfrom(<span class="sgreen">2000</span>)    <span class="hblue"># 3. Get a message</span>
                <span class="hblue"># ... do something</span>
                response <span class="igrey">=</span> b<span class="mblue">'world'</span>
                sock.sendto(response, addr)        <span class="hblue"># 4. Send a response back</span>
        
        <span class="lgreen"><strong>def</strong></span> run_client(address):
            sock <span class="igrey">=</span> socket(AF_INET, SOCK_DGRAM)     <span class="hblue"># 1. Create a UDP socket</span>
            sock.sendto(b<span class="mblue">'hello'</span>, address)         <span class="hblue"># 2. Send a message</span>
            response, addr <span class="igrey">=</span> sock.recvfrom(<span class="sgreen">2000</span>)   <span class="hblue"># 3. Get response</span>
            print(<span class="mblue">"Received:"</span>, response)
            sock.close()
        
        <span class="lgreen"><strong>if</strong></span> <span class="dblue">__name__</span> <span class="igrey">==</span> <span class="mblue">'__main__'</span>:
            import sys
            <span class="lgreen"><strong>if</strong></span> len(sys.argv) <span class="igrey">!=</span> <span class="sgreen">4</span>:
                <span class="lgreen"><strong>raise</strong></span> <span class="pgold">SystemExit</span>(<span class="mblue">'Usage: udp.py [-client|-server] hostname port'</span>)
            address <span class="igrey">=</span> (sys.argv[<span class="sgreen">2</span>], int(sys.argv[<span class="sgreen">3</span>]))
            <span class="lgreen"><strong>if</strong></span> sys.argv[<span class="sgreen">1</span>] <span class="igrey">==</span> <span class="mblue">'-server'</span>:
                run_server(address)
            <span class="lgreen"><strong>elif</strong></span> sys.argv[<span class="sgreen">1</span>] <span class="igrey">==</span> <span class="mblue">'-client'</span>:
                run_client(address)</pre>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec31"><span epub:type="pagebreak" id="page_288"></span>9.15.21 <code>struct</code> Module</h4>
        <p class="noindent">The <code>struct</code> module is used to convert data between Python and binary data structures, represented as Python byte strings. These data structures are often used when interacting with functions written in C, binary file formats, network protocols, or binary communication over serial ports.</p>
        <p class="indent">As an example, suppose you need to construct a binary message with its format described by a C data structure:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0288-01" id="f0288-01">Click here to view code image</a></p>
        <pre># Message format: All values are "big endian"
        struct Message {
            unsigned short msgid;      // 16 bit unsigned integer
            unsigned int sequence;     // 32 bit sequence number
            float x;                   // 32 bit float
            float y;                   // 32 bit float
        }</pre>
        <p class="indent">Here’s how you do this using the <code>struct</code> module:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0288-02" id="f0288-02">Click here to view code image</a></p>
        <pre>&gt;&gt;&gt; import struct
        &gt;&gt;&gt; data = struct.pack('&gt;HIff', 123, 456, 1.23, 4.56)
        &gt;&gt;&gt; data
        b'\x00{\x00\x00\x00-?\x9dp\xa4@\x91\xeb\x85'
        &gt;&gt;&gt;</pre>
        <p class="indent">To decode binary data, use <code>struct.unpack</code>:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0288-02a" id="f0288-02a">Click here to view code image</a></p>
        <pre>&gt;&gt;&gt; struct.unpack('&gt;HIff', data)
        (123, 456, 1.2300000190734863, 4.559999942779541)
        &gt;&gt;&gt;</pre>
        <p class="indent">The differences in the floating-point values are due to the loss of accuracy incurred by their conversion to 32-bit values. Python represents floating-point values as 64-bit double precision values.</p>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec32">9.15.22 <code>subprocess</code> Module</h4>
        <p class="noindent">The <code>subprocess</code> module is used to execute a separate program as a subprocess, but with control over the execution environment including I/O handling, termination, and so forth. There are two common uses of the module.</p>
        <p class="indent">If you want to run a separate program and collect all of its output at once, use <code>check_output()</code>. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0288-03" id="f0288-03">Click here to view code image</a></p>
        <pre>import subprocess
        
        <span class="hblue"># Run the 'netstat -a' command and collect its output</span>
        <span class="lgreen"><strong>try</strong></span>:
            out <span class="igrey">=</span> subprocess.check_output([<span class="mblue">'netstat'</span>, <span class="mblue">'-a'</span>])
        <span epub:type="pagebreak" id="page_289"></span><span class="lgreen"><strong>except</strong></span> subprocess.CalledProcessError as e:
            print(<span class="mblue">"It failed:"</span>, e)</pre>
        <p class="indent">The data returned by <code>check_output()</code> is presented as bytes. If you want to convert it to text, make sure you apply a proper decoding:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0289-02" id="f0289-02">Click here to view code image</a></p>
        <pre>text <span class="igrey">=</span> out.decode(<span class="mblue">'utf-8'</span>)</pre>
        <p class="indent">It is also possible to set up a pipe and to interact with a subprocess in a more detailed manner. To do that, use the <code>Popen</code> class like this:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0289-03" id="f0289-03">Click here to view code image</a></p>
        <pre>import subprocess
        
        p <span class="igrey">=</span> subprocess.Popen([<span class="mblue">'wc'</span>],
                             stdin<span class="igrey">=</span>subprocess.PIPE,
                             stdout<span class="igrey">=</span>subprocess.PIPE)
        
        <span class="hblue"># Send data to the subprocess</span>
        p.stdin.write(b<span class="mblue">'hello world\nthis is a test\n'</span>)
        p.stdin.close()
        
        <span class="hblue"># Read data back</span>
        out <span class="igrey">=</span> p.stdout.read()
        print(out)</pre>
        <p class="indent">An instance <code>p</code> of <code>Popen</code> has attributes <code>stdin</code> and <code>stdout</code> that can be used to communicate with the subprocess.</p>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec33">9.15.23 <code>tempfile</code> Module</h4>
        <p class="noindent">The <code>tempfile</code> module provides support for creating temporary files and directories. Here is an example of creating a temporary file:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0289-04" id="f0289-04">Click here to view code image</a></p>
        <pre>import tempfile
        
        <span class="lgreen"><strong>with</strong></span> tempfile.TemporaryFile() as f:
            f.write(b<span class="mblue">'Hello World'</span>)
            f.seek(<span class="sgreen">0</span>)
            data <span class="igrey">=</span> f.read()
            print(<span class="mblue">'Got:'</span>, data)</pre>
        <p class="indent">By default, temporary files are open in binary mode and allow both reading and writing. The <code>with</code> statement is also commonly used to define a scope for when the file will be used. The file is deleted at the end of the <code>with</code> block.</p>
        <p class="indent">If you would like to create a temporary directory, use this:<span epub:type="pagebreak" id="page_290"></span></p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0290-01" id="f0290-01">Click here to view code image</a></p>
        <pre><span class="lgreen"><strong>with</strong></span> tempfile.TemporaryDirectory() as dirname:
            <span class="hblue"># Use the directory dirname</span>
            ...</pre>
        <p class="indent">As with a file, the directory and all of its contents will be deleted at the end of the <code>with</code> block.</p>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec34">9.15.24 <code>textwrap</code> Module</h4>
        <p class="noindent">The <code>textwrap</code> module can be used to format text to fit a specific terminal width. Perhaps it’s a bit special-purpose but it can sometimes be useful in cleaning up text for output when making reports. There are two functions of interest.</p>
        <p class="indent"><code>wrap()</code> takes text and wraps it to fit a specified column width. The function returns a list of strings. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0290-02" id="f0290-02">Click here to view code image</a></p>
        <pre>import textwrap
        
        text <span class="igrey">=</span> <span class="mblue">"""look into my eyes</span>
        <span class="mblue">look into my eyes</span>
        <span class="mblue">the eyes the eyes the eyes</span>
        <span class="mblue">not around the eyes</span>
        <span class="mblue">don't look around the eyes</span>
        <span class="mblue">look into my eyes you're under
        """</span>
        
        wrapped <span class="igrey">=</span> textwrap.wrap(text, width<span class="igrey">=</span><span class="sgreen">81</span>)
        print(<span class="mblue">'\n'</span>.join(wrapped))
        <span class="hblue"># Produces:</span>
        <span class="hblue"># look into my eyes look into my eyes the</span>
        <span class="hblue"># eyes the eyes the eyes not around the</span>
        <span class="hblue"># eyes don't look around the eyes look</span>
        <span class="hblue"># into my eyes you're under</span></pre>
        <p class="indent">The <code>indent()</code> function can be used to indent a block of text. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0290-03" id="f0290-03">Click here to view code image</a></p>
        <pre>print(textwrap.indent(text, '    '))
        # Produces:
        #    look into my eyes
        #    look into my eyes
        #    the eyes the eyes the eyes
        #    not around the eyes
        #    don't look around the eyes
        #    look into my eyes you're under</pre>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec35"><span epub:type="pagebreak" id="page_291"></span>9.15.25 <code>threading</code> Module</h4>
        <p class="noindent">The <code>threading</code> module is used to execute code concurrently. This problem commonly arises with I/O handling in network programs. Thread programming is a large topic, but the following examples illustrate solutions to common problems.</p>
        <p class="indent">Here’s an example of launching a thread and waiting for it:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0291-01" id="f0291-01">Click here to view code image</a></p>
        <pre>import threading
        import time
        
        <span class="lgreen"><strong>def</strong></span> countdown(n):
            <span class="lgreen"><strong>while</strong></span> n <span class="igrey">&gt;</span> <span class="sgreen">0</span>:
                print(<span class="mblue">'T-minus'</span>, n)
                n <span class="igrey">-=</span> <span class="sgreen">1</span>
                time.sleep(<span class="sgreen">1</span>)
        
        t <span class="igrey">=</span> threading.Thread(target<span class="igrey">=</span>countdown, args<span class="igrey">=</span>[<span class="sgreen">10</span>])
        t.start()
        t.join()      <span class="hblue"># Wait for the thread to finish</span></pre>
        <p class="indent">If you’re never going to wait for the thread to finish, make it daemonic by supplying an extra <code>daemon</code> flag like this:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0291-02" id="f0291-02">Click here to view code image</a></p>
        <pre>t <span class="igrey">=</span> threading.Thread(target<span class="igrey">=</span>countdown, args<span class="igrey">=</span>[<span class="sgreen">10</span>], daemon<span class="igrey">=</span><span class="dblue">True</span>)</pre>
        <p class="indent">If you want to make a thread terminate, you’ll need to do so explicitly with a flag or some dedicated variable for that purpose. The thread will have to be programmed to check for it.</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0291-03" id="f0291-03">Click here to view code image</a></p>
        <pre>import threading
        import time
        
        must_stop <span class="igrey">=</span> <span class="dblue">False</span>
        
        <span class="lgreen"><strong>def</strong></span> countdown(n):
            <span class="lgreen"><strong>while</strong></span> n <span class="igrey">&gt;</span> <span class="sgreen">0</span> <span class="lgreen"><strong>and not</strong></span> must_stop:
                print(<span class="mblue">'T-minus'</span>, n)
                n <span class="igrey">-=</span> <span class="sgreen">1</span>
                time.sleep(<span class="sgreen">1</span>)</pre>
        <p class="indent">If threads are going to mutate shared data, protect it with a <code>Lock</code>.</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0291-04" id="f0291-04">Click here to view code image</a></p>
        <pre>import threading
        
        <span class="lgreen"><strong>class</strong></span> Counter:
            <span class="lgreen"><strong>def</strong></span> <span class="cblue">__init__</span>(<span class="dblue">self</span>):
                <span class="dblue">self</span>.value <span class="igrey">=</span> <span class="sgreen">0</span>
                <span class="dblue">self</span>.lock <span class="igrey">=</span> threading.Lock()
        
        <span epub:type="pagebreak" id="page_292"></span>    <span class="lgreen"><strong>def</strong></span> increment(<span class="dblue">self</span>):
                <span class="lgreen"><strong>with</strong></span> <span class="dblue">self</span>.lock:
                     <span class="dblue">self</span>.value <span class="igrey">+=</span> <span class="sgreen">1</span>
        
            <span class="lgreen"><strong>def</strong></span> decrement(<span class="dblue">self</span>):
                <span class="lgreen"><strong>with</strong></span> <span class="dblue">self</span>.lock:
                     <span class="dblue">self</span>.value <span class="igrey">-=</span> <span class="sgreen">1</span></pre>
        <p class="indent">If one thread must wait for another thread to do something, use an <code>Event</code>.</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0292-02" id="f0292-02">Click here to view code image</a></p>
        <pre>import threading
        import time
        
        <span class="lgreen"><strong>def</strong></span> step1(evt):
            print(<span class="mblue">'Step 1'</span>)
            time.sleep(<span class="sgreen">5</span>)
            evt.set()
        
        <span class="lgreen"><strong>def</strong></span> step2(evt):
            evt.wait()
            print(<span class="mblue">'Step 2'</span>)
        
        evt <span class="igrey">=</span> threading.Event()
        threading.Thread(target<span class="igrey">=</span>step1, args<span class="igrey">=</span>[evt]).start()
        threading.Thread(target<span class="igrey">=</span>step2, args<span class="igrey">=</span>[evt]).start()</pre>
        <p class="indent">If threads are going to communicate, use a <code>Queue</code>:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0292-03" id="f0292-03">Click here to view code image</a></p>
        <pre>import threading
        import queue
        import time
        
        <span class="lgreen"><strong>def</strong></span> producer(q):
            <span class="lgreen"><strong>for</strong></span> i <span class="lgreen"><strong>in</strong></span> range(<span class="sgreen">10</span>):
                print(<span class="mblue">'Producing:'</span>, i)
                q.put(i)
            print(<span class="mblue">'Done'</span>)
            q.put(<span class="dblue">None</span>)
        
        <span class="lgreen"><strong>def</strong></span> consumer(q):
            <span class="lgreen"><strong>while</strong></span> <span class="dblue">True</span>:
                item <span class="igrey">=</span> q.get()
                <span class="lgreen"><strong>if</strong></span> item <span class="lgreen"><strong>is</strong></span> <span class="dblue">None</span>:
                    <span class="lgreen"><strong>break</strong></span>
                print(<span class="mblue">'Consuming:'</span>, item)
            print(<span class="mblue">'Goodbye'</span>)
        
        <span epub:type="pagebreak" id="page_293"></span>q <span class="igrey">=</span> queue.Queue()
        threading.Thread(target<span class="igrey">=</span>producer, args<span class="igrey">=</span>[q]).start()
        threading.Thread(target<span class="igrey">=</span>consumer, args<span class="igrey">=</span>[q]).start()</pre>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec36">9.15.26 <code>time</code> Module</h4>
        <p class="noindent">The <code>time</code> module is used to access system time-related functions. The following selected functions are the most useful:</p>
        <pre>sleep(seconds)</pre>
        <p class="indent">Make Python sleep for a given number of seconds, given as a floating point.</p>
        <pre>time()</pre>
        <p class="indent">Return the current system time in UTC as a floating-point number. This is the number of seconds since the epoch (usually January 1, 1970 for UNIX systems). Use <code>localtime()</code> to convert it into a data structure suitable for extracting useful information.</p>
        <pre>localtime([secs])</pre>
        <p class="indent">Return a <code>struct_time</code> object representing the local time on the system or the time represented by the floating-point value <code>secs</code> passed as an argument. The resulting struct has attributes <code>tm_year</code>, <code>tm_mon</code>, <code>tm_mday</code>, <code>tm_hour</code>, <code>tm_min</code>, <code>tm_sec</code>, <code>tm_wday</code>, <code>tm_yday</code>, and <code>tm_isdst</code>.</p>
        <pre>gmtime([secs])</pre>
        <p class="indent">The same as <code>localtime()</code> except that the resulting structure represents the time in UTC (or Greenwich Mean Time).</p>
        <pre>ctime([secs])</pre>
        <p class="indent">Convert a time represented as seconds to a text string suitable for printing. Useful for debugging and logging.</p>
        <pre>asctime(tm)</pre>
        <p class="indent">Convert a time structure as represented by <code>localtime()</code> into a text string suitable for printing.</p>
        <p class="indent">The <code>datetime</code> module is more generally used for representing dates and times for the purpose of performing date-related computations and dealing with timezones.</p>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec37">9.15.27 <code>urllib</code> Package</h4>
        <p class="noindent">The <code>urllib</code> package is used to make client-side HTTP requests. Perhaps the most useful function is <code>urllib.request.urlopen()</code> which can be used to fetch simple webpages. For example:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0293-02" id="f0293-02">Click here to view code image</a></p>
        <pre>&gt;&gt;&gt; from urllib.request import urlopen
        &gt;&gt;&gt; u = urlopen('http://www.python.org')
        <span epub:type="pagebreak" id="page_294"></span>&gt;&gt;&gt; data = u.read()
        &gt;&gt;&gt;</pre>
        <p class="indent">If you want to encode form parameters, you can use <code>urllib.parse.urlencode()</code> as shown here:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0294-02" id="f0294-02">Click here to view code image</a></p>
        <pre>from urllib.parse import urlencode
        from urllib.request import urlopen
        
        form <span class="igrey">=</span> {
           <span class="mblue">'name'</span>: <span class="mblue">'Mary A. Python'</span>,
           <span class="mblue">'email'</span>: <span class="mblue">'mary123@python.org'</span>
        }
        
        data <span class="igrey">=</span> urlencode(form)
        u <span class="igrey">=</span> urlopen(<span class="mblue">'http://httpbin.org/post'</span>, data.encode(<span class="mblue">'utf-8'</span>))
        response <span class="igrey">=</span> u.read()</pre>
        <p class="indent">The <code>urlopen()</code> function works fine for basic webpages and APIs involving HTTP or HTTPS. However, it becomes quite awkward to use if access also involves cookies, advanced authentication schemes, and other layers. Frankly, most Python programmers would use a third-party library such as <code>requests</code> or <code>httpx</code> to handle these situations. You should too.</p>
        <p class="indent">The <code>urllib.parse</code> subpackage has additional functions for manipulating URLs themselves. For example, the <code>urlparse()</code> function can be used to pull apart a URL:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0294-03" id="f0294-03">Click here to view code image</a></p>
        <pre>&gt;&gt;&gt; url = 'http://httpbin.org/get?name=Dave&amp;n=42'
        &gt;&gt;&gt; from urllib.parse import urlparse
        &gt;&gt;&gt; urlparse(url)
        ParseResult(scheme='http', netloc='httpbin.org', path='/get', params='',
        query='name=Dave&amp;n=42', fragment='')
        &gt;&gt;&gt;
        </pre>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec38">9.15.28 <code>unicodedata</code> Module</h4>
        <p class="noindent">The <code>unicodedata</code> module is used for more advanced operations involving Unicode text strings. There are often multiple representations of the same Unicode text. For example, the character U+00F1 (ñ) might be fully composed as a single character U+00F1 or decomposed into a multicharacter sequence U+006e U+0303 (n, ~). This can cause strange problems in programs that are expecting text strings that visually render the same to actually be the same in representation. Consider the following example involving dictionary keys:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0294-04" id="f0294-04">Click here to view code image</a></p>
        <pre>&gt;&gt;&gt; d = {}
        &gt;&gt;&gt; d['Jalape\xf1o'] = 'spicy'
        &gt;&gt;&gt; d['Jalapen\u0303o'] = 'mild'
        &gt;&gt;&gt; d
        <span epub:type="pagebreak" id="page_295"></span>{'jalapeño': 'spicy', 'jalapeño': 'mild' }
        &gt;&gt;&gt;</pre>
        <p class="indent">At first glance, this looks like it should be an operational error—how could a dictionary have two identical, yet separate, keys like that? The answer is found in the fact that the keys consist of different Unicode character sequences.</p>
        <p class="indent">If consistent processing of identically rendered Unicode strings is an issue, they should be normalized. The <code>unicodedata.normalize()</code> function can be used to ensure a consistent character representation. For example, <code>unicodedata.normalize('NFC', s)</code> will make sure that all characters in <code>s</code> are fully composed and not represented as a sequence of combining characters. Using <code>unicodedata.normalize('NFD', s)</code> will make sure that all characters in <code>s</code> are fully decomposed.</p>
        <p class="indent">The <code>unicodedata</code> module also has functions for testing character properties such as capitalization, numbers, and whitespace. General character properties can be obtained with the <code>unicodedata.category(c)</code> function. For example, <code>unicodedata.category('A')</code> returns <code>'Lu'</code>, signifying that the character is an uppercase letter. More information about these values can be found in the official Unicode character database at <code><a href="https://www.unicode.org/ucd">https://www.unicode.org/ucd</a></code>.</p>
        </section>
        <section>
        <h4 class="h4" id="ch09lev2sec39">9.15.29 <code>xml</code> Package</h4>
        <p class="noindent">The <code>xml</code> package is a large collection of modules for processing XML data in various ways. However, if your primary goal is to read an XML document and extract information from it, the easiest way to do it is to use the <code>xml.etree</code> subpackage. Suppose you had an XML document in a file <code>recipe.xml</code> like this:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0295-03" id="f0295-03">Click here to view code image</a></p>
        <pre><span class="cblue">&lt;?xml</span> <span class="lgreen">version=</span><span class="mblue">"1.0"</span> <span class="lgreen">encoding=</span><span class="mblue">"iso-8859-1"</span><span class="cblue">?&gt;</span>
        &lt;recipe&gt;
           &lt;title&gt;Famous Guacamole&lt;/title&gt;
           &lt;description&gt;A southwest favorite!&lt;/description&gt;
           &lt;ingredients&gt;
                &lt;item num<span class="lgreen">=</span><span class="mblue">"4"</span>&gt; Large avocados, chopped &lt;/item&gt;
                &lt;item num<span class="lgreen">=</span><span class="mblue">"1"</span>&gt; Tomato, chopped &lt;/item&gt;
                &lt;item num<span class="lgreen">=</span><span class="mblue">"1/2"</span> units<span class="lgreen">=</span><span class="mblue">"C"</span>&gt; White onion, chopped &lt;/item&gt;
                &lt;item num<span class="lgreen">=</span><span class="mblue">"2"</span> units<span class="lgreen">=</span><span class="mblue">"tbl"</span>&gt; Fresh squeezed lemon juice &lt;/item&gt;
                &lt;item num<span class="lgreen">=</span><span class="mblue">"1"</span>&gt; Jalapeno pepper, diced &lt;/item&gt;
                &lt;item num<span class="lgreen">=</span><span class="mblue">"1"</span> units<span class="lgreen">=</span><span class="mblue">"tbl"</span>&gt; Fresh cilantro, minced &lt;/item&gt;
                &lt;item num<span class="lgreen">=</span><span class="mblue">"1"</span> units<span class="lgreen">=</span><span class="mblue">"tbl"</span>&gt; Garlic, minced &lt;/item&gt;
                &lt;item num<span class="lgreen">=</span><span class="mblue">"3"</span> units<span class="lgreen">=</span><span class="mblue">"tsp"</span>&gt; Salt &lt;/item&gt;
                &lt;item num<span class="lgreen">=</span><span class="mblue">"12"</span> units<span class="lgreen">=</span><span class="mblue">"bottles"</span>&gt; Ice-cold beer &lt;/item&gt;
           &lt;/ingredients&gt;
           &lt;directions&gt;
           Combine all ingredients and hand whisk to desired consistency.
           Serve and enjoy with ice-cold beers.
        <span epub:type="pagebreak" id="page_296"></span>   &lt;/directions&gt;
        &lt;/recipe&gt;</pre>
        <p class="indent">Here’s how to extract specific elements from it:</p>
        <p class="codelink"><a href="ch09_images.xhtml#rf0296-02" id="f0296-02">Click here to view code image</a></p>
        <pre>from xml.etree.ElementTree import ElementTree
        
        doc <span class="igrey">=</span> ElementTree(file<span class="igrey">=</span><span class="mblue">"recipe.xml"</span>)
        title <span class="igrey">=</span> doc.find(<span class="mblue">'title'</span>)
        print(title.text)
        
        <span class="hblue"># Alternative (just get element text)</span>
        print(doc.findtext(<span class="mblue">'description'</span>))
        
        <span class="hblue"># Iterate over multiple elements</span>
        <span class="lgreen"><strong>for</strong></span> item <span class="lgreen"><strong>in</strong></span> doc.findall(<span class="mblue">'ingredients/item'</span>):
            num <span class="igrey">=</span> item.get(<span class="mblue">'num'</span>)
            units <span class="igrey">=</span> item.get(<span class="mblue">'units'</span>, <span class="mblue">''</span>)
            text <span class="igrey">=</span> item.text.strip()
            print(<span class="trose">f'</span><span class="mblue">{</span>num<span class="mblue">} {</span>units<span class="mblue">} {</span>text<span class="mblue">}</span><span class="trose">'</span>)</pre>
        </section>
        </section>
        <section>
        <h3 class="h3" id="ch09lev1sec16">9.16 Final Words</h3>
        <p class="noindent">I/O is a fundamental part of writing any useful program. Given its popularity, Python is able to work with literally any data format, encoding, or document structure that’s in use. Although the standard library might not support it, you will almost certainly find a third-party module to solve your problem.</p>
        <p class="indent">In the big picture, it may be more useful to think about the edges of your application. At the outer boundary between your program and reality, it’s common to encounter issues related to data encoding. This is especially true for textual data and Unicode. Much of the complexity in Python’s I/O handling—supporting different encoding, error handling policies, and so on—is aimed at this specific problem. It’s also critical to keep in mind that textual data and binary data are strictly separated. Knowing what you’re working with helps in understanding the big picture.</p>
        <p class="indent">A secondary consideration in I/O is the overall evaluation model. Python code is currently separated into two worlds—normal synchronous code and asynchronous code usually associated with the <code>asyncio</code> module (characterized by the use of <code>async</code> functions and the <code>async/await</code> syntax). Asynchronous code almost always requires using dedicated libraries that are capable of operating in that environment. This, in turn, forces your hand on writing your application code in the “async” style as well. Honestly, you should probably avoid asynchronous coding unless you absolutely know that you need it—and if you’re not really sure, then you almost certainly don’t. Most of the well-adjusted Python-speaking universe codes in a normal synchronous style that is far easier to reason about, debug, and test. You should choose that.</p>
        </section>
        </section>
        </div>
        <div id="sbo-rt-content"><section epub:type="chapter">
            <h2 class="h2" id="ch10"><span epub:type="pagebreak" id="page_297"></span><span class="ash">10.</span> Built-in Functions and Standard Library</h2>
            <p class="noindent">This chapter is a compact reference to Python built-in functions. These functions are always available without any <code>import</code> statement. The chapter concludes with a brief overview of some useful standard library modules.</p>
            <section>
            <h3 class="h3" id="ch10lev1sec1">10.1 Built-in Functions</h3>
            <pre>abs(x)</pre>
            <p class="indent1">Returns the absolute value of <code>x</code>.</p>
            <pre>all(s)</pre>
            <p class="indent1">Returns <code>True</code> if all of the values in the iterable <code>s</code> evaluate as <code>True</code>. Returns <code>True</code> if <code>s</code> is empty.</p>
            <pre>any(s)</pre>
            <p class="indent1">Returns <code>True</code> if any of the values in the iterable <code>s</code> evaluate as <code>True</code>. Returns <code>False</code> if <code>s</code> is empty.</p>
            <pre>ascii(x)</pre>
            <p class="indent1">Creates a printable representation of the object <code>x</code> just like the <code>repr()</code>, but only uses ASCII characters in the result. Non-ASCII characters are turned into appropriate escape sequences. This can be used to view Unicode strings in a terminal or shell that doesn’t support Unicode.</p>
            <pre>bin(x)</pre>
            <p class="indent1">Returns a string with the binary representation of the integer <code>x</code>.</p>
            <pre>bool([x])</pre>
            <p class="indent1">Type representing Boolean values <code>True</code> and <code>False</code>. If used to convert <code>x</code>, it returns <code>True</code> if <code>x</code> evaluates to true using the usual truth-testing semantics—that is, nonzero number, nonempty list, and so on. Otherwise, <code>False</code> is returned. <code>False</code> is also the default value returned if <code>bool()</code> is called without any arguments. The <code>bool</code> class <span epub:type="pagebreak" id="page_298"></span>inherits from <code>int</code> so the Boolean values <code>True</code> and <code>False</code> can be used as integers with values <code>1</code> and <code>0</code> in mathematical calculations.</p>
            <pre>breakpoint()</pre>
            <p class="indent1">Sets a manual debugger breakpoint. When encountered, control will transfer to <code>pdb</code>, the Python debugger.</p>
            <pre>bytearray([x])</pre>
            <p class="indent1">A type representing a mutable array of bytes. When creating an instance, <code>x</code> may either be an iterable sequence of integers in the range 0 to 255, an 8-bit string or bytes literal, or an integer that specifies the size of the byte array (in which case every entry will be initialized to <code>0</code>).</p>
            <pre>bytearray(s ,encoding)</pre>
            <p class="indent1">An alternative calling convention for creating a <code>bytearray</code> instance from characters in a string <code>s</code> where <code>encoding</code> specifies the character encoding to use in the conversion.</p>
            <pre>bytes([x])</pre>
            <p class="indent1">A type representing an immutable array of bytes.</p>
            <pre>bytes(s, encoding)</pre>
            <p class="indent1">An alternate calling convention for creating bytes from a string <code>s</code> where <code>encoding</code> specifies the encoding to use in conversion.</p>
            <p class="indent"><a href="ch10.xhtml#ch10tab01">Table 10.1</a> shows operations supported by both bytes and byte arrays.</p>
            <figure class="table" id="ch10tab01">
            <figcaption><p class="tab-caption"><span class="ash">Table 10.1</span> Operations on Bytes and Bytearrays</p></figcaption>
            <table>
            <thead>
            <tr>
            <th><p class="tabtext">Operation</p></th>
            <th><p class="tabtext">Description</p></th>
            </tr>
            </thead>
            <tbody>
            <tr>
            <td><p class="tabtext"><code>s + t</code></p></td>
            <td><p class="tabtext">Concatenates if <code>t</code> is bytes.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s * n</code></p></td>
            <td><p class="tabtext">Replicates if <code>n</code> is an integer.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s % x</code></p></td>
            <td><p class="tabtext">Formats bytes. <code>x</code> is tuple.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s[i]</code></p></td>
            <td><p class="tabtext">Returns element <code>i</code> as an integer.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s[i:j]</code></p></td>
            <td><p class="tabtext">Returns a slice.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s[i:j:stride]</code></p></td>
            <td><p class="tabtext">Returns an extended slice.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>len(s)</code></p></td>
            <td><p class="tabtext">Number of bytes in <code>s</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.capitalize()</code></p></td>
            <td><p class="tabtext">Capitalizes the first character.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.center(width [, pad])</code></p></td>
            <td><p class="tabtext">Centers the string in a field of length <code>width</code>. <code>pad</code> is a padding character.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.count(sub [, start [, end]])</code></p></td>
            <td><p class="tabtext">Counts occurrences of the specified substring <code>sub</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.decode([encoding [, errors]])</code></p></td>
            <td><p class="tabtext">Decodes a byte string into text (<code>bytes</code> type only).</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.endswith(suffix [, start [, end]])</code></p></td>
            <td><p class="tabtext">Checks the end of the string for a <code>suffix</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.expandtabs([tabsize])</code></p></td>
            <td><p class="tabtext">Replaces tabs with spaces.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><span epub:type="pagebreak" id="page_299"></span><code>s.find(sub [, start [, end]])</code></p></td>
            <td><p class="tabtext">Finds the first occurrence of the specified substring <code>sub</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.hex()</code></p></td>
            <td><p class="tabtext">Converts to a hexadecimal string.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.index(sub [, start [, end]])</code></p></td>
            <td><p class="tabtext">Finds the first occurrence or error in the specified substring <code>sub</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.isalnum()</code></p></td>
            <td><p class="tabtext">Checks whether all characters are alphanumeric.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.isalpha()</code></p></td>
            <td><p class="tabtext">Checks whether all characters are alphabetic.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.isascii()</code></p></td>
            <td><p class="tabtext">Checks whether all characters are ASCII.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.isdigit()</code></p></td>
            <td><p class="tabtext">Checks whether all characters are digits.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.islower()</code></p></td>
            <td><p class="tabtext">Checks whether all characters are lowercase.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.isspace()</code></p></td>
            <td><p class="tabtext">Checks whether all characters are whitespace.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.istitle()</code></p></td>
            <td><p class="tabtext">Checks whether the string is a title-cased string (first letter of each word capitalized).</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.isupper()</code></p></td>
            <td><p class="tabtext">Checks whether all characters are uppercase.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.join(t)</code></p></td>
            <td><p class="tabtext">Joins a sequence of strings <code>t</code> using a delimiter <code>s</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.ljust(width [, fill])</code></p></td>
            <td><p class="tabtext">Left-aligns <code>s</code> in a string of size <code>width</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.lower()</code></p></td>
            <td><p class="tabtext">Converts to lowercase.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.lstrip([chrs])</code></p></td>
            <td><p class="tabtext">Removes leading whitespace or characters supplied in <code>chrs</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.maketrans(x [, y [, z]])</code></p></td>
            <td><p class="tabtext">Makes a translation table for <code>s.translate()</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.partition(sep)</code></p></td>
            <td><p class="tabtext">Partitions a string based on a separator string <code>sep</code>. Returns a tuple <code>(head, sep, tail)</code> or <code>(s, '', '')</code> if <code>sep</code> isn’t found.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.removeprefix(prefix)</code></p></td>
            <td><p class="tabtext">Returns <code>s</code> with a given <code>prefix</code> removed if present.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.removesuffix(suffix)</code></p></td>
            <td><p class="tabtext">Returns <code>s</code> with a given <code>suffix</code> removed if present.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.replace(old, new [, maxreplace])</code></p></td>
            <td><p class="tabtext">Replaces a substring.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.rfind(sub [, start [, end]])</code></p></td>
            <td><p class="tabtext">Finds the last occurrence of a substring.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.rindex(sub [, start [, end]])</code></p></td>
            <td><p class="tabtext">Finds the last occurrence or raises an error.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.rjust(width [, fill])</code></p></td>
            <td><p class="tabtext">Right-aligns <code>s</code> in a string of length <code>width</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.rpartition(sep)</code></p></td>
            <td><p class="tabtext">Partitions <code>s</code> based on a separator <code>sep</code>, but searches from the end of the string.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.rsplit([sep [, maxsplit]])</code></p></td>
            <td><p class="tabtext">Splits a string from the end of the string using <code>sep</code> as a delimiter. <code>maxsplit</code> is the maximum number of splits to perform. If <code>maxsplit</code> is omitted, the result is identical to the <code>split()</code> method.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><span epub:type="pagebreak" id="page_300"></span><code>s.rstrip([chrs])</code></p></td>
            <td><p class="tabtext">Removes trailing whitespace or characters supplied in <code>chrs</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.split([sep [, maxsplit]])</code></p></td>
            <td><p class="tabtext">Splits a string using <code>sep</code> as a delimiter. <code>maxsplit</code> is the maximum number of splits to perform.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.splitlines([keepends])</code></p></td>
            <td><p class="tabtext">Splits a string into a list of lines. If <code>keepends</code> is <code>1</code>, trailing newlines are preserved.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.startswith(prefix [, start [, end]])</code></p></td>
            <td><p class="tabtext">Checks whether a string starts with <code>prefix</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.strip([chrs])</code></p></td>
            <td><p class="tabtext">Removes leading and trailing whitespace or characters supplied in <code>chrs</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.swapcase()</code></p></td>
            <td><p class="tabtext">Converts uppercase to lowercase, and vice versa.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.title()</code></p></td>
            <td><p class="tabtext">Returns a title-cased version of the string.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.translate(table [, deletechars])</code></p></td>
            <td><p class="tabtext">Translates a string using a character translation table <code>table</code>, removing characters in <code>deletechars</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.upper()</code></p></td>
            <td><p class="tabtext">Converts a string to uppercase.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.zfill(width)</code></p></td>
            <td><p class="tabtext">Pads a string with zeros on the left up to the specified <code>width</code>.</p></td>
            </tr>
            </tbody>
            </table>
            </figure>
            <p class="indent">Byte arrays additionally support the methods in <a href="ch10.xhtml#ch10tab02">Table 10.2</a>.</p>
            <figure class="table" id="ch10tab02">
            <figcaption><p class="tab-caption"><span class="ash">Table 10.2</span> Additional Operations on Byte Arrays</p></figcaption>
            <table>
            <thead>
            <tr>
            <th><p class="tabtext">Operation</p></th>
            <th><p class="tabtext">Description</p></th>
            </tr>
            </thead>
            <tbody>
            <tr>
            <td><p class="tabtext"><code>s[i] = v</code></p></td>
            <td><p class="tabtext">Item assignment</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s[i:j] = t</code></p></td>
            <td><p class="tabtext">Slice assignment</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s[i:j:stride] = t</code></p></td>
            <td><p class="tabtext">Extended slice assignment</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>del s[i]</code></p></td>
            <td><p class="tabtext">Item deletion</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>del s[i:j]</code></p></td>
            <td><p class="tabtext">Slice deletion</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>del s[i:j:stride]</code></p></td>
            <td><p class="tabtext">Extended slice deletion</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.append(x)</code></p></td>
            <td><p class="tabtext">Appends a new byte to the end.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.clear()</code></p></td>
            <td><p class="tabtext">Clears the byte array.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.copy()</code></p></td>
            <td><p class="tabtext">Makes a copy.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.extend(t)</code></p></td>
            <td><p class="tabtext">Extends <code>s</code> with bytes from <code>t</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.insert(n, x)</code></p></td>
            <td><p class="tabtext">Inserts byte <code>x</code> at index <code>n</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.pop([n])</code></p></td>
            <td><p class="tabtext">Removes and returns byte at index <code>n</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.remove(x)</code></p></td>
            <td><p class="tabtext">Removes first occurrence of byte <code>x</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.reverse()</code></p></td>
            <td><p class="tabtext">Reverses the byte array in-place.</p></td>
            </tr>
            </tbody>
            </table>
            </figure>
            <pre><span epub:type="pagebreak" id="page_301"></span>callable(obj)</pre>
            <p class="indent1">Returns <code>True</code> if <code>obj</code> is callable as a function.</p>
            <pre>chr(x)</pre>
            <p class="indent1">Converts the integer <code>x</code> representing a Unicode code-point into a single-character string.</p>
            <pre>classmethod(func)</pre>
            <p class="indent1">This decorator creates a class method for the function <code>func</code>. It is typically only used inside class definitions where it is implicitly invoked using <code>@classmethod</code>. Unlike a normal method, a class method receives the class as the first argument, not an instance.</p>
            <pre>compile(string, filename, kind)</pre>
            <p class="indent1">Compiles <code>string</code> into a code object for use with <code>exec()</code> or <code>eval()</code>. <code>string</code> is a string containing valid Python code. If this code spans multiple lines, the lines must be terminated by a single newline (<code>'\n'</code>) and not platform-specific variants (for example, <code>'\r\n'</code> on Windows). <code>filename</code> is a string containing the name of the file in which the string was defined (if any). <code>kind</code> is <code>'exec'</code> for a sequence of statements, <code>'eval'</code> for a single expression, or <code>'single'</code> for a single executable statement. The resulting code object that is returned can be directly passed to <code>exec()</code> or <code>eval()</code> in place of a string.</p>
            <pre>complex([real [, imag]])</pre>
            <p class="indent1">Type representing a complex number with real and imaginary components, <code>real</code> and <code>imag</code>, which can be supplied as any numeric type. If <code>imag</code> is omitted, the imaginary component is set to zero. If <code>real</code> is passed as a string, the string is parsed and converted to a complex number. In this case, <code>imag</code> should be omitted. If <code>real</code> is any other kind of object, the value of <code>real.__complex__()</code> is returned. If no arguments are given, <code>0j</code> is returned.</p>
            <p class="indent"><a href="ch10.xhtml#ch10tab03">Table 10.3</a> shows methods and attributes of <code>complex</code>.</p>
            <figure class="table" id="ch10tab03">
            <figcaption><p class="tab-caption"><span class="ash">Table 10.3</span> Attributes of <code>complex</code></p></figcaption>
            <table>
            <thead>
            <tr>
            <th><p class="tabtext">Attribute/Method</p></th>
            <th><p class="tabtext">Description</p></th>
            </tr>
            </thead>
            <tbody>
            <tr>
            <td><p class="tabtext"><code>z.real</code></p></td>
            <td><p class="tabtext">Real component</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>z.imag</code></p></td>
            <td><p class="tabtext">Imaginary component</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>z.conjugate()</code></p></td>
            <td><p class="tabtext">Conjugates as a complex number.</p></td>
            </tr>
            </tbody>
            </table>
            </figure>
            <p class="codelink"><a href="ch10_images.xhtml#rf0301-01" id="f0301-01">Click here to view code image</a></p>
            <pre>delattr(object, attr)</pre>
            <p class="indent1">Deletes an attribute of an object. <code>attr</code> is a string. Same as <code>del object.attr</code>.</p>
            <p class="codelink"><a href="ch10_images.xhtml#rf0301-02" id="f0301-02">Click here to view code image</a></p>
            <pre>dict([m]) <strong>or</strong> dict(key1=value1, key2=value2, ...)</pre>
            <p class="indent1">Type representing a dictionary. If no argument is given, an empty dictionary is returned. If <code>m</code> is a mapping object (such as another dictionary), a new dictionary <span epub:type="pagebreak" id="page_302"></span>having the same keys and same values as <code>m</code> is returned. For example, if <code>m</code> is a dictionary, <code>dict(m)</code> makes a shallow copy of it. If <code>m</code> is not a mapping, it must support iteration in which a sequence of <code>(key, value)</code> pairs is produced. These pairs are used to populate the dictionary. <code>dict()</code> can also be called with keyword arguments. for example, <code>dict(foo=3, bar=7)</code> creates the dictionary <code>{'foo': 3, 'bar': 7 }</code>.</p>
            <p class="indent"><a href="ch10.xhtml#ch10tab04">Table 10.4</a> shows operations supported by dictionaries.</p>
            <figure class="table" id="ch10tab04">
            <figcaption><p class="tab-caption"><span class="ash">Table 10.4</span> Operations on Dictionaries</p></figcaption>
            <table>
            <thead>
            <tr>
            <th><p class="tabtext">Operation</p></th>
            <th><p class="tabtext">Description</p></th>
            </tr>
            </thead>
            <tbody>
            <tr>
            <td><p class="tabtext"><code>m | n</code></p></td>
            <td><p class="tabtext">Merges <code>m</code> and <code>n</code> into a single dictionary.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>len(m)</code></p></td>
            <td><p class="tabtext">Returns the number of items in <code>m</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>m[k]</code></p></td>
            <td><p class="tabtext">Returns the item of <code>m</code> with key <code>k</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>m[k]=x</code></p></td>
            <td><p class="tabtext">Sets <code>m[k]</code> to <code>x</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>del m[k]</code></p></td>
            <td><p class="tabtext">Removes <code>m[k]</code> from <code>m</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>k in m</code></p></td>
            <td><p class="tabtext">Returns <code>True</code> if <code>k</code> is a key in <code>m</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>m.clear()</code></p></td>
            <td><p class="tabtext">Removes all items from <code>m</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>m.copy()</code></p></td>
            <td><p class="tabtext">Makes a shallow copy of <code>m</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>m.fromkeys(s [, value])</code></p></td>
            <td><p class="tabtext">Creates a new dictionary with keys from sequence <code>s</code> and values all set to value.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>m.get(k [, v])</code></p></td>
            <td><p class="tabtext">Returns <code>m[k]</code> if found; otherwise, returns <code>v</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>m.items()</code></p></td>
            <td><p class="tabtext">Returns <code>(key, value)</code> pairs.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>m.keys()</code></p></td>
            <td><p class="tabtext">Returns the keys.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>m.pop(k [, default])</code></p></td>
            <td><p class="tabtext">Returns <code>m[k]</code> if found and removes it from <code>m</code>; otherwise, returns default if supplied or raises <code>KeyError</code> if not.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>m.popitem()</code></p></td>
            <td><p class="tabtext">Removes a random <code>(key, value)</code> pair from <code>m</code> and returns it as a tuple.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>m.setdefault(k [, v])</code></p></td>
            <td><p class="tabtext">Returns <code>m[k]</code> if found; otherwise, returns <code>v</code> and sets <code>m[k] = v</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>m.update(b)</code></p></td>
            <td><p class="tabtext">Adds all objects from <code>b</code> to <code>m</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>m.values()</code></p></td>
            <td><p class="tabtext">Returns the values.</p></td>
            </tr>
            </tbody>
            </table>
            </figure>
            <pre>dir([object])</pre>
            <p class="indent1">Returns a sorted list of attribute names. If <code>object</code> is a module, it contains the list of symbols defined in that module. If <code>object</code> is a type or class object, it returns a list of attribute names. The names are typically obtained from the object’s <code>__dict__</code> attribute if defined, but other sources may be used. If no argument is given, the names in the current local symbol table are returned. It should be noted that this function is primarily used for informational purposes (for example, used interactively at the command line). It should not be used for formal program analysis because the information obtained may be incomplete. Also, user-defined classes can define a special method <code>__dir__()</code> that alters the result of this function.<span epub:type="pagebreak" id="page_303"></span></p>
            <pre>divmod(a, b)</pre>
            <p class="indent1">Returns the quotient and remainder of long division as a tuple. For integers, the value <code>(a // b, a % b)</code> is returned. For floats, <code>(math.floor(a / b), a % b)</code> is returned. This function may not be called with complex numbers.</p>
            <p class="codelink"><a href="ch10_images.xhtml#rf0303-02" id="f0303-02">Click here to view code image</a></p>
            <pre>enumerate(iter, start=0)</pre>
            <p class="indent1">Given an iterable object, <code>iter</code>, returns a new iterator (of type <code>enumerate</code>) that produces tuples containing a count and the value produced from <code>iter</code>. For example, if <code>iter</code> produces <code>a</code>, <code>b</code>, <code>c</code>, then <code>enumerate(iter)</code> produces <code>(0,a)</code>, <code>(1,b)</code>, <code>(2,c)</code>. The optional <code>start</code> changes the initial value of the count.</p>
            <p class="codelink"><a href="ch10_images.xhtml#rf0303-03" id="f0303-03">Click here to view code image</a></p>
            <pre>eval(expr [, globals [, locals]])</pre>
            <p class="indent1">Evaluates an expression. <code>expr</code> is a string or a code object created by <code>compile()</code>. <code>globals</code> and <code>locals</code> are mapping objects that define the global and local namespaces, respectively, for the operation. If omitted, the expression is evaluated using the values of <code>globals()</code> and <code>locals()</code> as executed in the caller’s environment. It is most common for globals and locals to be specified as dictionaries, but advanced applications can supply custom mapping objects.</p>
            <p class="codelink"><a href="ch10_images.xhtml#rf0303-04" id="f0303-04">Click here to view code image</a></p>
            <pre>exec(code [, global [, locals]])</pre>
            <p class="indent1">Executes Python statements. <code>code</code> is a string, bytes, or a code object created by <code>compile()</code>. <code>globals</code> and <code>locals</code> define the global and local namespaces, respectively, for the operation. If omitted, the code is executed using the values of <code>globals()</code> and <code>locals()</code> as executed in the caller’s environment.</p>
            <p class="codelink"><a href="ch10_images.xhtml#rf0303-05" id="f0303-05">Click here to view code image</a></p>
            <pre>filter(function, iterable)</pre>
            <p class="indent1">Creates an iterator that returns the items in <code>iterable</code> for which <code>function(item)</code> evaluates as <code>True</code>.</p>
            <pre>float([x])</pre>
            <p class="indent1">Type representing a floating-point number. If <code>x</code> is a number, it is converted to a float. If <code>x</code> is a string, it is parsed into a float. For all other objects, <code>x.__float__()</code> is invoked. If no argument is supplied, <code>0.0</code> is returned.</p>
            <p class="indent"><a href="ch10.xhtml#ch10tab05">Table 10.5</a> shows methods and attributes of floats.</p>
            <figure class="table" id="ch10tab05">
            <figcaption><p class="tab-caption"><span class="ash">Table 10.5</span> Methods and Attributes of Floats</p></figcaption>
            <table>
            <thead>
            <tr>
            <th><p class="tabtext">Attribute/Method</p></th>
            <th><p class="tabtext">Description</p></th>
            </tr>
            </thead>
            <tbody>
            <tr>
            <td><p class="tabtext"><code>x.real</code></p></td>
            <td><p class="tabtext">Real component when used as a complex.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>x.imag</code></p></td>
            <td><p class="tabtext">Imaginary component when used as a complex.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>x.conjugate()</code></p></td>
            <td><p class="tabtext">Conjugates as a complex number.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>x.as_integer_ratio()</code></p></td>
            <td><p class="tabtext">Converts to numerator/denominator pair.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>x.hex()</code></p></td>
            <td><p class="tabtext">Creates a hexadecimal representation</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>x.is_integer()</code></p></td>
            <td><p class="tabtext">Tests if an exact integer value.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>float.fromhex(s)</code></p></td>
            <td><p class="tabtext">Creates from a hexadecimal string. A class method.</p></td>
            </tr>
            </tbody>
            </table>
            </figure>
            <pre><span epub:type="pagebreak" id="page_304"></span>format(value [, format_spec])</pre>
            <p class="indent1">Converts <code>value</code> to a formatted string according to the format specification string in <code>format_spec</code>. This operation invokes <code>value.__format__()</code>, which is free to interpret the format specification as it sees fit. For simple types of data, the format specifier typically includes an alignment character of <code>'&lt;'</code>, <code>'&gt;'</code>, or <code>'^'</code>, a number (which indicates the field width), and a character code of <code>'d'</code>, <code>'f'</code>, or <code>'s'</code> for integer, floating point, or string values, respectively. For example, a format specification of <code>'d'</code> formats an integer, a specification of <code>'8d'</code> right-aligns an integer in an 8-character field, and <code>'&lt;8d'</code> left-aligns an integer in an 8-character field. More details on <code>format()</code> and format specifiers can be found in <a href="ch09.xhtml#ch09">Chapter 9</a>.</p>
            <pre>frozenset([items])</pre>
            <p class="indent1">Type representing an immutable set object populated with values taken from <code>items</code> which must be an iterable. The values must also be immutable. If no argument is given, an empty set is returned. A <code>frozenset</code> supports all of the operations found on <code>sets</code> except for any operations that mutate a set in-place.</p>
            <pre>getattr(object, name [,default])</pre>
            <p class="indent1">Returns the value of a named attribute of an object. <code>name</code> is a string containing the attribute name. <code>default</code> is an optional value to return if no such attribute exists; otherwise, <code>AttributeError</code> is raised. Same as accessing <code>object.name</code>.</p>
            <pre>globals()</pre>
            <p class="indent1">Returns the dictionary of the current module that represents the global namespace. When called inside another function or method, it returns the global namespace of the module in which the function or method was defined.</p>
            <pre>hasattr(object, name)</pre>
            <p class="indent1">Returns <code>True</code> if <code>name</code> is the name of an attribute of object. <code>name</code> is a string.</p>
            <pre>hash(object)</pre>
            <p class="indent1">Returns an integer hash value for an object (if possible). The hash value is primarily used in the implementation of dictionaries, sets, and other mapping objects. The hash value is always the same for any objects that compare as equal. Mutable objects usually don’t define a hash value, although user-defined classes can define a method <code>__hash__()</code> to support this operation.</p>
            <pre>hex(x)</pre>
            <p class="indent1">Creates a hexadecimal string from an integer <code>x</code>.</p>
            <pre>id(object)</pre>
            <p class="indent1">Returns the unique integer identity of object. You should not interpret the return value in any way (for example, it’s not a memory location).</p>
            <pre>input([prompt])</pre>
            <p class="indent1">Prints a prompt to standard output and reads a single line of input from standard input. The returned line is not modified in any way. It does not include a line ending (e.g., <code>'\n'</code>).</p>
            <pre><span epub:type="pagebreak" id="page_305"></span>int(x [,base])</pre>
            <p class="indent1">Type representing an integer. If <code>x</code> is a number, it is converted to an integer by truncating towards 0. If it is a string, it is parsed into an integer value. <code>base</code> optionally specifies a base when converting from a string.</p>
            <p class="indent">In addition to their support for common math operations, integers also have a number of attributes and methods listed in <a href="ch10.xhtml#ch10tab06">Table 10.6</a>.</p>
            <figure class="table" id="ch10tab06">
            <figcaption><p class="tab-caption"><span class="ash">Table 10.6</span> Methods and Attributes of Integers</p></figcaption>
            <table>
            <thead>
            <tr>
            <th><p class="tabtext">Operation</p></th>
            <th><p class="tabtext">Description</p></th>
            </tr>
            </thead>
            <tbody>
            <tr>
            <td><p class="tabtext"><code>x.numerator</code></p></td>
            <td><p class="tabtext">Numerator when used as a fraction.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>x.denominator</code></p></td>
            <td><p class="tabtext">Denominator when used as a fraction.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>x.real</code></p></td>
            <td><p class="tabtext">Real component when used as a complex.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>x.imag</code></p></td>
            <td><p class="tabtext">Imaginary component when used as a complex.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>x.conjugate()</code></p></td>
            <td><p class="tabtext">Conjugates as a complex number.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>x.bit_length()</code></p></td>
            <td><p class="tabtext">Number of bits needed to represent the value in binary.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>x.to_bytes(length, byteorder, *, signed=False)</code></p></td>
            <td><p class="tabtext">Converts to bytes.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>int.from_bytes(bytes, byteorder, *, signed=False)</code></p></td>
            <td><p class="tabtext">Converts from bytes. A class method.</p></td>
            </tr>
            </tbody>
            </table>
            </figure>
            <pre>isinstance(object, classobj)</pre>
            <p class="indent1">Returns <code>True</code> if <code>object</code> is an instance of <code>classobj</code> or a subclass of <code>classobj</code>. The <code>classobj</code> parameter can also be a tuple of possible types or classes. For example, <code>isinstance(s, (list, tuple))</code> returns <code>True</code> if <code>s</code> is a tuple or a list.</p>
            <pre>issubclass(class1, class2)</pre>
            <p class="indent1">Returns <code>True</code> if <code>class1</code> is a subclass of (derived from) <code>class2</code>. <code>class2</code> can also be a tuple of possible classes, in which case each class will be checked. Note that <code>issubclass(A, A)</code> is <code>True</code>.</p>
            <pre>iter(object [,sentinel])</pre>
            <p class="indent1">Returns an iterator for producing items in <code>object</code>. If the <code>sentinel</code> parameter is omitted, the object must either provide the method <code>__iter__()</code>, which creates an iterator, or the object must implement <code>__getitem__()</code>, which accepts integer arguments starting at 0. If <code>sentinel</code> is specified, <code>object</code> is interpreted differently. Instead, <code>object</code> should be a callable object that takes no parameters. The returned iterator object will call this function repeatedly until the returned value is equal to <code>sentinel</code>, at which point iteration will stop. A <code>TypeError</code> will be generated if <code>object</code> does not support iteration.</p>
            <pre><span epub:type="pagebreak" id="page_306"></span>len(s)</pre>
            <p class="indent1">Returns the number of items contained in <code>s</code> which should be some kind of container such as a list, tuple, string, set, or dictionary.</p>
            <pre>list([items])</pre>
            <p class="indent1">Type representing a list. <code>items</code> may be any iterable object, the values of which are used to populate the list. If <code>items</code> is already a list, a shallow copy is made. If no argument is given, an empty list is returned.</p>
            <p class="indent"><a href="ch10.xhtml#ch10tab07">Table 10.7</a> shows operations defined on lists.</p>
            <figure class="table" id="ch10tab07">
            <figcaption><p class="tab-caption"><span class="ash">Table 10.7</span> List Operators and Methods</p></figcaption>
            <table>
            <thead>
            <tr>
            <th><p class="tabtext">Operation</p></th>
            <th><p class="tabtext">Description</p></th>
            </tr>
            </thead>
            <tbody>
            <tr>
            <td><p class="tabtext"><code>s + t</code></p></td>
            <td><p class="tabtext">Concatenation if <code>t</code> is a list.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s * n</code></p></td>
            <td><p class="tabtext">Replication if <code>n</code> is an integer.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s[i]</code></p></td>
            <td><p class="tabtext">Returns element <code>i</code> of <code>s</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s[i:j]</code></p></td>
            <td><p class="tabtext">Returns a slice.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s[i:j:stride]</code></p></td>
            <td><p class="tabtext">Returns an extended slice.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s[i] = v</code></p></td>
            <td><p class="tabtext">Item assignment.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s[i:j] = t</code></p></td>
            <td><p class="tabtext">Slice assignment.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s[i:j:stride] = t</code></p></td>
            <td><p class="tabtext">Extended slice assignment.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>del s[i]</code></p></td>
            <td><p class="tabtext">Item deletion.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>del s[i:j]</code></p></td>
            <td><p class="tabtext">Slice deletion.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>del s[i:j:stride]</code></p></td>
            <td><p class="tabtext">Extended slice deletion.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>len(s)</code></p></td>
            <td><p class="tabtext">Number of elements in <code>s</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.append(x)</code></p></td>
            <td><p class="tabtext">Appends a new element, <code>x</code>, to the end of <code>s</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.extend(t)</code></p></td>
            <td><p class="tabtext">Appends a new list, <code>t</code>, to the end of <code>s</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.count(x)</code></p></td>
            <td><p class="tabtext">Counts occurrences of <code>x</code></p></td>
            <td><p class="tabtext">in <code>s</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.index(x [, start [, stop]])</code></p></td>
            <td><p class="tabtext">Returns the smallest <code>i</code> where <code>s[i] == x</code>. <code>start</code> and <code>stop</code> optionally specify the starting and ending index for the search.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.insert(i, x)</code></p></td>
            <td><p class="tabtext">Inserts <code>x</code> at index <code>i</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.pop([i])</code></p></td>
            <td><p class="tabtext">Returns the element <code>i</code> and removes it from the list. If <code>i</code> is omitted, the last element is returned.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.remove(x)</code></p></td>
            <td><p class="tabtext">Searches for <code>x</code> and removes it from <code>s</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.reverse()</code></p></td>
            <td><p class="tabtext">Reverses items of <code>s</code> in place.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.sort([key [, reverse]])</code></p></td>
            <td><p class="tabtext">Sorts items of <code>s</code> in place. <code>key</code> is a key function. <code>reverse</code> is a flag that sorts the list in reverse order. <code>key</code> and <code>reverse</code> should always be specified as keyword arguments.</p></td>
            </tr>
            </tbody>
            </table>
            </figure>
            <pre><span epub:type="pagebreak" id="page_307"></span>locals()</pre>
            <p class="indent1">Returns a dictionary corresponding to the local namespace of the caller. This dictionary should only be used to inspect the execution environment—changes made to the dictionary don’t have any effect on the corresponding local variables.</p>
            <pre>map(function, items, ...)</pre>
            <p class="indent1">Creates an iterator that produces the results of applying <code>function</code> to the items in <code>items</code>. If multiple input sequences are supplied, <code>function</code> is assumed to take that many arguments, with each argument taken from a different sequence. In this case, the result is only as long as the shortest input sequence.</p>
            <p class="codelink"><a href="ch10_images.xhtml#rf0307-03" id="f0307-03">Click here to view code image</a></p>
            <pre>max(s [, args, ...], *, default=obj, key=func)</pre>
            <p class="indent1">For a single argument, <code>s</code>, this function returns the maximum value of the items in <code>s</code>, which may be any iterable object. For multiple arguments, it returns the largest of the arguments. If the keyword-only argument <code>default</code> is given, it supplies the value to return if <code>s</code> is empty. If the keyword-only argument <code>key</code> is given, then the value <code>v</code> for which <code>key(v)</code> returns the maximum value is returned.</p>
            <p class="codelink"><a href="ch10_images.xhtml#rf0307-04" id="f0307-04">Click here to view code image</a></p>
            <pre>min(s [, args, ...], *, default=obj, key=func)</pre>
            <p class="indent1">The same as <code>max(s)</code> except that the minimum value is returned.</p>
            <pre>next(s [, default])</pre>
            <p class="indent1">Returns the next item from the iterator <code>s</code>. If the iterator has no more items, a <code>StopIteration</code> exception is raised unless a value is supplied to the default argument. In that case, <code>default</code> is returned instead.</p>
            <pre>object()</pre>
            <p class="indent1">The base class for all objects in Python. You can call it to create an instance, but the result isn’t especially interesting.</p>
            <pre>oct(x)</pre>
            <p class="indent1">Converts an integer, <code>x</code>, to an octal string.</p>
            <p class="codelink"><a href="ch10_images.xhtml#rf0307-06" id="f0307-06">Click here to view code image</a></p>
            <pre>open(filename [, mode [, bufsize [, encoding [, errors [, newline [, closefd]]]]]])</pre>
            <p class="indent1">Opens the file <code>filename</code> and returns a file object. The arguments are described in detail in <a href="ch09.xhtml#ch09">Chapter 9</a>.</p>
            <pre>ord(c)</pre>
            <p class="indent1">Returns the integer ordinal value of a single character, <code>c</code>. This value usually corresponds to the character’s Unicode code-point value.</p>
            <pre>pow(x, y [, z])</pre>
            <p class="indent1">Returns <code>x ** y</code>. If <code>z</code> is supplied, this function returns <code>(x ** y) % z</code>. If all three arguments are given, they must be integers and <code>y</code> must be non-negative.</p>
            <p class="codelink"><a href="ch10_images.xhtml#rf0308-01" id="f0308-01">Click here to view code image</a></p>
            <pre><span epub:type="pagebreak" id="page_308"></span>print(value, ... , *, sep=separator, end=ending, file=outfile)</pre>
            <p class="indent1">Print a collection of values. As input, you can supply any number of values, all of which are printed on the same line. The <code>sep</code> keyword argument is used to specify a different separator character (a space by default). The <code>end</code> keyword argument specifies a different line ending (<code>'\n'</code> by default). The <code>file</code> keyword argument redirects the output to a file object.</p>
            <p class="codelink"><a href="ch10_images.xhtml#rf0308-02" id="f0308-02">Click here to view code image</a></p>
            <pre>property([fget [,fset [,fdel [,doc]]]])</pre>
            <p class="indent1">Creates a property attribute for classes. <code>fget</code> is a function that returns the attribute value, <code>fset</code> sets the attribute value, and <code>fdel</code> deletes an attribute. <code>doc</code> provides a documentation string. Properties are often specified as a decorator:</p>
            <p class="codelink"><a href="ch10_images.xhtml#rf0308-03" id="f0308-03">Click here to view code image</a></p>
            <pre><span class="lgreen"><strong>class</strong></span> SomeClass:
                x <span class="igrey">=</span> property(doc<span class="igrey">=</span><span class="mblue">'This is property x'</span>)
                <span class="wasabi">@x.getter</span>
                <span class="lgreen"><strong>def</strong></span> x(<span class="dblue">self</span>):
                    print(<span class="mblue">'getting x'</span>)
            
                <span class="wasabi">@x.setter</span>
                <span class="lgreen"><strong>def</strong></span> x(<span class="dblue">self</span>, value):
                    print(<span class="mblue">'setting x to'</span>, value)
            
                <span class="wasabi">@x.deleter</span>
                <span class="lgreen"><strong>def</strong></span> x(<span class="dblue">self</span>):
                    print(<span class="mblue">'deleting x'</span>)</pre>
            <p class="codelink"><a href="ch10_images.xhtml#rf0308-04" id="f0308-04">Click here to view code image</a></p>
            <pre>range([start,] stop [, step])</pre>
            <p class="indent1">Creates a <code>range</code> object that represents a range of integer values from <code>start</code> to <code>stop</code>. <code>step</code> indicates a stride and is set to <code>1</code> if omitted. If <code>start</code> is omitted (when <code>range()</code> is called with one argument), it defaults to <code>0</code>. A negative step creates a list of numbers in descending order.</p>
            <pre>repr(object)</pre>
            <p class="indent1">Returns a string representation of <code>object</code>. In most cases, the returned string is an expression that can be passed to <code>eval()</code> to recreate the object.</p>
            <pre>reversed(s)</pre>
            <p class="indent1">Creates a reverse iterator for sequence <code>s</code>. This function only works if <code>s</code> defines the <code>__reversed__()</code> method or it implements the sequence methods <code>__len__()</code> and <code>__getitem__()</code>. It does not work with generators.</p>
            <pre>round(x [, n])</pre>
            <p class="indent1">Rounds the result of rounding the floating-point number <code>x</code> to the closest multiple of 10 to the power minus <code>n</code>. If <code>n</code> is omitted, it defaults to <code>0</code>. If two multiples are equally close, it rounds towards 0 if the previous digit is even and away from 0 otherwise (for example, <code>0.5</code> is rounded to <code>0.0</code> and <code>1.5</code> is rounded to <code>2</code>).</p>
            <pre><span epub:type="pagebreak" id="page_309"></span>set([items])</pre>
            <p class="indent1">Creates a set populated with items taken from the iterable object <code>items</code>. The items must be immutable. If <code>items</code> contains other sets, those sets must be of type <code>frozenset</code>. If <code>items</code> is omitted, an empty set is returned.</p>
            <p class="indent"><a href="ch10.xhtml#ch10tab08">Table 10.8</a> shows operations on sets.</p>
            <figure class="table" id="ch10tab08">
            <figcaption><p class="tab-caption"><span class="ash">Table 10.8</span> Set Operations and Methods</p></figcaption>
            <table>
            <thead>
            <tr>
            <th><p class="tabtext">Operation</p></th>
            <th><p class="tabtext">Description</p></th>
            </tr>
            </thead>
            <tbody>
            <tr>
            <td><p class="tabtext"><code>s | t</code></p></td>
            <td><p class="tabtext">Union</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s &amp; t</code></p></td>
            <td><p class="tabtext">Intersection</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s - t</code></p></td>
            <td><p class="tabtext">Difference</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s ^ t</code></p></td>
            <td><p class="tabtext">Symmetric difference</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>len(s)</code></p></td>
            <td><p class="tabtext">Returns number of items in <code>s</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.add(item)</code></p></td>
            <td><p class="tabtext">Adds item to <code>s</code>. Has no effect if item is already in <code>s</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.clear()</code></p></td>
            <td><p class="tabtext">Removes all items from <code>s</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.copy()</code></p></td>
            <td><p class="tabtext">Makes a copy of <code>s</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.difference(t)</code></p></td>
            <td><p class="tabtext">Set difference. Returns all the items in <code>s</code>, but not in <code>t</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.difference_update(t)</code></p></td>
            <td><p class="tabtext">Removes all the items from <code>s</code> that are also in <code>t</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.discard(item)</code></p></td>
            <td><p class="tabtext">Removes <code>item</code> from <code>s</code>. If <code>item</code> is not a member of <code>s</code>, nothing happens.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.intersection(t)</code></p></td>
            <td><p class="tabtext">Intersection. Returns all the items that are both in <code>s</code> and in <code>t</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.intersection_update(t)</code></p></td>
            <td><p class="tabtext">Computes the intersection of <code>s</code> and <code>t</code> and leaves the result in <code>s</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.isdisjoint(t)</code></p></td>
            <td><p class="tabtext">Returns <code>True</code> if <code>s</code> and <code>t</code> have no items in common.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.issubset(t)</code></p></td>
            <td><p class="tabtext">Returns <code>True</code> if <code>s</code> is a subset of <code>t</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.issuperset(t)</code></p></td>
            <td><p class="tabtext">Returns <code>True</code> if <code>s</code> is a superset of <code>t</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.pop()</code></p></td>
            <td><p class="tabtext">Returns an arbitrary set element and removes it from <code>s</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.remove(item)</code></p></td>
            <td><p class="tabtext">Removes <code>item</code> from <code>s</code>. If <code>item</code> is not a member, <code>KeyError</code> is raised.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.symmetric_difference(t)</code></p></td>
            <td><p class="tabtext">Symmetric difference. Returns all the items that are in <code>s</code> or <code>t</code>, but not in both sets.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.symmetric_difference_update(t)</code></p></td>
            <td><p class="tabtext">Computes the symmetric difference of <code>s</code> and <code>t</code> and leaves the result in <code>s</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.union(t)</code></p></td>
            <td><p class="tabtext">Union. Returns all items in <code>s</code> or <code>t</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.update(t)</code></p></td>
            <td><p class="tabtext">Adds all the items in <code>t</code> to <code>s</code>. <code>t</code> may be another set, a sequence, or any object that supports iteration.</p></td>
            </tr>
            </tbody>
            </table>
            </figure>
            <p class="codelink"><a href="ch10_images.xhtml#rf0310-01" id="f0310-01">Click here to view code image</a></p>
            <pre><span epub:type="pagebreak" id="page_310"></span>setattr(object, name, value)</pre>
            <p class="indent1">Sets an attribute of an object. <code>name</code> is a string. Same as <code>object.name = value</code>.</p>
            <p class="codelink"><a href="ch10_images.xhtml#rf0310-02" id="f0310-02">Click here to view code image</a></p>
            <pre>slice([start,] stop [, step])</pre>
            <p class="indent1">Returns a slice object representing integers in the specified range. Slice objects are also generated by the extended slice syntax <code>a[i:i:k]</code>.</p>
            <p class="codelink"><a href="ch10_images.xhtml#rf0310-03" id="f0310-03">Click here to view code image</a></p>
            <pre>sorted(iterable, *, key=keyfunc, reverse=reverseflag)</pre>
            <p class="indent1">Creates a sorted list from items in <code>iterable</code>. The keyword argument <code>key</code> is a single-argument function that transforms values before they are compared. The keyword argument <code>reverse</code> is a Boolean flag that specifies whether or not the resulting list is sorted in reverse order. The <code>key</code> and <code>reverse</code> arguments must be specified using keywords—for example, <code>sorted(a, key=get_name)</code>.</p>
            <pre>staticmethod(func)</pre>
            <p class="indent1">Creates a static method for use in classes. This function is usually used as a <code>@staticmethod</code> decorator.</p>
            <pre>str([object])</pre>
            <p class="indent1">Type representing a string. If object is supplied, a string representation of its value is created by calling its <code>__str__()</code> method. This is the same string that you see when you print the object. If no argument is given, an empty string is created.</p>
            <p class="indent"><a href="ch10.xhtml#ch10tab09">Table 10.9</a> shows methods defined on strings.</p>
            <figure class="table" id="ch10tab09">
            <figcaption><p class="tab-caption"><span class="ash">Table 10.9</span> String Operators and Methods</p></figcaption>
            <table>
            <thead>
            <tr>
            <th><p class="tabtext">Operation</p></th>
            <th><p class="tabtext">Description</p></th>
            </tr>
            </thead>
            <tbody>
            <tr>
            <td><p class="tabtext"><code>s + t</code></p></td>
            <td><p class="tabtext">Concatenates strings if <code>t</code> is a string.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s * n</code></p></td>
            <td><p class="tabtext">Replicates a string if <code>n</code> is an integer.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s % x</code></p></td>
            <td><p class="tabtext">Formats a string. <code>x</code> is tuple.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s[i]</code></p></td>
            <td><p class="tabtext">Returns element <code>i</code> of a string.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s[i:j]</code></p></td>
            <td><p class="tabtext">Returns a slice.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s[i:j:stride]</code></p></td>
            <td><p class="tabtext">Returns an extended slice.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>len(s)</code></p></td>
            <td><p class="tabtext">Number of elements in <code>s</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.capitalize()</code></p></td>
            <td><p class="tabtext">Capitalizes the first character.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.casefold()</code></p></td>
            <td><p class="tabtext">Converts <code>s</code> to a string usable for a caseless comparison.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.center(width [, pad])</code></p></td>
            <td><p class="tabtext">Centers the string in a field of length <code>width</code>. <code>pad</code> is a padding character.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.count(sub [, start [, end]])</code></p></td>
            <td><p class="tabtext">Counts occurrences of the specified substring <code>sub</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.decode([encoding [, errors]])</code></p></td>
            <td><p class="tabtext">Decodes a byte string into text (<code>bytes</code> type only).</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.encode([encoding [, errors]])</code></p></td>
            <td><p class="tabtext">Returns an encoded version of the string (<code>str</code> type only).</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><span epub:type="pagebreak" id="page_311"></span><code>s.endswith(suffix [, start [, end]])</code></p></td>
            <td><p class="tabtext">Checks the end of the string for a <code>suffix</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.expandtabs([tabsize])</code></p></td>
            <td><p class="tabtext">Replaces tabs with spaces.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.find(sub [, start [, end]])</code></p></td>
            <td><p class="tabtext">Finds the first occurrence of the specified substring <code>sub</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.format(*args, **kwargs)</code></p></td>
            <td><p class="tabtext">Formats <code>s</code> (<code>str</code> type only).</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.format_map(m)</code></p></td>
            <td><p class="tabtext">Formats <code>s</code> with substitutions taking from the mapping <code>m</code> (<code>str</code> type only).</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.index(sub [, start [, end]])</code></p></td>
            <td><p class="tabtext">Finds the first occurrence or error in the specified substring <code>sub</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.isalnum()</code></p></td>
            <td><p class="tabtext">Checks whether all characters are alphanumeric.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.isalpha()</code></p></td>
            <td><p class="tabtext">Checks whether all characters are alphabetic.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.isascii()</code></p></td>
            <td><p class="tabtext">Checks whether all characters are ASCII.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.isdecimal()</code></p></td>
            <td><p class="tabtext">Checks whether all characters are decimal characters. Does not match superscript, subscripts, or other special digits.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.isdigit()</code></p></td>
            <td><p class="tabtext">Checks whether all characters are digits. Matches superscripts and superscripts, but not vulgar fractions.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.isidentifier()</code></p></td>
            <td><p class="tabtext">Checks whether <code>s</code> is a valid Python identifier.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.islower()</code></p></td>
            <td><p class="tabtext">Checks whether all characters are lowercase.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.isnumeric()</code></p></td>
            <td><p class="tabtext">Checks whether all characters are numeric. Matches all forms of numeric characters such as vulgar fractions, Roman numerals, etc.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.isprintable()</code></p></td>
            <td><p class="tabtext">Checks whether all characters are printable.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.isspace()</code></p></td>
            <td><p class="tabtext">Checks whether all characters are whitespace.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.istitle()</code></p></td>
            <td><p class="tabtext">Checks whether the string is a title-cased string (first letter of each word capitalized).</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.isupper()</code></p></td>
            <td><p class="tabtext">Checks whether all characters are uppercase.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.join(t)</code></p></td>
            <td><p class="tabtext">Joins a sequence of strings <code>t</code> using a delimiter <code>s</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.ljust(width [, fill])</code></p></td>
            <td><p class="tabtext">Left-aligns <code>s</code> in a string of size <code>width</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.lower()</code></p></td>
            <td><p class="tabtext">Converts to lowercase.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.lstrip([chrs])</code></p></td>
            <td><p class="tabtext">Removes leading whitespace or characters supplied in <code>chrs</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.maketrans(x [, y [, z]])</code></p></td>
            <td><p class="tabtext">Makes a translation table for <code>s.translate()</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.partition(sep)</code></p></td>
            <td><p class="tabtext">Partitions a string based on a separator string <code>sep</code>. Returns a tuple <code>(head, sep, tail)</code> or <code>(s, '', '')</code> if <code>sep</code> isn’t found.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><span epub:type="pagebreak" id="page_312"></span><code>s.removeprefix(prefix)</code></p></td>
            <td><p class="tabtext">Returns <code>s</code> with a given <code>prefix</code> removed if present.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.removesuffix(suffix)</code></p></td>
            <td><p class="tabtext">Returns <code>s</code> with a given <code>suffix</code> removed if present.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.replace(old, new [, maxreplace])</code></p></td>
            <td><p class="tabtext">Replaces a substring.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.rfind(sub [, start [, end]])</code></p></td>
            <td><p class="tabtext">Finds the last occurrence of a substring.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.rindex(sub [, start [, end]])</code></p></td>
            <td><p class="tabtext">Finds the last occurrence or raises an error.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.rjust(width [, fill])</code></p></td>
            <td><p class="tabtext">Right-aligns <code>s</code> in a string of length <code>width</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.rpartition(sep)</code></p></td>
            <td><p class="tabtext">Partitions <code>s</code> based on a separator <code>sep</code>, but searches from the end of the string.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.rsplit([sep [, maxsplit]])</code></p></td>
            <td><p class="tabtext">Splits a string from the end of the string using <code>sep</code> as a delimiter. <code>maxsplit</code> is the maximum number of splits to perform. If <code>maxsplit</code> is omitted, the result is identical to the <code>split()</code> method.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.rstrip([chrs])</code></p></td>
            <td><p class="tabtext">Removes trailing whitespace or characters supplied in <code>chrs</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.split([sep [, maxsplit]])</code></p></td>
            <td><p class="tabtext">Splits a string using <code>sep</code> as a delimiter. <code>maxsplit</code> is the maximum number of splits to perform.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.splitlines([keepends])</code></p></td>
            <td><p class="tabtext">Splits a string into a list of lines. If <code>keepends</code> is <code>1</code>, trailing newlines are preserved.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.startswith(prefix [, start [, end]])</code></p></td>
            <td><p class="tabtext">Checks whether a string starts with a <code>prefix</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.strip([chrs])</code></p></td>
            <td><p class="tabtext">Removes leading and trailing whitespace or characters supplied in <code>chrs</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.swapcase()</code></p></td>
            <td><p class="tabtext">Converts uppercase to lowercase, and vice versa.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.title()</code></p></td>
            <td><p class="tabtext">Returns a title-cased version of the string.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.translate(table [, deletechars])</code></p></td>
            <td><p class="tabtext">Translates a string using a character translation table <code>table</code>, removing characters in <code>deletechars</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.upper()</code></p></td>
            <td><p class="tabtext">Converts a string to uppercase.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.zfill(width)</code></p></td>
            <td><p class="tabtext">Pads a string with zeros on the left up to the specified width.</p></td>
            </tr>
            </tbody>
            </table>
            </figure>
            <pre>sum(items [,initial])</pre>
            <p class="indent1">Computes the sum of a sequence of items taken from the iterable object <code>items</code>. <code>initial</code> provides the starting value and defaults to <code>0</code>. This function usually only works with numbers.</p>
            <pre><span epub:type="pagebreak" id="page_313"></span>super()</pre>
            <p class="indent1">Returns an object that represents the collective superclasses of the class in which its used. The primary purpose of this object is to invoke methods in base classes. Here’s an example:</p>
            <p class="codelink"><a href="ch10_images.xhtml#rf0313-01" id="f0313-01">Click here to view code image</a></p>
            <pre><span class="lgreen"><strong>class</strong></span> B(A):
                 <span class="lgreen"><strong>def</strong></span> foo(<span class="dblue">self</span>):
                     super().foo()     <span class="hblue"># Invoke foo() defined by superclasses.</span>
            
            tuple([items])</pre>
            <p class="indent1">Type representing a tuple. If supplied, <code>items</code> is an iterable object that is used to populate the tuple. However, if <code>items</code> is already a tuple, it’s returned unmodified. If no argument is given, an empty tuple is returned.</p>
            <p class="indent"><a href="ch10.xhtml#ch10tab10">Table 10.10</a> shows methods defined on tuples.</p>
            <figure class="table" id="ch10tab10">
            <figcaption><p class="tab-caption"><span class="ash">Table 10.10</span> Tuple Operators and Methods</p></figcaption>
            <table>
            <thead>
            <tr>
            <th><p class="tabtext">Operation</p></th>
            <th><p class="tabtext">Description</p></th>
            </tr>
            </thead>
            <tbody>
            <tr>
            <td><p class="tabtext"><code>s + t</code></p></td>
            <td><p class="tabtext">Concatenation if <code>t</code> is a list.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s * n</code></p></td>
            <td><p class="tabtext">Replication if <code>n</code> is an integer.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s[i]</code></p></td>
            <td><p class="tabtext">Returns element <code>i</code> of a <code>s</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s[i:j]</code></p></td>
            <td><p class="tabtext">Returns a slice.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s[i:j:stride]</code></p></td>
            <td><p class="tabtext">Returns an extended slice.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>len(s)</code></p></td>
            <td><p class="tabtext">Number of elements in <code>s</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.append(x)</code></p></td>
            <td><p class="tabtext">Appends a new element, <code>x</code>, to the end of <code>s</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.count(x)</code></p></td>
            <td><p class="tabtext">Counts occurrences of <code>x</code> in <code>s</code>.</p></td>
            </tr>
            <tr>
            <td><p class="tabtext"><code>s.index(x [, start [, stop]])</code></p></td>
            <td><p class="tabtext">Returns the smallest <code>i</code> where <code>s[i] == x</code>. <code>start</code> and <code>stop</code> optionally specify the starting and ending index for the search.</p></td>
            </tr>
            </tbody>
            </table>
            </figure>
            <pre>type(object)</pre>
            <p class="indent1">The base class of all types in Python. When called as a function, returns the type of <code>object</code>. This type is the same as the object’s class. For common types such as integers, floats, and lists, the type will refer to one of the other built-in classes such as <code>int</code>, <code>float</code>, <code>list</code>, and so forth. For user-defined objects, the type is the associated class. For objects related to Python’s internals, you will typically get a reference to one of the classes defined in the <code>types</code> module.</p>
            <pre>vars([object])</pre>
            <p class="indent1">Returns the symbol table of <code>object</code> (usually found in its <code>__dict__</code> attribute). If no argument is given, a dictionary corresponding to the local namespace is returned. The dictionary returned by this function should be assumed to be read-only. It’s not safe to modify its contents.</p>
            <pre><span epub:type="pagebreak" id="page_314"></span>zip([s1 [, s2 [, ... ]]])</pre>
            <p class="indent1">Creates an iterator that produces tuples containing one item each from <code>s1</code>, <code>s2</code>, and so on. The nth tuple is <code>(s1[n], s2[n], ... )</code>. The resulting iterator stops when the shortest input is exhausted. If no arguments are given, the iterator produces no values.</p>
            </section>
            <section>
            <h3 class="h3" id="ch10lev1sec2">10.2 Built-in Exceptions</h3>
            <p class="noindent">This section describes the built-in exceptions used to report different kinds of errors.</p>
            <section>
            <h4 class="h4" id="ch10lev2sec1">10.2.1 Exception Base Classes</h4>
            <p class="noindent">The following exceptions serve as base classes for all the other exceptions:</p>
            <pre>BaseException</pre>
            <p class="indent1">The root class for all exceptions. All built-in exceptions are derived from this class.</p>
            <pre>Exception</pre>
            <p class="indent1">The base class for all program-related exceptions. That includes all built-in exceptions except for <code>SystemExit</code>, <code>GeneratorExit</code>, and <code>KeyboardInterrupt</code>. User-defined exceptions should inherit from <code>Exception</code>.</p>
            <pre>ArithmeticError</pre>
            <p class="indent1">The base class for arithmetic exceptions, including <code>OverflowError</code>, <code>ZeroDivisionError</code>, and <code>FloatingPointError</code>.</p>
            <pre>LookupError</pre>
            <p class="indent1">The base class for indexing and key errors, including <code>IndexError</code> and <code>KeyError</code>.</p>
            <pre>EnvironmentError</pre>
            <p class="indent1">The base class for errors that occur outside Python. Is a synonym for <code>OSError</code>.</p>
            <p class="indent">The preceding exceptions are never raised explicitly. However, they can be used to catch certain classes of errors. For instance, the following code would catch any sort of numerical error:</p>
            <p class="codelink"><a href="ch10_images.xhtml#rf0314-02" id="f0314-02">Click here to view code image</a></p>
            <pre><span class="lgreen"><strong>try</strong></span>:
                <span class="hblue"># Some operation</span>
                ...
            <span class="lgreen"><strong>except</strong></span> <span class="pgold">ArithmeticError</span> as e:
                <span class="hblue"># Math error</span></pre>
            </section>
            <section>
            <h4 class="h4" id="ch10lev2sec2">10.2.2 Exception Attributes</h4>
            <p class="noindent">Instances of an exception <code>e</code> have a few standard attributes that can be useful to inspect and/or manipulate it in certain applications.</p>
            <pre><span epub:type="pagebreak" id="page_315"></span>e.args</pre>
            <p class="indent1">The tuple of arguments supplied when raising the exception. In most cases, this is a one-item tuple with a string describing the error. For <code>EnvironmentError</code> exceptions, the value is a 2-tuple or 3-tuple containing an integer error number, string error message, and an optional filename. The contents of this tuple might be useful if you need to recreate the exception in a different context—for example, to raise an exception in a different Python interpreter process.</p>
            <pre>e.__cause__</pre>
            <p class="indent1">Previous exception when using explicit chained exceptions.</p>
            <pre>e.__context__</pre>
            <p class="indent1">Previous exception for implicitly chained exceptions.</p>
            <pre>e.__traceback__</pre>
            <p class="indent1">Traceback object associated with the exception.</p>
            </section>
            <section>
            <h4 class="h4" id="ch10lev2sec3">10.2.3 Predefined Exception Classes</h4>
            <p class="noindent">The following exceptions are raised by programs:</p>
            <pre>AssertionError</pre>
            <p class="indent1">Failed assert statement.</p>
            <pre>AttributeError</pre>
            <p class="indent1">Failed attribute reference or assignment.</p>
            <pre>BufferError</pre>
            <p class="indent1">Memory buffer expected.</p>
            <pre>EOFError</pre>
            <p class="indent1">End of file. Generated by the built-in functions <code>input()</code> and <code>raw_input()</code>. It should be noted that most other I/O operations such as the <code>read()</code> and <code>readline()</code> methods of files return an empty string to signal EOF instead of raising an exception.</p>
            <pre>FloatingPointError</pre>
            <p class="indent1">Failed floating-point operation. It should be noted that floating-point exception handling is a tricky problem and this exception only gets raised if Python has been configured and built in a way that enables it. It is more common for floating-point errors to silently produce results such as <code>float('nan')</code> or <code>float('inf')</code>. A subclass of <code>ArithmeticError</code>.</p>
            <pre>GeneratorExit</pre>
            <p class="indent1">Raised inside a generator function to signal termination. This happens when a generator is destroyed prematurely (before all generator values are consumed) or the <code>close()</code> method of a generator is called. If a generator ignores this exception, the generator is terminated, and the exception is silently ignored.</p>
            <pre><span epub:type="pagebreak" id="page_316"></span>IOError</pre>
            <p class="indent1">Failed I/O operation. The value is an <code>IOError</code> instance with the attributes <code>errno</code>, <code>strerror</code>, and <code>filename</code>. <code>errno</code> is an integer error number, <code>strerror</code> is a string error message, and <code>filename</code> is an optional filename. A subclass of <code>EnvironmentError</code>.</p>
            <pre>ImportError</pre>
            <p class="indent1">Raised when an <code>import</code> statement can’t find a module or when <code>from</code> can’t find a name in a module.</p>
            <pre>IndentationError</pre>
            <p class="indent1">Indentation error. A subclass of <code>SyntaxError</code>.</p>
            <pre>IndexError</pre>
            <p class="indent1">Sequence subscript out of range. A subclass of <code>LookupError</code>.</p>
            <pre>KeyError</pre>
            <p class="indent1">Key not found in a mapping. A subclass of <code>LookupError</code>.</p>
            <pre>KeyboardInterrupt</pre>
            <p class="indent1">Raised when the user hits the interrupt key (usually Ctrl+C).</p>
            <pre>MemoryError</pre>
            <p class="indent1">Recoverable out-of-memory error.</p>
            <pre>ModuleNotFoundError</pre>
            <p class="indent1">Module can’t be found by the <code>import</code> statement.</p>
            <pre>NameError</pre>
            <p class="indent1">Name not found in local or global namespaces.</p>
            <pre>NotImplementedError</pre>
            <p class="indent1">Unimplemented feature. Can be raised by base classes that require derived classes to implement certain methods. A subclass of <code>RuntimeError</code>.</p>
            <pre>OSError</pre>
            <p class="indent1">Operating system error. Primarily raised by functions in the <code>os</code> module. The following exceptions are subclasses: <code>BlockingIOError</code>, <code>BrokenPipeError</code>, <code>ChildProcessError</code>, <code>ConnectionAbortedError</code>, <code>ConnectionError</code>, <code>ConnectionRefusedError</code>, <code>ConnectionResetError</code>, <code>FileExistsError</code>, <code>FileNotFoundError</code>, <code>InterruptedError</code>, <code>IsADirectoryError</code>, <code>NotADirectoryError</code>, <code>PermissionError</code>, <code>ProcessLookupError</code>, <code>TimeoutError</code>.</p>
            <pre>OverflowError</pre>
            <p class="indent1">Result of an integer value being too large to be represented. This exception usually only arises if large integer values are passed to objects that internally rely upon fixed-precision machine integers in their implementation. For example, this error can arise with <code>range</code> or <code>xrange</code> objects if you specify starting or ending values that exceed 32 bits in size. A subclass of <code>ArithmeticError</code>.</p>
            <pre><span epub:type="pagebreak" id="page_317"></span>RecursionError</pre>
            <p class="indent1">Recursion limit exceeded.</p>
            <pre>ReferenceError</pre>
            <p class="indent1">Result of accessing a weak reference after the underlying object has been destroyed (see the <code>weakref</code> module).</p>
            <pre>RuntimeError</pre>
            <p class="indent1">A generic error not covered by any of the other categories.</p>
            <pre>StopIteration</pre>
            <p class="indent1">Raised to signal the end of iteration. This normally happens in the <code>next()</code> method of an object or in a generator function.</p>
            <pre>StopAsyncIteration</pre>
            <p class="indent1">Raised to signal the end of asynchronous iteration. Only applicable in the context of <code>async</code> functions and generators.</p>
            <pre>SyntaxError</pre>
            <p class="indent1">Parser syntax error. Instances have the attributes <code>filename</code>, <code>lineno</code>, <code>offset</code>, and <code>text</code>, which can be used to gather more information.</p>
            <pre>SystemError</pre>
            <p class="indent1">Internal error in the interpreter. The value is a string indicating the problem.</p>
            <pre>SystemExit</pre>
            <p class="indent1">Raised by the <code>sys.exit()</code> function. The value is an integer indicating the return code. If it’s necessary to exit immediately, <code>os._exit()</code> can be used.</p>
            <pre>TabError</pre>
            <p class="indent1">Inconsistent tab usage. Generated when Python is run with the <code>-tt</code> option. A subclass of <code>SyntaxError</code>.</p>
            <pre>TypeError</pre>
            <p class="indent1">Occurs when an operation or function is applied to an object of an inappropriate type.</p>
            <pre>UnboundLocalError</pre>
            <p class="indent1">Unbound local variable referenced. This error occurs if a variable is referenced before it’s defined in a function. A subclass of <code>NameError</code>.</p>
            <pre>UnicodeError</pre>
            <p class="indent1">Unicode encoding or decoding error. A subclass of <code>ValueError</code>. The following exceptions are subclasses: <code>UnicodeEncodeError</code>, <code>UnicodeDecodeError</code>, <code>UnicodeTranslateError</code>.</p>
            <pre>ValueError</pre>
            <p class="indent1">Generated when the argument to a function or operation is the right type but an inappropriate value.</p>
            <pre><span epub:type="pagebreak" id="page_318"></span>WindowsError</pre>
            <p class="indent1">Generated by failed system calls on Windows. A subclass of <code>OSError</code>.</p>
            <pre>ZeroDivisionError</pre>
            <p class="indent1">Dividing by zero. A subclass of <code>ArithmeticError</code>.</p>
            </section>
            </section>
            <section>
            <h3 class="h3" id="ch10lev1sec3">10.3 Standard Library</h3>
            <p class="noindent">Python comes with a sizable standard library. Many of these modules have been previously described in the book. Reference material can be found at <code><a href="https://docs.python.org/library">https://docs.python.org/library</a></code>. That material is not repeated here.</p>
            <p class="indent">The modules listed below are notable because they are generally useful for a wide variety of applications and for Python programming in general.</p>
            <section>
            <h4 class="h4" id="ch10lev2sec4">10.3.1 <code>collections</code> Module</h4>
            <p class="noindent">The <code>collections</code> module supplements Python with a variety of additional container objects that can be quite useful for working with data—such as a double-ended queue (<code>deque</code>), dictionaries that automatically initialize missing items (<code>defaultdict</code>), and counters for tabulation (<code>Counter</code>).</p>
            </section>
            <section>
            <h4 class="h4" id="ch10lev2sec5">10.3.2 <code>datetime</code> Module</h4>
            <p class="noindent">The <code>datetime</code> module is where you find functions related to dates, times, and computations involving those things.</p>
            </section>
            <section>
            <h4 class="h4" id="ch10lev2sec6">10.3.3 <code>itertools</code> Module</h4>
            <p class="noindent">The <code>itertools</code> module provides a variety of useful iteration patterns—chaining iterables together, iterating over product sets, permutations, grouping, and similar operations.</p>
            </section>
            <section>
            <h4 class="h4" id="ch10lev2sec7">10.3.4 <code>inspect</code> Module</h4>
            <p class="noindent">The <code>inspect</code> module provides functions for inspecting the internals of code-related elements such as functions, classes, generators, and coroutines. It’s commonly used in metaprogramming by functions that define decorators and similar features.</p>
            </section>
            <section>
            <h4 class="h4" id="ch10lev2sec8">10.3.5 <code>math</code> Module</h4>
            <p class="noindent">The <code>math</code> module provides common mathematical functions such as <code>sqrt()</code>, <code>cos()</code>, and <code>sin()</code>.</p>
            </section>
            <section>
            <h4 class="h4" id="ch10lev2sec9"><span epub:type="pagebreak" id="page_319"></span>10.3.6 <code>os</code> Module</h4>
            <p class="noindent">The <code>os</code> module is where you find low-level functions related to the host operating system—processes, files, pipes, permissions, and similar features.</p>
            </section>
            <section>
            <h4 class="h4" id="ch10lev2sec10">10.3.7 <code>random</code> Module</h4>
            <p class="noindent">The <code>random</code> module provides various functions related to random number generation.</p>
            </section>
            <section>
            <h4 class="h4" id="ch10lev2sec11">10.3.8 <code>re</code> Module</h4>
            <p class="noindent">The <code>re</code> module provides support for working with text via regular expression pattern matching.</p>
            </section>
            <section>
            <h4 class="h4" id="ch10lev2sec12">10.3.9 <code>shutil</code> Module</h4>
            <p class="noindent">The <code>shutil</code> module has functions for performing common tasks related to the shell, such as copying files and directories.</p>
            </section>
            <section>
            <h4 class="h4" id="ch10lev2sec13">10.3.10 <code>statistics</code> Module</h4>
            <p class="noindent">The <code>statistics</code> module provides functions for computing common statistical values such as means, medians, and standard deviation.</p>
            </section>
            <section>
            <h4 class="h4" id="ch10lev2sec14">10.3.11 <code>sys</code> Module</h4>
            <p class="noindent">The <code>sys</code> module contains a variety of attributes and methods related to the runtime environment of Python itself. This includes command-line options, standard I/O streams, the import path, and similar features.</p>
            </section>
            <section>
            <h4 class="h4" id="ch10lev2sec15">10.3.12 <code>time</code> Module</h4>
            <p class="noindent">The <code>time</code> module is where you find various functions related to system time, such as getting the value of the system clock, sleeping, and the number of elapsed CPU seconds.</p>
            </section>
            <section>
            <h4 class="h4" id="ch10lev2sec16">10.3.13 <code>turtle</code> Module</h4>
            <p class="noindent">Turtle graphics. You know, for kids.</p>
            </section>
            <section>
            <h4 class="h4" id="ch10lev2sec17">10.3.14 <code>unittest</code> Module</h4>
            <p class="noindent">The <code>unittest</code> module provides built-in support for writing unit tests. Python itself is tested using <code>unittest</code>. However, many programmers prefer using third-party libraries such as <code>pytest</code> for testing. This author concurs.</p>
            </section>
            </section>
            <section>
            <h3 class="h3" id="ch10lev1sec4"><span epub:type="pagebreak" id="page_320"></span>10.4 Final Words: Use the Built-Ins</h3>
            <p class="noindent">In the modern world where there are hundreds of thousands of Python packages, it is easy for programmers to seek solutions to small problems in the form of third-party package dependencies. However, Python has long had an extremely useful set of built-in functions and datatypes. Combined with modules from the standard library, a wide range of common programming problems can often be solved using nothing beyond what Python already provides. Given a choice, prefer that.</p>
            </section>
            </section>
            </div>
  </body>
</html>
